<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc?>
<?asciidoc-numbered?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
<info>
<title>Reference design specifications</title>
<date>2024-02-20</date>
</info>
<chapter xml:id="telco-ref-design-specs-overview">
<title>Telco core and RAN DU reference design specifications</title>

<simpara>The telco core reference design specification (RDS) describes OpenShift Container Platform 4.14 clusters running on commodity hardware that can support large scale telco applications including control plane and some centralized data plane functions.</simpara>
<simpara>The telco RAN RDS describes the configuration for clusters running on commodity hardware to host 5G workloads in the Radio Access Network (RAN).</simpara>
<section xml:id="telco-ref-design-overview_telco_ref_design_specs">
<title>Reference design specifications for telco 5G deployments</title>
<simpara>Red Hat and certified partners offer deep technical expertise and support for networking and operational capabilities required to run telco applications on OpenShift Container Platform 4.14 clusters.</simpara>
<simpara>Red Hat&#8217;s telco partners require a well-integrated, well-tested, and stable environment that can be replicated at scale for enterprise 5G solutions.
The telco core and RAN DU reference design specifications (RDS) outline the recommended solution architecture based on a specific version of OpenShift Container Platform.
Each RDS describes a tested and validated platform configuration for telco core and RAN DU use models.
The RDS ensures an optimal experience when running your applications by defining the set of critical KPIs for telco 5G core and RAN DU.
Following the RDS minimizes high severity escalations and improves application stability.</simpara>
<simpara>5G use cases are evolving and your workloads are continually changing.
Red Hat is committed to iterating over the telco core and RAN DU RDS to support evolving requirements based on customer and partner feedback.</simpara>
</section>
<section xml:id="telco-ran-core-ref-design-spec_telco_ref_design_specs">
<title>Reference design scope</title>
<simpara>The telco core and telco RAN reference design specifications (RDS) capture the recommended, tested, and supported configurations to get reliable and repeatable performance for clusters running the telco core and telco RAN profiles.</simpara>
<simpara>Each RDS includes the released features and supported configurations that are engineered and validated for clusters to run the individual profiles.
The configurations provide a baseline OpenShift Container Platform installation that meets feature and KPI targets.
Each RDS also describes expected variations for each individual configuration.
Validation of each RDS includes many long duration and at-scale tests.</simpara>
<note>
<simpara>The validated reference configurations are updated for each major Y-stream release of OpenShift Container Platform.
Z-stream patch releases are periodically re-tested against the reference configurations.</simpara>
</note>
</section>
<section xml:id="telco-deviations-from-the-ref-design_telco_ref_design_specs">
<title>Deviations from the reference design</title>
<simpara>Deviating from the validated telco core and telco RAN DU reference design specifications (RDS) can have significant impact beyond the specific component or feature that you change.
Deviations require analysis and engineering in the context of the complete solution.</simpara>
<important>
<simpara>All deviations from the RDS should be analyzed and documented with clear action tracking information.
Due diligence is expected from partners to understand how to bring deviations into line with the reference design.
This might require partners to provide additional resources to engage with Red Hat to work towards enabling their use case to achieve a best in class outcome with the platform.
This is critical for the supportability of the solution and ensuring alignment across Red Hat and with partners.</simpara>
</important>
<simpara>Deviation from the RDS can have some or all of the following consequences:</simpara>
<itemizedlist>
<listitem>
<simpara>It can take longer to resolve issues.</simpara>
</listitem>
<listitem>
<simpara>There is a risk of missing project service-level agreements (SLAs), project deadlines, end provider performance requirements, and so on.</simpara>
</listitem>
<listitem>
<simpara>Unapproved deviations may require escalation at executive levels.</simpara>
<note>
<simpara>Red Hat prioritizes the servicing of requests for deviations based on partner engagement priorities.</simpara>
</note>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="_telco_ran_du_reference_design_specification">
<title>Telco RAN DU reference design specification</title>
<section xml:id="telco-ran-ref-design-spec">
<title>{rds-caps} 4.14 reference design overview</title>

<simpara>The Telco RAN distributed unit (DU) 4.14 reference design configures an OpenShift Container Platform 4.14 cluster running on commodity hardware to host telco RAN DU workloads.
It captures the recommended, tested, and supported configurations to get reliable and repeatable performance for a cluster running the telco RAN DU profile.</simpara>
<section xml:id="telco-ran-414-ref-design-features_ran-ref-design-spec">
<title>OpenShift Container Platform 4.14 features for telco RAN DU</title>
<simpara>The following features that are included in OpenShift Container Platform 4.14 and are leveraged by the telco RAN DU reference design specification (RDS) have been added or updated.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>OpenShift Container Platform 4.14 features for the telco RAN DU RDS</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Feature</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>GitOps ZTP independence from managed cluster version</simpara></entry>
<entry align="left" valign="top"><simpara>You can now use GitOps ZTP to manage clusters that are running different versions of OpenShift Container Platform compared to the version that is running on the hub cluster. You can also have a mix of OpenShift Container Platform versions in the deployed fleet of clusters.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/scalability_and_performance/ztp_far_edge/ztp-preparing-the-hub-cluster.html#ztp-preparing-the-ztp-git-repository-ver-ind_ztp-preparing-the-hub-cluster">Preparing the GitOps ZTP site configuration repository for version independence</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Using custom CRs alongside the reference CRs in GitOps ZTP</simpara></entry>
<entry align="left" valign="top"><simpara>You can now use custom CRs alongside the reference configuration CRs provided in the <literal>ztp-site-generate</literal> container.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/scalability_and_performance/ztp_far_edge/ztp-advanced-policy-config.html#ztp-adding-new-content-to-gitops-ztp_ztp-advanced-policy-config">Adding custom content to the GitOps ZTP pipeline</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Using custom node labels in the <literal>SiteConfig</literal> CR with GitOps ZTP</simpara></entry>
<entry align="left" valign="top"><simpara>you can now use the <literal>nodeLabels</literal> field in the <literal>SiteConfig</literal> CR to create custom roles for nodes in managed clusters.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/scalability_and_performance/ztp_far_edge/ztp-deploying-far-edge-sites.html#ztp-sno-siteconfig-config-reference_ztp-deploying-far-edge-sites">single-node OpenShift SiteConfig CR installation reference</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP events and metrics</simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>PtpConfig</literal> reference configuration CRs have been updated.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/networking/using-ptp.html#discover-ptp-devices_using-ptp">Discovering PTP capable network devices in your cluster</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Precaching user-specified images</simpara></entry>
<entry align="left" valign="top"><simpara>You can now precache application workload images before upgrading your applications on single-node OpenShift clusters with Topology Aware Lifecycle Manager.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/scalability_and_performance/ztp_far_edge/ztp-precaching-tool.html#ztp-pre-staging-tool">Precaching images for single-node OpenShift deployments</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Using OpenShift capabilities to further reduce the single-node OpenShift DU footprint</simpara></entry>
<entry align="left" valign="top"><simpara>Use cluster capabilities to enable or disable optional components before you install the cluster.
In OpenShift Container Platform 4.14, the following optional capabilities are available:
<literal>baremetal</literal>, <literal>marketplace</literal>, <literal>openshift-samples</literal>, <literal>Console</literal>, <literal>Insights</literal>, <literal>Storage</literal>, <literal>CSISnapshot</literal>, <literal>NodeTuning</literal>, <literal>MachineAPI</literal>. The reference configuration includes only those features required for RAN DU.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/installing/cluster-capabilities.html#cluster-capabilities">Cluster capabilities</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="telco-ran-architecture-overview_ran-ref-design-spec">
<title>Deployment architecture overview</title>
<simpara>You deploy the telco RAN DU 4.14 reference configuration to managed clusters from a centrally managed RHACM hub cluster.
The reference design specification (RDS) includes configuration of the managed clusters and the hub cluster components.</simpara>
<figure>
<title>Telco RAN DU deployment architecture overview</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/474_OpenShift_OpenShift_RAN_RDS_arch_updates_1023.png" contentwidth="one show how the hub cluster uses Red Hat OpenShift GitOps to install managed clusters" contentdepth="and the other showing how the hub cluster uses Topology Aware Lifecycle Manager to apply policies to managed clusters"/>
</imageobject>
<textobject><phrase>A diagram showing two distinctive network far edge deployment processes</phrase></textobject>
</mediaobject>
</figure>
</section>
</section>
<section xml:id="telco-ran-du-overview">
<title>Telco RAN DU use model overview</title>

<simpara>Use the following information to plan telco RAN DU workloads, cluster resources, and hardware specifications for the hub cluster and managed single-node OpenShift clusters.</simpara>
<section xml:id="telco-du-workloads_ran-ref-design-overview">
<title>Telco RAN DU application workloads</title>
<simpara>DU worker nodes must have 3rd Generation Xeon (Ice Lake) 2.20 GHz or better CPUs with firmware tuned for maximum performance.</simpara>
<simpara>5G RAN DU user applications and workloads should conform to the following best practices and application limits:</simpara>
<itemizedlist>
<listitem>
<simpara>Develop cloud-native network functions (CNFs) that conform to the latest version of the <link xlink:href="https://test-network-function.github.io/cnf-best-practices/">CNF best practices guide</link>.</simpara>
</listitem>
<listitem>
<simpara>Use SR-IOV for high performance networking.</simpara>
</listitem>
<listitem>
<simpara>Use exec probes sparingly and only when no other suitable options are available</simpara>
<itemizedlist>
<listitem>
<simpara>Do not use exec probes if a CNF uses CPU pinning.
Use other probe implementations, for example, <literal>httpGet</literal> or <literal>tcpSocket</literal>.</simpara>
</listitem>
<listitem>
<simpara>When you need to use exec probes, limit the exec probe frequency and quantity.
The maximum number of exec probes must be kept below 10, and frequency must not be set to less than 10 seconds.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="telco-reference-application-workload-characteristics_ran-ref-design-overview">
<title>Telco RAN DU representative reference application workload characteristics</title>
<simpara>The representative reference application workload has the following characteristics:</simpara>
<itemizedlist>
<listitem>
<simpara>Has a maximum of 15 pods and 30 containers for the vRAN application including its management and control functions</simpara>
</listitem>
<listitem>
<simpara>Uses a maximum of 2 <literal>ConfigMap</literal> and 4 <literal>Secret</literal> CRs per pod</simpara>
</listitem>
<listitem>
<simpara>Uses a maximum of 10 exec probes with a frequency of not less than 10 seconds</simpara>
</listitem>
<listitem>
<simpara>Incremental application load on the <literal>kube-apiserver</literal> is less than 10% of the cluster platform usage</simpara>
<note>
<simpara>You can extract CPU load can from the platform metrics.
For example:</simpara>
<programlisting language="text" linenumbering="unnumbered">query=avg_over_time(pod:container_cpu_usage:sum{namespace="openshift-kube-apiserver"}[30m])</programlisting>
</note>
</listitem>
<listitem>
<simpara>Application logs are not collected by the platform log collector</simpara>
</listitem>
<listitem>
<simpara>Aggregate traffic on the primary CNI is less than 1 MBps</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="telco-ran-managed-cluster-resources_ran-ref-design-overview">
<title>Telco RAN DU worker node cluster resource utilization</title>
<simpara>The maximum number of running pods in the system, inclusive of application workloads and OpenShift Container Platform pods, is 120.</simpara>
<variablelist>
<varlistentry>
<term>Resource utilization</term>
<listitem>
<simpara>OpenShift Container Platform resource utilization varies depending on many factors including application workload characteristics such as:</simpara>
<itemizedlist>
<listitem>
<simpara>Pod count</simpara>
</listitem>
<listitem>
<simpara>Type and frequency of probes</simpara>
</listitem>
<listitem>
<simpara>Messaging rates on primary CNI or secondary CNI with kernel networking</simpara>
</listitem>
<listitem>
<simpara>API access rate</simpara>
</listitem>
<listitem>
<simpara>Logging rates</simpara>
</listitem>
<listitem>
<simpara>Storage IOPS</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<simpara>Cluster resource requirements are applicable under the following conditions:</simpara>
<itemizedlist>
<listitem>
<simpara>The cluster is running the described representative application workload.</simpara>
</listitem>
<listitem>
<simpara>The cluster is managed with the constraints described in <link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-validation-artifacts.html#telco-ran-hub-cluster-management_ran-ref-design-overview">Hub cluster management resources</link>.</simpara>
</listitem>
<listitem>
<simpara>Components noted as optional in the RAN DU use model configuration are not applied.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>You will need to do additional analysis to determine the impact on resource utilization and ability to meet KPI targets for configurations outside the scope of the Telco RAN DU reference design.
You might have to allocate additional resources in the cluster depending on your requirements.</simpara>
</important>
</section>
<section xml:id="telco-ran-hub-cluster-management_ran-ref-design-overview">
<title>Hub cluster management characteristics</title>
<simpara>Red Hat Advanced Cluster Management (RHACM) is the recommended cluster management solution.
Configure it to the following limits on the hub cluster:</simpara>
<itemizedlist>
<listitem>
<simpara>Configure a maximum of 5 RHACM policies with a compliant evaluation interval of at least 10 minutes.</simpara>
</listitem>
<listitem>
<simpara>Use a maximum of 10 managed cluster templates in policies.
Where possible, use hub-side templating.</simpara>
</listitem>
<listitem>
<simpara>Disable all RHACM add-ons except for the <literal>policy-controller</literal> and <literal>observability-controller</literal> add-ons.
Set <literal>Observability</literal> to the default configuration.</simpara>
<important>
<simpara>Configuring optional components or enabling additional features will result in additional resource usage and can reduce overall system performance.</simpara>
<simpara>For more information, see <link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-components.xml#telco-reference-ran-du-deployment-components_ran-ref-design-components">Reference design deployment components</link>.</simpara>
</important>
</listitem>
</itemizedlist>
<table frame="all" rowsep="1" colsep="1">
<title>OpenShift platform resource utilization under reference application load</title>
<?dbhtml table-width="90%"?>
<?dbfo table-width="90%"?>
<?dblatex table-width="90%"?>
<tgroup cols="3">
<colspec colname="col_1" colwidth="63.7497*"/>
<colspec colname="col_2" colwidth="127.4998*"/>
<colspec colname="col_3" colwidth="191.2503*"/>
<thead>
<row>
<entry align="left" valign="top">Metric</entry>
<entry align="left" valign="top">Limit</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>CPU usage</simpara></entry>
<entry align="left" valign="top"><simpara>Less than 4000 mc – 2 cores (4 hyperthreads)</simpara></entry>
<entry align="left" valign="top"><simpara>Platform CPU is pinned to reserved cores, including both hyperthreads in each reserved core. The system is engineered to use 3 CPUs (3000mc) at steady-state to allow for periodic system tasks and spikes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Memory used</simpara></entry>
<entry align="left" valign="top"><simpara>Less than 16G</simpara></entry>
<entry align="left" valign="top"></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="telco-ran-du-reference-components_ran-ref-design-overview">
<title>Telco RAN DU RDS components</title>
<simpara>The following sections describe the various OpenShift Container Platform components and configurations that you use to configure and deploy clusters to run telco RAN DU workloads.</simpara>
<figure>
<title>Telco RAN DU reference design components</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/319_OpenShift_PTP_bare-metal_OCP_nodes_1023_RAN_DU.png"/>
</imageobject>
<textobject><phrase>A diagram describing the telco RAN DU component stack.</phrase></textobject>
</mediaobject>
</figure>
<note>
<simpara>Ensure that components that are not included in the telco RAN DU profile do not affect the CPU resources allocated to workload applications.</simpara>
</note>
<important>
<simpara>Out of tree drivers are not supported.</simpara>
</important>
</section>
<section xml:id="telco-ran-measured-kpi-results_ran-ref-design-overview">
<title>KPI test results overview</title>
<simpara>All results are taken from 12-hour test runs.</simpara>
<variablelist>
<varlistentry>
<term>Realtime kernel KPI test</term>
<listitem>
<simpara>Workload nodes running the realtime kernel are validated to these performance KPIs:</simpara>
<itemizedlist>
<listitem>
<simpara>No <literal>oslat</literal> samples greater than 20µs.</simpara>
</listitem>
<listitem>
<simpara>99.9999% of <literal>cyclictest</literal> samples are less than 10µs. No samples above 20µs.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Non-realtime kernel KPI test</term>
<listitem>
<simpara>The non-realtime kernel can be run with a reduced predictable latency target.
The following performance KPIs are validated:</simpara>
<itemizedlist>
<listitem>
<simpara>No <literal>oslat</literal> samples above 20µs.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara><literal>cyclictest</literal> tests are not applicable for non-realtime systems.</simpara>
</note>
<variablelist>
<varlistentry>
<term>RFC2544 KPI test</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Zero packet loss at 99.9% line rate (25 Gbps) for 512 byte frames.</simpara>
</listitem>
<listitem>
<simpara>Packet latency is less than 30µs at 80% line rate for 512 byte frames over 12 hour test.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara>The test application is the DPDK <literal>testpmd</literal> utility.</simpara>
</note>
<variablelist>
<varlistentry>
<term>PTP network synchronization</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The time offset for boundary and ordinary clock configurations, as measured at the follower port on the Intel E810-XXVDA4 (Salem Channel) NIC is less than 100 ns as indicated by the <literal>openshift_ptp_offset_ns</literal> metric.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="telco-ran-ref-du-components">
<title>Telco RAN DU 4.14 reference design components</title>

<simpara>The following sections describe the various OpenShift Container Platform components and configurations that you use to configure and deploy clusters to run RAN DU workloads.</simpara>
<section xml:id="telco-ran-bios-tuning_ran-ref-design-components">
<title>Host firmware tuning</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Configure system level performance.
See <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-reference-cluster-configuration-for-vdu.html#ztp-du-configuring-host-firmware-requirements_sno-configure-for-vdu">Configuring host firmware for low latency and high performance</link> for recommended settings.</simpara>
<simpara>If Ironic inspection is enabled, the firmware setting values are available from the per-cluster <literal>BareMetalHost</literal> CR on the hub cluster.
You enable Ironic inspection with a label in the <literal>spec.clusters.nodes</literal> field in the <literal>SiteConfig</literal> CR that you use to install the cluster.
For example:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">nodes:
  - hostName: "example-node1.example.com"
    ironicInspect: "enabled"</programlisting>
<note>
<simpara>The telco RAN DU reference <literal>SiteConfig</literal> does not enable the <literal>ironicInspect</literal> field by default.</simpara>
</note>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Hyperthreading must be enabled</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Tune all settings for maximum performance</simpara>
<note>
<simpara>You can tune firmware selections for power savings at the expense of performance as required.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-node-tuning-operator_ran-ref-design-components">
<title>Node Tuning Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>You tune the cluster performance by <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/cnf-create-performance-profiles.html">creating a performance profile</link>.
Settings that you configure with a performance profile include:</simpara>
<itemizedlist>
<listitem>
<simpara>Selecting the realtime or non-realtime kernel.</simpara>
</listitem>
<listitem>
<simpara>Allocating cores to a reserved or isolated <literal>cpuset</literal>.
OpenShift Container Platform processes allocated to the management workload partition are pinned to reserved set.</simpara>
</listitem>
<listitem>
<simpara>Enabling kubelet features (CPU manager, topology manager, and memory manager).</simpara>
</listitem>
<listitem>
<simpara>Configuring huge pages.</simpara>
</listitem>
<listitem>
<simpara>Setting additional kernel arguments.</simpara>
</listitem>
<listitem>
<simpara>Setting per-core power tuning and max CPU frequency.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<simpara>The Node Tuning Operator uses the <literal>PerformanceProfile</literal> CR to configure the cluster. You need to configure the following settings in the RAN DU profile <literal>PerformanceProfile</literal> CR:</simpara>
<itemizedlist>
<listitem>
<simpara>Select reserved and isolated cores and ensure that you allocate at least 4 hyperthreads (equivalent to 2 cores) on Intel 3rd Generation Xeon (Ice Lake) 2.20 GHz CPUs or better with firmware tuned for maximum performance.</simpara>
</listitem>
<listitem>
<simpara>Set the reserved <literal>cpuset</literal> to include both hyperthread siblings for each included core.
Unreserved cores are available as allocatable CPU for scheduling workloads.
Ensure that hyperthread siblings are not split across reserved and isolated cores.</simpara>
</listitem>
<listitem>
<simpara>Configure reserved and isolated CPUs to include all threads in all cores based on what you have set as reserved and isolated CPUs.</simpara>
</listitem>
<listitem>
<simpara>Set core 0 of each NUMA node to be included in the reserved CPU set.</simpara>
</listitem>
<listitem>
<simpara>Set the huge page size to 1G.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara>You should not add additional workloads to the management partition.
Only those pods which are part of the OpenShift management platform should be annotated into the management partition.</simpara>
</note>
<variablelist>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>You should use the RT kernel to meet performance requirements.</simpara>
<note>
<simpara>You can use the non-RT kernel if required.</simpara>
</note>
</listitem>
<listitem>
<simpara>The number of huge pages that you configure depends on the application workload requirements.
Variation in this parameter is expected and allowed.</simpara>
</listitem>
<listitem>
<simpara>Variation is expected in the configuration of reserved and isolated CPU sets based on selected hardware and additional components in use on the system.
Variation must still meet the specified limits.</simpara>
</listitem>
<listitem>
<simpara>Hardware without IRQ affinity support impacts isolated CPUs.
To ensure that pods with guaranteed whole CPU QoS have full use of the allocated CPU, all hardware in the server must support IRQ affinity.
For more information, see <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/cnf-low-latency-tuning.html#about_irq_affinity_setting_cnf-master">About support of IRQ affinity setting</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara>In OpenShift Container Platform 4.14, any <literal>PerformanceProfile</literal> CR configured on the cluster causes the Node Tuning Operator to automatically set all cluster nodes to use cgroup v1.</simpara>
<simpara>For more information about cgroups, see <link xlink:href="https://docs.openshift.com/container-platform/4.15/nodes/clusters/nodes-cluster-cgroups-2.html#nodes-clusters-cgroups-2_nodes-cluster-cgroups-2">Configuring Linux cgroup</link>.</simpara>
</note>
</section>
<section xml:id="telco-ran-ptp-operator_ran-ref-design-components">
<title>PTP Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>PTP grandmaster clock (T-GM) GPS timing with Intel E810-XXV-4T Westport Channel NIC – minimum firmware version 4.30 (Technology Preview)</simpara>
</listitem>
<listitem>
<simpara>PTP events and metrics for grandmaster (T-GM) are new in  OpenShift Container Platform 4.14 (Technology Preview)</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Configure of <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-reference-cluster-configuration-for-vdu.html#ztp-sno-du-configuring-ptp_sno-configure-for-vdu">PTP timing</link> support for cluster nodes.
The DU node can run in the following modes:</simpara>
<itemizedlist>
<listitem>
<simpara>As an ordinary clock synced to a T-GM or boundary clock (T-BC)</simpara>
</listitem>
<listitem>
<simpara>As dual boundary clocks, one per NIC (high availability is not supported)</simpara>
</listitem>
<listitem>
<simpara>As grandmaster clock with support for E810 Westport Channel NICs (Technology Preview)</simpara>
</listitem>
<listitem>
<simpara>Optionally as a boundary clock for radio units (RUs)</simpara>
</listitem>
</itemizedlist>
<simpara>Optional: subscribe applications to PTP events that happen on the node that the application is running.
You subscribe the application to events via HTTP.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>High availability is not supported with dual NIC configurations.</simpara>
</listitem>
<listitem>
<simpara>Westport Channel NICs configured as T-GM do not support DPLL with the current ice driver version.</simpara>
</listitem>
<listitem>
<simpara>GPS offsets are not reported.
Use a default offset of less than or equal to 5.</simpara>
</listitem>
<listitem>
<simpara>DPLL offsets are not reported.
Use a default offset of less than or equal to 5.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Configurations are provided for ordinary clock, boundary clock, or grandmaster clock</simpara>
</listitem>
<listitem>
<simpara>PTP fast event notifications uses <literal>ConfigMap</literal> CRs to store PTP event subscriptions.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-sr-iov-operator_ran-ref-design-components">
<title>SR-IOV Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The SR-IOV Operator provisions and configures the SR-IOV CNI and device plugins.
Both <literal>netdevice</literal> (kernel VFs) and <literal>vfio</literal> (DPDK) devices are supported.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Customer variation on the configuration and number of <literal>SriovNetwork</literal> and <literal>SriovNetworkNodePolicy</literal> custom resources (CRs) is expected.</simpara>
</listitem>
<listitem>
<simpara>IOMMU kernel command line settings are applied with a <literal>MachineConfig</literal> CR at install time. This ensures that the <literal>SriovOperator</literal> CR does not cause a reboot of the node when adding them.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-logging_ran-ref-design-components">
<title>Logging</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Vector is now the recommended log collector.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Use logging to collect logs from the far edge node for remote analysis.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Handling logs beyond the infrastructure and audit logs, for example, from the application workload requires additional CPU and network bandwidth based on additional logging rate.</simpara>
</listitem>
<listitem>
<simpara>As of OpenShift Container Platform 4.14, vector is the reference log collector.</simpara>
<note>
<simpara>Use of fluentd in the RAN use model is deprecated.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-sriov-fec-operator_ran-ref-design-components">
<title>SRIOV-FEC Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>SRIOV-FEC Operator is an optional 3rd party Certified Operator supporting FEC accelerator hardware.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Starting with FEC Operator v2.7.0:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>SecureBoot</literal> is supported</simpara>
</listitem>
<listitem>
<simpara>The <literal>vfio</literal> driver for the <literal>PF</literal> requires the usage of <literal>vfio-token</literal> that is injected into Pods.
The <literal>VF</literal> token can be passed to DPDK by using the EAL parameter <literal>--vfio-vf-token</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The SRIOV-FEC Operator uses CPU cores from the <literal>isolated</literal> CPU set.</simpara>
</listitem>
<listitem>
<simpara>You can validate FEC readiness as part of the pre-checks for application deployment, for example, by extending the validation policy.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-local-storage-operator_ran-ref-design-components">
<title>Local Storage Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>You can create persistent volumes that can be used as <literal>PVC</literal> resources by applications with the Local Storage Operator.
The number and type of <literal>PV</literal> resources that you create depends on your requirements.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Create backing storage for <literal>PV</literal> CRs before creating the <literal>PV</literal>.
This can be a partition, a local volume, LVM volume, or full disk.</simpara>
</listitem>
<listitem>
<simpara>Refer to the device listing in <literal>LocalVolume</literal> CRs by the hardware path used to access each device to ensure correct allocation of disks and partitions.
Logical names (for example, <literal>/dev/sda</literal>) are not guaranteed to be consistent across node reboots.</simpara>
<simpara>For more information, see the <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_file_systems/assembly_overview-of-persistent-naming-attributes_managing-file-systems#device-identifiers_assembly_overview-of-persistent-naming-attributes">RHEL 9 documentation on device identifiers</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-lvms-operator_ran-ref-design-components">
<title>LVMS Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Simplified LVMS <literal>deviceSelector</literal> logic</simpara>
</listitem>
<listitem>
<simpara>LVM Storage with <literal>ext4</literal> and <literal>PV</literal> resources</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara>LVMS Operator is an optional component.</simpara>
</note>
<variablelist>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The LVMS Operator provides dynamic provisioning of block and file storage.
The LVMS Operator creates logical volumes from local devices that can be used as <literal>PVC</literal> resources by applications.
Volume expansion and snapshots are also possible.</simpara>
<simpara>The following example configuration creates a <literal>vg1</literal> volume group that leverages all available disks on the node except the installation disk:</simpara>
<formalpara>
<title>StorageLVMCluster.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: lvm.topolvm.io/v1alpha1
kind: LVMCluster
metadata:
  name: storage-lvmcluster
  namespace: openshift-storage
  annotations:
    ran.openshift.io/ztp-deploy-wave: "10"
spec: {}
  storage:
    deviceClasses:
    - name: vg1
      thinPoolConfig:
        name: thin-pool-1
        sizePercent: 90
        overprovisionRatio: 10</programlisting>
</para>
</formalpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>In single-node OpenShift clusters, persistent storage must be provided  by either LVMS or Local Storage, not both.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The LVMS Operator is not the reference storage solution for the DU use case.
If you require LVMS Operator for application workloads, the resource use is accounted for against the application cores.</simpara>
</listitem>
<listitem>
<simpara>Ensure that sufficient disks or partitions are available for storage requirements.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-workload-partitioning_ran-ref-design-components">
<title>Workload partitioning</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Workload partitioning pins OpenShift platform and Day 2 Operator pods that are part of the DU profile to the reserved <literal>cpuset</literal> and removes the reserved CPU from node accounting.
This leaves all unreserved CPU cores available for user workloads.</simpara>
<simpara>The method of enabling and configuring workload partitioning changed in OpenShift Container Platform 4.14.</simpara>
<variablelist>
<varlistentry>
<term>4.14 and later</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Configure partitions by setting installation parameters:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">cpuPartitioningMode: AllNodes</programlisting>
</listitem>
<listitem>
<simpara>Configure management partition cores with the reserved CPU set in the <literal>PerformanceProfile</literal> CR</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>4.13 and earlier</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Configure partitions with extra <literal>MachineConfiguration</literal> CRs applied at install-time</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara><literal>Namespace</literal> and <literal>Pod</literal> CRs must be annotated to allow the pod to be applied to the management partition</simpara>
</listitem>
<listitem>
<simpara>Pods with CPU limits cannot be allocated to the partition.
This is because mutation can change the pod QoS.</simpara>
</listitem>
<listitem>
<simpara>For more information about the minimum number of CPUs that can be allocated to the management partition, see <link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-components.xml#telco-ran-node-tuning-operator_ran-ref-design-components">Node Tuning Operator</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Workload Partitioning pins all management pods to reserved cores.
A sufficient number of cores must be allocated to the reserved set to account for operating system, management pods, and expected spikes in CPU use that occur when the workload starts, the node reboots, or other system events happen.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-cluster-tuning_ran-ref-design-components">
<title>Cluster tuning</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>You can remove the Image Registry Operator by using the cluster capabilities feature.</simpara>
<note>
<simpara>You configure cluster capabilities by using the <literal>spec.clusters.installConfigOverrides</literal> field in the <literal>SiteConfig</literal> CR that you use to install the cluster.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The cluster capabilities feature now includes a <literal>MachineAPI</literal> component which, when excluded, disables the following Operators and their resources in the cluster:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>openshift/cluster-autoscaler-operator</literal></simpara>
</listitem>
<listitem>
<simpara><literal>openshift/cluster-control-plane-machine-set-operator</literal></simpara>
</listitem>
<listitem>
<simpara><literal>openshift/machine-api-operator</literal></simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Cluster capabilities are not available for installer-provisioned installation methods.</simpara>
</listitem>
<listitem>
<simpara>You must apply all platform tuning configurations.
The following table lists the required platform tuning configurations:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Cluster capabilities configurations</title>
<?dbhtml table-width="90%"?>
<?dbfo table-width="90%"?>
<?dblatex table-width="90%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="191.25*"/>
<colspec colname="col_2" colwidth="191.25*"/>
<thead>
<row>
<entry align="left" valign="top">Feature</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Remove optional cluster capabilities</simpara></entry>
<entry align="left" valign="top"><simpara>Reduce the OpenShift Container Platform footprint by disabling optional cluster Operators on single-node OpenShift clusters only.</simpara>
<itemizedlist>
<listitem>
<simpara>Remove all optional Operators except the Marketplace and Node Tuning Operators.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Configure cluster monitoring</simpara></entry>
<entry align="left" valign="top"><simpara>Configure the monitoring stack for reduced footprint by doing the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Disable the local <literal>alertmanager</literal> and <literal>telemeter</literal> components.</simpara>
</listitem>
<listitem>
<simpara>If you use RHACM observability, the CR must be augmented with appropriate <literal>additionalAlertManagerConfigs</literal> CRs to forward alerts to the hub cluster.</simpara>
</listitem>
<listitem>
<simpara>Reduce the <literal>Prometheus</literal> retention period to 24h.</simpara>
<note>
<simpara>The RHACM hub cluster aggregates managed cluster metrics.</simpara>
</note>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disable networking diagnostics</simpara></entry>
<entry align="left" valign="top"><simpara>Disable networking diagnostics for single-node OpenShift because they are not required.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Configure a single Operator Hub catalog source</simpara></entry>
<entry align="left" valign="top"><simpara>Configure the cluster to use a single catalog source that contains only the Operators required for a RAN DU deployment.
Each catalog source increases the CPU use on the cluster.
Using a single <literal>CatalogSource</literal> fits within the platform CPU budget.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-machine-configuration_ran-ref-design-components">
<title>Machine configuration</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Set <literal>rcu_normal</literal> after node recovery</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The CRI-O wipe disable <literal>MachineConfig</literal> assumes that images on disk are static other than during scheduled maintenance in defined maintenance windows.
To ensure the images are static, do not set the pod <literal>imagePullPolicy</literal> field to <literal>Always</literal>.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Machine configuration options</title>
<?dbhtml table-width="90%"?>
<?dbfo table-width="90%"?>
<?dblatex table-width="90%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="191.25*"/>
<colspec colname="col_2" colwidth="191.25*"/>
<thead>
<row>
<entry align="left" valign="top">Feature</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Container runtime</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the container runtime to <literal>crun</literal> for all node roles.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>kubelet config and container mount hiding</simpara></entry>
<entry align="left" valign="top"><simpara>Reduces the frequency of kubelet housekeeping and eviction monitoring to reduce CPU usage.
Create a container mount namespace, visible to kubelet and CRI-O, to reduce system mount scanning resource usage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SCTP</simpara></entry>
<entry align="left" valign="top"><simpara>Optional configuration (enabled by default)
Enables SCTP. SCTP is required by RAN applications but disabled by default in RHCOS.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>kdump</simpara></entry>
<entry align="left" valign="top"><simpara>Optional configuration (enabled by default)
Enables kdump to capture debug information when a kernel panic occurs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CRI-O wipe disable</simpara></entry>
<entry align="left" valign="top"><simpara>Disables automatic wiping of the CRI-O image cache after unclean shutdown.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV-related kernel arguments</simpara></entry>
<entry align="left" valign="top"><simpara>Includes additional SR-IOV related arguments in the kernel command line.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>RCU Normal systemd service</simpara></entry>
<entry align="left" valign="top"><simpara>Sets <literal>rcu_normal</literal> after the system is fully started.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>One-shot time sync</simpara></entry>
<entry align="left" valign="top"><simpara>Runs a one-time system time synchronization job for control plane or worker nodes.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-reference-ran-du-deployment-components_ran-ref-design-components">
<title>Reference design deployment components</title>
<simpara>The following sections describe the various OpenShift Container Platform components and configurations that you use to configure the hub cluster with Red Hat Advanced Cluster Management (RHACM).</simpara>
<section xml:id="telco-ran-red-hat-advanced-cluster-management-rhacm_ran-ref-design-components">
<title>Red Hat Advanced Cluster Management (RHACM)</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Additional node labels can be configured during installation.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>RHACM provides Multi Cluster Engine (MCE) installation and ongoing lifecycle management functionality for deployed clusters.
You declaratively specify configurations and upgrades with <literal>Policy</literal> CRs and apply the policies to clusters with the RHACM policy controller as managed by Topology Aware Lifecycle Manager.</simpara>
<itemizedlist>
<listitem>
<simpara>GitOps Zero Touch Provisioning (ZTP) uses the MCE feature of RHACM</simpara>
</listitem>
<listitem>
<simpara>Configuration, upgrades, and cluster status are managed with the RHACM policy controller</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>A single hub cluster supports up to 3500 deployed single-node OpenShift clusters with 5 <literal>Policy</literal> CRs bound to each cluster.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Cluster specific configuration: managed clusters typically have some number of configuration values that are specific to the individual cluster.
These configurations should be managed using RHACM policy hub-side templating with values pulled from <literal>ConfigMap</literal> CRs based on the cluster name.</simpara>
</listitem>
<listitem>
<simpara>To save CPU resources on managed clusters, policies that apply static configurations should be unbound from managed clusters after GitOps ZTP installation of the cluster.
For more information, see <link xlink:href="https://docs.openshift.com/container-platform/latest/storage/understanding-persistent-storage.html#releasing_understanding-persistent-storage">Release a persistent volume</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-topology-aware-lifecycle-manager-talm_ran-ref-design-components">
<title>Topology Aware Lifecycle Manager (TALM)</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Added support for pre-caching additional user-specified images</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<variablelist>
<varlistentry>
<term>Managed updates</term>
<listitem>
<simpara>TALM is an Operator that runs only on the hub cluster for managing how changes (including cluster and Operator upgrades, configuration, and so on) are rolled out to the network.
TALM does the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Progressively applies updates to fleets of clusters in user-configurable batches by using <literal>Policy</literal> CRs.</simpara>
</listitem>
<listitem>
<simpara>Adds <literal>ztp-done</literal> labels or other user configurable labels on a per-cluster basis</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Precaching for single-node OpenShift clusters</term>
<listitem>
<simpara>TALM supports optional precaching of OpenShift Container Platform, OLM Operator, and additional user images to single-node OpenShift clusters before initiating an upgrade.</simpara>
<itemizedlist>
<listitem>
<simpara>A new <literal>PreCachingConfig</literal> custom resource is available for specifying optional pre-caching configurations.
For example:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: ran.openshift.io/v1alpha1
kind: PreCachingConfig
metadata:
  name: example-config
  namespace: example-ns
spec:
  additionalImages:
    - quay.io/foobar/application1@sha256:3d5800990dee7cd4727d3fe238a97e2d2976d3808fc925ada29c559a47e2e
    - quay.io/foobar/application2@sha256:3d5800123dee7cd4727d3fe238a97e2d2976d3808fc925ada29c559a47adf
    - quay.io/foobar/applicationN@sha256:4fe1334adfafadsf987123adfffdaf1243340adfafdedga0991234afdadfs
  spaceRequired: 45 GiB <co xml:id="CO1-1"/>
  overrides:
    preCacheImage: quay.io/test_images/pre-cache:latest
    platformImage: quay.io/openshift-release-dev/ocp-release@sha256:3d5800990dee7cd4727d3fe238a97e2d2976d3808fc925ada29c559a47e2e
  operatorsIndexes:
    - registry.example.com:5000/custom-redhat-operators:1.0.0
  operatorsPackagesAndChannels:
    - local-storage-operator: stable
    - ptp-operator: stable
    - sriov-network-operator: stable
  excludePrecachePatterns: <co xml:id="CO1-2"/>
    - aws
    - vsphere</programlisting>
<calloutlist>
<callout arearefs="CO1-1">
<para>Configurable <literal>space-required</literal> parameter allows you to validate before and after pre-caching storage space</para>
</callout>
<callout arearefs="CO1-2">
<para>Configurable filtering allows exclusion of unused images</para>
</callout>
</calloutlist>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
<varlistentry>
<term>Backup and restore for single-node OpenShift</term>
<listitem>
<simpara>TALM supports taking a snapshot of the cluster operating system and configuration to a dedicated partition on a local disk.
A restore script is provided that returns the cluster to the backed up state.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>TALM supports concurrent cluster deployment in batches of 400</simpara>
</listitem>
<listitem>
<simpara>Precaching and backup features are for single-node OpenShift clusters only.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The <literal>PreCachingConfig</literal> CR is optional and does not need to be created if you just wants to precache platform related (OpenShift and OLM Operator) images.
The <literal>PreCachingConfig</literal> CR must be applied before referencing it in the <literal>ClusterGroupUpgrade</literal> CR.</simpara>
</listitem>
<listitem>
<simpara>Create a recovery partition during installation if you opt to use the TALM backup and restore feature.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-gitops-operator-and-ztp-plugins_ran-ref-design-components">
<title>GitOps and GitOps ZTP plugins</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>GA support for inclusion of user-provided CRs in Git for GitOps ZTP deployments</simpara>
</listitem>
<listitem>
<simpara>GitOps ZTP independence from the deployed cluster version</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>GitOps and GitOps ZTP plugins provide a GitOps-based infrastructure for managing cluster deployment and configuration.
Cluster definitions and configurations are maintained as a declarative state in Git.
ZTP plugins provide support for generating installation CRs from the <literal>SiteConfig</literal> CR and automatic wrapping of configuration CRs in policies based on <literal>PolicyGenTemplate</literal> CRs.</simpara>
<simpara>You can deploy and manage multiple versions of OpenShift Container Platform on managed clusters with the baseline reference configuration CRs in a <literal>/source-crs</literal> subdirectory provided that subdirectory also contains the <literal>kustomization.yaml</literal> file.
You add user-provided CRs to this subdirectory that you use with the predefined CRs that are specified in the <literal>PolicyGenTemplate</literal> CRs.
This allows you to tailor your configurations to suit your specific requirements and provides GitOps ZTP version independence between managed clusters and the hub cluster.</simpara>
<simpara>For more information, see the following:</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-preparing-the-hub-cluster.html#ztp-preparing-the-ztp-git-repository-ver-ind_ztp-preparing-the-hub-cluster">Preparing the site configuration repository for version independence</link></simpara>
</listitem>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-advanced-policy-config.html#ztp-adding-new-content-to-gitops-ztp_ztp-advanced-policy-config">Adding custom content to the GitOps ZTP pipeline</link></simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>300 <literal>SiteConfig</literal> CRs per ArgoCD application.
You can use multiple applications to achieve the maximum number of clusters supported by a single hub cluster.</simpara>
</listitem>
<listitem>
<simpara>Content in the <literal>/source-crs</literal> folder in Git overrides content provided in the GitOps ZTP plugin container.
Git takes precedence in the search path.</simpara>
</listitem>
<listitem>
<simpara>Add the <literal>/source-crs</literal> folder in the same directory as the <literal>kustomization.yaml</literal> file, which includes the <literal>PolicyGenTemplate</literal> as a generator.</simpara>
<note>
<simpara>Alternative locations for the <literal>/source-crs</literal> directory are not supported in this context.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>To avoid confusion or unintentional overwriting of files when updating content, use unique and distinguishable names for user-provided CRs in the <literal>/source-crs</literal> folder and extra manifests in Git.</simpara>
</listitem>
<listitem>
<simpara>The <literal>SiteConfig</literal> CR allows multiple extra-manifest paths.
When files with the same name are found in multiple directory paths, the last file found takes precedence.
This allows the full set of version specific Day 0 manifests (extra-manifests) to be placed in Git and referenced from the <literal>SiteConfig</literal>.
With this feature, you can deploy multiple OpenShift Container Platform versions to managed clusters simultaneously.</simpara>
</listitem>
<listitem>
<simpara>The <literal>extraManifestPath</literal> field of the <literal>SiteConfig</literal> CR is deprecated from OpenShift Container Platform 4.15 and later.
Use the new <literal>extraManifests.searchPaths</literal> field instead.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-ran-agent-based-installer-abi_ran-ref-design-components">
<title>Agent-based installer</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>No reference design updates in this release</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Agent-based installer (ABI) provides installation capabilities without centralized infrastructure.
The installation program creates an ISO image that you mount to the server.
When the server boots it installs OpenShift Container Platform and supplied extra manifests.</simpara>
<note>
<simpara>You can also use ABI to install OpenShift Container Platform clusters without a hub cluster.
An image registry is still required when you use ABI in this manner.</simpara>
</note>
</listitem>
</varlistentry>
</variablelist>
<simpara>Agent-based installer (ABI) is an optional component.</simpara>
<variablelist>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>You can supply a limited set of additional manifests at installation time.</simpara>
</listitem>
<listitem>
<simpara>You must include <literal>MachineConfiguration</literal> CRs that are required by the RAN DU use case.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>ABI provides a baseline OpenShift Container Platform installation.</simpara>
</listitem>
<listitem>
<simpara>You install Day 2 Operators and the remainder of the RAN DU use case configurations after installation.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="telco-ran-additional-components_ran-ref-design-components">
<title>Additional components</title>
<section xml:id="telco-ran-redfish-operator_ran-ref-design-components">
<title>Bare Metal Event Relay</title>
<simpara>The Bare Metal Event Relay is an optional Operator that runs exclusively on the managed spoke cluster. It relays Redfish hardware events to cluster applications.</simpara>
<note>
<simpara>The Bare Metal Event Relay is not included in the RAN DU use model reference configuration and is an optional feature.
If you want to use the Bare Metal Event Relay, assign additional CPU resources from the application CPU budget.</simpara>
</note>
</section>
</section>
</section>
<section xml:id="telco-ran-ref-du-crs">
<title>Telco RAN distributed unit (DU) reference configuration CRs</title>

<simpara>Use the following custom resources (CRs) to configure and deploy OpenShift Container Platform clusters with the telco RAN DU profile.
Some of the CRs are optional depending on your requirements.
CR fields you can change are annotated in the CR with YAML comments.</simpara>
<note>
<simpara>You can extract the complete set of RAN DU CRs from the <literal>ztp-site-generate</literal> container image.
See <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-preparing-the-hub-cluster.html#ztp-preparing-the-ztp-git-repository_ztp-preparing-the-hub-cluster">Preparing the GitOps ZTP site configuration repository</link> for more information.</simpara>
</note>
<section xml:id="day-2-operators-crs_ran-ref-design-crs">
<title>Day 2 Operators reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Day 2 Operators CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-clusterlogforwarder-yaml">ClusterLogForwarder.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-clusterlogging-yaml">ClusterLogging.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-clusterlogns-yaml">ClusterLogNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-clusterlogopergroup-yaml">ClusterLogOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-clusterlogsubscription-yaml">ClusterLogSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Local Storage Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-storageclass-yaml">StorageClass.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Local Storage Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-storagelv-yaml">StorageLV.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Local Storage Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-storagens-yaml">StorageNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Local Storage Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-storageopergroup-yaml">StorageOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Local Storage Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-storagesubscription-yaml">StorageSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Node Tuning Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-performanceprofile-yaml">PerformanceProfile.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Node Tuning Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-tunedperformancepatch-yaml">TunedPerformancePatch.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP fast event notifications</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpoperatorconfigforevent-yaml">PtpOperatorConfigForEvent.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpconfigboundary-yaml">PtpConfigBoundary.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpconfiggmwpc-yaml">PtpConfigGmWpc.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpconfigslave-yaml">PtpConfigSlave.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpsubscription-yaml">PtpSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpsubscriptionns-yaml">PtpSubscriptionNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-ptpsubscriptionopergroup-yaml">PtpSubscriptionOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV FEC Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-acceleratorsns-yaml">AcceleratorsNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV FEC Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-acceleratorsopergroup-yaml">AcceleratorsOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV FEC Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-acceleratorssubscription-yaml">AcceleratorsSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV FEC Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovfecclusterconfig-yaml">SriovFecClusterConfig.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovnetwork-yaml">SriovNetwork.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovnetworknodepolicy-yaml">SriovNetworkNodePolicy.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovoperatorconfig-yaml">SriovOperatorConfig.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovsubscription-yaml">SriovSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovsubscriptionns-yaml">SriovSubscriptionNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-sriovsubscriptionopergroup-yaml">SriovSubscriptionOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="cluster-tuning-crs_ran-ref-design-crs">
<title>Cluster tuning reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Cluster tuning CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Cluster capabilities</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-example-sno-yaml">example-sno.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disabling network diagnostics</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-disablesnonetworkdiag-yaml">DisableSnoNetworkDiag.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Monitoring configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-reducemonitoringfootprint-yaml">ReduceMonitoringFootprint.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>OperatorHub</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-defaultcatsrc-yaml">DefaultCatsrc.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>OperatorHub</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-disconnectedicsp-yaml">DisconnectedICSP.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>OperatorHub</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-operatorhub-yaml">OperatorHub.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="machine-configuration-crs_ran-ref-design-crs">
<title>Machine configuration reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Machine configuration CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Container runtime (crun)</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-enable-crun-master-yaml">enable-crun-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Container runtime (crun)</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-enable-crun-worker-yaml">enable-crun-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disabling CRI-O wipe</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-99-crio-disable-wipe-master-yaml">99-crio-disable-wipe-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disabling CRI-O wipe</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-99-crio-disable-wipe-worker-yaml">99-crio-disable-wipe-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Enabling kdump</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-05-kdump-config-master-yaml">05-kdump-config-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Enabling kdump</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-05-kdump-config-worker-yaml">05-kdump-config-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Enabling kdump</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-06-kdump-master-yaml">06-kdump-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Enabling kdump</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-06-kdump-worker-yaml">06-kdump-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Kubelet configuration and container mount hiding</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-01-container-mount-ns-and-kubelet-conf-master-yaml">01-container-mount-ns-and-kubelet-conf-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Kubelet configuration and container mount hiding</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-01-container-mount-ns-and-kubelet-conf-worker-yaml">01-container-mount-ns-and-kubelet-conf-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>One-shot time sync</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-99-sync-time-once-master-yaml">99-sync-time-once-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>One-shot time sync</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-99-sync-time-once-worker-yaml">99-sync-time-once-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SCTP</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-03-sctp-machine-config-master-yaml">03-sctp-machine-config-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SCTP</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-03-sctp-machine-config-worker-yaml">03-sctp-machine-config-worker.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV related kernel arguments</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/ran/telco-ran-ref-du-crs.xml#ztp-07-sriov-related-kernel-args-master-yaml">07-sriov-related-kernel-args-master.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="telco-reference-ran-du-use-case-yaml_ran-ref-design-crs">
<title>YAML reference</title>
<simpara>The following is a complete reference for all the custom resources (CRs) that make up the telco RAN DU 4.14 reference configuration.</simpara>
<section xml:id="day-2-operators-yaml_ran-ref-design-crs">
<title>Day 2 Operators reference YAML</title>
<formalpara xml:id="ztp-clusterlogforwarder-yaml">
<title>ClusterLogForwarder.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: "logging.openshift.io/v1"
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
  annotations: {}
spec:
  outputs: $outputs
  pipelines: $pipelines</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-clusterlogging-yaml">
<title>ClusterLogging.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: logging.openshift.io/v1
kind: ClusterLogging
metadata:
  name: instance
  namespace: openshift-logging
  annotations: {}
spec:
  managementState: "Managed"
  collection:
    logs:
      type: "vector"</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-clusterlogns-yaml">
<title>ClusterLogNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-logging
  annotations:
    workload.openshift.io/allowed: management</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-clusterlogopergroup-yaml">
<title>ClusterLogOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: cluster-logging
  namespace: openshift-logging
  annotations: {}
spec:
  targetNamespaces:
    - openshift-logging</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-clusterlogsubscription-yaml">
<title>ClusterLogSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: cluster-logging
  namespace: openshift-logging
  annotations: {}
spec:
  channel: "stable"
  name: cluster-logging
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Manual
status:
  state: AtLatestKnown</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-storageclass-yaml">
<title>StorageClass.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  annotations: {}
  name: example-storage-class
provisioner: kubernetes.io/no-provisioner
reclaimPolicy: Delete</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-storagelv-yaml">
<title>StorageLV.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: "local.storage.openshift.io/v1"
kind: "LocalVolume"
metadata:
  name: "local-disks"
  namespace: "openshift-local-storage"
  annotations: {}
spec:
  logLevel: Normal
  managementState: Managed
  storageClassDevices:
    # The list of storage classes and associated devicePaths need to be specified like this example:
    - storageClassName: "example-storage-class"
      volumeMode: Filesystem
      fsType: xfs
      # The below must be adjusted to the hardware.
      # For stability and reliability, it's recommended to use persistent
      # naming conventions for devicePaths, such as /dev/disk/by-path.
      devicePaths:
        - /dev/disk/by-path/pci-0000:05:00.0-nvme-1
#---
## How to verify
## 1. Create a PVC
# apiVersion: v1
# kind: PersistentVolumeClaim
# metadata:
#   name: local-pvc-name
# spec:
#   accessModes:
#   - ReadWriteOnce
#   volumeMode: Filesystem
#   resources:
#     requests:
#       storage: 100Gi
#   storageClassName: example-storage-class
#---
## 2. Create a pod that mounts it
# apiVersion: v1
# kind: Pod
# metadata:
#   labels:
#     run: busybox
#   name: busybox
# spec:
#   containers:
#   - image: quay.io/quay/busybox:latest
#     name: busybox
#     resources: {}
#     command: ["/bin/sh", "-c", "sleep infinity"]
#     volumeMounts:
#     - name: local-pvc
#       mountPath: /data
#   volumes:
#   - name: local-pvc
#     persistentVolumeClaim:
#       claimName: local-pvc-name
#   dnsPolicy: ClusterFirst
#   restartPolicy: Always
## 3. Run the pod on the cluster and verify the size and access of the `/data` mount</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-storagens-yaml">
<title>StorageNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: v1
kind: Namespace
metadata:
  name: openshift-local-storage
  annotations:
    workload.openshift.io/allowed: management</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-storageopergroup-yaml">
<title>StorageOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: openshift-local-storage
  namespace: openshift-local-storage
  annotations: {}
spec:
  targetNamespaces:
    - openshift-local-storage</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-storagesubscription-yaml">
<title>StorageSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: local-storage-operator
  namespace: openshift-local-storage
  annotations: {}
spec:
  channel: "stable"
  name: local-storage-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Manual
status:
  state: AtLatestKnown</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-performanceprofile-yaml">
<title>PerformanceProfile.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: performance.openshift.io/v2
kind: PerformanceProfile
metadata:
  # if you change this name make sure the 'include' line in TunedPerformancePatch.yaml
  # matches this name: include=openshift-node-performance-${PerformanceProfile.metadata.name}
  # Also in file 'validatorCRs/informDuValidator.yaml':
  # name: 50-performance-${PerformanceProfile.metadata.name}
  name: openshift-node-performance-profile
  annotations:
    ran.openshift.io/reference-configuration: "ran-du.redhat.com"
spec:
  additionalKernelArgs:
    - "rcupdate.rcu_normal_after_boot=0"
    - "efi=runtime"
    - "vfio_pci.enable_sriov=1"
    - "vfio_pci.disable_idle_d3=1"
    - "module_blacklist=irdma"
  cpu:
    isolated: $isolated
    reserved: $reserved
  hugepages:
    defaultHugepagesSize: $defaultHugepagesSize
    pages:
      - size: $size
        count: $count
        node: $node
  machineConfigPoolSelector:
    pools.operator.machineconfiguration.openshift.io/$mcp: ""
  nodeSelector:
    node-role.kubernetes.io/$mcp: ""
  numa:
    topologyPolicy: "restricted"
  # To use the standard (non-realtime) kernel, set enabled to false
  realTimeKernel:
    enabled: true
  workloadHints:
    # WorkloadHints defines the set of upper level flags for different type of workloads.
    # See https://github.com/openshift/cluster-node-tuning-operator/blob/master/docs/performanceprofile/performance_profile.md#workloadhints
    # for detailed descriptions of each item.
    # The configuration below is set for a low latency, performance mode.
    realTime: true
    highPowerConsumption: false
    perPodPowerManagement: false</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-tunedperformancepatch-yaml">
<title>TunedPerformancePatch.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: tuned.openshift.io/v1
kind: Tuned
metadata:
  name: performance-patch
  namespace: openshift-cluster-node-tuning-operator
  annotations: {}
spec:
  profile:
    - name: performance-patch
      # Please note:
      # - The 'include' line must match the associated PerformanceProfile name, following below pattern
      #   include=openshift-node-performance-${PerformanceProfile.metadata.name}
      # - When using the standard (non-realtime) kernel, remove the kernel.timer_migration override from
      #   the [sysctl] section and remove the entire section if it is empty.
      data: |
        [main]
        summary=Configuration changes profile inherited from performance created tuned
        include=openshift-node-performance-openshift-node-performance-profile
        [sysctl]
        kernel.timer_migration=1
        [scheduler]
        group.ice-ptp=0:f:10:*:ice-ptp.*
        group.ice-gnss=0:f:10:*:ice-gnss.*
        [service]
        service.stalld=start,enable
        service.chronyd=stop,disable
  recommend:
    - machineConfigLabels:
        machineconfiguration.openshift.io/role: "$mcp"
      priority: 19
      profile: performance-patch</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpoperatorconfigforevent-yaml">
<title>PtpOperatorConfigForEvent.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: ptp.openshift.io/v1
kind: PtpOperatorConfig
metadata:
  name: default
  namespace: openshift-ptp
  annotations: {}
spec:
  daemonNodeSelector:
    node-role.kubernetes.io/$mcp: ""
  ptpEventConfig:
    enableEventPublisher: true
    transportHost: "http://ptp-event-publisher-service-NODE_NAME.openshift-ptp.svc.cluster.local:9043"</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpconfigboundary-yaml">
<title>PtpConfigBoundary.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: boundary
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: "boundary"
      ptp4lOpts: "-2"
      phc2sysOpts: "-a -r -n 24"
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      ptp4lConf: |
        # The interface name is hardware-specific
        [$iface_slave]
        masterOnly 0
        [$iface_master_1]
        masterOnly 1
        [$iface_master_2]
        masterOnly 1
        [$iface_master_3]
        masterOnly 1
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        slaveOnly 0
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 248
        clockAccuracy 0xFE
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval -4
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval 0
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 135
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        max_frequency 900000000
        clock_servo pi
        sanity_freq_limit 200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type BC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 0
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0xA0
  recommend:
    - profile: "boundary"
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpconfiggmwpc-yaml">
<title>PtpConfigGmWpc.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: grandmaster
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: "grandmaster"
      ptp4lOpts: "-2 --summary_interval -4"
      phc2sysOpts: -r -u 0 -m -O -37 -N 8 -R 16 -s $iface_master -n 24
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      plugins:
        e810:
          enableDefaultConfig: false
          settings:
            LocalMaxHoldoverOffSet: 1500
            LocalHoldoverTimeout: 14400
            MaxInSpecOffset: 100
          pins: $e810_pins
          #  "$iface_master":
          #    "U.FL2": "0 2"
          #    "U.FL1": "0 1"
          #    "SMA2": "0 2"
          #    "SMA1": "0 1"
          ublxCmds:
            - args: #ubxtool -P 29.20 -z CFG-HW-ANT_CFG_VOLTCTRL,1
                - "-P"
                - "29.20"
                - "-z"
                - "CFG-HW-ANT_CFG_VOLTCTRL,1"
              reportOutput: false
            - args: #ubxtool -P 29.20 -e GPS
                - "-P"
                - "29.20"
                - "-e"
                - "GPS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d Galileo
                - "-P"
                - "29.20"
                - "-d"
                - "Galileo"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d GLONASS
                - "-P"
                - "29.20"
                - "-d"
                - "GLONASS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d BeiDou
                - "-P"
                - "29.20"
                - "-d"
                - "BeiDou"
              reportOutput: false
            - args: #ubxtool -P 29.20 -d SBAS
                - "-P"
                - "29.20"
                - "-d"
                - "SBAS"
              reportOutput: false
            - args: #ubxtool -P 29.20 -t -w 5 -v 1 -e SURVEYIN,600,50000
                - "-P"
                - "29.20"
                - "-t"
                - "-w"
                - "5"
                - "-v"
                - "1"
                - "-e"
                - "SURVEYIN,600,50000"
              reportOutput: true
            - args: #ubxtool -P 29.20 -p MON-HW
                - "-P"
                - "29.20"
                - "-p"
                - "MON-HW"
              reportOutput: true
      ts2phcOpts: " "
      ts2phcConf: |
        [nmea]
        ts2phc.master 1
        [global]
        use_syslog  0
        verbose 1
        logging_level 7
        ts2phc.pulsewidth 100000000
        #GNSS module s /dev/ttyGNSS* -al use _0
        #cat /dev/ttyGNSS_1700_0 to find available serial port
        #example value of gnss_serialport is /dev/ttyGNSS_1700_0
        ts2phc.nmea_serialport $gnss_serialport
        leapfile  /usr/share/zoneinfo/leap-seconds.list
        [$iface_master]
        ts2phc.extts_polarity rising
        ts2phc.extts_correction 0
      ptp4lConf: |
        [$iface_master]
        masterOnly 1
        [$iface_master_1]
        masterOnly 1
        [$iface_master_2]
        masterOnly 1
        [$iface_master_3]
        masterOnly 1
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 6
        clockAccuracy 0x27
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval 0
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval -4
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 7
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        clock_servo pi
        sanity_freq_limit  200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type BC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 0
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0x20
  recommend:
    - profile: "grandmaster"
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpconfigslave-yaml">
<title>PtpConfigSlave.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: ptp.openshift.io/v1
kind: PtpConfig
metadata:
  name: slave
  namespace: openshift-ptp
  annotations: {}
spec:
  profile:
    - name: "slave"
      # The interface name is hardware-specific
      interface: $interface
      ptp4lOpts: "-2 -s"
      phc2sysOpts: "-a -r -n 24"
      ptpSchedulingPolicy: SCHED_FIFO
      ptpSchedulingPriority: 10
      ptpSettings:
        logReduce: "true"
      ptp4lConf: |
        [global]
        #
        # Default Data Set
        #
        twoStepFlag 1
        slaveOnly 1
        priority1 128
        priority2 128
        domainNumber 24
        #utc_offset 37
        clockClass 255
        clockAccuracy 0xFE
        offsetScaledLogVariance 0xFFFF
        free_running 0
        freq_est_interval 1
        dscp_event 0
        dscp_general 0
        dataset_comparison G.8275.x
        G.8275.defaultDS.localPriority 128
        #
        # Port Data Set
        #
        logAnnounceInterval -3
        logSyncInterval -4
        logMinDelayReqInterval -4
        logMinPdelayReqInterval -4
        announceReceiptTimeout 3
        syncReceiptTimeout 0
        delayAsymmetry 0
        fault_reset_interval -4
        neighborPropDelayThresh 20000000
        masterOnly 0
        G.8275.portDS.localPriority 128
        #
        # Run time options
        #
        assume_two_step 0
        logging_level 6
        path_trace_enabled 0
        follow_up_info 0
        hybrid_e2e 0
        inhibit_multicast_service 0
        net_sync_monitor 0
        tc_spanning_tree 0
        tx_timestamp_timeout 50
        unicast_listen 0
        unicast_master_table 0
        unicast_req_duration 3600
        use_syslog 1
        verbose 0
        summary_interval 0
        kernel_leap 1
        check_fup_sync 0
        clock_class_threshold 7
        #
        # Servo Options
        #
        pi_proportional_const 0.0
        pi_integral_const 0.0
        pi_proportional_scale 0.0
        pi_proportional_exponent -0.3
        pi_proportional_norm_max 0.7
        pi_integral_scale 0.0
        pi_integral_exponent 0.4
        pi_integral_norm_max 0.3
        step_threshold 2.0
        first_step_threshold 0.00002
        max_frequency 900000000
        clock_servo pi
        sanity_freq_limit 200000000
        ntpshm_segment 0
        #
        # Transport options
        #
        transportSpecific 0x0
        ptp_dst_mac 01:1B:19:00:00:00
        p2p_dst_mac 01:80:C2:00:00:0E
        udp_ttl 1
        udp6_scope 0x0E
        uds_address /var/run/ptp4l
        #
        # Default interface options
        #
        clock_type OC
        network_transport L2
        delay_mechanism E2E
        time_stamping hardware
        tsproc_mode filter
        delay_filter moving_median
        delay_filter_length 10
        egressLatency 0
        ingressLatency 0
        boundary_clock_jbod 0
        #
        # Clock description
        #
        productDescription ;;
        revisionData ;;
        manufacturerIdentity 00:00:00
        userDescription ;
        timeSource 0xA0
  recommend:
    - profile: "slave"
      priority: 4
      match:
        - nodeLabel: "node-role.kubernetes.io/$mcp"</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpsubscription-yaml">
<title>PtpSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: ptp-operator-subscription
  namespace: openshift-ptp
  annotations: {}
spec:
  channel: "stable"
  name: ptp-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Manual
status:
  state: AtLatestKnown</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpsubscriptionns-yaml">
<title>PtpSubscriptionNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-ptp
  annotations:
    workload.openshift.io/allowed: management
  labels:
    openshift.io/cluster-monitoring: "true"</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-ptpsubscriptionopergroup-yaml">
<title>PtpSubscriptionOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: ptp-operators
  namespace: openshift-ptp
  annotations: {}
spec:
  targetNamespaces:
    - openshift-ptp</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-acceleratorsns-yaml">
<title>AcceleratorsNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: v1
kind: Namespace
metadata:
  name: vran-acceleration-operators
  annotations: {}</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-acceleratorsopergroup-yaml">
<title>AcceleratorsOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: vran-operators
  namespace: vran-acceleration-operators
  annotations: {}
spec:
  targetNamespaces:
    - vran-acceleration-operators</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-acceleratorssubscription-yaml">
<title>AcceleratorsSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: sriov-fec-subscription
  namespace: vran-acceleration-operators
  annotations: {}
spec:
  channel: stable
  name: sriov-fec
  source: certified-operators
  sourceNamespace: openshift-marketplace
  installPlanApproval: Manual
status:
  state: AtLatestKnown</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovfecclusterconfig-yaml">
<title>SriovFecClusterConfig.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: sriovfec.intel.com/v2
kind: SriovFecClusterConfig
metadata:
  name: config
  namespace: vran-acceleration-operators
  annotations: {}
spec:
  drainSkip: $drainSkip # true if SNO, false by default
  priority: 1
  nodeSelector:
    node-role.kubernetes.io/master: ""
  acceleratorSelector:
    pciAddress: $pciAddress
  physicalFunction:
    pfDriver: "vfio-pci"
    vfDriver: "vfio-pci"
    vfAmount: 16
    bbDevConfig: $bbDevConfig
#Recommended configuration for Intel ACC100 (Mount Bryce) FPGA here: https://github.com/smart-edge-open/openshift-operator/blob/main/spec/openshift-sriov-fec-operator.md#sample-cr-for-wireless-fec-acc100
#Recommended configuration for Intel N3000 FPGA here: https://github.com/smart-edge-open/openshift-operator/blob/main/spec/openshift-sriov-fec-operator.md#sample-cr-for-wireless-fec-n3000</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovnetwork-yaml">
<title>SriovNetwork.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetwork
metadata:
  name: ""
  namespace: openshift-sriov-network-operator
  annotations: {}
spec:
  #  resourceName: ""
  networkNamespace: openshift-sriov-network-operator
#  vlan: ""
#  spoofChk: ""
#  ipam: ""
#  linkState: ""
#  maxTxRate: ""
#  minTxRate: ""
#  vlanQoS: ""
#  trust: ""
#  capabilities: ""</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovnetworknodepolicy-yaml">
<title>SriovNetworkNodePolicy.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetworkNodePolicy
metadata:
  name: $name
  namespace: openshift-sriov-network-operator
  annotations: {}
spec:
  # The attributes for Mellanox/Intel based NICs as below.
  #     deviceType: netdevice/vfio-pci
  #     isRdma: true/false
  deviceType: $deviceType
  isRdma: $isRdma
  nicSelector:
    # The exact physical function name must match the hardware used
    pfNames: [$pfNames]
  nodeSelector:
    node-role.kubernetes.io/$mcp: ""
  numVfs: $numVfs
  priority: $priority
  resourceName: $resourceName</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovoperatorconfig-yaml">
<title>SriovOperatorConfig.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: sriovnetwork.openshift.io/v1
kind: SriovOperatorConfig
metadata:
  name: default
  namespace: openshift-sriov-network-operator
  annotations: {}
spec:
  configDaemonNodeSelector:
    "node-role.kubernetes.io/$mcp": ""
  # Injector and OperatorWebhook pods can be disabled (set to "false") below
  # to reduce the number of management pods. It is recommended to start with the
  # webhook and injector pods enabled, and only disable them after verifying the
  # correctness of user manifests.
  #   If the injector is disabled, containers using sr-iov resources must explicitly assign
  #   them in the  "requests"/"limits" section of the container spec, for example:
  #    containers:
  #    - name: my-sriov-workload-container
  #      resources:
  #        limits:
  #          openshift.io/&lt;resource_name&gt;:  "1"
  #        requests:
  #          openshift.io/&lt;resource_name&gt;:  "1"
  enableInjector: true
  enableOperatorWebhook: true
  logLevel: 0</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovsubscription-yaml">
<title>SriovSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: sriov-network-operator-subscription
  namespace: openshift-sriov-network-operator
  annotations: {}
spec:
  channel: "stable"
  name: sriov-network-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Manual
status:
  state: AtLatestKnown</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovsubscriptionns-yaml">
<title>SriovSubscriptionNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: v1
kind: Namespace
metadata:
  name: openshift-sriov-network-operator
  annotations:
    workload.openshift.io/allowed: management</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-sriovsubscriptionopergroup-yaml">
<title>SriovSubscriptionOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: sriov-network-operators
  namespace: openshift-sriov-network-operator
  annotations: {}
spec:
  targetNamespaces:
    - openshift-sriov-network-operator</programlisting>
</para>
</formalpara>
</section>
<section xml:id="cluster-tuning-yaml_ran-ref-design-crs">
<title>Cluster tuning reference YAML</title>
<formalpara xml:id="ztp-example-sno-yaml">
<title>example-sno.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># example-node1-bmh-secret &amp; assisted-deployment-pull-secret need to be created under same namespace example-sno
---
apiVersion: ran.openshift.io/v1
kind: SiteConfig
metadata:
  name: "example-sno"
  namespace: "example-sno"
spec:
  baseDomain: "example.com"
  pullSecretRef:
    name: "assisted-deployment-pull-secret"
  clusterImageSetNameRef: "openshift-4.10"
  sshPublicKey: "ssh-rsa AAAA..."
  clusters:
    - clusterName: "example-sno"
      networkType: "OVNKubernetes"
      # installConfigOverrides is a generic way of passing install-config
      # parameters through the siteConfig.  The 'capabilities' field configures
      # the composable openshift feature.  In this 'capabilities' setting, we
      # remove all but the marketplace component from the optional set of
      # components.
      # Notes:
      # - NodeTuning is needed for 4.13 and later, not for 4.12 and earlier
      installConfigOverrides: '{"capabilities":{"baselineCapabilitySet": "None", "additionalEnabledCapabilities": [ "marketplace", "NodeTuning" ] }}'
      # It is strongly recommended to include crun manifests as part of the additional install-time manifests for 4.13+.
      # The crun manifests can be obtained from source-crs/optional-extra-manifest/ and added to the git repo ie.sno-extra-manifest.
      # extraManifestPath: sno-extra-manifest
      clusterLabels:
        # These example cluster labels correspond to the bindingRules in the PolicyGenTemplate examples
        du-profile: "4.14"
        # These example cluster labels correspond to the bindingRules in the PolicyGenTemplate examples in ../policygentemplates:
        # ../policygentemplates/common-ranGen.yaml will apply to all clusters with 'common: true'
        common: true
        # ../policygentemplates/group-du-sno-ranGen.yaml will apply to all clusters with 'group-du-sno: ""'
        group-du-sno: ""
        # ../policygentemplates/example-sno-site.yaml will apply to all clusters with 'sites: "example-sno"'
        # Normally this should match or contain the cluster name so it only applies to a single cluster
        sites: "example-sno"
      clusterNetwork:
        - cidr: 1001:1::/48
          hostPrefix: 64
      machineNetwork:
        - cidr: 1111:2222:3333:4444::/64
      serviceNetwork:
        - 1001:2::/112
      additionalNTPSources:
        - 1111:2222:3333:4444::2
      # Initiates the cluster for workload partitioning. Setting specific reserved/isolated CPUSets is done via PolicyTemplate
      # please see Workload Partitioning Feature for a complete guide.
      cpuPartitioningMode: AllNodes
      # Optionally; This can be used to override the KlusterletAddonConfig that is created for this cluster:
      #crTemplates:
      #  KlusterletAddonConfig: "KlusterletAddonConfigOverride.yaml"
      nodes:
        - hostName: "example-node1.example.com"
          role: "master"
          # Optionally; This can be used to configure desired BIOS setting on a host:
          #biosConfigRef:
          #  filePath: "example-hw.profile"
          bmcAddress: "idrac-virtualmedia+https://[1111:2222:3333:4444::bbbb:1]/redfish/v1/Systems/System.Embedded.1"
          bmcCredentialsName:
            name: "example-node1-bmh-secret"
          bootMACAddress: "AA:BB:CC:DD:EE:11"
          # Use UEFISecureBoot to enable secure boot
          bootMode: "UEFI"
          rootDeviceHints:
            wwn: "0x11111000000asd123"
            # example of diskPartition below is used for image registry (check ImageRegistry.md for more details), but it's not limited to this use case
          #        diskPartition:
          #          - device: /dev/disk/by-id/wwn-0x11111000000asd123 # match rootDeviceHints
          #            partitions:
          #              - mount_point: /var/imageregistry
          #                size: 102500
          #                start: 344844

          nodeNetwork:
            interfaces:
              - name: eno1
                macAddress: "AA:BB:CC:DD:EE:11"
            config:
              interfaces:
                - name: eno1
                  type: ethernet
                  state: up
                  ipv4:
                    enabled: false
                  ipv6:
                    enabled: true
                    address:
                      # For SNO sites with static IP addresses, the node-specific,
                      # API and Ingress IPs should all be the same and configured on
                      # the interface
                      - ip: 1111:2222:3333:4444::aaaa:1
                        prefix-length: 64
              dns-resolver:
                config:
                  search:
                    - example.com
                  server:
                    - 1111:2222:3333:4444::2
              routes:
                config:
                  - destination: ::/0
                    next-hop-interface: eno1
                    next-hop-address: 1111:2222:3333:4444::1
                    table-id: 254</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-disablesnonetworkdiag-yaml">
<title>DisableSnoNetworkDiag.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
  annotations: {}
spec:
  disableNetworkDiagnostics: true</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-reducemonitoringfootprint-yaml">
<title>ReduceMonitoringFootprint.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-monitoring-config
  namespace: openshift-monitoring
  annotations: {}
data:
  config.yaml: |
    grafana:
      enabled: false
    alertmanagerMain:
      enabled: false
    telemeterClient:
      enabled: false
    prometheusK8s:
       retention: 24h</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-defaultcatsrc-yaml">
<title>DefaultCatsrc.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: default-cat-source
  namespace: openshift-marketplace
  annotations:
    target.workload.openshift.io/management: '{"effect": "PreferredDuringScheduling"}'
spec:
  displayName: default-cat-source
  image: $imageUrl
  publisher: Red Hat
  sourceType: grpc
  updateStrategy:
    registryPoll:
      interval: 1h
status:
  connectionState:
    lastObservedState: READY</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-disconnectedicsp-yaml">
<title>DisconnectedICSP.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operator.openshift.io/v1alpha1
kind: ImageContentSourcePolicy
metadata:
  name: disconnected-internal-icsp
  annotations: {}
spec:
  repositoryDigestMirrors:
    - $mirrors</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-operatorhub-yaml">
<title>OperatorHub.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: config.openshift.io/v1
kind: OperatorHub
metadata:
  name: cluster
  annotations: {}
spec:
  disableAllDefaultSources: true</programlisting>
</para>
</formalpara>
</section>
<section xml:id="machine-configuration-yaml_ran-ref-design-crs">
<title>Machine configuration reference YAML</title>
<formalpara xml:id="ztp-enable-crun-master-yaml">
<title>enable-crun-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: ContainerRuntimeConfig
metadata:
  name: enable-crun-master
spec:
  machineConfigPoolSelector:
    matchLabels:
      pools.operator.machineconfiguration.openshift.io/master: ""
  containerRuntimeConfig:
    defaultRuntime: crun</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-enable-crun-worker-yaml">
<title>enable-crun-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: ContainerRuntimeConfig
metadata:
  name: enable-crun-worker
spec:
  machineConfigPoolSelector:
    matchLabels:
      pools.operator.machineconfiguration.openshift.io/worker: ""
  containerRuntimeConfig:
    defaultRuntime: crun</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-99-crio-disable-wipe-master-yaml">
<title>99-crio-disable-wipe-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 99-crio-disable-wipe-master
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            source: data:text/plain;charset=utf-8;base64,W2NyaW9dCmNsZWFuX3NodXRkb3duX2ZpbGUgPSAiIgo=
          mode: 420
          path: /etc/crio/crio.conf.d/99-crio-disable-wipe.toml</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-99-crio-disable-wipe-worker-yaml">
<title>99-crio-disable-wipe-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 99-crio-disable-wipe-worker
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            source: data:text/plain;charset=utf-8;base64,W2NyaW9dCmNsZWFuX3NodXRkb3duX2ZpbGUgPSAiIgo=
          mode: 420
          path: /etc/crio/crio.conf.d/99-crio-disable-wipe.toml</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-05-kdump-config-master-yaml">
<title>05-kdump-config-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 05-kdump-config-master
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - enabled: true
          name: kdump-remove-ice-module.service
          contents: |
            [Unit]
            Description=Remove ice module when doing kdump
            Before=kdump.service
            [Service]
            Type=oneshot
            RemainAfterExit=true
            ExecStart=/usr/local/bin/kdump-remove-ice-module.sh
            [Install]
            WantedBy=multi-user.target
    storage:
      files:
        - contents:
            source: data:text/plain;charset=utf-8;base64,IyEvdXNyL2Jpbi9lbnYgYmFzaAoKIyBUaGlzIHNjcmlwdCByZW1vdmVzIHRoZSBpY2UgbW9kdWxlIGZyb20ga2R1bXAgdG8gcHJldmVudCBrZHVtcCBmYWlsdXJlcyBvbiBjZXJ0YWluIHNlcnZlcnMuCiMgVGhpcyBpcyBhIHRlbXBvcmFyeSB3b3JrYXJvdW5kIGZvciBSSEVMUExBTi0xMzgyMzYgYW5kIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhhdCBpc3N1ZSBpcwojIGZpeGVkLgoKc2V0IC14CgpTRUQ9Ii91c3IvYmluL3NlZCIKR1JFUD0iL3Vzci9iaW4vZ3JlcCIKCiMgb3ZlcnJpZGUgZm9yIHRlc3RpbmcgcHVycG9zZXMKS0RVTVBfQ09ORj0iJHsxOi0vZXRjL3N5c2NvbmZpZy9rZHVtcH0iClJFTU9WRV9JQ0VfU1RSPSJtb2R1bGVfYmxhY2tsaXN0PWljZSIKCiMgZXhpdCBpZiBmaWxlIGRvZXNuJ3QgZXhpc3QKWyAhIC1mICR7S0RVTVBfQ09ORn0gXSAmJiBleGl0IDAKCiMgZXhpdCBpZiBmaWxlIGFscmVhZHkgdXBkYXRlZAoke0dSRVB9IC1GcSAke1JFTU9WRV9JQ0VfU1RSfSAke0tEVU1QX0NPTkZ9ICYmIGV4aXQgMAoKIyBUYXJnZXQgbGluZSBsb29rcyBzb21ldGhpbmcgbGlrZSB0aGlzOgojIEtEVU1QX0NPTU1BTkRMSU5FX0FQUEVORD0iaXJxcG9sbCBucl9jcHVzPTEgLi4uIGhlc3RfZGlzYWJsZSIKIyBVc2Ugc2VkIHRvIG1hdGNoIGV2ZXJ5dGhpbmcgYmV0d2VlbiB0aGUgcXVvdGVzIGFuZCBhcHBlbmQgdGhlIFJFTU9WRV9JQ0VfU1RSIHRvIGl0CiR7U0VEfSAtaSAncy9eS0RVTVBfQ09NTUFORExJTkVfQVBQRU5EPSJbXiJdKi8mICcke1JFTU9WRV9JQ0VfU1RSfScvJyAke0tEVU1QX0NPTkZ9IHx8IGV4aXQgMAo=
          mode: 448
          path: /usr/local/bin/kdump-remove-ice-module.sh</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-05-kdump-config-worker-yaml">
<title>05-kdump-config-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 05-kdump-config-worker
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - enabled: true
          name: kdump-remove-ice-module.service
          contents: |
            [Unit]
            Description=Remove ice module when doing kdump
            Before=kdump.service
            [Service]
            Type=oneshot
            RemainAfterExit=true
            ExecStart=/usr/local/bin/kdump-remove-ice-module.sh
            [Install]
            WantedBy=multi-user.target
    storage:
      files:
        - contents:
            source: data:text/plain;charset=utf-8;base64,IyEvdXNyL2Jpbi9lbnYgYmFzaAoKIyBUaGlzIHNjcmlwdCByZW1vdmVzIHRoZSBpY2UgbW9kdWxlIGZyb20ga2R1bXAgdG8gcHJldmVudCBrZHVtcCBmYWlsdXJlcyBvbiBjZXJ0YWluIHNlcnZlcnMuCiMgVGhpcyBpcyBhIHRlbXBvcmFyeSB3b3JrYXJvdW5kIGZvciBSSEVMUExBTi0xMzgyMzYgYW5kIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhhdCBpc3N1ZSBpcwojIGZpeGVkLgoKc2V0IC14CgpTRUQ9Ii91c3IvYmluL3NlZCIKR1JFUD0iL3Vzci9iaW4vZ3JlcCIKCiMgb3ZlcnJpZGUgZm9yIHRlc3RpbmcgcHVycG9zZXMKS0RVTVBfQ09ORj0iJHsxOi0vZXRjL3N5c2NvbmZpZy9rZHVtcH0iClJFTU9WRV9JQ0VfU1RSPSJtb2R1bGVfYmxhY2tsaXN0PWljZSIKCiMgZXhpdCBpZiBmaWxlIGRvZXNuJ3QgZXhpc3QKWyAhIC1mICR7S0RVTVBfQ09ORn0gXSAmJiBleGl0IDAKCiMgZXhpdCBpZiBmaWxlIGFscmVhZHkgdXBkYXRlZAoke0dSRVB9IC1GcSAke1JFTU9WRV9JQ0VfU1RSfSAke0tEVU1QX0NPTkZ9ICYmIGV4aXQgMAoKIyBUYXJnZXQgbGluZSBsb29rcyBzb21ldGhpbmcgbGlrZSB0aGlzOgojIEtEVU1QX0NPTU1BTkRMSU5FX0FQUEVORD0iaXJxcG9sbCBucl9jcHVzPTEgLi4uIGhlc3RfZGlzYWJsZSIKIyBVc2Ugc2VkIHRvIG1hdGNoIGV2ZXJ5dGhpbmcgYmV0d2VlbiB0aGUgcXVvdGVzIGFuZCBhcHBlbmQgdGhlIFJFTU9WRV9JQ0VfU1RSIHRvIGl0CiR7U0VEfSAtaSAncy9eS0RVTVBfQ09NTUFORExJTkVfQVBQRU5EPSJbXiJdKi8mICcke1JFTU9WRV9JQ0VfU1RSfScvJyAke0tEVU1QX0NPTkZ9IHx8IGV4aXQgMAo=
          mode: 448
          path: /usr/local/bin/kdump-remove-ice-module.sh</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-06-kdump-master-yaml">
<title>06-kdump-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 06-kdump-enable-master
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - enabled: true
          name: kdump.service
  kernelArguments:
    - crashkernel=512M</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-06-kdump-worker-yaml">
<title>06-kdump-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 06-kdump-enable-worker
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - enabled: true
          name: kdump.service
  kernelArguments:
    - crashkernel=512M</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-01-container-mount-ns-and-kubelet-conf-master-yaml">
<title>01-container-mount-ns-and-kubelet-conf-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: container-mount-namespace-and-kubelet-conf-master
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmRlYnVnKCkgewogIGVjaG8gJEAgPiYyCn0KCnVzYWdlKCkgewogIGVjaG8gVXNhZ2U6ICQoYmFzZW5hbWUgJDApIFVOSVQgW2VudmZpbGUgW3Zhcm5hbWVdXQogIGVjaG8KICBlY2hvIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBFeGVjU3RhcnQgc3RhbnphIGZyb20gdGhlIGdpdmVuIHN5c3RlbWQgdW5pdCBhbmQgcmV0dXJuIGl0IHRvIHN0ZG91dAogIGVjaG8KICBlY2hvICJJZiAnZW52ZmlsZScgaXMgcHJvdmlkZWQsIHB1dCBpdCBpbiB0aGVyZSBpbnN0ZWFkLCBhcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lZCAndmFybmFtZSciCiAgZWNobyAiRGVmYXVsdCAndmFybmFtZScgaXMgRVhFQ1NUQVJUIGlmIG5vdCBzcGVjaWZpZWQiCiAgZXhpdCAxCn0KClVOSVQ9JDEKRU5WRklMRT0kMgpWQVJOQU1FPSQzCmlmIFtbIC16ICRVTklUIHx8ICRVTklUID09ICItLWhlbHAiIHx8ICRVTklUID09ICItaCIgXV07IHRoZW4KICB1c2FnZQpmaQpkZWJ1ZyAiRXh0cmFjdGluZyBFeGVjU3RhcnQgZnJvbSAkVU5JVCIKRklMRT0kKHN5c3RlbWN0bCBjYXQgJFVOSVQgfCBoZWFkIC1uIDEpCkZJTEU9JHtGSUxFI1wjIH0KaWYgW1sgISAtZiAkRklMRSBdXTsgdGhlbgogIGRlYnVnICJGYWlsZWQgdG8gZmluZCByb290IGZpbGUgZm9yIHVuaXQgJFVOSVQgKCRGSUxFKSIKICBleGl0CmZpCmRlYnVnICJTZXJ2aWNlIGRlZmluaXRpb24gaXMgaW4gJEZJTEUiCkVYRUNTVEFSVD0kKHNlZCAtbiAtZSAnL15FeGVjU3RhcnQ9LipcXCQvLC9bXlxcXSQvIHsgcy9eRXhlY1N0YXJ0PS8vOyBwIH0nIC1lICcvXkV4ZWNTdGFydD0uKlteXFxdJC8geyBzL15FeGVjU3RhcnQ9Ly87IHAgfScgJEZJTEUpCgppZiBbWyAkRU5WRklMRSBdXTsgdGhlbgogIFZBUk5BTUU9JHtWQVJOQU1FOi1FWEVDU1RBUlR9CiAgZWNobyAiJHtWQVJOQU1FfT0ke0VYRUNTVEFSVH0iID4gJEVOVkZJTEUKZWxzZQogIGVjaG8gJEVYRUNTVEFSVApmaQo=
          mode: 493
          path: /usr/local/bin/extractExecStart
        - contents:
            source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKbnNlbnRlciAtLW1vdW50PS9ydW4vY29udGFpbmVyLW1vdW50LW5hbWVzcGFjZS9tbnQgIiRAIgo=
          mode: 493
          path: /usr/local/bin/nsenterCmns
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Manages a mount namespace that both kubelet and crio can use to share their container-specific mounts

            [Service]
            Type=oneshot
            RemainAfterExit=yes
            RuntimeDirectory=container-mount-namespace
            Environment=RUNTIME_DIRECTORY=%t/container-mount-namespace
            Environment=BIND_POINT=%t/container-mount-namespace/mnt
            ExecStartPre=bash -c "findmnt ${RUNTIME_DIRECTORY} || mount --make-unbindable --bind ${RUNTIME_DIRECTORY} ${RUNTIME_DIRECTORY}"
            ExecStartPre=touch ${BIND_POINT}
            ExecStart=unshare --mount=${BIND_POINT} --propagation slave mount --make-rshared /
            ExecStop=umount -R ${RUNTIME_DIRECTORY}
          name: container-mount-namespace.service
        - dropins:
            - contents: |
                [Unit]
                Wants=container-mount-namespace.service
                After=container-mount-namespace.service

                [Service]
                ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                EnvironmentFile=-/%t/%N-execstart.env
                ExecStart=
                ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                    ${ORIG_EXECSTART}"
              name: 90-container-mount-namespace.conf
          name: crio.service
        - dropins:
            - contents: |
                [Unit]
                Wants=container-mount-namespace.service
                After=container-mount-namespace.service

                [Service]
                ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                EnvironmentFile=-/%t/%N-execstart.env
                ExecStart=
                ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                    ${ORIG_EXECSTART} --housekeeping-interval=30s"
              name: 90-container-mount-namespace.conf
            - contents: |
                [Service]
                Environment="OPENSHIFT_MAX_HOUSEKEEPING_INTERVAL_DURATION=60s"
                Environment="OPENSHIFT_EVICTION_MONITORING_PERIOD_DURATION=30s"
              name: 30-kubelet-interval-tuning.conf
          name: kubelet.service</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-01-container-mount-ns-and-kubelet-conf-worker-yaml">
<title>01-container-mount-ns-and-kubelet-conf-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: container-mount-namespace-and-kubelet-conf-worker
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmRlYnVnKCkgewogIGVjaG8gJEAgPiYyCn0KCnVzYWdlKCkgewogIGVjaG8gVXNhZ2U6ICQoYmFzZW5hbWUgJDApIFVOSVQgW2VudmZpbGUgW3Zhcm5hbWVdXQogIGVjaG8KICBlY2hvIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBFeGVjU3RhcnQgc3RhbnphIGZyb20gdGhlIGdpdmVuIHN5c3RlbWQgdW5pdCBhbmQgcmV0dXJuIGl0IHRvIHN0ZG91dAogIGVjaG8KICBlY2hvICJJZiAnZW52ZmlsZScgaXMgcHJvdmlkZWQsIHB1dCBpdCBpbiB0aGVyZSBpbnN0ZWFkLCBhcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBuYW1lZCAndmFybmFtZSciCiAgZWNobyAiRGVmYXVsdCAndmFybmFtZScgaXMgRVhFQ1NUQVJUIGlmIG5vdCBzcGVjaWZpZWQiCiAgZXhpdCAxCn0KClVOSVQ9JDEKRU5WRklMRT0kMgpWQVJOQU1FPSQzCmlmIFtbIC16ICRVTklUIHx8ICRVTklUID09ICItLWhlbHAiIHx8ICRVTklUID09ICItaCIgXV07IHRoZW4KICB1c2FnZQpmaQpkZWJ1ZyAiRXh0cmFjdGluZyBFeGVjU3RhcnQgZnJvbSAkVU5JVCIKRklMRT0kKHN5c3RlbWN0bCBjYXQgJFVOSVQgfCBoZWFkIC1uIDEpCkZJTEU9JHtGSUxFI1wjIH0KaWYgW1sgISAtZiAkRklMRSBdXTsgdGhlbgogIGRlYnVnICJGYWlsZWQgdG8gZmluZCByb290IGZpbGUgZm9yIHVuaXQgJFVOSVQgKCRGSUxFKSIKICBleGl0CmZpCmRlYnVnICJTZXJ2aWNlIGRlZmluaXRpb24gaXMgaW4gJEZJTEUiCkVYRUNTVEFSVD0kKHNlZCAtbiAtZSAnL15FeGVjU3RhcnQ9LipcXCQvLC9bXlxcXSQvIHsgcy9eRXhlY1N0YXJ0PS8vOyBwIH0nIC1lICcvXkV4ZWNTdGFydD0uKlteXFxdJC8geyBzL15FeGVjU3RhcnQ9Ly87IHAgfScgJEZJTEUpCgppZiBbWyAkRU5WRklMRSBdXTsgdGhlbgogIFZBUk5BTUU9JHtWQVJOQU1FOi1FWEVDU1RBUlR9CiAgZWNobyAiJHtWQVJOQU1FfT0ke0VYRUNTVEFSVH0iID4gJEVOVkZJTEUKZWxzZQogIGVjaG8gJEVYRUNTVEFSVApmaQo=
          mode: 493
          path: /usr/local/bin/extractExecStart
        - contents:
            source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKbnNlbnRlciAtLW1vdW50PS9ydW4vY29udGFpbmVyLW1vdW50LW5hbWVzcGFjZS9tbnQgIiRAIgo=
          mode: 493
          path: /usr/local/bin/nsenterCmns
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Manages a mount namespace that both kubelet and crio can use to share their container-specific mounts

            [Service]
            Type=oneshot
            RemainAfterExit=yes
            RuntimeDirectory=container-mount-namespace
            Environment=RUNTIME_DIRECTORY=%t/container-mount-namespace
            Environment=BIND_POINT=%t/container-mount-namespace/mnt
            ExecStartPre=bash -c "findmnt ${RUNTIME_DIRECTORY} || mount --make-unbindable --bind ${RUNTIME_DIRECTORY} ${RUNTIME_DIRECTORY}"
            ExecStartPre=touch ${BIND_POINT}
            ExecStart=unshare --mount=${BIND_POINT} --propagation slave mount --make-rshared /
            ExecStop=umount -R ${RUNTIME_DIRECTORY}
          name: container-mount-namespace.service
        - dropins:
            - contents: |
                [Unit]
                Wants=container-mount-namespace.service
                After=container-mount-namespace.service

                [Service]
                ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                EnvironmentFile=-/%t/%N-execstart.env
                ExecStart=
                ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                    ${ORIG_EXECSTART}"
              name: 90-container-mount-namespace.conf
          name: crio.service
        - dropins:
            - contents: |
                [Unit]
                Wants=container-mount-namespace.service
                After=container-mount-namespace.service

                [Service]
                ExecStartPre=/usr/local/bin/extractExecStart %n /%t/%N-execstart.env ORIG_EXECSTART
                EnvironmentFile=-/%t/%N-execstart.env
                ExecStart=
                ExecStart=bash -c "nsenter --mount=%t/container-mount-namespace/mnt \
                    ${ORIG_EXECSTART} --housekeeping-interval=30s"
              name: 90-container-mount-namespace.conf
            - contents: |
                [Service]
                Environment="OPENSHIFT_MAX_HOUSEKEEPING_INTERVAL_DURATION=60s"
                Environment="OPENSHIFT_EVICTION_MONITORING_PERIOD_DURATION=30s"
              name: 30-kubelet-interval-tuning.conf
          name: kubelet.service</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-99-sync-time-once-master-yaml">
<title>99-sync-time-once-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 99-sync-time-once-master
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Sync time once
            After=network.service
            [Service]
            Type=oneshot
            TimeoutStartSec=300
            ExecStart=/usr/sbin/chronyd -n -f /etc/chrony.conf -q
            RemainAfterExit=yes
            [Install]
            WantedBy=multi-user.target
          enabled: true
          name: sync-time-once.service</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-99-sync-time-once-worker-yaml">
<title>99-sync-time-once-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 99-sync-time-once-worker
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Sync time once
            After=network.service
            [Service]
            Type=oneshot
            TimeoutStartSec=300
            ExecStart=/usr/sbin/chronyd -n -f /etc/chrony.conf -q
            RemainAfterExit=yes
            [Install]
            WantedBy=multi-user.target
          enabled: true
          name: sync-time-once.service</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-03-sctp-machine-config-master-yaml">
<title>03-sctp-machine-config-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: load-sctp-module-master
spec:
  config:
    ignition:
      version: 2.2.0
    storage:
      files:
        - contents:
            source: data:,
            verification: {}
          filesystem: root
          mode: 420
          path: /etc/modprobe.d/sctp-blacklist.conf
        - contents:
            source: data:text/plain;charset=utf-8,sctp
          filesystem: root
          mode: 420
          path: /etc/modules-load.d/sctp-load.conf</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-03-sctp-machine-config-worker-yaml">
<title>03-sctp-machine-config-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: load-sctp-module-worker
spec:
  config:
    ignition:
      version: 2.2.0
    storage:
      files:
        - contents:
            source: data:,
            verification: {}
          filesystem: root
          mode: 420
          path: /etc/modprobe.d/sctp-blacklist.conf
        - contents:
            source: data:text/plain;charset=utf-8,sctp
          filesystem: root
          mode: 420
          path: /etc/modules-load.d/sctp-load.conf</programlisting>
</para>
</formalpara>
<formalpara xml:id="ztp-07-sriov-related-kernel-args-master-yaml">
<title>07-sriov-related-kernel-args-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 07-sriov-related-kernel-args-master
spec:
  config:
    ignition:
      version: 3.2.0
  kernelArguments:
    - intel_iommu=on
    - iommu=pt</programlisting>
</para>
</formalpara>
</section>
</section>
</section>
<section xml:id="telco-ran-ref-software-artifacts">
<title>Telco RAN DU reference configuration software specifications</title>

<simpara>The following information describes the telco RAN DU reference design specification (RDS) validated software versions.</simpara>
<section xml:id="ztp-telco-ran-software-versions_ran-ref-design-validation">
<title>Telco RAN DU 4.14 validated software components</title>
<simpara>The Red Hat telco RAN DU 4.14 solution has been validated using the following Red Hat software products for OpenShift Container Platform managed clusters and hub clusters.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Telco RAN DU managed cluster validated software components</title>
<?dbhtml table-width="80%"?>
<?dbfo table-width="80%"?>
<?dblatex table-width="80%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="170*"/>
<colspec colname="col_2" colwidth="170*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Software version</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Managed cluster version</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster Logging Operator</simpara></entry>
<entry align="left" valign="top"><simpara>5.7</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Local Storage Operator</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PTP Operator</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SRIOV Operator</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Node Tuning Operator</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Logging Operator</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SRIOV-FEC Operator</simpara></entry>
<entry align="left" valign="top"><simpara>2.7</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<table frame="all" rowsep="1" colsep="1">
<title>Hub cluster validated software components</title>
<?dbhtml table-width="80%"?>
<?dbfo table-width="80%"?>
<?dblatex table-width="80%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="170*"/>
<colspec colname="col_2" colwidth="170*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Software version</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Hub cluster version</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>GitOps ZTP plugin</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat Advanced Cluster Management (RHACM)</simpara></entry>
<entry align="left" valign="top"><simpara>2.8, 2.9</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat OpenShift GitOps</simpara></entry>
<entry align="left" valign="top"><simpara>1.9, 1.10</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Topology Aware Lifecycle Manager (TALM)</simpara></entry>
<entry align="left" valign="top"><simpara>4.14</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
</chapter>
<chapter xml:id="_telco_core_reference_design_specification">
<title>Telco core reference design specification</title>
<section xml:id="telco-core-ref-design-overview">
<title>Telco RAN DU 4.14 reference design overview</title>

<simpara>The telco core reference design specification (RDS) configures a OpenShift Container Platform cluster running on commodity hardware to host telco core workloads.</simpara>
<section xml:id="telco-core-whats-new-ref-design_core-ref-design-overview">
<title>OpenShift Container Platform 4.14 features for telco core</title>
<simpara>The following features that are included in OpenShift Container Platform 4.14 and are leveraged by the telco core reference design specification (RDS) have been added or updated.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>New features for telco core in OpenShift Container Platform 4.14</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Feature</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Support for running rootless Data Plane Development Kit (DPDK) workloads with kernel access by using the TAP CNI plugin</simpara></entry>
<entry align="left" valign="top"><simpara>DPDK applications that inject traffic into the kernel can run in non-privileged pods with the help of the TAP CNI plugin.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/networking/hardware_networks/using-dpdk-and-rdma.html#nw-running-dpdk-rootless-tap_using-dpdk-and-rdma">Using the TAP CNI to run a rootless DPDK workload with kernel access</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Dynamic use of non-reserved CPUs for OVS</simpara></entry>
<entry align="left" valign="top"><simpara>With this release, the Open vSwitch (OVS) networking stack can dynamically use non-reserved CPUs.
The dynamic use of non-reserved CPUs occurs by default in performance-tuned clusters with a CPU manager policy set to <literal>static</literal>.
The dynamic use of available, non-reserved CPUs maximizes compute resources for OVS and minimizes network latency for workloads during periods of high demand.
OVS cannot use isolated CPUs assigned to containers in <literal>Guaranteed</literal> QoS pods. This separation avoids disruption to critical application workloads.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Enabling more control over the C-states for each pod</simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>PerformanceProfile</literal> supports <literal>perPodPowerManagement</literal> which provides more control over the C-states for pods. Now, instead of disabling C-states completely, you can specify a maximum latency in microseconds for C-states. You configure this option in the <literal>cpu-c-states.crio.io</literal> annotation, which helps to optimize power savings for high-priority applications by enabling some of the shallower C-states instead of disabling them completely.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/scalability_and_performance/cnf-low-latency-tuning.html#node-tuning-operator-pod-power-saving-config_cnf-master">Optional: Power saving configurations</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Exclude SR-IOV network topology for NUMA-aware scheduling</simpara></entry>
<entry align="left" valign="top"><simpara>You can exclude advertising Non-Uniform Memory Access (NUMA) nodes for the SR-IOV network to the Topology Manager. By not advertising NUMA nodes for the SR-IOV network, you can permit more flexible SR-IOV network deployments during NUMA-aware pod scheduling.</simpara>
<simpara>For example, in some scenarios, you want flexibility for how a pod is deployed. By not providing a NUMA node hint to the Topology Manager for the pod&#8217;s SR-IOV network resource, the Topology Manager can deploy the SR-IOV network resource and the pod CPU and memory resources to different NUMA nodes. In previous OpenShift Container Platform releases, the Topology Manager attempted to place all resources on the same NUMA node.</simpara>
<itemizedlist>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/networking/hardware_networks/configuring-sriov-device.html#nw-sriov-exclude-topology-manager_configuring-sriov-device">Exclude the SR-IOV network topology for NUMA-aware scheduling</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Egress service resource to manage egress traffic for pods behind a load balancer (Technology Preview)</simpara></entry>
<entry align="left" valign="top"><simpara>With this update, you can use an <literal>EgressService</literal> custom resource (CR) to manage egress traffic for pods behind a load balancer service.</simpara>
<simpara>You can use the <literal>EgressService</literal> CR to manage egress traffic in the following ways:</simpara>
<itemizedlist>
<listitem>
<simpara>Assign the load balancer service&#8217;s IP address as the source IP address of egress traffic for pods behind the load balancer service.</simpara>
</listitem>
<listitem>
<simpara>Configure the egress traffic for pods behind a load balancer to a different network than the default node network.</simpara>
</listitem>
<listitem>
<simpara><link xlink:href="https://docs.openshift.com/container-platform/4.15/networking/ovn_kubernetes_network_provider/configuring-egress-traffic-for-vrf-loadbalancer-services.html#configuring-egress-traffic-loadbalancer-services">Configuring an egress service</link></simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="telco-ran-rds-overview">
<title>Telco core 4.14 use model overview</title>

<simpara>The Telco core reference design specification (RDS) describes a platform that supports large-scale telco applications including control plane functions such as signaling and aggregation. It also includes some centralized data plane functions, for example, user plane functions (UPF). These functions generally require scalability, complex networking support, resilient software-defined storage, and support performance requirements that are less stringent and constrained than far-edge deployments like RAN.</simpara>
<formalpara>
<title>Telco core use model architecture</title>
<para><inlinemediaobject>
<imageobject>
<imagedata fileref="images/473_OpenShift_Telco_Core_Reference_arch_1123.png"/>
</imageobject>
<textobject><phrase>Use model architecture</phrase></textobject>
</inlinemediaobject></para>
</formalpara>
<simpara>The networking prerequisites for telco core functions are diverse and encompass an array of networking attributes and performance benchmarks. IPv6 is mandatory, with dual-stack configurations being prevalent. Certain functions demand maximum throughput and transaction rates, necessitating user plane networking support such as DPDK. Other functions adhere to conventional cloud-native patterns and can use solutions such as OVN-K, kernel networking, and load balancing.</simpara>
<simpara>Telco core clusters are configured as standard three control plane clusters with worker nodes configured with the stock non real-time (RT) kernel. To support workloads with varying networking and performance requirements, worker nodes are segmented using <literal>MachineConfigPool</literal> CRs. For example, this is done to separate non-user data plane nodes from high-throughput nodes. To support the required telco operational features, the clusters have a standard set of Operator Lifecycle Manager (OLM) Day 2 Operators installed.</simpara>
<section xml:id="telco-core-ref-design-baseline-model_ran-core-design-overview">
<title>Common baseline model</title>
<simpara>The following configurations and use model description are applicable to all telco core use cases.</simpara>
<variablelist>
<varlistentry>
<term>Cluster</term>
<listitem>
<simpara>The cluster conforms to these requirements:</simpara>
<itemizedlist>
<listitem>
<simpara>High-availability (3+ supervisor nodes) control plane</simpara>
</listitem>
<listitem>
<simpara>Non-schedulable supervisor nodes</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Storage</term>
<listitem>
<simpara>Core use cases require persistent storage as provided by external OpenShift Data Foundation. For more information, see the "Storage" subsection in "Reference core design components".</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Networking</term>
<listitem>
<simpara>Telco core clusters networking conforms to these requirements:</simpara>
<itemizedlist>
<listitem>
<simpara>Dual stack IPv4/IPv6</simpara>
</listitem>
<listitem>
<simpara>Fully disconnected: Clusters do not have access to public networking at any point in their lifecycle.</simpara>
</listitem>
<listitem>
<simpara>Multiple networks: Segmented networking provides isolation between OAM, signaling, and storage traffic.</simpara>
</listitem>
<listitem>
<simpara>Cluster network type: OVN-Kubernetes is required for IPv6 support.</simpara>
</listitem>
</itemizedlist>
<simpara>Core clusters have multiple layers of networking supported by underlying RHCOS, SR-IOV Operator, Load Balancer, and other components detailed in the following "Networking" section. At a high level these layers include:</simpara>
<itemizedlist>
<listitem>
<simpara>Cluster networking: The cluster network configuration is defined and applied through the installation configuration. Updates to the configuration can be done at day-2 through the NMState Operator. Initial configuration can be used to establish:</simpara>
<itemizedlist>
<listitem>
<simpara>Host interface configuration</simpara>
</listitem>
<listitem>
<simpara>A/A Bonding (Link Aggregation Control Protocol (LACP))</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Secondary or additional networks: OpenShift CNI is configured through the Network <literal>additionalNetworks</literal> or NetworkAttachmentDefinition CRs.</simpara>
<itemizedlist>
<listitem>
<simpara>MACVLAN</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Application Workload: User plane networking is running in cloud-native network functions (CNFs).</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Service Mesh</term>
<listitem>
<simpara>Use of Service Mesh by telco CNFs is very common. It is expected that all core clusters will include a Service Mesh implementation. Service Mesh implementation and configuration is outside the scope of this specification.</simpara>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="telco-core-ref-eng-usecase-model_ran-core-design-overview">
<title>Engineering Considerations common use model</title>
<simpara>The following engineering considerations are relevant for the common use model.</simpara>
<variablelist>
<varlistentry>
<term>Worker nodes</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Worker nodes run on Intel 3rd Generation Xeon (IceLake) processors or newer. Alternatively, if using Skylake or earlier processors, the mitigations for silicon security vulnerabilities such as Spectre must be disabled; failure to do so may result in a significant 40 percent decrease in transaction performance.</simpara>
</listitem>
<listitem>
<simpara>IRQ Balancing is enabled on worker nodes. The <literal>PerformanceProfile</literal> sets <literal>globallyDisableIrqLoadBalancing: false</literal>. Guaranteed QoS Pods are annotated to ensure isolation as described in "CPU partitioning and performance tuning" subsection in "Reference core design components" section.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>All nodes</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Hyper-Threading is enabled on all nodes</simpara>
</listitem>
<listitem>
<simpara>CPU architecture is <literal>x86_64</literal> only</simpara>
</listitem>
<listitem>
<simpara>Nodes are running the stock (non-RT) kernel</simpara>
</listitem>
<listitem>
<simpara>Nodes are not configured for workload partitioning</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<simpara>The balance of node configuration between power management and maximum performance varies between <literal>MachineConfigPools</literal> in the cluster. This configuration is consistent for all nodes within a <literal>MachineConfigPool</literal>.</simpara>
<variablelist>
<varlistentry>
<term>CPU partitioning</term>
<listitem>
<simpara>CPU partitioning is configured using the PerformanceProfile and applied on a per <literal>MachineConfigPool</literal> basis. See the "CPU partitioning and performance tuning" subsection in "Reference core design components".</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-ref-application-workloads_ran-core-design-overview">
<title>Application workloads</title>
<simpara>Application workloads running on core clusters might include a mix of high-performance networking CNFs and traditional best-effort or burstable pod workloads.</simpara>
<simpara>Guaranteed QoS scheduling is available to pods that require exclusive or dedicated use of CPUs due to performance or security requirements. Typically pods hosting high-performance and low-latency-sensitive Cloud Native Functions (CNFs) utilizing user plane networking with DPDK necessitate the exclusive utilization of entire CPUs. This is accomplished through node tuning and guaranteed Quality of Service (QoS) scheduling. For pods that require exclusive use of CPUs, be aware of the potential implications of hyperthreaded systems and configure them to request multiples of 2 CPUs when the entire core (2 hyperthreads) must be allocated to the pod.</simpara>
<simpara>Pods running network functions that do not require the high throughput and low latency networking are typically scheduled with best-effort or burstable QoS and do not require dedicated or isolated CPU cores.</simpara>
<variablelist>
<varlistentry>
<term>Description of limits</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>CNF applications should conform to the latest version of the <emphasis>CNF Best Practices</emphasis> guide.</simpara>
</listitem>
<listitem>
<simpara>For a mix of best-effort and burstable QoS pods.</simpara>
<itemizedlist>
<listitem>
<simpara>Guaranteed QoS pods might be used but require correct configuration of reserved and isolated CPUs in the <literal>PerformanceProfile</literal>.</simpara>
</listitem>
<listitem>
<simpara>Guaranteed QoS Pods must include annotations for fully isolating CPUs.</simpara>
</listitem>
<listitem>
<simpara>Best effort and burstable pods are not guaranteed exclusive use of a CPU. Workloads might be preempted by other workloads, operating system daemons, or kernel tasks.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Exec probes should be avoided unless there is no viable alternative.</simpara>
<itemizedlist>
<listitem>
<simpara>Do not use exec probes if a CNF is using CPU pinning.</simpara>
</listitem>
<listitem>
<simpara>Other probe implementations, for example <literal>httpGet/tcpSocket</literal>, should be used.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Signaling workload</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Signaling workloads typically use SCTP, REST, gRPC, or similar TCP or UDP protocols.</simpara>
</listitem>
<listitem>
<simpara>The transactions per second (TPS) is in the order of hundreds of thousands using secondary CNI (multus) configured as MACVLAN or SR-IOV.</simpara>
</listitem>
<listitem>
<simpara>Signaling workloads run in pods with either guaranteed or burstable QoS.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
</section>
<section xml:id="telco-core-ref-components">
<title>Telco core reference design components</title>

<simpara>The following sections describe the various OpenShift Container Platform components and configurations that you use to configure and deploy clusters to run telco core workloads.</simpara>
<section xml:id="telco-core-cpu-partitioning-performance-tune_core-ref-design-components">
<title>CPU partitioning and performance tuning</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Open vSwitch (OVS) is removed from CPU partitioning. OVS manages its cpuset dynamically to automatically adapt to network traffic needs. Users no longer need to reserve additional CPUs for handling high network throughput on the primary container network interface (CNI). There is no impact on the configuration needed to benefit from this change.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>CPU partitioning allows for the separation of sensitive workloads from generic purposes, auxiliary processes, interrupts, and driver work queues to achieve improved performance and latency. The CPUs allocated to those auxiliary processes are referred to as <literal>reserved</literal> in the following sections. In hyperthreaded systems, a CPU is one hyperthread.</simpara>
<simpara>For more information, see <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/cnf-low-latency-tuning.html#cnf-cpu-infra-container_cnf-master">Restricting CPUs for infra and application containers</link>.</simpara>
<simpara>Configure system level performance.
For recommended settings, see <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-reference-cluster-configuration-for-vdu.html#ztp-du-configuring-host-firmware-requirements_sno-configure-for-vdu">Configuring host firmware for low latency and high performance</link>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The operating system needs a certain amount of CPU to perform all the support tasks including kernel networking.</simpara>
<itemizedlist>
<listitem>
<simpara>A system with just user plane networking applications (DPDK) needs at least one Core (2 hyperthreads when enabled) reserved for the operating system and the infrastructure components.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>A system with Hyper-Threading enabled must always put all core sibling threads to the same pool of CPUs.</simpara>
</listitem>
<listitem>
<simpara>The set of reserved and isolated cores must include all CPU cores.</simpara>
</listitem>
<listitem>
<simpara>Core 0 of each NUMA node must be included in the reserved CPU set.</simpara>
</listitem>
<listitem>
<simpara>Isolated cores might be impacted by interrupts. The following annotations must be attached to the pod if guaranteed QoS pods require full use of the CPU:</simpara>
<screen>cpu-load-balancing.crio.io: "disable"
cpu-quota.crio.io: "disable"
irq-load-balancing.crio.io: "disable"</screen>
</listitem>
<listitem>
<simpara>When per-pod power management is enabled with <literal>PerformanceProfile.workloadHints.perPodPowerManagement</literal> the following annotations must also be attached to the pod if guaranteed QoS pods require full use of the CPU:</simpara>
<screen>cpu-c-states.crio.io: "disable"
cpu-freq-governor.crio.io: "performance"</screen>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The minimum reserved capacity (<literal>systemReserved</literal>) required can be found by following the guidance in  <link xlink:href="https://access.redhat.com/solutions/5843241">"Which amount of CPU and memory are recommended to reserve for the system in OCP 4 nodes?"</link></simpara>
</listitem>
<listitem>
<simpara>The actual required reserved CPU capacity depends on the cluster configuration and workload attributes.</simpara>
</listitem>
<listitem>
<simpara>This reserved CPU value must be rounded up to a full core (2 hyper-thread) alignment.</simpara>
</listitem>
<listitem>
<simpara>Changes to the CPU partitioning will drain and reboot the nodes in the MCP.</simpara>
</listitem>
<listitem>
<simpara>The reserved CPUs reduce the pod density, as the reserved CPUs are removed from the allocatable capacity of the OpenShift node.</simpara>
</listitem>
<listitem>
<simpara>The real-time workload hint should be enabled if the workload is real-time capable.</simpara>
</listitem>
<listitem>
<simpara>Hardware without Interrupt Request (IRQ) affinity support will impact isolated CPUs. To ensure that pods with guaranteed CPU QoS have full use of allocated CPU, all hardware in the server must support IRQ affinity.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-service-mesh_core-ref-design-components">
<title>Service Mesh</title>
<variablelist>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Telco core CNFs typically require a service mesh implementation. The specific features and performance required are dependent on the application. The selection of service mesh implementation and configuration is outside the scope of this documentation. The impact of service mesh on cluster resource utilization and performance, including additional latency introduced into pod networking, must be accounted for in the overall solution engineering.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-networking_core-ref-design-components">
<title>Networking</title>
<simpara>OpenShift Container Platform networking is an ecosystem of features, plugins, and advanced networking capabilities that extend Kubernetes networking with the advanced networking-related features that your cluster needs to manage its network traffic for one or multiple hybrid clusters.</simpara>
<section xml:id="telco-core-cluster-network-operator_core-ref-design-components">
<title>Cluster Network Operator (CNO)</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The CNO deploys and manages the cluster network components including the default OVN-Kubernetes network plugin during OpenShift Container Platform cluster installation. It allows configuring primary interface MTU settings, OVN gateway modes to use node routing tables for pod egress, and additional secondary networks such as MACVLAN.</simpara>
<simpara>In support of network traffic segregation, multiple network interfaces are configured through the CNO. Traffic steering to these interfaces is configured through static routes applied by using the NMState Operator. To ensure that pod traffic is properly routed, OVN-K is configured with the <literal>routingViaHost</literal> option enabled. This setting uses the kernel routing table and the applied static routes rather than OVN for pod egress traffic.</simpara>
<simpara>The Whereabouts CNI plugin is used to provide dynamic IPv4 and IPv6 addressing for additional pod network interfaces without the use of a DHCP server.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>OVN-Kubernetes is required for IPv6 support.</simpara>
</listitem>
<listitem>
<simpara>Large MTU cluster support requires connected network equipment to be set to the same or larger value.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Pod egress traffic is handled by kernel routing table with the <literal>routingViaHost</literal> option. Appropriate static routes must be configured in the host.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-load-balancer_core-ref-design-components">
<title>Load Balancer</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>MetalLB is a load-balancer implementation for bare metal Kubernetes clusters using standard routing protocols. It enables a Kubernetes service to get an external IP address which is also added to the host network for the cluster.</simpara>
<simpara>Some use cases might require features not available in MetalLB, for example stateful load balancing. Where necessary, you can use an external third party load balancer. Selection and configuration of an external load balancer is outside the scope of this specification. When an external third party load balancer is used, the integration effort must include enough analysis to ensure all performance and resource utilization requirements are met.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Stateful load balancing is not supported by MetalLB. An alternate load balancer implementation must be used if this is a requirement for workload CNFs.</simpara>
</listitem>
<listitem>
<simpara>The networking infrastructure must ensure that the external IP address is routable from clients to the host network for the cluster.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>MetalLB is used in BGP mode only for core use case models.</simpara>
</listitem>
<listitem>
<simpara>For core use models, MetalLB is supported with only the OVN-Kubernetes network provider used in local gateway mode. See <literal>routingViaHost</literal> in the "Cluster Network Operator" section.</simpara>
</listitem>
<listitem>
<simpara>BGP configuration in MetalLB varies depending on the requirements of the network and peers.</simpara>
</listitem>
<listitem>
<simpara>Address pools can be configured as needed, allowing variation in addresses, aggregation length, auto assignment, and other relevant parameters.</simpara>
</listitem>
<listitem>
<simpara>The values of parameters in the Bi-Directional Forwarding Detection (BFD) profile should remain close to the defaults. Shorter values might lead to false negatives and impact performance.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-sriov_core-ref-design-components">
<title>SR-IOV</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>SR-IOV enables physical network interfaces (PFs) to be divided into multiple virtual functions (VFs). VFs can then be assigned to multiple pods to achieve higher throughput performance while keeping the pods isolated. The SR-IOV Network Operator provisions and manages SR-IOV CNI, network device plugin, and other components of the SR-IOV stack.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The network interface controllers supported are listed in <link xlink:href="https://docs.openshift.com/container-platform/4.15/networking/hardware_networks/about-sriov.html#nw-sriov-supported-platforms_about-sriov">OCP supported SR-IOV devices</link></simpara>
</listitem>
<listitem>
<simpara>SR-IOV and IOMMU enablement in BIOS: The SR-IOV Network Operator automatically enables IOMMU on the kernel command line.</simpara>
</listitem>
<listitem>
<simpara>SR-IOV VFs do not receive link state updates from PF. If link down detection is needed, it must be done at the protocol level.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>SR-IOV interfaces in <literal>vfio</literal> mode are typically used to enable additional secondary networks for applications that require high throughput or low latency.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-nmstate-operator_core-ref-design-components">
<title>NMState Operator</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The NMState Operator provides a Kubernetes API for performing network configurations across the cluster&#8217;s nodes. It enables network interface configurations, static IPs and DNS, VLANs, trunks, bonding, static routes, MTU, and enabling promiscuous mode on the secondary interfaces. The cluster nodes periodically report on the state of each node&#8217;s network interfaces to the API server.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The initial networking configuration is applied using <literal>NMStateConfig</literal> content in the installation CRs. The NMState Operator is used only when needed for network updates.</simpara>
</listitem>
<listitem>
<simpara>When SR-IOV virtual functions are used for host networking, the NMState Operator using <literal>NodeNetworkConfigurationPolicy</literal> is used to configure those VF interfaces, for example, VLANs and the MTU.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="telco-core-logging_core-ref-design-components">
<title>Logging</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The ClusterLogging Operator enables collection and shipping of logs off the node for remote archival and analysis. The reference configuration ships audit and infrastructure logs to a remote archive by using Kafka.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The impact of cluster CPU use is based on the number or size of logs generated and the amount of log filtering configured.</simpara>
</listitem>
<listitem>
<simpara>The reference configuration does not include shipping of application logs. Inclusion of application logs in the configuration requires evaluation of the application logging rate and sufficient additional CPU resources allocated to the reserved set.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-power-management_core-ref-design-components">
<title>Power Management</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>You can specify a maximum latency that is C-state for a low latency pod when using per-pod power management. Previously, C-states could only be disabled completely on a per pod basis.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The <link xlink:href="https://docs.openshift.com/container-platform/4.15/rest_api/node_apis/performanceprofile-performance-openshift-io-v2.html#spec-workloadhints">Performance Profile</link> can be used to configure a cluster in a high power, low power or mixed (<link xlink:href="https://docs.openshift.com/container-platform/4.15/scalability_and_performance/cnf-low-latency-tuning.html#node-tuning-operator-pod-power-saving-config_cnf-master">per-pod power management</link>) mode. The choice of power mode depends on the characteristics of the workloads running on the cluster particularly how sensitive they are to latency.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Power configuration relies on appropriate BIOS configuration, for example, enabling C-states and P-states. Configuration varies between hardware vendors.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Latency: To ensure that latency-sensitive workloads meet their requirements, you will need either a high-power configuration or a per-pod power management configuration. Per-pod power management is only available for <literal>Guaranteed</literal> QoS Pods with dedicated pinned CPUs.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-storage_core-ref-design-components">
<title>Storage</title>
<variablelist>
<varlistentry>
<term>Overview</term>
<listitem>
<simpara>Cloud native storage services can be provided by multiple solutions including OpenShift Data Foundation from Red Hat or third parties.</simpara>
<simpara>OpenShift Data Foundation is a Ceph based software-defined storage solution for containers. It provides block storage, file system storage, and on-premises object storage, which can be dynamically provisioned for both persistent and non-persistent data requirements. Telco core applications require persistent storage.</simpara>
<note>
<simpara>All storage data may not be encrypted in flight. To reduce risk, isolate the storage network from other cluster networks. The storage network must not be reachable, or routable, from other cluster networks. Only nodes directly attached to the storage network should be allowed to gain access to it.</simpara>
</note>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="_openshift_data_foundation">
<title>OpenShift Data Foundation</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Red Hat OpenShift Data Foundation is a software-defined storage service for containers.
For Telco core clusters, storage support is provided by OpenShift Data Foundation storage services running externally to the application workload cluster. OpenShift Data Foundation supports separation of storage traffic using secondary CNI networks.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>In an IPv4/IPv6 dual-stack networking environment, OpenShift Data Foundation uses IPv4 addressing. For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.13/html-single/4.13_release_notes/index#support_openshift_dual_stack_with_odf_using_ipv4">Support OpenShift dual stack with ODF using IPv4</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>OpenShift Data Foundation network traffic should be isolated from other traffic on a dedicated network, for example, by using VLAN isolation.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="_other_storage">
<title>Other Storage</title>
<simpara>Other storage solutions can be used to provide persistent storage for core clusters. The configuration and integration of these solutions is outside the scope of the telco core RDS. Integration of the storage solution into the core cluster must include correct sizing and performance analysis to ensure the storage meets overall performance and resource utilization requirements.</simpara>
</section>
</section>
<section xml:id="telco-core-monitoring_core-ref-design-components">
<title>Monitoring</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The Cluster Monitoring Operator is included by default on all OpenShift clusters and provides monitoring (metrics, dashboards, and alerting) for the platform components and optionally user projects as well.</simpara>
<simpara>Configuration of the monitoring operator allows for customization, including:</simpara>
<itemizedlist>
<listitem>
<simpara>Default retention period</simpara>
</listitem>
<listitem>
<simpara>Custom alert rules</simpara>
</listitem>
</itemizedlist>
<simpara>The default handling of pod CPU and memory metrics is based on upstream Kubernetes <literal>cAdvisor</literal> and makes a tradeoff that prefers handling of stale data over metric accuracy. This leads to spiky data that will create false triggers of alerts over user-specified thresholds. OpenShift supports an opt-in dedicated service monitor feature creating an additional set of pod CPU and memory metrics that do not suffer from the spiky behavior. For additional information, see <link xlink:href="https://access.redhat.com/solutions/7012719">this solution guide</link>.</simpara>
<simpara>In addition to default configuration, the following metrics are expected to be configured for telco core clusters:</simpara>
<itemizedlist>
<listitem>
<simpara>Pod CPU and memory metrics and alerts for user workloads</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Monitoring configuration must enable the dedicated service monitor feature for accurate representation of pod metrics</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The Prometheus retention period is specified by the user. The value used is a tradeoff between operational requirements for maintaining historical data on the cluster against CPU and storage resources. Longer retention periods increase the need for storage and require additional CPU to manage the indexing of data.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-scheduling_core-ref-design-components">
<title>Scheduling</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>NUMA-aware scheduling with the NUMA Resources Operator is now generally available in OpenShift Container Platform 4.14.</simpara>
</listitem>
<listitem>
<simpara>With this release, you can exclude advertising the Non-Uniform Memory Access (NUMA) node for the SR-IOV network to the Topology Manager. By not advertising the NUMA node for the SR-IOV network, you can permit more flexible SR-IOV network deployments during NUMA-aware pod scheduling. To exclude advertising the NUMA node for the SR-IOV network resource to the Topology Manager, set the value <literal>excludeTopology</literal> to <literal>true</literal> in the <literal>SriovNetworkNodePolicy</literal> CR. For more information, see <link xlink:href="https://docs.openshift.com/container-platform/4.15/networking/hardware_networks/configuring-sriov-device.html#nw-sriov-exclude-topology-manager_configuring-sriov-device">Exclude the SR-IOV network topology for NUMA-aware scheduling</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The scheduler is a cluster-wide component responsible for selecting the right node for a given workload. It is a core part of the platform and does not require any specific configuration in the common deployment scenarios. However, there are few specific use cases described in the following section.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>The default scheduler does not understand the NUMA locality of workloads. It only knows about the sum of all free resources on a worker node. This might cause workloads to be rejected when scheduled to a node with <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/using-cpu-manager.html#topology_manager_policies_using-cpu-manager-and-topology_manager">Topology manager policy</link> set to <literal>single-numa-node</literal> or <literal>restricted</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>For example, consider a pod requesting 6 CPUs and being scheduled to an empty node that has 4 CPUs per NUMA node. The total allocatable capacity of the node is 8 CPUs and the scheduler will place the pod there. The node local admission will fail, however, as there are only 4 CPUs available in each of the NUMA nodes.</simpara>
</listitem>
<listitem>
<simpara>All clusters with multi-NUMA nodes are required to use the <link xlink:href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/cnf-numa-aware-scheduling.html#installing-the-numa-resources-operator_numa-aware">NUMA Resources Operator</link>. The <literal>machineConfigPoolSelector</literal> of the NUMA Resources Operator must select all nodes where NUMA aligned scheduling is needed.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>All machine config pools must have consistent hardware configuration for example all nodes are expected to have the same NUMA zone count.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Pods might require annotations for correct scheduling and isolation. For more information on annotations, see the "CPU Partitioning and performance tuning" section.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-installation_core-ref-design-components">
<title>Installation</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<term>Description</term>
<listitem>
<simpara>Telco core clusters can be installed using the Agent Based Installer (ABI). This method allows users to install OpenShift Container Platform on bare metal servers without requiring additional servers or VMs for managing the installation. The ABI installer can be run on any system for example a laptop to generate an ISO installation image. This ISO is used as the installation media for the cluster supervisor nodes. Progress can be monitored using the ABI tool from any system with network connectivity to the supervisor node’s API interfaces.</simpara>
<itemizedlist>
<listitem>
<simpara>Installation from declarative CRs</simpara>
</listitem>
<listitem>
<simpara>Does not require additional servers to support installation</simpara>
</listitem>
<listitem>
<simpara>Supports install in disconnected environment</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Disconnected installation requires a reachable registry with all required content mirrored.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Networking configuration should be applied as NMState configuration during installation in preference to day-2 configuration by using the NMState Operator.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-security_core-ref-design-components">
<title>Security</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>DPDK applications that need to inject traffic to the kernel can run in non-privileged pods with the help of the TAP CNI plugin. Furthermore, in this 4.14 release that ability to create a MAC-VLAN, IP-VLAN, and VLAN subinterface based on a master interface in a container namespace is generally available.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Telco operators are security conscious and require clusters to be hardened against multiple attack vectors. Within OpenShift Container Platform, there is no single component or feature responsible for securing a cluster. This section provides details of security-oriented features and configuration for the use models covered in this specification.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">SecurityContextConstraints</emphasis>: All workload pods should be run with restricted-v2 or restricted SCC.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Seccomp</emphasis>: All pods should be run with the <literal>RuntimeDefault</literal> (or stronger) seccomp profile.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Rootless DPDK pods</emphasis>: Many user-plane networking (DPDK) CNFs require pods to run with root privileges. With this feature, a conformant DPDK pod can be run without requiring root privileges.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Storage</emphasis>: The storage network should be isolated and non-routable to other cluster networks. See the "Storage" section for additional details.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Rootless DPDK pods requires the following additional configuration steps:</simpara>
<itemizedlist>
<listitem>
<simpara>Configure the TAP plugin with the <literal>container_t</literal> SELinux context.</simpara>
</listitem>
<listitem>
<simpara>Enable the <literal>container_use_devices</literal> SELinux boolean on the hosts.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>For rootless DPDK pod support, the SELinux boolean <literal>container_use_devices</literal> must be enabled on the host for the TAP device to be created. This introduces a security risk that is acceptable for short to mid-term use. Other solutions will be explored.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-scalability_core-ref-design-components">
<title>Scalability</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Clusters will scale to the sizing listed in the limits and requirements section.</simpara>
<simpara>Scaling of workloads is described in the use model section.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Cluster scales to at least 120 nodes</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-additional-config">
<title>Additional configuration</title>
<section xml:id="telco-core-disconnected-environment_core-ref-design-components">
<title>Disconnected environment</title>
<variablelist>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>Telco core clusters are expected to be installed in networks without direct access to the internet. All container images needed to install, configure, and operator the cluster must be available in a disconnected registry. This includes OpenShift Container Platform images, day-2 Operator Lifecycle Manager (OLM) Operator images, and application workload images. The use of a disconnected environment provides multiple benefits, for example:</simpara>
<itemizedlist>
<listitem>
<simpara>Limiting access to the cluster for security</simpara>
</listitem>
<listitem>
<simpara>Curated content: The registry is populated based on curated and approved updates for the clusters</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>A unique name is required for all custom CatalogSources. Do not reuse the default catalog names.</simpara>
</listitem>
<listitem>
<simpara>A valid time source must be configured as part of cluster installation.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="telco-core-kernel_core-ref-design-components">
<title>Kernel</title>
<variablelist>
<varlistentry>
<term>New in this release</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Description</term>
<listitem>
<simpara>The user can install the following kernel modules by using <literal>MachineConfig</literal> to provide extended kernel functionality to CNFs:</simpara>
<itemizedlist>
<listitem>
<simpara>sctp</simpara>
</listitem>
<listitem>
<simpara>ip_gre</simpara>
</listitem>
<listitem>
<simpara>ip6_tables</simpara>
</listitem>
<listitem>
<simpara>ip6t_REJECT</simpara>
</listitem>
<listitem>
<simpara>ip6table_filter</simpara>
</listitem>
<listitem>
<simpara>ip6table_mangle</simpara>
</listitem>
<listitem>
<simpara>iptable_filter</simpara>
</listitem>
<listitem>
<simpara>iptable_mangle</simpara>
</listitem>
<listitem>
<simpara>iptable_nat</simpara>
</listitem>
<listitem>
<simpara>xt_multiport</simpara>
</listitem>
<listitem>
<simpara>xt_owner</simpara>
</listitem>
<listitem>
<simpara>xt_REDIRECT</simpara>
</listitem>
<listitem>
<simpara>xt_statistic</simpara>
</listitem>
<listitem>
<simpara>xt_TCPMSS</simpara>
</listitem>
<listitem>
<simpara>xt_u32</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Limits and requirements</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Use of functionality available through these kernel modules must be analyzed by the user to determine the impact on CPU load, system performance, and ability to sustain KPI.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>Out of tree drivers are not supported.</simpara>
</note>
</listitem>
</varlistentry>
<varlistentry>
<term>Engineering considerations</term>
<listitem>
<simpara>Not applicable</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
</section>
<section xml:id="telco-core-ref-du-crs">
<title>Telco core 4.14 reference configuration CRs</title>

<simpara>Use the following custom resources (CRs) to configure and deploy OpenShift Container Platform clusters with the telco core profile.
Use the CRs to form the common baseline used in all the specific use models unless otherwise indicated.</simpara>
<note>
<simpara>The telco core CRs are available in <link xlink:href="https://github.com/openshift-kni/telco-reference/tree/release-4.14">GitHub</link>.</simpara>
</note>
<section xml:id="resource-tuning-crs_ran-core-ref-design-crs">
<title>Resource Tuning reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Resource Tuning CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>System reserved capacity</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-pid-limits-cr-yaml">pid-limits-cr.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>System reserved capacity</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-control-plane-system-reserved-yaml">control-plane-system-reserved.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="storage-crs_ran-core-ref-design-crs">
<title>Storage reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Storage CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>External ODF configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-odfns-yaml">odfNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>External ODF configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-odfopergroup-yaml">odfOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>External ODF configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-odfsubscription-yaml">odfSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>External ODF configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-01-rook-ceph-external-cluster-details.secret-yaml">01-rook-ceph-external-cluster-details.secret.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>External ODF configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-02-ocs-external-storagecluster-yaml">02-ocs-external-storagecluster.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="networking-crs_ran-core-ref-design-crs">
<title>Networking reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Networking CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Baseline</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-network-yaml">Network.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Baseline</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-networkattachmentdefinition-yaml">networkAttachmentDefinition.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Network Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sriovsubscriptionns-yaml">SriovSubscriptionNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Network Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sriovsubscriptionopergroup-yaml">SriovSubscriptionOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Network Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sriovsubscription-yaml">SriovSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Network Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sriovoperatorconfig-yaml">SriovOperatorConfig.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Network Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sriovnetworknodepolicy-yaml">sriovNetworkNodePolicy.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SR-IOV Network Operator</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sriovnetwork-yaml">sriovNetwork.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-metallbns-yaml">metallbNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-metallbopergroup-yaml">metallbOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-metallbsubscription-yaml">metallbSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-metallb-yaml">metallb.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-bgp-peer-yaml">bgp-peer.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-bfd-profile-yaml">bfd-profile.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-addr-pool-yaml">addr-pool.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Load balancer</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-bgp-advr-yaml">bgp-advr.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Multus - Tap CNI for rootless DPDK pod</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-mc_rootless_pods_selinux-yaml">mc_rootless_pods_selinux.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="scheduling-crs_ran-core-ref-design-crs">
<title>Scheduling reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Scheduling CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>NUMA-aware scheduler</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-nropsubscriptionns-yaml">NROPSubscriptionNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NUMA-aware scheduler</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-nropsubscriptionopergroup-yaml">NROPSubscriptionOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NUMA-aware scheduler</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-nropsubscription-yaml">NROPSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NUMA-aware scheduler</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sched-yaml">sched.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NUMA-aware scheduler</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-nrop-yaml">nrop.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="other-crs_ran-core-ref-design-crs">
<title>Other reference CRs</title>
<table frame="all" rowsep="1" colsep="1">
<title>Other CRs</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Component</entry>
<entry align="left" valign="top">Reference CR</entry>
<entry align="left" valign="top">Optional</entry>
<entry align="left" valign="top">New in this release</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Disconnected configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-catalog-source-yaml">catalog-source.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disconnected configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-icsp-yaml">icsp.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disconnected configuration</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-operator-hub-yaml">operator-hub.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-clusterlogns-yaml">ClusterLogNS.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-clusterlogopergroup-yaml">ClusterLogOperGroup.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-clusterlogsubscription-yaml">ClusterLogSubscription.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-clusterlogforwarder-yaml">ClusterLogForwarder.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster logging</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-clusterlogging-yaml">ClusterLogging.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Additional kernel modules</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-control-plane-load-kernel-modules-yaml">control-plane-load-kernel-modules.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Additional kernel modules</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-worker-load-kernel-modules-yaml">worker-load-kernel-modules.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Additional kernel modules</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-sctp_module_mc-yaml">sctp_module_mc.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Power management</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-performanceprofile-yaml">PerformanceProfile.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Monitoring and observability</simpara></entry>
<entry align="left" valign="top"><simpara><link xlink:href="../../telco_ref_design_specs/core/telco-core-ref-crs.xml#telco-core-monitoring-config-cm-yaml">monitoring-config-cm.yaml</link></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="telco-reference-core-use-case-yaml_ran-core-ref-design-crs">
<title>YAML reference</title>
<section xml:id="resource-tuning-yaml_ran-core-ref-design-crs">
<title>Resource Tuning reference YAML</title>
<formalpara xml:id="telco-core-pid-limits-cr-yaml">
<title>pid-limits-cr.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# count: 1
apiVersion: machineconfiguration.openshift.io/v1
kind: ContainerRuntimeConfig
metadata:
  name: 99-change-pidslimit-custom
spec:
  machineConfigPoolSelector:
    matchLabels:
      # Set to appropriate MCP
      pools.operator.machineconfiguration.openshift.io/master: ""
  containerRuntimeConfig:
    pidsLimit: $pidsLimit
    # Example:
    #pidsLimit: 4096</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-control-plane-system-reserved-yaml">
<title>control-plane-system-reserved.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# count: 1
apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: autosizing-master
spec:
  autoSizingReserved: true
  machineConfigPoolSelector:
    matchLabels:
      pools.operator.machineconfiguration.openshift.io/master: ""</programlisting>
</para>
</formalpara>
</section>
<section xml:id="storage-yaml_ran-core-ref-design-crs">
<title>Storage reference YAML</title>
<formalpara xml:id="telco-core-odfns-yaml">
<title>odfNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-storage
  annotations:
    workload.openshift.io/allowed: management
  labels:
    openshift.io/cluster-monitoring: "true"</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-odfopergroup-yaml">
<title>odfOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: openshift-storage-operatorgroup
  namespace: openshift-storage
spec:
  targetNamespaces:
    - openshift-storage</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-odfsubscription-yaml">
<title>odfSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: odf-operator
  namespace: openshift-storage
spec:
  channel: "stable-4.14"
  name: odf-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Automatic</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-01-rook-ceph-external-cluster-details.secret-yaml">
<title>01-rook-ceph-external-cluster-details.secret.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
---
apiVersion: v1
kind: Secret
metadata:
  name: rook-ceph-external-cluster-details
  namespace: openshift-storage
type: Opaque
data:
  # encoded content has been made generic
  external_cluster_details: eyJuYW1lIjoicm9vay1jZXBoLW1vbi1lbmRwb2ludHMiLCJraW5kIjoiQ29uZmlnTWFwIiwiZGF0YSI6eyJkYXRhIjoiY2VwaHVzYTE9MS4yLjMuNDo2Nzg5IiwibWF4TW9uSWQiOiIwIiwibWFwcGluZyI6Int9In19LHsibmFtZSI6InJvb2stY2VwaC1tb24iLCJraW5kIjoiU2VjcmV0IiwiZGF0YSI6eyJhZG1pbi1zZWNyZXQiOiJhZG1pbi1zZWNyZXQiLCJmc2lkIjoiMTExMTExMTEtMTExMS0xMTExLTExMTEtMTExMTExMTExMTExIiwibW9uLXNlY3JldCI6Im1vbi1zZWNyZXQifX0seyJuYW1lIjoicm9vay1jZXBoLW9wZXJhdG9yLWNyZWRzIiwia2luZCI6IlNlY3JldCIsImRhdGEiOnsidXNlcklEIjoiY2xpZW50LmhlYWx0aGNoZWNrZXIiLCJ1c2VyS2V5IjoiYzJWamNtVjAifX0seyJuYW1lIjoibW9uaXRvcmluZy1lbmRwb2ludCIsImtpbmQiOiJDZXBoQ2x1c3RlciIsImRhdGEiOnsiTW9uaXRvcmluZ0VuZHBvaW50IjoiMS4yLjMuNCwxLjIuMy4zLDEuMi4zLjIiLCJNb25pdG9yaW5nUG9ydCI6IjkyODMifX0seyJuYW1lIjoiY2VwaC1yYmQiLCJraW5kIjoiU3RvcmFnZUNsYXNzIiwiZGF0YSI6eyJwb29sIjoib2RmX3Bvb2wifX0seyJuYW1lIjoicm9vay1jc2ktcmJkLW5vZGUiLCJraW5kIjoiU2VjcmV0IiwiZGF0YSI6eyJ1c2VySUQiOiJjc2ktcmJkLW5vZGUiLCJ1c2VyS2V5IjoiIn19LHsibmFtZSI6InJvb2stY3NpLXJiZC1wcm92aXNpb25lciIsImtpbmQiOiJTZWNyZXQiLCJkYXRhIjp7InVzZXJJRCI6ImNzaS1yYmQtcHJvdmlzaW9uZXIiLCJ1c2VyS2V5IjoiYzJWamNtVjAifX0seyJuYW1lIjoicm9vay1jc2ktY2VwaGZzLXByb3Zpc2lvbmVyIiwia2luZCI6IlNlY3JldCIsImRhdGEiOnsiYWRtaW5JRCI6ImNzaS1jZXBoZnMtcHJvdmlzaW9uZXIiLCJhZG1pbktleSI6IiJ9fSx7Im5hbWUiOiJyb29rLWNzaS1jZXBoZnMtbm9kZSIsImtpbmQiOiJTZWNyZXQiLCJkYXRhIjp7ImFkbWluSUQiOiJjc2ktY2VwaGZzLW5vZGUiLCJhZG1pbktleSI6ImMyVmpjbVYwIn19LHsibmFtZSI6ImNlcGhmcyIsImtpbmQiOiJTdG9yYWdlQ2xhc3MiLCJkYXRhIjp7ImZzTmFtZSI6ImNlcGhmcyIsInBvb2wiOiJtYW5pbGFfZGF0YSJ9fQ==</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-02-ocs-external-storagecluster-yaml">
<title>02-ocs-external-storagecluster.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
---
apiVersion: ocs.openshift.io/v1
kind: StorageCluster
metadata:
  name: ocs-external-storagecluster
  namespace: openshift-storage
spec:
  externalStorage:
    enable: true
  labelSelector: {}</programlisting>
</para>
</formalpara>
</section>
<section xml:id="networking-yaml_ran-core-ref-design-crs">
<title>Networking reference YAML</title>
<formalpara xml:id="telco-core-network-yaml">
<title>Network.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: operator.openshift.io/v1
kind: Network
metadata:
  name: cluster
spec:
  defaultNetwork:
    ovnKubernetesConfig:
      gatewayConfig:
        routingViaHost: true
  # additional networks are optional and may alternatively be specified using NetworkAttachmentDefinition CRs
  additionalNetworks: [$additionalNetworks]
  # eg
  #- name: add-net-1
  #  namespace: app-ns-1
  #  rawCNIConfig: '{ "cniVersion": "0.3.1", "name": "add-net-1", "plugins": [{"type": "macvlan", "master": "bond1", "ipam": {}}] }'
  #  type: Raw
  #- name: add-net-2
  #  namespace: app-ns-1
  #  rawCNIConfig: '{ "cniVersion": "0.4.0", "name": "add-net-2", "plugins": [ {"type": "macvlan", "master": "bond1", "mode": "private" },{ "type": "tuning", "name": "tuning-arp" }] }'
  #  type: Raw</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-networkattachmentdefinition-yaml">
<title>networkAttachmentDefinition.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# copies: 0-N
apiVersion: "k8s.cni.cncf.io/v1"
kind: NetworkAttachmentDefinition
metadata:
  name: $name
  namespace: $ns
spec:
  nodeSelector:
    kubernetes.io/hostname: $nodeName
  config: $config
  #eg
  #config: '{
  #  "cniVersion": "0.3.1",
  #  "name": "external-169",
  #  "type": "vlan",
  #  "master": "ens8f0",
  #  "mode": "bridge",
  #  "vlanid": 169,
  #  "ipam": {
  #    "type": "static",
  #  }
  #}'</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sriovsubscriptionns-yaml">
<title>SriovSubscriptionNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-sriov-network-operator
  annotations:
    workload.openshift.io/allowed: management</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sriovsubscriptionopergroup-yaml">
<title>SriovSubscriptionOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: sriov-network-operators
  namespace: openshift-sriov-network-operator
spec:
  targetNamespaces:
    - openshift-sriov-network-operator</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sriovsubscription-yaml">
<title>SriovSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: sriov-network-operator-subscription
  namespace: openshift-sriov-network-operator
spec:
  channel: "stable"
  name: sriov-network-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Automatic</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sriovoperatorconfig-yaml">
<title>SriovOperatorConfig.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
---
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovOperatorConfig
metadata:
  name: default
  namespace: openshift-sriov-network-operator
spec:
  configDaemonNodeSelector:
    node-role.kubernetes.io/worker: ""
  enableInjector: true
  enableOperatorWebhook: true</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sriovnetworknodepolicy-yaml">
<title>sriovNetworkNodePolicy.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional (though expected in all deployments)
# count: 0-N
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetworkNodePolicy
metadata:
  name: $name
  namespace: openshift-sriov-network-operator
spec: {} # $spec
# eg
#deviceType: netdevice
#nicSelector:
#  deviceID: "1593"
#  pfNames:
#  - ens8f0np0#0-9
#  rootDevices:
#  - 0000:d8:00.0
#  vendor: "8086"
#nodeSelector:
#  kubernetes.io/hostname: host.sample.lab
#numVfs: 20
#priority: 99
#excludeTopology: true
#resourceName: resourceNameABCD</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sriovnetwork-yaml">
<title>sriovNetwork.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional (though expected for all)
# count: 0-N
apiVersion: sriovnetwork.openshift.io/v1
kind: SriovNetwork
metadata:
  name: $name # eg sriov-network-abcd
  namespace: openshift-sriov-network-operator
spec:
  capabilities: "$capabilities" # eg '{"mac": true, "ips": true}'
  ipam: "$ipam" # eg '{ "type": "host-local", "subnet": "10.3.38.0/24" }'
  networkNamespace: $nns # eg cni-test
  resourceName: $resource # eg resourceTest</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-metallbns-yaml">
<title>metallbNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
---
apiVersion: v1
kind: Namespace
metadata:
  name: metallb-system
  annotations:
    workload.openshift.io/allowed: management
  labels:
    openshift.io/cluster-monitoring: "true"</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-metallbopergroup-yaml">
<title>metallbOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: metallb-operator
  namespace: metallb-system</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-metallbsubscription-yaml">
<title>metallbSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: metallb-operator-sub
  namespace: metallb-system
spec:
  channel: stable
  name: metallb-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Automatic</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-metallb-yaml">
<title>metallb.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: metallb.io/v1beta1
kind: MetalLB
metadata:
  name: metallb
  namespace: metallb-system
spec:
  nodeSelector:
    node-role.kubernetes.io/worker: ""</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-bgp-peer-yaml">
<title>bgp-peer.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1-N
apiVersion: metallb.io/v1beta1
kind: BGPPeer
metadata:
  name: $name
  namespace: metallb-system
spec:
  peerAddress: $ip # eg 192.168.1.2
  peerASN: $peerasn # eg 64501
  myASN: $myasn # eg 64500
  routerID: $id # eg 10.10.10.10
  bfdProfile: bfdprofile</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-bfd-profile-yaml">
<title>bfd-profile.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1-N
apiVersion: metallb.io/v1beta1
kind: BFDProfile
metadata:
  name: bfdprofile
  namespace: metallb-system
spec:
  ################
  # These values may vary. Recommended values are included as default
  receiveInterval: 150 # default 300ms
  transmitInterval: 150 # default 300ms
  #echoInterval: 300 # default 50ms
  detectMultiplier: 10 # default 3
  echoMode: true
  passiveMode: true
  minimumTtl: 5 # default 254
  #
  ################</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-addr-pool-yaml">
<title>addr-pool.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1-N
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: $name # eg addresspool3
  namespace: metallb-system
  annotations:
    metallb.universe.tf/address-pool: $name # eg addresspool3
spec:
  ##############
  # Expected variation in this configuration
  addresses: [$pools]
  #- 3.3.3.0/24
  autoAssign: true
  ##############</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-bgp-advr-yaml">
<title>bgp-advr.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1-N
apiVersion: metallb.io/v1beta1
kind: BGPAdvertisement
metadata:
  name: $name # eg bgpadvertisement-1
  namespace: metallb-system
spec:
  ipAddressPools: [$pool]
  # eg:

  #  - addresspool3
  peers: [$peers]
  # eg:

  #    - peer-one
  communities: [$communities]
  # Note correlation with address pool.
  # eg:

  #    - 65535:65282
  aggregationLength: 32
  aggregationLengthV6: 128
  localPref: 100</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-mc_rootless_pods_selinux-yaml">
<title>mc_rootless_pods_selinux.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 99-worker-setsebool
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Set SELinux boolean for tap cni plugin
            Before=kubelet.service

            [Service]
            Type=oneshot
            ExecStart=/sbin/setsebool container_use_devices=on
            RemainAfterExit=true

            [Install]
            WantedBy=multi-user.target graphical.target
          enabled: true
          name: setsebool.service</programlisting>
</para>
</formalpara>
</section>
<section xml:id="scheduling-yaml_ran-core-ref-design-crs">
<title>Scheduling reference YAML</title>
<formalpara xml:id="telco-core-nropsubscriptionns-yaml">
<title>NROPSubscriptionNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-numaresources
  annotations:
    workload.openshift.io/allowed: management</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-nropsubscriptionopergroup-yaml">
<title>NROPSubscriptionOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required: yes
# count: 1
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: numaresources-operator
  namespace: openshift-numaresources
spec:
  targetNamespaces:
    - openshift-numaresources</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-nropsubscription-yaml">
<title>NROPSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: numaresources-operator
  namespace: openshift-numaresources
spec:
  channel: "4.14"
  name: numaresources-operator
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sched-yaml">
<title>sched.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># Optional
# count: 1
apiVersion: nodetopology.openshift.io/v1
kind: NUMAResourcesScheduler
metadata:
  name: numaresourcesscheduler
spec:
  #cacheResyncPeriod: "0"
  # Image spec should be the latest for the release
  imageSpec: "registry.redhat.io/openshift4/noderesourcetopology-scheduler-rhel9:v4.14.0"
  #logLevel: "Trace"
  schedulerName: topo-aware-scheduler</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-nrop-yaml">
<title>nrop.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># Optional
# count: 1
apiVersion: nodetopology.openshift.io/v1
kind: NUMAResourcesOperator
metadata:
  name: numaresourcesoperator
spec:
  nodeGroups:
    - config:
        # Periodic is the default setting
        infoRefreshMode: Periodic
      machineConfigPoolSelector:
        matchLabels:
          # This label must match the pool(s) you want to run NUMA-aligned workloads
          pools.operator.machineconfiguration.openshift.io/worker: ""</programlisting>
</para>
</formalpara>
</section>
<section xml:id="other-yaml_ran-core-ref-design-crs">
<title>Other reference YAML</title>
<formalpara xml:id="telco-core-catalog-source-yaml">
<title>catalog-source.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1..N
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: redhat-operators-disconnected
  namespace: openshift-marketplace
spec:
  displayName: Red Hat Disconnected Operators Catalog
  image: $imageUrl
  publisher: Red Hat
  sourceType: grpc
#  updateStrategy:
#    registryPoll:
#      interval: 1h
#status:
#    connectionState:
#        lastObservedState: READY</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-icsp-yaml">
<title>icsp.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: operator.openshift.io/v1alpha1
kind: ImageContentSourcePolicy
metadata:
  name: disconnected-internal-icsp
spec:
  repositoryDigestMirrors: []
#    - $mirrors</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-operator-hub-yaml">
<title>operator-hub.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: config.openshift.io/v1
kind: OperatorHub
metadata:
  name: cluster
spec:
  disableAllDefaultSources: true</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-clusterlogns-yaml">
<title>ClusterLogNS.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-logging
  annotations:
    workload.openshift.io/allowed: management</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-clusterlogopergroup-yaml">
<title>ClusterLogOperGroup.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: cluster-logging
  namespace: openshift-logging
spec:
  targetNamespaces:
    - openshift-logging</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-clusterlogsubscription-yaml">
<title>ClusterLogSubscription.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: cluster-logging
  namespace: openshift-logging
spec:
  channel: "stable"
  name: cluster-logging
  source: redhat-operators-disconnected
  sourceNamespace: openshift-marketplace
  installPlanApproval: Automatic</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-clusterlogforwarder-yaml">
<title>ClusterLogForwarder.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: logging.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: instance
  namespace: openshift-logging
spec:
  outputs:
    - type: "kafka"
      name: kafka-open
      url: tcp://10.11.12.13:9092/test
  pipelines:
    - inputRefs:
        - infrastructure
        #- application
        - audit
      labels:
        label1: test1
        label2: test2
        label3: test3
        label4: test4
        label5: test5
      name: all-to-default
      outputRefs:
        - kafka-open</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-clusterlogging-yaml">
<title>ClusterLogging.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: logging.openshift.io/v1
kind: ClusterLogging
metadata:
  name: instance
  namespace: openshift-logging
spec:
  collection:
    type: vector
  managementState: Managed</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-control-plane-load-kernel-modules-yaml">
<title>control-plane-load-kernel-modules.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# count: 1
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 40-load-kernel-modules-control-plane
spec:
  config:
    # Release info found in https://github.com/coreos/butane/releases
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            source: data:,
          mode: 420
          overwrite: true
          path: /etc/modprobe.d/kernel-blacklist.conf
        - contents:
            source: data:text/plain;charset=utf-8;base64,aXBfZ3JlCmlwNl90YWJsZXMKaXA2dF9SRUpFQ1QKaXA2dGFibGVfZmlsdGVyCmlwNnRhYmxlX21hbmdsZQppcHRhYmxlX2ZpbHRlcgppcHRhYmxlX21hbmdsZQppcHRhYmxlX25hdAp4dF9tdWx0aXBvcnQKeHRfb3duZXIKeHRfUkVESVJFQ1QKeHRfc3RhdGlzdGljCnh0X1RDUE1TUwp4dF91MzI=
          mode: 420
          overwrite: true
          path: /etc/modules-load.d/kernel-load.conf</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-worker-load-kernel-modules-yaml">
<title>worker-load-kernel-modules.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# count: 1
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 40-load-kernel-modules-worker
spec:
  config:
    # Release info found in https://github.com/coreos/butane/releases
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            source: data:,
          mode: 420
          overwrite: true
          path: /etc/modprobe.d/kernel-blacklist.conf
        - contents:
            source: data:text/plain;charset=utf-8;base64,aXBfZ3JlCmlwNl90YWJsZXMKaXA2dF9SRUpFQ1QKaXA2dGFibGVfZmlsdGVyCmlwNnRhYmxlX21hbmdsZQppcHRhYmxlX2ZpbHRlcgppcHRhYmxlX21hbmdsZQppcHRhYmxlX25hdAp4dF9tdWx0aXBvcnQKeHRfb3duZXIKeHRfUkVESVJFQ1QKeHRfc3RhdGlzdGljCnh0X1RDUE1TUwp4dF91MzI=
          mode: 420
          overwrite: true
          path: /etc/modules-load.d/kernel-load.conf</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-sctp_module_mc-yaml">
<title>sctp_module_mc.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# count: 1
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: load-sctp-module
spec:
  config:
    ignition:
      version: 2.2.0
    storage:
      files:
        - contents:
            source: data:,
            verification: {}
          filesystem: root
          mode: 420
          path: /etc/modprobe.d/sctp-blacklist.conf
        - contents:
            source: data:text/plain;charset=utf-8;base64,c2N0cA==
          filesystem: root
          mode: 420
          path: /etc/modules-load.d/sctp-load.conf</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-performanceprofile-yaml">
<title>PerformanceProfile.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># required
# count: 1
apiVersion: performance.openshift.io/v2
kind: PerformanceProfile
metadata:
  name: $name
  annotations:
    # Some pods want the kernel stack to ignore IPv6 router Advertisement.
    kubeletconfig.experimental: |
      {"allowedUnsafeSysctls":["net.ipv6.conf.all.accept_ra"]}
spec:
  cpu:
    # node0 CPUs: 0-17,36-53
    # node1 CPUs: 18-34,54-71
    # siblings: (0,36), (1,37)...
    # we want to reserve the first Core of each NUMA socket
    #
    # no CPU left behind! all-cpus == isolated + reserved
    isolated: $isolated # eg 1-17,19-35,37-53,55-71
    reserved: $reserved # eg 0,18,36,54
  # Guaranteed QoS pods will disable IRQ balancing for cores allocated to the pod.
  # default value of globallyDisableIrqLoadBalancing is false
  globallyDisableIrqLoadBalancing: false
  hugepages:
    defaultHugepagesSize: 1G
    pages:
      # 32GB per numa node
      - count: $count # eg 64
        size: 1G
  machineConfigPoolSelector:
    # For SNO: machineconfiguration.openshift.io/role: 'master'
    pools.operator.machineconfiguration.openshift.io/worker: ''
  nodeSelector:
    # For SNO: node-role.kubernetes.io/master: ""
    node-role.kubernetes.io/worker: ""
  workloadHints:
    realTime: false
    highPowerConsumption: false
    perPodPowerManagement: true
  realTimeKernel:
    enabled: false
  numa:
    # All guaranteed QoS containers get resources from a single NUMA node
    topologyPolicy: "single-numa-node"
  net:
    # Limit the number or IRQs to 8 (number or reserved CPUs)
    # =&gt; this is good enough as I have only 262 IT now instead of 501
    # but this is a waste... TODO: now waste (see below)!
    #
    # This is more than enough for eno1 (host and OVN)
    # eno2 should be down. TODO: add MCO or use NMSTATE in OCP4.10
    # SR-IOV PFs: only VFs are used. TODO: MCO to have a single IRQ
    userLevelNetworking: false</programlisting>
</para>
</formalpara>
<formalpara xml:id="telco-core-monitoring-config-cm-yaml">
<title>monitoring-config-cm.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered"># optional
# count: 1
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-monitoring-config
  namespace: openshift-monitoring
data:
  config.yaml: |
    k8sPrometheusAdapter:
      dedicatedServiceMonitors:
        enabled: true
    prometheusK8s:
      retention: 15d
      volumeClaimTemplate:
        spec:
          storageClassName: ocs-external-storagecluster-ceph-rbd
          resources:
            requests:
              storage: 100Gi
    alertmanagerMain:
      volumeClaimTemplate:
        spec:
          storageClassName: ocs-external-storagecluster-ceph-rbd
          resources:
            requests:
              storage: 20Gi</programlisting>
</para>
</formalpara>
</section>
</section>
</section>
</chapter>
</book>