<?xml version="1.0" encoding="UTF-8"?>
<?asciidoc-toc?>
<?asciidoc-numbered?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
<info>
<title>Support</title>
<date>2024-02-13</date>
</info>
<chapter xml:id="support-overview">
<title>Support overview</title>

<simpara>Red Hat offers cluster administrators tools for gathering data for your cluster, monitoring, and troubleshooting.</simpara>
<section xml:id="support-overview-get-support">
<title>Get support</title>
<simpara><link xl:href="../support/getting-support.xml#getting-support">Get support</link>: Visit the Red Hat Customer Portal to review knowledge base articles, submit a support case, and review additional product documentation and resources.</simpara>
</section>
<section xml:id="support-overview-remote-health-monitoring">
<title>Remote health monitoring issues</title>
<simpara><link xl:href="../support/remote_health_monitoring/about-remote-health-monitoring.xml#about-remote-health-monitoring">Remote health monitoring issues</link>:
{product-title} collects telemetry and configuration data about your cluster and reports it to Red Hat by using the Telemeter Client and the Insights Operator. Red Hat uses this data to understand and resolve issues in <emphasis>connected cluster</emphasis>. Similar to connected clusters, you can <link xl:href="../support/remote_health_monitoring/remote-health-reporting-from-restricted-network.xml#remote-health-reporting-from-restricted-network">Use remote health monitoring in a restricted network</link>. {product-title} collects data and monitors health using the following:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Telemetry</emphasis>: The Telemetry Client gathers and uploads the metrics values to Red Hat every four minutes and thirty seconds. Red Hat uses this data to:</simpara>
<itemizedlist>
<listitem>
<simpara>Monitor the clusters.</simpara>
</listitem>
<listitem>
<simpara>Roll out {product-title} upgrades.</simpara>
</listitem>
<listitem>
<simpara>Improve the upgrade experience.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">Insight Operator</emphasis>: By default, {product-title} installs and enables the Insight Operator, which reports configuration and component failure status every two hours. The Insight Operator helps to:</simpara>
<itemizedlist>
<listitem>
<simpara>Identify potential cluster issues proactively.</simpara>
</listitem>
<listitem>
<simpara>Provide a solution and preventive action in Red Hat OpenShift Cluster Manager.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>You can <link xl:href="../support/remote_health_monitoring/showing-data-collected-by-remote-health-monitoring.xml#showing-data-collected-by-remote-health-monitoring">review telemetry information</link>.</simpara>
<simpara>If you have enabled remote health reporting, <link xl:href="../support/remote_health_monitoring/using-insights-to-identify-issues-with-your-cluster.xml#using-insights-to-identify-issues-with-your-cluster">Use Insights to identify issues</link>. You can optionally disable remote health reporting.</simpara>
</section>
<section xml:id="support-overview-gather-data-cluster">
<title>Gather data about your cluster</title>
<simpara><link xl:href="../support/gathering-cluster-data.xml#gathering-cluster-data">Gather data about your cluster</link>: Red Hat recommends gathering your debugging information when opening a support case. This helps Red Hat Support to perform a root cause analysis. A cluster administrator can use the following to gather data about your cluster:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">The must-gather tool</emphasis>: Use the <literal>must-gather</literal> tool to collect information about your cluster and to debug the issues.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">sosreport</emphasis>:  Use the <literal>sosreport</literal> tool to collect configuration details, system information, and diagnostic data for debugging purposes.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Cluster ID</emphasis>: Obtain the unique identifier for your cluster, when providing information to Red Hat Support.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Bootstrap node journal logs</emphasis>: Gather <literal>bootkube.service</literal> <literal>journald</literal> unit logs and container logs from the bootstrap node to troubleshoot bootstrap-related issues.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Cluster node journal logs</emphasis>: Gather <literal>journald</literal> unit logs and logs within <literal>/var/log</literal> on individual cluster nodes to troubleshoot node-related issues.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">A network trace</emphasis>: Provide a network packet trace from a specific {product-title} cluster node or a container to Red Hat Support to help troubleshoot network-related issues.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Diagnostic data</emphasis>: Use the <literal>redhat-support-tool</literal> command to gather(?) diagnostic data about your cluster.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="support-overview-troubleshooting-issues">
<title>Troubleshooting issues</title>
<simpara>A cluster administrator can monitor and troubleshoot the following {product-title} component issues:</simpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-installations.xml#troubleshooting-installations">Installation issues</link>: {product-title} installation proceeds through various stages. You can perform the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Monitor the installation stages.</simpara>
</listitem>
<listitem>
<simpara>Determine at which stage installation issues occur.</simpara>
</listitem>
<listitem>
<simpara>Investigate multiple installation issues.</simpara>
</listitem>
<listitem>
<simpara>Gather logs from a failed installation.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/verifying-node-health.xml#verifying-node-health">Node issues</link>: A cluster administrator can verify and troubleshoot node-related issues by reviewing the status, resource usage, and configuration of a node. You can query the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Kubelet’s status on a node.</simpara>
</listitem>
<listitem>
<simpara>Cluster node journal logs.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-crio-issues.xml#troubleshooting-crio-issues">Crio issues</link>: A cluster administrator can verify CRI-O container runtime engine status on each cluster node. If you experience container runtime issues, perform the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Gather CRI-O journald unit logs.</simpara>
</listitem>
<listitem>
<simpara>Cleaning CRI-O storage.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-operating-system-issues.xml#troubleshooting-operating-system-issues">Operating system issues</link>: {product-title}  runs on Red Hat Enterprise Linux CoreOS. If you experience operating system issues, you can investigate kernel crash procedures. Ensure the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Enable kdump.</simpara>
</listitem>
<listitem>
<simpara>Test the kdump configuration.</simpara>
</listitem>
<listitem>
<simpara>Analyze a core dump.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-network-issues.xml#troubleshooting-network-issues">Network issues</link>: To troubleshoot Open vSwitch issues, a cluster administrator can perform the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Configure the Open vSwitch log level temporarily.</simpara>
</listitem>
<listitem>
<simpara>Configure the Open vSwitch log level permanently.</simpara>
</listitem>
<listitem>
<simpara>Display Open vSwitch logs.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-operator-issues.xml#troubleshooting-operator-issues">Operator issues</link>: A cluster administrator can do the following to resolve Operator issues:</simpara>
<itemizedlist>
<listitem>
<simpara>Verify Operator subscription status.</simpara>
</listitem>
<listitem>
<simpara>Check Operator pod health.</simpara>
</listitem>
<listitem>
<simpara>Gather Operator logs.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/investigating-pod-issues.xml#investigating-pod-issues">Pod issues</link>: A cluster administrator can troubleshoot pod-related issues by reviewing the status of a pod and completing the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Review pod and container logs.</simpara>
</listitem>
<listitem>
<simpara>Start debug pods with root access.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-s2i.xml#troubleshooting-s2i">Source-to-image issues</link>: A cluster administrator can observe the S2I stages to determine where in the S2I process a failure occurred. Gather the following to resolve Source-to-Image (S2I) issues:</simpara>
<itemizedlist>
<listitem>
<simpara>Source-to-Image diagnostic data.</simpara>
</listitem>
<listitem>
<simpara>Application diagnostic data to investigate application failure.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/troubleshooting-storage-issues.xml#troubleshooting-storage-issues">Storage issues</link>: A multi-attach storage error occurs when the mounting volume on a new node is not possible because the failed node cannot unmount the attached volume. A cluster administrator can do the following to resolve multi-attach storage issues:</simpara>
<itemizedlist>
<listitem>
<simpara>Enable multiple attachments by using RWX volumes.</simpara>
</listitem>
<listitem>
<simpara>Recover or delete the failed node when using an RWO volume.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/investigating-monitoring-issues.xml#investigating-monitoring-issues">Monitoring issues</link>: A cluster administrator can follow the procedures on the troubleshooting page for monitoring. If the metrics for your user-defined projects are unavailable or if Prometheus is consuming a lot of disk space, check the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Investigate why user-defined metrics are unavailable.</simpara>
</listitem>
<listitem>
<simpara>Determine why Prometheus is consuming a lot of disk space.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../logging/cluster-logging.xml#cluster-logging">Logging issues</link>: A cluster administrator can follow the procedures in the "Support" and "Troubleshooting logging" sections to resolve logging issues:</simpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="../logging/troubleshooting/cluster-logging-cluster-status.xml#cluster-logging-clo-status_cluster-logging-cluster-status">Viewing the status of the Red Hat OpenShift Logging Operator</link>.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="../logging/troubleshooting/cluster-logging-cluster-status.xml#cluster-logging-clo-status-comp_cluster-logging-cluster-status">Viewing the status of logging components</link>.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="../logging/troubleshooting/troubleshooting-logging-alerts.xml#troubleshooting-logging-alerts">Troubleshooting logging alerts</link>.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="../logging/cluster-logging-support.xml#cluster-logging-must-gather-collecting_cluster-logging-support">Collecting information about your logging environment by using the <literal>oc adm must-gather</literal> command</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link xl:href="../support/troubleshooting/diagnosing-oc-issues.xml#diagnosing-oc-issues">OpenShift CLI (<literal>oc</literal>) issues</link>: Investigate OpenShift CLI (<literal>oc</literal>) issues by increasing the log level.</simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="managing-cluster-resources">
<title>Managing your cluster resources</title>

<simpara>You can apply global configuration options in {product-title}. Operators apply these configuration settings across the cluster.</simpara>
<section xml:id="support-cluster-resources_managing-cluster-resources">
<title>Interacting with your cluster resources</title>
<simpara>You can interact with cluster resources by using the OpenShift CLI (<literal>oc</literal>) tool in {product-title}. The cluster resources that you see after running the <literal>oc api-resources</literal> command can be edited.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have access to the web console or you have installed the <literal>oc</literal> CLI tool.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To see which configuration Operators have been applied, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc api-resources -o name | grep config.openshift.io</programlisting>
</listitem>
<listitem>
<simpara>To see what cluster resources you can configure, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc explain &lt;resource_name&gt;.config.openshift.io</programlisting>
</listitem>
<listitem>
<simpara>To see the configuration of custom resource definition (CRD) objects in the cluster, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get &lt;resource_name&gt;.config -o yaml</programlisting>
</listitem>
<listitem>
<simpara>To edit the cluster resource configuration, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc edit &lt;resource_name&gt;.config -o yaml</programlisting>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="getting-support">
<title>Getting support</title>

<section xml:id="support_getting-support">
<title>Getting support</title>
<simpara>If you experience difficulty with a procedure described in this documentation, or with {product-title} in general, visit the <link xl:href="http://access.redhat.com">Red Hat Customer Portal</link>.</simpara>
<simpara>From the Customer Portal, you can:</simpara>
<itemizedlist>
<listitem>
<simpara>Search or browse through the Red Hat Knowledgebase of articles and solutions relating to Red Hat products.</simpara>
</listitem>
<listitem>
<simpara>Submit a support case to Red Hat Support.</simpara>
</listitem>
<listitem>
<simpara>Access other product documentation.</simpara>
</listitem>
</itemizedlist>
<simpara>To identify issues with your cluster, you can use Insights in <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>. Insights provides details about issues and, if available, information on how to solve a problem.</simpara>
<simpara>If you have a suggestion for improving this documentation or have found an
error, submit a <link xl:href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&amp;summary=Documentation_issue&amp;issuetype=1&amp;components=12367614&amp;priority=10200&amp;versions=12385624">Jira issue</link> for the most relevant documentation component. Please provide specific details, such as the section name and {product-title} version.</simpara>
</section>
<section xml:id="support-knowledgebase-about_getting-support">
<title>About the Red Hat Knowledgebase</title>
<simpara>The <link xl:href="https://access.redhat.com/knowledgebase">Red Hat Knowledgebase</link> provides rich content aimed at helping you make the most of Red Hat&#8217;s products and technologies. The Red Hat Knowledgebase consists of articles, product documentation, and videos outlining best practices on installing, configuring, and using Red Hat products. In addition, you can search for solutions to known issues, each providing concise root cause descriptions and remedial steps.</simpara>
</section>
<section xml:id="support-knowledgebase-search_getting-support">
<title>Searching the Red Hat Knowledgebase</title>
<simpara>In the event of an {product-title} issue, you can perform an initial search to determine if a solution already exists within the Red Hat Knowledgebase.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have a Red Hat Customer Portal account.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the <link xl:href="http://access.redhat.com">Red Hat Customer Portal</link>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Search</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the search field, input keywords and strings relating to the problem, including:</simpara>
<itemizedlist>
<listitem>
<simpara>{product-title} components (such as <emphasis role="strong">etcd</emphasis>)</simpara>
</listitem>
<listitem>
<simpara>Related procedure (such as <emphasis role="strong">installation</emphasis>)</simpara>
</listitem>
<listitem>
<simpara>Warnings, error messages, and other outputs related to explicit failures</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Enter</emphasis> key.</simpara>
</listitem>
<listitem>
<simpara>Optional: Select the <emphasis role="strong">{product-title}</emphasis> product filter.</simpara>
</listitem>
<listitem>
<simpara>Optional: Select the <emphasis role="strong">Documentation</emphasis> content type filter.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="support-submitting-a-case_getting-support">
<title>Submitting a support case</title>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat Customer Portal account.</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat Standard or Premium subscription.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Get support</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Cases</emphasis> tab of the <emphasis role="strong">Customer Support</emphasis> page:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Optional: Change the pre-filled account and owner details if needed.</simpara>
</listitem>
<listitem>
<simpara>Select the appropriate category for your issue, such as <emphasis role="strong">Bug or Defect</emphasis>, and click <emphasis role="strong">Continue</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Enter the following information:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Summary</emphasis> field, enter a concise but descriptive problem summary and further details about the symptoms being experienced, as well as your expectations.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">{product-title}</emphasis> from the <emphasis role="strong">Product</emphasis> drop-down menu.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">{product-version}</emphasis> from the <emphasis role="strong">Version</emphasis> drop-down.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Review the list of suggested Red Hat Knowledgebase solutions for a potential match against the problem that is being reported. If the suggested articles do not address the issue, click <emphasis role="strong">Continue</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Review the updated list of suggested Red Hat Knowledgebase solutions for a potential match against the problem that is being reported. The list is refined as you provide more information during the case creation process. If the suggested articles do not address the issue, click <emphasis role="strong">Continue</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the account information presented is as expected, and if not, amend accordingly.</simpara>
</listitem>
<listitem>
<simpara>Check that the autofilled {product-title} Cluster ID is correct. If it is not, manually obtain your cluster ID.</simpara>
<itemizedlist>
<listitem>
<simpara>To manually obtain your cluster ID using the {product-title} web console:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Navigate to <emphasis role="strong">Home</emphasis> &#8594; <emphasis role="strong">Overview</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Find the value in the <emphasis role="strong">Cluster ID</emphasis> field of the <emphasis role="strong">Details</emphasis> section.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Alternatively, it is possible to open a new support case through the {product-title} web console and have your cluster ID autofilled.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From the toolbar, navigate to <emphasis role="strong">(?) Help</emphasis> &#8594; <emphasis role="strong">Open Support Case</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">Cluster ID</emphasis> value is autofilled.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>To obtain your cluster ID using the OpenShift CLI (<literal>oc</literal>), run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get clusterversion -o jsonpath='{.items[].spec.clusterID}{"\n"}'</programlisting>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Complete the following questions where prompted and then click <emphasis role="strong">Continue</emphasis>:</simpara>
<itemizedlist>
<listitem>
<simpara>What are you experiencing? What are you expecting to happen?</simpara>
</listitem>
<listitem>
<simpara>Define the value or impact to you or the business.</simpara>
</listitem>
<listitem>
<simpara>Where are you experiencing this behavior? What environment?</simpara>
</listitem>
<listitem>
<simpara>When does this behavior occur? Frequency? Repeatedly? At certain times?</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Upload relevant diagnostic data files and click <emphasis role="strong">Continue</emphasis>.
It is recommended to include data gathered using the <literal>oc adm must-gather</literal> command as a starting point, plus any issue specific data that is not collected by that command.</simpara>
</listitem>
<listitem>
<simpara>Input relevant case management details and click <emphasis role="strong">Continue</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Preview the case details and click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="getting-support-additional-resources" role="_additional-resources">
<title>Additional resources</title>
<itemizedlist>
<listitem>
<simpara>For details about identifying issues with your cluster, see <link xl:href="../support/remote_health_monitoring/using-insights-to-identify-issues-with-your-cluster.xml#using-insights-to-identify-issues-with-your-cluster">Using Insights to identify issues with your cluster</link>.</simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="_remote_health_monitoring_with_connected_clusters">
<title>Remote health monitoring with connected clusters</title>
<section xml:id="about-remote-health-monitoring">
<title>About remote health monitoring</title>

<simpara>{product-title} collects telemetry and configuration data about your cluster and reports it to Red Hat by using the Telemeter Client and the Insights Operator. The data that is provided to Red Hat enables the benefits outlined in this document.</simpara>
<simpara>A cluster that reports data to Red Hat through Telemetry and the Insights Operator is considered a <emphasis>connected cluster</emphasis>.</simpara>
<simpara><emphasis role="strong">Telemetry</emphasis> is the term that Red Hat uses to describe the information being sent to Red Hat by the {product-title} Telemeter Client. Lightweight attributes are sent from connected clusters to Red Hat to enable subscription management automation, monitor the health of clusters, assist with support, and improve customer experience.</simpara>
<simpara>The <emphasis role="strong">Insights Operator</emphasis> gathers {product-title} configuration data and sends it to Red Hat. The data is used to produce insights about potential issues that a cluster might be exposed to. These insights are communicated to cluster administrators on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
<simpara>More information is provided in this document about these two processes.</simpara>
<formalpara>
<title>Telemetry and Insights Operator benefits</title>
<para>Telemetry and the Insights Operator enable the following benefits for end-users:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Enhanced identification and resolution of issues</emphasis>. Events that might seem normal to an end-user can be observed by Red Hat from a broader perspective across a fleet of clusters. Some issues can be more rapidly identified from this point of view and resolved without an end-user needing to open a support case or file a <link xl:href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&amp;summary=Summary&amp;issuetype=1&amp;priority=10200&amp;versions=12385624">Jira issue</link>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Advanced release management</emphasis>. {product-title} offers the <literal>candidate</literal>, <literal>fast</literal>, and <literal>stable</literal> release channels, which enable you to choose an update strategy. The graduation of a release from <literal>fast</literal> to <literal>stable</literal> is dependent on the success rate of updates and on the events seen during upgrades. With the information provided by connected clusters, Red Hat can improve the quality of releases to <literal>stable</literal> channels and react more rapidly to issues found in the <literal>fast</literal> channels.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Targeted prioritization of new features and functionality</emphasis>. The data collected provides insights about which areas of {product-title} are used most. With this information, Red Hat can focus on developing the new features and functionality that have the greatest impact for our customers.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">A streamlined support experience</emphasis>. You can provide a cluster ID for a connected cluster when creating a support ticket on the <link xl:href="https://access.redhat.com/support/">Red Hat Customer Portal</link>. This enables Red Hat to deliver a streamlined support experience that is specific to your cluster, by using the connected information. This document provides more information about that enhanced support experience.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Predictive analytics</emphasis>. The insights displayed for your cluster on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link> are enabled by the information collected from connected clusters. Red Hat is investing in applying deep learning, machine learning, and artificial intelligence automation to help identify issues that {product-title} clusters are exposed to.</simpara>
</listitem>
</itemizedlist>
<section xml:id="telemetry-about-telemetry_about-remote-health-monitoring">
<title>About Telemetry</title>
<simpara>Telemetry sends a carefully chosen subset of the cluster monitoring metrics to Red Hat. The Telemeter Client fetches the metrics values every four minutes and thirty seconds and uploads the data to Red Hat. These metrics are described in this document.</simpara>
<simpara>This stream of data is used by Red Hat to monitor the clusters in real-time and to react as necessary to problems that impact our customers. It also allows Red Hat to roll out {product-title} upgrades to customers to minimize service impact and continuously improve the upgrade experience.</simpara>
<simpara>This debugging information is available to Red Hat Support and Engineering teams with the same restrictions as accessing data reported through support cases. All connected cluster information is used by Red Hat to help make {product-title} better and more intuitive to use.</simpara>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>See the <link xl:href="../../updating/updating_a_cluster/updating-cluster-web-console.xml#updating-cluster-web-console">{product-title} update documentation</link> for more information about updating or upgrading a cluster.</simpara>
</listitem>
</itemizedlist>
<section xml:id="what-information-is-collected_about-remote-health-monitoring">
<title>Information collected by Telemetry</title>
<simpara>The following information is collected by Telemetry:</simpara>
<section xml:id="system-information_about-remote-health-monitoring">
<title>System information</title>
<itemizedlist>
<listitem>
<simpara>Version information, including the {product-title} cluster version and installed update details that are used to determine update version availability</simpara>
</listitem>
<listitem>
<simpara>Update information, including the number of updates available per cluster, the channel and image repository used for an update, update progress information, and the number of errors that occur in an update</simpara>
</listitem>
<listitem>
<simpara>The unique random identifier that is generated during an installation</simpara>
</listitem>
<listitem>
<simpara>Configuration details that help Red Hat Support to provide beneficial support for customers, including node configuration at the cloud infrastructure level, hostnames, IP addresses, Kubernetes pod names, namespaces, and services</simpara>
</listitem>
<listitem>
<simpara>The {product-title} framework components installed in a cluster and their condition and status</simpara>
</listitem>
<listitem>
<simpara>Events for all namespaces listed as "related objects" for a degraded Operator</simpara>
</listitem>
<listitem>
<simpara>Information about degraded software</simpara>
</listitem>
<listitem>
<simpara>Information about the validity of certificates</simpara>
</listitem>
<listitem>
<simpara>The name of the provider platform that {product-title} is deployed on and the data center location</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="sizing-information_about-remote-health-monitoring">
<title>Sizing Information</title>
<itemizedlist>
<listitem>
<simpara>Sizing information about clusters, machine types, and machines, including the number of CPU cores and the amount of RAM used for each</simpara>
</listitem>
<listitem>
<simpara>The number of etcd members and the number of objects stored in the etcd cluster</simpara>
</listitem>
<listitem>
<simpara>Number of application builds by build strategy type</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="usage-information_about-remote-health-monitoring">
<title>Usage information</title>
<itemizedlist>
<listitem>
<simpara>Usage information about components, features, and extensions</simpara>
</listitem>
<listitem>
<simpara>Usage details about Technology Previews and unsupported configurations</simpara>
</listitem>
</itemizedlist>
<simpara>Telemetry does not collect identifying information such as usernames or passwords. Red Hat does not intend to collect personal information. If Red Hat discovers that personal information has been inadvertently received, Red Hat will delete such information. To the extent that any telemetry data constitutes personal data, please refer to the <link xl:href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Statement</link> for more information about Red Hat&#8217;s privacy practices.</simpara>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>See <link xl:href="../../support/remote_health_monitoring/showing-data-collected-by-remote-health-monitoring.xml#showing-data-collected-from-the-cluster_showing-data-collected-by-remote-health-monitoring">Showing data collected by Telemetry</link> for details about how to list the attributes that Telemetry gathers from Prometheus in {product-title}.</simpara>
</listitem>
<listitem>
<simpara>See the <link xl:href="https://github.com/openshift/cluster-monitoring-operator/blob/master/manifests/0000_50_cluster-monitoring-operator_04-config.yaml">upstream cluster-monitoring-operator source code</link> for a list of the attributes that Telemetry gathers from Prometheus.</simpara>
</listitem>
<listitem>
<simpara>Telemetry is installed and enabled by default. If you need to opt out of remote health reporting, see <link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#opting-out-remote-health-reporting">Opting out of remote health reporting</link>.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="insights-operator-about_about-remote-health-monitoring">
<title>About the Insights Operator</title>
<simpara>The Insights Operator periodically gathers configuration and component failure status and, by default, reports that data every two hours to Red Hat. This information enables Red Hat to assess configuration and deeper failure data than is reported through Telemetry.</simpara>
<simpara>Users of {product-title} can display the report of each cluster in the <link xl:href="https://console.redhat.com/openshift/insights/advisor/">Insights Advisor</link> service on Red Hat Hybrid Cloud Console. If any issues have been identified, Insights provides further details and, if available, steps on how to solve a problem.</simpara>
<simpara>The Insights Operator does not collect identifying information, such as user names, passwords, or certificates. See <link xl:href="https://console.redhat.com/security/insights">Red Hat Insights Data &amp; Application Security</link> for information about Red Hat Insights data collection and controls.</simpara>
<simpara>Red Hat uses all connected cluster information to:</simpara>
<itemizedlist>
<listitem>
<simpara>Identify potential cluster issues and provide a solution and preventive actions in the <link xl:href="https://console.redhat.com/openshift/insights/advisor/">Insights Advisor</link> service on Red Hat Hybrid Cloud Console</simpara>
</listitem>
<listitem>
<simpara>Improve {product-title} by providing aggregated and critical information to product and support teams</simpara>
</listitem>
<listitem>
<simpara>Make {product-title} more intuitive</simpara>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>The Insights Operator is installed and enabled by default. If you need to opt out of remote health reporting, see <link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#opting-out-remote-health-reporting">Opting out of remote health reporting</link>.</simpara>
</listitem>
</itemizedlist>
<section xml:id="insights-operator-what-information-is-collected_about-remote-health-monitoring">
<title>Information collected by the Insights Operator</title>
<simpara>The following information is collected by the Insights Operator:</simpara>
<itemizedlist>
<listitem>
<simpara>General information about your cluster and its components to identify issues that are specific to your {product-title} version and environment</simpara>
</listitem>
<listitem>
<simpara>Configuration files, such as the image registry configuration, of your cluster to determine incorrect settings and issues that are specific to parameters you set</simpara>
</listitem>
<listitem>
<simpara>Errors that occur in the cluster components</simpara>
</listitem>
<listitem>
<simpara>Progress information of running updates, and the status of any component upgrades</simpara>
</listitem>
<listitem>
<simpara>Details of the platform that {product-title} is deployed on, such as Amazon Web Services, and the region that the cluster is located in</simpara>
</listitem>
<listitem>
<simpara>Cluster workload information transformed into discreet Secure Hash Algorithm (SHA) values, which allows Red Hat to assess workloads for security and version vulnerabilities without disclosing sensitive details</simpara>
</listitem>
<listitem>
<simpara>If an Operator reports an issue, information is collected about core {product-title} pods in the <literal>openshift-&#42;</literal> and <literal>kube-&#42;</literal> projects. This includes state, resource, security context, volume information, and more.</simpara>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>See <link xl:href="../../support/remote_health_monitoring/showing-data-collected-by-remote-health-monitoring.xml#insights-operator-showing-data-collected-from-the-cluster_showing-data-collected-by-remote-health-monitoring">Showing data collected by the Insights Operator</link> for details about how to review the data that is collected by the Insights Operator.</simpara>
</listitem>
<listitem>
<simpara>The Insights Operator source code is available for review and contribution. See the <link xl:href="https://github.com/openshift/insights-operator/blob/master/docs/gathered-data.md">Insights Operator upstream project</link> for a list of the items collected by the Insights Operator.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="understanding-telemetry-and-insights-operator-data-flow_about-remote-health-monitoring">
<title>Understanding Telemetry and Insights Operator data flow</title>
<simpara>The Telemeter Client collects selected time series data from the Prometheus API. The time series data is uploaded to api.openshift.com every four minutes and thirty seconds for processing.</simpara>
<simpara>The Insights Operator gathers selected data from the Kubernetes API and the Prometheus API into an archive. The archive is uploaded to <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link> every two hours for processing. The Insights Operator also downloads the latest Insights analysis from <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>. This is used to populate the <emphasis role="strong">Insights status</emphasis> pop-up that is included in the <emphasis role="strong">Overview</emphasis> page in the {product-title} web console.</simpara>
<simpara>All of the communication with Red Hat occurs over encrypted channels by using Transport Layer Security (TLS) and mutual certificate authentication. All of the data is encrypted in transit and at rest.</simpara>
<simpara>Access to the systems that handle customer data is controlled through multi-factor authentication and strict authorization controls. Access is granted on a need-to-know basis and is limited to required operations.</simpara>
<formalpara>
<title>Telemetry and Insights Operator data flow</title>
<para><inlinemediaobject>
<imageobject>
<imagedata fileref="images/telmetry-and-insights-operator-data-flow.png"/>
</imageobject>
<textobject><phrase>Telemetry and Insights Operator data flow</phrase></textobject>
</inlinemediaobject></para>
</formalpara>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>See <link xl:href="../../monitoring/monitoring-overview.xml#monitoring-overview_monitoring-overview">Monitoring overview</link> for more information about the {product-title} monitoring stack.</simpara>
</listitem>
<listitem>
<simpara>See <link xl:href="../../installing/install_config/configuring-firewall.xml#configuring-firewall">Configuring your firewall</link> for details about configuring a firewall and enabling endpoints for Telemetry and Insights</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="additional-details-about-how-remote-health-monitoring-data-is-used">
<title>Additional details about how remote health monitoring data is used</title>
<simpara>The information collected to enable remote health monitoring is detailed in <link xl:href="../../support/remote_health_monitoring/about-remote-health-monitoring.xml#what-information-is-collected_about-remote-health-monitoring">Information collected by Telemetry</link> and <link xl:href="../../support/remote_health_monitoring/about-remote-health-monitoring.xml#insights-operator-what-information-is-collected_about-remote-health-monitoring">Information collected by the Insights Operator</link>.</simpara>
<simpara>As further described in the preceding sections of this document, Red Hat collects data about your use of the Red Hat Product(s) for purposes such as providing support and upgrades, optimizing performance or configuration, minimizing service impacts, identifying and remediating threats, troubleshooting, improving the offerings and user experience, responding to issues, and for billing purposes if applicable.</simpara>
<formalpara>
<title>Collection safeguards</title>
<para>Red Hat employs technical and organizational measures designed to protect the telemetry and configuration data.</para>
</formalpara>
<formalpara>
<title>Sharing</title>
<para>Red Hat may share the data collected through Telemetry and the Insights Operator internally within Red Hat to improve your user experience. Red Hat may share telemetry and configuration data with its business partners in an aggregated form that does not identify customers to help the partners better understand their markets and their customers’ use of Red Hat offerings or to ensure the successful integration of products jointly supported by those partners.</para>
</formalpara>
<formalpara>
<title>Third parties</title>
<para>Red Hat may engage certain third parties to assist in the collection, analysis, and storage of the Telemetry and configuration data.</para>
</formalpara>
<formalpara>
<title>User control / enabling and disabling telemetry and configuration data collection</title>
<para>You may disable {product-title} Telemetry and the Insights Operator by following the instructions in <link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#opting-out-remote-health-reporting">Opting out of remote health reporting</link>.</para>
</formalpara>
</section>
</section>
<section xml:id="showing-data-collected-by-remote-health-monitoring">
<title>Showing data collected by remote health monitoring</title>

<simpara>As an administrator, you can review the metrics collected by Telemetry and the Insights Operator.</simpara>
<section xml:id="showing-data-collected-from-the-cluster_showing-data-collected-by-remote-health-monitoring">
<title>Showing data collected by Telemetry</title>
<simpara>You can view the cluster and components time series data captured by Telemetry.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have installed the
{product-title}
CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role or the <literal>cluster-monitoring-view</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to a cluster.</simpara>
</listitem>
<listitem>
<simpara>Run the following command, which queries a cluster&#8217;s Prometheus service and returns the full set of time series data captured by Telemetry:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl -G -k -H "Authorization: Bearer $(oc whoami -t)" \
https://$(oc get route prometheus-k8s-federate -n \
openshift-monitoring -o jsonpath="{.spec.host}")/federate \
--data-urlencode 'match[]={__name__=~"cluster:usage:.*"}' \
--data-urlencode 'match[]={__name__="count:up0"}' \
--data-urlencode 'match[]={__name__="count:up1"}' \
--data-urlencode 'match[]={__name__="cluster_version"}' \
--data-urlencode 'match[]={__name__="cluster_version_available_updates"}' \
--data-urlencode 'match[]={__name__="cluster_version_capability"}' \
--data-urlencode 'match[]={__name__="cluster_operator_up"}' \
--data-urlencode 'match[]={__name__="cluster_operator_conditions"}' \
--data-urlencode 'match[]={__name__="cluster_version_payload"}' \
--data-urlencode 'match[]={__name__="cluster_installer"}' \
--data-urlencode 'match[]={__name__="cluster_infrastructure_provider"}' \
--data-urlencode 'match[]={__name__="cluster_feature_set"}' \
--data-urlencode 'match[]={__name__="instance:etcd_object_counts:sum"}' \
--data-urlencode 'match[]={__name__="ALERTS",alertstate="firing"}' \
--data-urlencode 'match[]={__name__="code:apiserver_request_total:rate:sum"}' \
--data-urlencode 'match[]={__name__="cluster:capacity_cpu_cores:sum"}' \
--data-urlencode 'match[]={__name__="cluster:capacity_memory_bytes:sum"}' \
--data-urlencode 'match[]={__name__="cluster:cpu_usage_cores:sum"}' \
--data-urlencode 'match[]={__name__="cluster:memory_usage_bytes:sum"}' \
--data-urlencode 'match[]={__name__="openshift:cpu_usage_cores:sum"}' \
--data-urlencode 'match[]={__name__="openshift:memory_usage_bytes:sum"}' \
--data-urlencode 'match[]={__name__="workload:cpu_usage_cores:sum"}' \
--data-urlencode 'match[]={__name__="workload:memory_usage_bytes:sum"}' \
--data-urlencode 'match[]={__name__="cluster:virt_platform_nodes:sum"}' \
--data-urlencode 'match[]={__name__="cluster:node_instance_type_count:sum"}' \
--data-urlencode 'match[]={__name__="cnv:vmi_status_running:count"}' \
--data-urlencode 'match[]={__name__="cluster:vmi_request_cpu_cores:sum"}' \
--data-urlencode 'match[]={__name__="node_role_os_version_machine:cpu_capacity_cores:sum"}' \
--data-urlencode 'match[]={__name__="node_role_os_version_machine:cpu_capacity_sockets:sum"}' \
--data-urlencode 'match[]={__name__="subscription_sync_total"}' \
--data-urlencode 'match[]={__name__="olm_resolution_duration_seconds"}' \
--data-urlencode 'match[]={__name__="csv_succeeded"}' \
--data-urlencode 'match[]={__name__="csv_abnormal"}' \
--data-urlencode 'match[]={__name__="cluster:kube_persistentvolumeclaim_resource_requests_storage_bytes:provisioner:sum"}' \
--data-urlencode 'match[]={__name__="cluster:kubelet_volume_stats_used_bytes:provisioner:sum"}' \
--data-urlencode 'match[]={__name__="ceph_cluster_total_bytes"}' \
--data-urlencode 'match[]={__name__="ceph_cluster_total_used_raw_bytes"}' \
--data-urlencode 'match[]={__name__="ceph_health_status"}' \
--data-urlencode 'match[]={__name__="odf_system_raw_capacity_total_bytes"}' \
--data-urlencode 'match[]={__name__="odf_system_raw_capacity_used_bytes"}' \
--data-urlencode 'match[]={__name__="odf_system_health_status"}' \
--data-urlencode 'match[]={__name__="job:ceph_osd_metadata:count"}' \
--data-urlencode 'match[]={__name__="job:kube_pv:count"}' \
--data-urlencode 'match[]={__name__="job:odf_system_pvs:count"}' \
--data-urlencode 'match[]={__name__="job:ceph_pools_iops:total"}' \
--data-urlencode 'match[]={__name__="job:ceph_pools_iops_bytes:total"}' \
--data-urlencode 'match[]={__name__="job:ceph_versions_running:count"}' \
--data-urlencode 'match[]={__name__="job:noobaa_total_unhealthy_buckets:sum"}' \
--data-urlencode 'match[]={__name__="job:noobaa_bucket_count:sum"}' \
--data-urlencode 'match[]={__name__="job:noobaa_total_object_count:sum"}' \
--data-urlencode 'match[]={__name__="odf_system_bucket_count", system_type="OCS", system_vendor="Red Hat"}' \
--data-urlencode 'match[]={__name__="odf_system_objects_total", system_type="OCS", system_vendor="Red Hat"}' \
--data-urlencode 'match[]={__name__="noobaa_accounts_num"}' \
--data-urlencode 'match[]={__name__="noobaa_total_usage"}' \
--data-urlencode 'match[]={__name__="console_url"}' \
--data-urlencode 'match[]={__name__="cluster:ovnkube_master_egress_routing_via_host:max"}' \
--data-urlencode 'match[]={__name__="cluster:network_attachment_definition_instances:max"}' \
--data-urlencode 'match[]={__name__="cluster:network_attachment_definition_enabled_instance_up:max"}' \
--data-urlencode 'match[]={__name__="cluster:ingress_controller_aws_nlb_active:sum"}' \
--data-urlencode 'match[]={__name__="cluster:route_metrics_controller_routes_per_shard:min"}' \
--data-urlencode 'match[]={__name__="cluster:route_metrics_controller_routes_per_shard:max"}' \
--data-urlencode 'match[]={__name__="cluster:route_metrics_controller_routes_per_shard:avg"}' \
--data-urlencode 'match[]={__name__="cluster:route_metrics_controller_routes_per_shard:median"}' \
--data-urlencode 'match[]={__name__="cluster:openshift_route_info:tls_termination:sum"}' \
--data-urlencode 'match[]={__name__="insightsclient_request_send_total"}' \
--data-urlencode 'match[]={__name__="cam_app_workload_migrations"}' \
--data-urlencode 'match[]={__name__="cluster:apiserver_current_inflight_requests:sum:max_over_time:2m"}' \
--data-urlencode 'match[]={__name__="cluster:alertmanager_integrations:max"}' \
--data-urlencode 'match[]={__name__="cluster:telemetry_selected_series:count"}' \
--data-urlencode 'match[]={__name__="openshift:prometheus_tsdb_head_series:sum"}' \
--data-urlencode 'match[]={__name__="openshift:prometheus_tsdb_head_samples_appended_total:sum"}' \
--data-urlencode 'match[]={__name__="monitoring:container_memory_working_set_bytes:sum"}' \
--data-urlencode 'match[]={__name__="namespace_job:scrape_series_added:topk3_sum1h"}' \
--data-urlencode 'match[]={__name__="namespace_job:scrape_samples_post_metric_relabeling:topk3"}' \
--data-urlencode 'match[]={__name__="monitoring:haproxy_server_http_responses_total:sum"}' \
--data-urlencode 'match[]={__name__="rhmi_status"}' \
--data-urlencode 'match[]={__name__="status:upgrading:version:rhoam_state:max"}' \
--data-urlencode 'match[]={__name__="state:rhoam_critical_alerts:max"}' \
--data-urlencode 'match[]={__name__="state:rhoam_warning_alerts:max"}' \
--data-urlencode 'match[]={__name__="rhoam_7d_slo_percentile:max"}' \
--data-urlencode 'match[]={__name__="rhoam_7d_slo_remaining_error_budget:max"}' \
--data-urlencode 'match[]={__name__="cluster_legacy_scheduler_policy"}' \
--data-urlencode 'match[]={__name__="cluster_master_schedulable"}' \
--data-urlencode 'match[]={__name__="che_workspace_status"}' \
--data-urlencode 'match[]={__name__="che_workspace_started_total"}' \
--data-urlencode 'match[]={__name__="che_workspace_failure_total"}' \
--data-urlencode 'match[]={__name__="che_workspace_start_time_seconds_sum"}' \
--data-urlencode 'match[]={__name__="che_workspace_start_time_seconds_count"}' \
--data-urlencode 'match[]={__name__="cco_credentials_mode"}' \
--data-urlencode 'match[]={__name__="cluster:kube_persistentvolume_plugin_type_counts:sum"}' \
--data-urlencode 'match[]={__name__="visual_web_terminal_sessions_total"}' \
--data-urlencode 'match[]={__name__="acm_managed_cluster_info"}' \
--data-urlencode 'match[]={__name__="cluster:vsphere_vcenter_info:sum"}' \
--data-urlencode 'match[]={__name__="cluster:vsphere_esxi_version_total:sum"}' \
--data-urlencode 'match[]={__name__="cluster:vsphere_node_hw_version_total:sum"}' \
--data-urlencode 'match[]={__name__="openshift:build_by_strategy:sum"}' \
--data-urlencode 'match[]={__name__="rhods_aggregate_availability"}' \
--data-urlencode 'match[]={__name__="rhods_total_users"}' \
--data-urlencode 'match[]={__name__="instance:etcd_disk_wal_fsync_duration_seconds:histogram_quantile",quantile="0.99"}' \
--data-urlencode 'match[]={__name__="instance:etcd_mvcc_db_total_size_in_bytes:sum"}' \
--data-urlencode 'match[]={__name__="instance:etcd_network_peer_round_trip_time_seconds:histogram_quantile",quantile="0.99"}' \
--data-urlencode 'match[]={__name__="instance:etcd_mvcc_db_total_size_in_use_in_bytes:sum"}' \
--data-urlencode 'match[]={__name__="instance:etcd_disk_backend_commit_duration_seconds:histogram_quantile",quantile="0.99"}' \
--data-urlencode 'match[]={__name__="jaeger_operator_instances_storage_types"}' \
--data-urlencode 'match[]={__name__="jaeger_operator_instances_strategies"}' \
--data-urlencode 'match[]={__name__="jaeger_operator_instances_agent_strategies"}' \
--data-urlencode 'match[]={__name__="appsvcs:cores_by_product:sum"}' \
--data-urlencode 'match[]={__name__="nto_custom_profiles:count"}' \
--data-urlencode 'match[]={__name__="openshift_csi_share_configmap"}' \
--data-urlencode 'match[]={__name__="openshift_csi_share_secret"}' \
--data-urlencode 'match[]={__name__="openshift_csi_share_mount_failures_total"}' \
--data-urlencode 'match[]={__name__="openshift_csi_share_mount_requests_total"}' \
--data-urlencode 'match[]={__name__="cluster:velero_backup_total:max"}' \
--data-urlencode 'match[]={__name__="cluster:velero_restore_total:max"}' \
--data-urlencode 'match[]={__name__="eo_es_storage_info"}' \
--data-urlencode 'match[]={__name__="eo_es_redundancy_policy_info"}' \
--data-urlencode 'match[]={__name__="eo_es_defined_delete_namespaces_total"}' \
--data-urlencode 'match[]={__name__="eo_es_misconfigured_memory_resources_info"}' \
--data-urlencode 'match[]={__name__="cluster:eo_es_data_nodes_total:max"}' \
--data-urlencode 'match[]={__name__="cluster:eo_es_documents_created_total:sum"}' \
--data-urlencode 'match[]={__name__="cluster:eo_es_documents_deleted_total:sum"}' \
--data-urlencode 'match[]={__name__="pod:eo_es_shards_total:max"}' \
--data-urlencode 'match[]={__name__="eo_es_cluster_management_state_info"}' \
--data-urlencode 'match[]={__name__="imageregistry:imagestreamtags_count:sum"}' \
--data-urlencode 'match[]={__name__="imageregistry:operations_count:sum"}' \
--data-urlencode 'match[]={__name__="log_logging_info"}' \
--data-urlencode 'match[]={__name__="log_collector_error_count_total"}' \
--data-urlencode 'match[]={__name__="log_forwarder_pipeline_info"}' \
--data-urlencode 'match[]={__name__="log_forwarder_input_info"}' \
--data-urlencode 'match[]={__name__="log_forwarder_output_info"}' \
--data-urlencode 'match[]={__name__="cluster:log_collected_bytes_total:sum"}' \
--data-urlencode 'match[]={__name__="cluster:log_logged_bytes_total:sum"}' \
--data-urlencode 'match[]={__name__="cluster:kata_monitor_running_shim_count:sum"}' \
--data-urlencode 'match[]={__name__="platform:hypershift_hostedclusters:max"}' \
--data-urlencode 'match[]={__name__="platform:hypershift_nodepools:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_unhealthy_bucket_claims:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_buckets_claims:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_unhealthy_namespace_resources:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_namespace_resources:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_unhealthy_namespace_buckets:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_namespace_buckets:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_accounts:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_usage:max"}' \
--data-urlencode 'match[]={__name__="namespace:noobaa_system_health_status:max"}' \
--data-urlencode 'match[]={__name__="ocs_advanced_feature_usage"}' \
--data-urlencode 'match[]={__name__="os_image_url_override:sum"}'</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="insights-operator-showing-data-collected-from-the-cluster_showing-data-collected-by-remote-health-monitoring">
<title>Showing data collected by the Insights Operator</title>
<simpara>You can review the data that is collected by the Insights Operator.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Find the name of the currently running pod for the Insights Operator:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ INSIGHTS_OPERATOR_POD=$(oc get pods --namespace=openshift-insights -o custom-columns=:metadata.name --no-headers  --field-selector=status.phase=Running)</programlisting>
</listitem>
<listitem>
<simpara>Copy the recent data archives collected by the Insights Operator:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc cp openshift-insights/$INSIGHTS_OPERATOR_POD:/var/lib/insights-operator ./insights-data</programlisting>
</listitem>
</orderedlist>
<simpara>The recent Insights Operator archives are now available in the <literal>insights-data</literal> directory.</simpara>
</section>
</section>
<section xml:id="opting-out-remote-health-reporting">
<title>Opting out of remote health reporting</title>

<simpara>You may choose to opt out of reporting health and usage data for your cluster.</simpara>
<simpara>To opt out of remote health reporting, you must:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#insights-operator-new-pull-secret_opting-out-remote-health-reporting">Modify the global cluster pull secret</link> to disable remote health reporting.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#images-update-global-pull-secret_opting-out-remote-health-reporting">Update the cluster</link> to use this modified pull secret.</simpara>
</listitem>
</orderedlist>
<section xml:id="telemetry-consequences-of-disabling-telemetry_opting-out-remote-health-reporting">
<title>Consequences of disabling remote health reporting</title>
<simpara>In {product-title}, customers can opt out of reporting usage information. However, connected clusters allow Red Hat to react more quickly to problems and better support our customers, as well as better understand how product upgrades impact clusters. Connected clusters also help to simplify the subscription and entitlement process and enable the OpenShift Cluster Manager service to provide an overview of your clusters and their subscription status.</simpara>
<simpara>Red Hat strongly recommends leaving health and usage reporting enabled for pre-production and test clusters even if it is necessary to opt out for production clusters. This allows Red Hat to be a participant in qualifying {product-title} in your environments and react more rapidly to product issues.</simpara>
<simpara>Some of the consequences of opting out of having a connected cluster are:</simpara>
<itemizedlist>
<listitem>
<simpara>Red Hat will not be able to monitor the success of product upgrades or the health of your clusters without a support case being opened.</simpara>
</listitem>
<listitem>
<simpara>Red Hat will not be able to use configuration data to better triage customer support cases and identify which configurations our customers find important.</simpara>
</listitem>
<listitem>
<simpara>The OpenShift Cluster Manager will not show data about your clusters including health and usage information.</simpara>
</listitem>
<listitem>
<simpara>Your subscription entitlement information must be manually entered via console.redhat.com without the benefit of automatic usage reporting.</simpara>
</listitem>
</itemizedlist>
<simpara>In restricted networks, Telemetry and Insights data can still be reported through appropriate configuration of your proxy.</simpara>
</section>
<section xml:id="insights-operator-new-pull-secret_opting-out-remote-health-reporting">
<title>Modifying the global cluster pull secret to disable remote health reporting</title>
<simpara>You can modify your existing global cluster pull secret to disable remote health reporting. This disables both Telemetry and the Insights Operator.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Download the global cluster pull secret to your local file system.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc extract secret/pull-secret -n openshift-config --to=.</programlisting>
</listitem>
<listitem>
<simpara>In a text editor, edit the <literal>.dockerconfigjson</literal> file that was downloaded.</simpara>
</listitem>
<listitem>
<simpara>Remove the <literal>cloud.openshift.com</literal> JSON entry, for example:</simpara>
<programlisting language="json" linenumbering="unnumbered">"cloud.openshift.com":{"auth":"&lt;hash&gt;","email":"&lt;email_address&gt;"}</programlisting>
</listitem>
<listitem>
<simpara>Save the file.</simpara>
</listitem>
</orderedlist>
<simpara>You can now update your cluster to use this modified pull secret.</simpara>
</section>
<section xml:id="insights-operator-register-disconnected-cluster_opting-out-remote-health-reporting">
<title>Registering your disconnected cluster</title>
<simpara>Register your disconnected {product-title} cluster on the Red Hat Hybrid Cloud Console so that your cluster is not impacted by the consequences listed in the section named "Consequences of disabling remote health reporting".</simpara>
<important>
<simpara>By registering your disconnected cluster, you can continue to report your subscription usage to Red Hat. In turn, Red Hat can return accurate usage and capacity trends associated with your subscription, so that you can use the returned information to better organize subscription allocations across all of your resources.</simpara>
</important>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as <literal>cluster-admin</literal>.</simpara>
</listitem>
<listitem>
<simpara>You can log in to the Red Hat Hybrid Cloud Console.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Go to the <link xl:href="https://console.redhat.com/openshift/register"><emphasis role="strong">Register disconnected cluster</emphasis></link> web page on the Red Hat Hybrid Cloud Console.</simpara>
</listitem>
<listitem>
<simpara>Optional: To access the <emphasis role="strong">Register disconnected cluster</emphasis> web page from the home page of the Red Hat Hybrid Cloud Console, go to the <emphasis role="strong">Clusters</emphasis> navigation menu item and then select the <emphasis role="strong">Register cluster</emphasis> button.</simpara>
</listitem>
<listitem>
<simpara>Enter your cluster&#8217;s details in the provided fields on the <emphasis role="strong">Register disconnected cluster</emphasis> page.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Subscription settings</emphasis> section of the page, select the subcription settings that apply to your Red Hat subscription offering.</simpara>
</listitem>
<listitem>
<simpara>To register your disconnected cluster, select the <emphasis role="strong">Register cluster</emphasis> button.</simpara>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#telemetry-consequences-of-disabling-telemetry_opting-out-remote-health-reporting">Consequences of disabling remote health reporting</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/subscription_central/2023/html/getting_started_with_the_subscriptions_service/con-how-does-subscriptionwatch-show-data_assembly-viewing-understanding-subscriptionwatch-data-ctxt">How does the subscriptions service show my subscription data?</link>(Getting Started with the Subscription Service)</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="images-update-global-pull-secret_opting-out-remote-health-reporting">
<title>Updating the global cluster pull secret</title>
<simpara>You can update the global pull secret for your cluster by either replacing the current pull secret or appending a new pull secret.</simpara>
<simpara>The procedure is required when users use a separate registry to store images than the registry used during installation.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Optional: To append a new pull secret to the existing pull secret, complete the following steps:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Enter the following command to download the pull secret:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get secret/pull-secret -n openshift-config --template='{{index .data ".dockerconfigjson" | base64decode}}' &gt;&lt;pull_secret_location&gt; <co xml:id="CO1-1"/></programlisting>
<calloutlist>
<callout arearefs="CO1-1">
<para>Provide the path to the pull secret file.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Enter the following command to add the new pull secret:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc registry login --registry="&lt;registry&gt;" \ <co xml:id="CO2-1"/>
--auth-basic="&lt;username&gt;:&lt;password&gt;" \ <co xml:id="CO2-2"/>
--to=&lt;pull_secret_location&gt; <co xml:id="CO2-3"/></programlisting>
<calloutlist>
<callout arearefs="CO2-1">
<para>Provide the new registry. You can include multiple repositories within the same registry, for example: <literal>--registry="&lt;registry/my-namespace/my-repository&gt;"</literal>.</para>
</callout>
<callout arearefs="CO2-2">
<para>Provide the credentials of the new registry.</para>
</callout>
<callout arearefs="CO2-3">
<para>Provide the path to the pull secret file.</para>
</callout>
</calloutlist>
<simpara>Alternatively, you can perform a manual update to the pull secret file.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Enter the following command to update the global pull secret for your cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc set data secret/pull-secret -n openshift-config --from-file=.dockerconfigjson=&lt;pull_secret_location&gt; <co xml:id="CO3-1"/></programlisting>
<calloutlist>
<callout arearefs="CO3-1">
<para>Provide the path to the new pull secret file.</para>
</callout>
</calloutlist>
<simpara>This update is rolled out to all nodes, which can take some time depending on the size of your cluster.</simpara>
<note>
<simpara>As of {product-title} 4.7.4, changes to the global pull secret no longer trigger a node drain or reboot.</simpara>
</note>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="enabling-remote-health-reporting">
<title>Enabling remote health reporting</title>

<simpara>If you or your organization have disabled remote health reporting, you can enable this feature again. You can see that remote health reporting is disabled from the message "Insights not available" in the <emphasis role="strong">Status</emphasis> tile on the {product-title} Web Console Overview page.</simpara>
<simpara>To enable remote health reporting, you must <link xl:href="../../support/remote_health_monitoring/enabling-remote-health-reporting.xml#insights-operator-new-pull-secret-enable_enabling-remote-health-reporting">Modify the global cluster pull secret</link> with a new authorization token.</simpara>
<note>
<simpara>Enabling remote health reporting enables both Insights Operator and Telemetry.</simpara>
</note>
<section xml:id="insights-operator-new-pull-secret-enable_enabling-remote-health-reporting">
<title>Modifying your global cluster pull secret to enable remote health reporting</title>
<simpara>You can modify your existing global cluster pull secret to enable remote health reporting. If you have previously disabled remote health monitoring, you must first download a new pull secret with your <literal>console.openshift.com</literal> access token from Red Hat OpenShift Cluster Manager.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Access to OpenShift Cluster Manager.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <link xl:href="https://console.redhat.com/openshift/downloads">https://console.redhat.com/openshift/downloads</link>.</simpara>
</listitem>
<listitem>
<simpara>From <emphasis role="strong">Tokens</emphasis> &#8594; <emphasis role="strong">Pull Secret</emphasis>, click <emphasis role="strong">Download</emphasis>.</simpara>
<simpara>The file <literal>pull-secret.txt</literal> containing your <literal>cloud.openshift.com</literal> access token in JSON format downloads:</simpara>
<programlisting language="json" linenumbering="unnumbered">{
  "auths": {
    "cloud.openshift.com": {
      "auth": "<emphasis>&lt;your_token&gt;</emphasis>",
      "email": "<emphasis>&lt;email_address&gt;</emphasis>"
    }
  }
}</programlisting>
</listitem>
<listitem>
<simpara>Download the global cluster pull secret to your local file system.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get secret/pull-secret -n openshift-config --template='{{index .data ".dockerconfigjson" | base64decode}}' &gt; pull-secret</programlisting>
</listitem>
<listitem>
<simpara>Make a backup copy of your pull secret.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ cp pull-secret pull-secret-backup</programlisting>
</listitem>
<listitem>
<simpara>Open the <literal>pull-secret</literal> file in a text editor.</simpara>
</listitem>
<listitem>
<simpara>Append the <literal>cloud.openshift.com</literal> JSON entry from <literal>pull-secret.txt</literal> into <literal>auths</literal>.</simpara>
</listitem>
<listitem>
<simpara>Save the file.</simpara>
</listitem>
<listitem>
<simpara>Update the secret in your cluster.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">oc set data secret/pull-secret -n openshift-config --from-file=.dockerconfigjson=pull-secret</programlisting>
</listitem>
</orderedlist>
<simpara>It may take several minutes for the secret to update and your cluster to begin reporting.</simpara>
<orderedlist numeration="arabic">
<title>Verification</title>
<listitem>
<simpara>Navigate to the {product-title} Web Console Overview page.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Insights</emphasis> in the <emphasis role="strong">Status</emphasis> tile reports the number of issues found.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="using-insights-to-identify-issues-with-your-cluster">
<title>Using Insights to identify issues with your cluster</title>

<simpara>Insights repeatedly analyzes the data Insights Operator sends. Users of {product-title} can display the report in the <link xl:href="https://console.redhat.com/openshift/insights/advisor/">Insights Advisor</link> service on Red Hat Hybrid Cloud Console.</simpara>
<section xml:id="insights-operator-advisor-overview_using-insights-to-identify-issues-with-your-cluster">
<title>About Red Hat Insights Advisor for {product-title}</title>
<simpara>You can use Insights Advisor to assess and monitor the health of your {product-title} clusters. Whether you are concerned about individual clusters, or with your whole infrastructure, it is important to be aware of the exposure of your cluster infrastructure to issues that can affect service availability, fault tolerance, performance, or security.</simpara>
<simpara>Using cluster data collected by the Insights Operator, Insights repeatedly compares that data against a library of <emphasis>recommendations</emphasis>. Each recommendation is a set of cluster-environment conditions that can leave {product-title} clusters at risk. The results of the Insights analysis are available in the Insights Advisor service on Red Hat Hybrid Cloud Console. In the Console, you can perform the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>See clusters impacted by a specific recommendation.</simpara>
</listitem>
<listitem>
<simpara>Use robust filtering capabilities to refine your results to those recommendations.</simpara>
</listitem>
<listitem>
<simpara>Learn more about individual recommendations, details about the risks they present, and get resolutions tailored to your individual clusters.</simpara>
</listitem>
<listitem>
<simpara>Share results with other stakeholders.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="insights-operator-advisor-recommendations_using-insights-to-identify-issues-with-your-cluster">
<title>Understanding Insights Advisor recommendations</title>
<simpara>Insights Advisor bundles information about various cluster states and component configurations that can negatively affect the service availability, fault tolerance, performance, or security of your clusters. This information set is called a recommendation in Insights Advisor and includes the following information:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Name:</emphasis> A concise description of the recommendation</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Added:</emphasis> When the recommendation was published to the Insights Advisor archive</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Category:</emphasis> Whether the issue has the potential to negatively affect service availability, fault tolerance, performance, or security</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Total risk:</emphasis> A value derived from the <emphasis>likelihood</emphasis> that the condition will negatively affect your infrastructure, and the <emphasis>impact</emphasis> on operations if that were to happen</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Clusters:</emphasis> A list of clusters on which a recommendation is detected</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Description:</emphasis> A brief synopsis of the issue, including how it affects your clusters</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Link to associated topics:</emphasis> More information from Red Hat about the issue</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="displaying-potential-issues-with-your-cluster_using-insights-to-identify-issues-with-your-cluster">
<title>Displaying potential issues with your cluster</title>
<simpara>This section describes how to display the Insights report in <emphasis role="strong">Insights Advisor</emphasis> on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
<simpara>Note that Insights repeatedly analyzes your cluster and shows the latest results. These results can change, for example, if you fix an issue or a new issue has been detected.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Your cluster is registered on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Advisor</emphasis> &#8594; <emphasis role="strong">Recommendations</emphasis> on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
<simpara>Depending on the result, Insights Advisor displays one of the following:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">No matching recommendations found</emphasis>, if Insights did not identify any issues.</simpara>
</listitem>
<listitem>
<simpara>A list of issues Insights has detected, grouped by risk (low, moderate, important, and critical).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">No clusters yet</emphasis>, if Insights has not yet analyzed the cluster. The analysis starts shortly after the cluster has been installed, registered, and connected to the internet.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>If any issues are displayed, click the <emphasis role="strong">&gt;</emphasis> icon in front of the entry for more details.</simpara>
<simpara>Depending on the issue, the details can also contain a link to more information from Red Hat about the issue.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="displaying-all-insights-advisor-recommendations_using-insights-to-identify-issues-with-your-cluster">
<title>Displaying all Insights Advisor recommendations</title>
<simpara>The Recommendations view, by default, only displays the recommendations that are detected on your clusters. However, you can view all of the recommendations in the advisor archive.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>Your cluster is <link xl:href="https://console.redhat.com/openshift/register">registered</link> on Red Hat Hybrid Cloud Console.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Advisor</emphasis> &#8594; <emphasis role="strong">Recommendations</emphasis> on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">X</emphasis> icons next to the <emphasis role="strong">Clusters Impacted</emphasis> and <emphasis role="strong">Status</emphasis> filters.</simpara>
<simpara>You can now browse through all of the potential recommendations for your cluster.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="insights-operator-advisor-recommendation-filters_using-insights-to-identify-issues-with-your-cluster">
<title>Advisor recommendation filters</title>
<simpara>The Insights advisor service can return a large number of recommendations. To focus on your most critical recommendations, you can apply filters to the <link xl:href="https://console.redhat.com/openshift/insights/advisor/recommendations">Advisor recommendations</link> list to remove low-priority recommendations.</simpara>
<simpara>By default, filters are set to only show enabled recommendations that are impacting one or more clusters. To view all or disabled recommendations in the Insights library, you can customize the filters.</simpara>
<simpara>To apply a filter, select a filter type and then set its value based on the options that are available in the drop-down list. You can apply multiple filters to the list of recommendations.</simpara>
<simpara>You can set the following filter types:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Name:</emphasis> Search for a recommendation by name.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Total risk:</emphasis> Select one or more values from <emphasis role="strong">Critical</emphasis>, <emphasis role="strong">Important</emphasis>, <emphasis role="strong">Moderate</emphasis>, and <emphasis role="strong">Low</emphasis> indicating the likelihood and the severity of a negative impact on a cluster.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Impact:</emphasis> Select one or more values from <emphasis role="strong">Critical</emphasis>, <emphasis role="strong">High</emphasis>, <emphasis role="strong">Medium</emphasis>, and <emphasis role="strong">Low</emphasis> indicating the potential impact to the continuity of cluster operations.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Likelihood:</emphasis> Select one or more values from <emphasis role="strong">Critical</emphasis>, <emphasis role="strong">High</emphasis>, <emphasis role="strong">Medium</emphasis>, and <emphasis role="strong">Low</emphasis> indicating the potential for a negative impact to a cluster if the recommendation comes to fruition.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Category:</emphasis> Select one or more categories from <emphasis role="strong">Service Availability</emphasis>, <emphasis role="strong">Performance</emphasis>, <emphasis role="strong">Fault Tolerance</emphasis>, <emphasis role="strong">Security</emphasis>, and <emphasis role="strong">Best Practice</emphasis> to focus your attention on.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Status:</emphasis> Click a radio button to show enabled recommendations (default), disabled recommendations, or all recommendations.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Clusters impacted:</emphasis> Set the filter to show recommendations currently impacting one or more clusters, non-impacting recommendations, or all recommendations.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Risk of change:</emphasis> Select one or more values from <emphasis role="strong">High</emphasis>, <emphasis role="strong">Moderate</emphasis>, <emphasis role="strong">Low</emphasis>, and <emphasis role="strong">Very low</emphasis> indicating the risk that the implementation of the resolution could have on cluster operations.</simpara>
</listitem>
</itemizedlist>
<section xml:id="filtering-unnecessary-advisor-recommendations_using-insights-to-identify-issues-with-your-cluster">
<title>Filtering Insights advisor recommendations</title>
<simpara>As an {product-title} cluster manager, you can filter the recommendations that are displayed on the recommendations list. By applying filters, you can reduce the number of reported recommendations and concentrate on your highest priority recommendations.</simpara>
<simpara>The following procedure demonstrates how to set and remove <emphasis role="strong">Category</emphasis> filters; however, the procedure is applicable to any of the filter types and respective values.</simpara>
<formalpara>
<title>Prerequisites</title>
<para>You are logged in to the <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Go to <emphasis role="strong">Red Hat Hybrid Cloud Console</emphasis> &#8594; <emphasis role="strong">OpenShift</emphasis> &#8594; <emphasis role="strong">Advisor recommendations</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the main, filter-type drop-down list, select the <emphasis role="strong">Category</emphasis> filter type.</simpara>
</listitem>
<listitem>
<simpara>Expand the filter-value drop-down list and select the checkbox next to each category of recommendation you want to view. Leave the checkboxes for unnecessary categories clear.</simpara>
</listitem>
<listitem>
<simpara>Optional: Add additional filters to further refine the list.</simpara>
</listitem>
</orderedlist>
<simpara>Only recommendations from the selected categories are shown in the list.</simpara>
<itemizedlist>
<title>Verification</title>
<listitem>
<simpara>After applying filters, you can view the updated recommendations list. The applied filters are added next to the default filters.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="removing-filters-from-insights-recommendations_using-insights-to-identify-issues-with-your-cluster">
<title>Removing filters from Insights Advisor recommendations</title>
<simpara>You can apply multiple filters to the list of recommendations. When ready, you can remove them individually or completely reset them.</simpara>
<itemizedlist>
<title>Removing filters individually</title>
<listitem>
<simpara>Click the <emphasis role="strong">X</emphasis> icon next to each filter, including the default filters, to remove them individually.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Removing all non-default filters</title>
<listitem>
<simpara>Click <emphasis role="strong">Reset filters</emphasis> to remove only the filters that you applied, leaving the default filters in place.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="disabling-insights-advisor-recommendations_using-insights-to-identify-issues-with-your-cluster">
<title>Disabling Insights Advisor recommendations</title>
<simpara>You can disable specific recommendations that affect your clusters, so that they no longer appear in your reports. It is possible to disable a recommendation for a single cluster or all of your clusters.</simpara>
<note>
<simpara>Disabling a recommendation for all of your clusters also applies to any future clusters.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>Your cluster is registered on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Advisor</emphasis> &#8594; <emphasis role="strong">Recommendations</emphasis> on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>Optional: Use the <emphasis role="strong">Clusters Impacted</emphasis> and <emphasis role="strong">Status</emphasis> filters as needed.</simpara>
</listitem>
<listitem>
<simpara>Disable an alert by using one of the following methods:</simpara>
<itemizedlist>
<listitem>
<simpara>To disable an alert:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject> for that alert, and then click <emphasis role="strong">Disable recommendation</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a justification note and click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>To view the clusters affected by this alert before disabling the alert:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the name of the recommendation to disable. You are directed to the single recommendation page.</simpara>
</listitem>
<listitem>
<simpara>Review the list of clusters in the <emphasis role="strong">Affected clusters</emphasis> section.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Actions</emphasis> &#8594; <emphasis role="strong">Disable recommendation</emphasis> to disable the alert for all of your clusters.</simpara>
</listitem>
<listitem>
<simpara>Enter a justification note and click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="enabling-insights-advisor-recommendations_using-insights-to-identify-issues-with-your-cluster">
<title>Enabling a previously disabled Insights Advisor recommendation</title>
<simpara>When a recommendation is disabled for all clusters, you no longer see the recommendation in the Insights Advisor. You can change this behavior.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>Your cluster is registered on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Advisor</emphasis> &#8594; <emphasis role="strong">Recommendations</emphasis> on <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>Filter the recommendations to display on the disabled recommendations:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From the <emphasis role="strong">Status</emphasis> drop-down menu, select <emphasis role="strong">Status</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Filter by status</emphasis> drop-down menu, select <emphasis role="strong">Disabled</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optional: Clear the <emphasis role="strong">Clusters impacted</emphasis> filter.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Locate the recommendation to enable.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Enable recommendation</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="displaying-the-insights-status-in-the-web-console_using-insights-to-identify-issues-with-your-cluster">
<title>Displaying the Insights status in the web console</title>
<simpara>Insights repeatedly analyzes your cluster and you can display the status of identified potential issues of your cluster in the {product-title} web console. This status shows the number of issues in the different categories and, for further details, links to the reports in <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Your cluster is registered in <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link>.</simpara>
</listitem>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to the {product-title} web console.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Home</emphasis> &#8594; <emphasis role="strong">Overview</emphasis> in the {product-title} web console.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Insights</emphasis> on the <emphasis role="strong">Status</emphasis> card.</simpara>
<simpara>The pop-up window lists potential issues grouped by risk. Click the individual categories or <emphasis role="strong">View all recommendations in Insights Advisor</emphasis> to display more details.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="using-insights-operator">
<title>Using the Insights Operator</title>

<simpara>The Insights Operator periodically gathers configuration and component failure status and, by default, reports that data every two hours to Red Hat. This information enables Red Hat to assess configuration and deeper failure data than is reported through Telemetry. Users of {product-title} can display the report in the <link xl:href="https://console.redhat.com/openshift/insights/advisor/">Insights Advisor</link> service on Red Hat Hybrid Cloud Console.</simpara>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>The Insights Operator is installed and enabled by default. If you need to opt out of remote health reporting, see <link xl:href="../../support/remote_health_monitoring/opting-out-of-remote-health-reporting.xml#opting-out-remote-health-reporting">Opting out of remote health reporting</link>.</simpara>
</listitem>
<listitem>
<simpara>For more information on using Insights Advisor to identify issues with your cluster, see <link xl:href="../../support/remote_health_monitoring/using-insights-to-identify-issues-with-your-cluster.xml#using-insights-to-identify-issues-with-your-cluster">Using Insights to identify issues with your cluster</link>.</simpara>
</listitem>
</itemizedlist>
<section xml:id="understanding-insights-operator-alerts_using-insights-operator">
<title>Understanding Insights Operator alerts</title>
<simpara>The Insights Operator declares alerts through the Prometheus monitoring system to the Alertmanager. You can view these alerts in the Alerting UI in the {product-title} web console by using one of the following methods:</simpara>
<itemizedlist>
<listitem>
<simpara>In the <emphasis role="strong">Administrator</emphasis> perspective, click <emphasis role="strong">Observe</emphasis> &#8594; <emphasis role="strong">Alerting</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Developer</emphasis> perspective, click <emphasis role="strong">Observe</emphasis> &#8594; &lt;project_name&gt; &#8594; <emphasis role="strong">Alerts</emphasis> tab.</simpara>
</listitem>
</itemizedlist>
<simpara>Currently, Insights Operator sends the following alerts when the conditions are met:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Insights Operator alerts</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Alert</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>InsightsDisabled</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Insights Operator is disabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>SimpleContentAccessNotAvailable</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Simple content access is not enabled in Red Hat Subscription Management.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>InsightsRecommendationActive</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Insights has an active recommendation for the cluster.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="disabling-insights-operator-alerts_using-insights-operator">
<title>Disabling Insights Operator alerts</title>
<simpara>To prevent the Insights Operator from sending alerts to the cluster Prometheus instance, you edit the <literal>support</literal> secret. If the <literal>support</literal> secret doesn&#8217;t exist, you must create it when you first add custom configurations. Note that configurations within the <literal>support</literal> secret take precedence over the default settings defined in the <literal>pod.yaml</literal> file.
To prevent the Insights Operator from sending alerts to the cluster Prometheus instance, you edit the <literal>support</literal> secret. Note that this <literal>secret</literal> is created by default. The configurations stored in the support secret take precedence over any default settings specified in the <literal>pod.yaml</literal> file.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to the {product-title} web console as <literal>cluster-admin</literal>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Secrets</emphasis> page, select <emphasis role="strong">All Projects</emphasis> from the <emphasis role="strong">Project</emphasis> list, and then set <emphasis role="strong">Show default projects</emphasis> to on.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project from the <emphasis role="strong">Projects</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret by using the <emphasis role="strong">Search by name</emphasis> field.</simpara>
<itemizedlist>
<listitem>
<simpara>If the secret exists:</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Key/Value</emphasis>.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, enter <literal>disableInsightsAlerts</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> field, enter <literal>True</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>If the secret does not exist:</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis> &#8594; <emphasis role="strong">Key/value secret</emphasis>.</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>In the <emphasis role="strong">Secret name</emphasis> field, enter <literal>support</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, enter <literal>disableInsightsAlerts</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> field, enter <literal>True</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<simpara>After you save the changes, Insights Operator no longer sends alerts to the cluster Prometheus instance.</simpara>
</section>
<section xml:id="enabling-insights-operator-alerts_using-insights-operator">
<title>Enabling Insights Operator alerts</title>
<simpara>When alerts are disabled, the Insights Operator no longer sends alerts to the cluster Prometheus instance. You can change this behavior.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Remote health reporting is enabled, which is the default.</simpara>
</listitem>
<listitem>
<simpara>You are logged in to the {product-title} web console as <literal>cluster-admin</literal>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Secrets</emphasis> page, select <emphasis role="strong">All Projects</emphasis> from the <emphasis role="strong">Project</emphasis> list, and then set <emphasis role="strong">Show default projects</emphasis> to <emphasis role="strong">ON</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project from the <emphasis role="strong">Projects</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret by using the <emphasis role="strong">Search by name</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For the <literal>disableInsightsAlerts</literal> key, set the <emphasis role="strong">Value</emphasis> field to <literal>false</literal>.</simpara>
</listitem>
</orderedlist>
<simpara>After you save the changes, Insights Operator again sends alerts to the cluster Prometheus instance.</simpara>
</section>
<section xml:id="insights-operator-downloading-archive_using-insights-operator">
<title>Downloading your Insights Operator archive</title>
<simpara>Insights Operator stores gathered data in an archive located in the <literal>openshift-insights</literal> namespace of your cluster. You can download and review the data that is gathered by the Insights Operator.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Find the name of the running pod for the Insights Operator:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods --namespace=openshift-insights -o custom-columns=:metadata.name --no-headers  --field-selector=status.phase=Running</programlisting>
</listitem>
<listitem>
<simpara>Copy the recent data archives collected by the Insights Operator:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc cp openshift-insights/&lt;insights_operator_pod_name&gt;:/var/lib/insights-operator ./insights-data <co xml:id="CO4-1"/></programlisting>
<calloutlist>
<callout arearefs="CO4-1">
<para>Replace <literal>&lt;insights_operator_pod_name&gt;</literal> with the pod name output from the preceding command.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
<simpara>The recent Insights Operator archives are now available in the <literal>insights-data</literal> directory.</simpara>
</section>
<section xml:id="insights-operator-gather-duration_using-insights-operator">
<title>Viewing Insights Operator gather durations</title>
<simpara>You can view the time it takes for the Insights Operator to gather the information contained in the archive. This helps you to understand Insights Operator resource usage and issues with Insights Advisor.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>A recent copy of your Insights Operator archive.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>From your archive, open <literal>/insights-operator/gathers.json</literal>.</simpara>
<simpara>The file contains a list of Insights Operator gather operations:</simpara>
<programlisting language="json" linenumbering="unnumbered">    {
      "name": "clusterconfig/authentication",
      "duration_in_ms": 730, <co xml:id="CO5-1"/>
      "records_count": 1,
      "errors": null,
      "panic": null
    }</programlisting>
<calloutlist>
<callout arearefs="CO5-1">
<para><literal>duration_in_ms</literal> is the amount of time in milliseconds for each gather operation.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Inspect each gather operation for abnormalities.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="disabling-insights-operator-gather_using-insights-operator">
<title>Disabling the Insights Operator gather operations</title>
<simpara>You can disable the Insights Operator gather operations. Disabling the gather operations gives you the ability to increase privacy for your organization as Insights Operator will no longer gather and send Insights cluster reports to Red Hat. This will disable Insights analysis and recommendations for your cluster without affecting other core functions that require communication with Red Hat such as cluster transfers. You can view a list of attempted gather operations for your cluster from the <literal>/insights-operator/gathers.json</literal> file in your Insights Operator archive. Be aware that some gather operations only occur when certain conditions are met and might not appear in your most recent archive.</simpara>
<important>
<simpara>The <literal>InsightsDataGather</literal> custom resource is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</simpara>
<simpara>For more information about the support scope of Red Hat Technology Preview features, see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</link>.</simpara>
</important>
<note>
<simpara>If you enable Technology Preview in your cluster, the Insights Operator runs gather operations in individual pods. This is part of the Technology Preview feature set for the Insights Operator and supports the new data gathering features.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administration</emphasis> &#8594; <emphasis role="strong">CustomResourceDefinitions</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">CustomResourceDefinitions</emphasis> page, use the <emphasis role="strong">Search by name</emphasis> field to find the <emphasis role="strong">InsightsDataGather</emphasis> resource definition and click it.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">CustomResourceDefinition details</emphasis> page, click the <emphasis role="strong">Instances</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">cluster</emphasis>, and then click the <emphasis role="strong">YAML</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Disable the gather operations by performing one of the following edits to the <literal>InsightsDataGather</literal> configuration file:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>To disable all the gather operations, enter <literal>all</literal> under the <literal>disabledGatherers</literal> key:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: config.openshift.io/v1alpha1
kind: InsightsDataGather
metadata:
....

spec: <co xml:id="CO6-1"/>
  gatherConfig:
    disabledGatherers:
      - all <co xml:id="CO6-2"/></programlisting>
<calloutlist>
<callout arearefs="CO6-1">
<para>The <literal>spec</literal> parameter specifies gather configurations.</para>
</callout>
<callout arearefs="CO6-2">
<para>The <literal>all</literal> value disables all gather operations.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To disable individual gather operations, enter their values under the <literal>disabledGatherers</literal> key:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">spec:
  gatherConfig:
    disabledGatherers:
      - clusterconfig/container_images <co xml:id="CO7-1"/>
      - clusterconfig/host_subnets
      - workloads/workload_info</programlisting>
<calloutlist>
<callout arearefs="CO7-1">
<para>Example individual gather operation</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
<simpara>After you save the changes, the Insights Operator gather configurations are updated and the operations will no longer occur.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Disabling gather operations degrades Insights Advisor&#8217;s ability to offer effective recommendations for your cluster.</simpara>
</note>
</section>
<section xml:id="enabling-insights-operator-gather_using-insights-operator">
<title>Enabling the Insights Operator gather operations</title>
<simpara>You can enable the Insights Operator gather operations, if the gather operations have been disabled.</simpara>
<important>
<simpara>The <literal>InsightsDataGather</literal> custom resource is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</simpara>
<simpara>For more information about the support scope of Red Hat Technology Preview features, see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</link>.</simpara>
</important>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administration</emphasis> &#8594; <emphasis role="strong">CustomResourceDefinitions</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">CustomResourceDefinitions</emphasis> page, use the <emphasis role="strong">Search by name</emphasis> field to find the <emphasis role="strong">InsightsDataGather</emphasis> resource definition and click it.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">CustomResourceDefinition details</emphasis> page, click the <emphasis role="strong">Instances</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">cluster</emphasis>, and then click the <emphasis role="strong">YAML</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Enable the gather operations by performing one of the following edits:</simpara>
<itemizedlist>
<listitem>
<simpara>To enable all disabled gather operations, remove the <literal>gatherConfig</literal> stanza:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: config.openshift.io/v1alpha1
kind: InsightsDataGather
metadata:
....

spec:
  gatherConfig: <co xml:id="CO8-1"/>
    disabledGatherers: all</programlisting>
<calloutlist>
<callout arearefs="CO8-1">
<para>Remove the <literal>gatherConfig</literal> stanza to enable all gather operations.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To enable individual gather operations, remove their values under the <literal>disabledGatherers</literal> key:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">spec:
  gatherConfig:
    disabledGatherers:
      - clusterconfig/container_images <co xml:id="CO9-1"/>
      - clusterconfig/host_subnets
      - workloads/workload_info</programlisting>
<calloutlist>
<callout arearefs="CO9-1">
<para>Remove one or more gather operations.</para>
</callout>
</calloutlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
<simpara>After you save the changes, the Insights Operator gather configurations are updated and the affected gather operations start.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Disabling gather operations degrades Insights Advisor&#8217;s ability to offer effective recommendations for your cluster.</simpara>
</note>
</section>
<section xml:id="running-insights-operator-gather_using-insights-operator">
<title>Running an Insights Operator gather operation</title>
<simpara>You can run Insights Operator data gather operations on demand. The following procedures describe how to run the default list of gather operations using the OpenShift web console or CLI. You can customize the on demand gather function to exclude any gather operations you choose. Disabling gather operations from the default list degrades Insights Advisor&#8217;s ability to offer effective recommendations for your cluster. If you have previously disabled Insights Operator gather operations in your cluster, this procedure will override those parameters.</simpara>
<important>
<simpara>The <literal>DataGather</literal> custom resource is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</simpara>
<simpara>For more information about the support scope of Red Hat Technology Preview features, see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</link>.</simpara>
</important>
<note>
<simpara>If you enable Technology Preview in your cluster, the Insights Operator runs gather operations in individual pods. This is part of the Technology Preview feature set for the Insights Operator and supports the new data gathering features.</simpara>
</note>
<section xml:id="running-insights-operator-gather-web-console_using-insights-operator">
<title>Running an Insights Operator gather operation using the web console</title>
<simpara>You can run an Insights Operator gather operation using the {product-title} web console.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administration</emphasis> &#8594; <emphasis role="strong">CustomResourceDefinitions</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">CustomResourceDefinitions</emphasis> page, use the <emphasis role="strong">Search by name</emphasis> field to find the <emphasis role="strong">DataGather</emphasis> resource definition and click it.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">CustomResourceDefinition details</emphasis> page, click the <emphasis role="strong">Instances</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create DataGather</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>To create a new <literal>DataGather</literal> operation, edit the configuration file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: insights.openshift.io/v1alpha1
kind: DataGather
metadata:
  name: &lt;your_data_gather&gt; <co xml:id="CO10-1"/>
spec:
 gatherers: <co xml:id="CO10-2"/>
   - name: workloads
     state: Disabled</programlisting>
<calloutlist>
<callout arearefs="CO10-1">
<para>Replace the <literal>&lt;your_data_gather&gt;</literal> with a unique name for your gather operation.</para>
</callout>
<callout arearefs="CO10-2">
<para>Enter individual gather operations to disable under the <literal>gatherers</literal> parameter. This example disables the <literal>workloads</literal> data gather operation and will run the remainder of the default operations. To run the complete list of default gather operations, leave the <literal>spec</literal> parameter empty. You can find the complete list of gather operations in the Insights Operator documentation.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Verification</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Pods</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the Pods page, select the <emphasis role="strong">Project</emphasis> pulldown menu, and then turn on Show default projects.</simpara>
</listitem>
<listitem>
<simpara>Select the <literal>openshift-insights</literal> project from the <emphasis role="strong">Project</emphasis> pulldown menu.</simpara>
</listitem>
<listitem>
<simpara>Check that your new gather operation is prefixed with your chosen name under the list of pods in the <literal>openshift-insights</literal> project. Upon completion, the Insights Operator automatically uploads the data to Red Hat for processing.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="running-insights-operator-gather-openshift-cli_using-insights-operator">
<title>Running an Insights Operator gather operation using the OpenShift CLI</title>
<simpara>You can run an Insights Operator gather operation using the {product-title} command line interface.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to {product-title} as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Enter the following command to run the gather operation:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc apply -f &lt;your_datagather_definition&gt;.yaml</programlisting>
<simpara>Replace <literal>&lt;your_datagather_definition&gt;.yaml</literal> with a configuration file using the following parameters:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: insights.openshift.io/v1alpha1
kind: DataGather
metadata:
  name: &lt;your_data_gather&gt; <co xml:id="CO11-1"/>
spec:
 gatherers: <co xml:id="CO11-2"/>
   - name: workloads
     state: Disabled</programlisting>
<calloutlist>
<callout arearefs="CO11-1">
<para>Replace the <literal>&lt;your_data_gather&gt;</literal> with a unique name for your gather operation.</para>
</callout>
<callout arearefs="CO11-2">
<para>Enter individual gather operations to disable under the <literal>gatherers</literal> parameter. This example disables the <literal>workloads</literal> data gather operation and will run the remainder of the default operations. To run the complete list of default gather operations, leave the <literal>spec</literal> parameter empty. You can find the complete list of gather operations in the Insights Operator documentation.</para>
</callout>
</calloutlist>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Verification</title>
<listitem>
<simpara>Check that your new gather operation is prefixed with your chosen name under the list of pods in the <literal>openshift-insights</literal> project. Upon completion, the Insights Operator automatically uploads the data to Red Hat for processing.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="insights-operator-configuring_using-insights-operator">
<title>Configuring Insights Operator</title>
<simpara>You can configure Insights Operator to meet the needs of your organization. The Insights Operator is configured using a combination of the default configurations in the <literal>pod.yaml</literal> file in the Insights Operator <literal>Config</literal> directory and the configurations stored in the <literal>support</literal> secret in the <literal>openshift-config</literal> namespace. The <literal>support</literal> secret does not exist by default and must be created when adding custom configurations for the first time. Configurations in the <literal>support</literal> secret override the defaults set in the <literal>pod.yaml</literal> file.</simpara>
<simpara>The table below describes the available configuration attributes:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Insights Operator configurable attributes</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Attribute name</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Value type</entry>
<entry align="left" valign="top">Default value</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>enableGlobalObfuscation</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Enables the global obfuscation of IP addresses and the cluster domain name</simpara></entry>
<entry align="left" valign="top"><simpara>Boolean</simpara></entry>
<entry align="left" valign="top"><simpara><literal>false</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>scaInterval</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Specifies the frequency of the simple content access entitlements download</simpara></entry>
<entry align="left" valign="top"><simpara>Time interval</simpara></entry>
<entry align="left" valign="top"><simpara><literal>8h</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>scaPullDisabled</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Disables the simple content access entitlements download</simpara></entry>
<entry align="left" valign="top"><simpara>Boolean</simpara></entry>
<entry align="left" valign="top"><simpara><literal>false</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>clusterTransferInterval</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Specifies how often Insights Operator checks OpenShift Cluster Manager for available cluster transfers</simpara></entry>
<entry align="left" valign="top"><simpara>Time interval</simpara></entry>
<entry align="left" valign="top"><simpara><literal>24h</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>disableInsightsAlerts</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Disables Insights Operator alerts to the cluster Prometheus instance</simpara></entry>
<entry align="left" valign="top"><simpara>Boolean</simpara></entry>
<entry align="left" valign="top"><simpara><literal>False</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>This procedure describes how to set custom Insights Operator configurations.</simpara>
<important>
<simpara>Red Hat recommends you consult Red Hat Support before making changes to the default Insights Operator configuration.</simpara>
</important>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as a user with <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Secrets</emphasis> page, select <emphasis role="strong">All Projects</emphasis> from the <emphasis role="strong">Project</emphasis> list, and then set <emphasis role="strong">Show default projects</emphasis> to on.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project from the <emphasis role="strong">Project</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret using the <emphasis role="strong">Search by name</emphasis> field. If it does not exist, click <emphasis role="strong">Create</emphasis> &#8594; <emphasis role="strong">Key/value secret</emphasis> to create it.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject> for the secret, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Key/Value</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter an attribute name with an appropriate value (see table above), and click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Repeat the above steps for any additional configurations.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="remote-health-reporting-from-restricted-network">
<title>Using remote health reporting in a restricted network</title>

<simpara>You can manually gather and upload Insights Operator archives to diagnose issues from a restricted network.</simpara>
<simpara>To use the Insights Operator in a restricted network, you must:</simpara>
<itemizedlist>
<listitem>
<simpara>Create a copy of your Insights Operator archive.</simpara>
</listitem>
<listitem>
<simpara>Upload the Insights Operator archive to <link xl:href="https://console.redhat.com">console.redhat.com</link>.</simpara>
</listitem>
</itemizedlist>
<simpara>Additionally, you can choose to <link xl:href="../../support/remote_health_monitoring/remote-health-reporting-from-restricted-network.xml#insights-operator-enable-obfuscation_remote-health-reporting-from-restricted-network">obfuscate</link> the Insights Operator data before upload.</simpara>
<section xml:id="insights-operator-one-time-gather_remote-health-reporting-from-restricted-network">
<title>Running an Insights Operator gather operation</title>
<simpara>You must run a gather operation to create an Insights Operator archive.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to {product-title} as <literal>cluster-admin</literal>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Create a file named <literal>gather-job.yaml</literal> using this template:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">link:https://raw.githubusercontent.com/openshift/insights-operator/release-4.15/docs/gather-job.yaml[role=include]</programlisting>
</listitem>
<listitem>
<simpara>Copy your <literal>insights-operator</literal> image version:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get -n openshift-insights deployment insights-operator -o yaml</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: apps/v1
kind: Deployment
metadata:
  name: insights-operator
  namespace: openshift-insights
# ...
spec:
  template:
# ...
    spec:
      containers:
      - args:
# ...
        image: registry.ci.openshift.org/ocp/4.15-2023-10-12-212500@sha256:a0aa581400805ad0... <co xml:id="CO12-1"/>
# ...</programlisting>
</para>
</formalpara>
<calloutlist>
<callout arearefs="CO12-1">
<para>Specifies your <literal>insights-operator</literal> image version.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Paste your image version in <literal>gather-job.yaml</literal>:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: batch/v1
kind: Job
metadata:
  name: insights-operator-job
# ...
spec:
# ...
  template:
    spec:
    initContainers:
    - name: insights-operator
      image: image: registry.ci.openshift.org/ocp/4.15-2023-10-12-212500@sha256:a0aa581400805ad0... <co xml:id="CO13-1"/>
      terminationMessagePolicy: FallbackToLogsOnError
      volumeMounts:</programlisting>
<calloutlist>
<callout arearefs="CO13-1">
<para>Replace any existing value with your <literal>insights-operator</literal> image version.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create the gather job:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc apply -n openshift-insights -f gather-job.yaml</programlisting>
</listitem>
<listitem>
<simpara>Find the name of the job pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe -n openshift-insights job/insights-operator-job</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Name:             insights-operator-job
Namespace:        openshift-insights
# ...
Events:
  Type    Reason            Age    From            Message
  ----    ------            ----   ----            -------
  Normal  SuccessfulCreate  7m18s  job-controller  Created pod: insights-operator-job-&lt;your_job&gt;</programlisting>
</para>
</formalpara>
<variablelist>
<varlistentry>
<term>where</term>
<listitem>
<simpara><literal>insights-operator-job-&lt;your_job&gt;</literal> is the name of the pod.</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
<listitem>
<simpara>Verify that the operation has finished:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs -n openshift-insights insights-operator-job-&lt;your_job&gt; insights-operator</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">I0407 11:55:38.192084       1 diskrecorder.go:34] Wrote 108 records to disk in 33ms</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Save the created archive:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc cp openshift-insights/insights-operator-job-<emphasis>&lt;your_job&gt;</emphasis>:/var/lib/insights-operator ./insights-data</programlisting>
</listitem>
<listitem>
<simpara>Clean up the job:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete -n openshift-insights job insights-operator-job</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="insights-operator-manual-upload_remote-health-reporting-from-restricted-network">
<title>Uploading an Insights Operator archive</title>
<simpara>You can manually upload an Insights Operator archive to <link xl:href="https://console.redhat.com">console.redhat.com</link> to diagnose potential issues.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to {product-title} as <literal>cluster-admin</literal>.</simpara>
</listitem>
<listitem>
<simpara>You have a workstation with unrestricted internet access.</simpara>
</listitem>
<listitem>
<simpara>You have created a copy of the Insights Operator archive.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Download the <literal>dockerconfig.json</literal> file:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc extract secret/pull-secret -n openshift-config --to=.</programlisting>
</listitem>
<listitem>
<simpara>Copy your <literal>"cloud.openshift.com"</literal> <literal>"auth"</literal> token from the <literal>dockerconfig.json</literal> file:</simpara>
<programlisting language="json" linenumbering="unnumbered">{
  "auths": {
    "cloud.openshift.com": {
      "auth": "<emphasis>&lt;your_token&gt;</emphasis>",
      "email": "asd@redhat.com"
    }
}</programlisting>
</listitem>
<listitem>
<simpara>Upload the archive to <link xl:href="https://console.redhat.com">console.redhat.com</link>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl -v -H "User-Agent: insights-operator/one10time200gather184a34f6a168926d93c330 cluster/<emphasis>&lt;cluster_id&gt;</emphasis>" -H "Authorization: Bearer <emphasis>&lt;your_token&gt;</emphasis>" -F "upload=@<emphasis>&lt;path_to_archive&gt;</emphasis>; type=application/vnd.redhat.openshift.periodic+tar" https://console.redhat.com/api/ingress/v1/upload</programlisting>
<simpara>where <literal><emphasis>&lt;cluster_id&gt;</emphasis></literal> is your cluster ID, <literal><emphasis>&lt;your_token&gt;</emphasis></literal> is the token from your pull secret, and <literal><emphasis>&lt;path_to_archive&gt;</emphasis></literal> is the path to the Insights Operator archive.</simpara>
<simpara>If the operation is successful, the command returns a <literal>"request_id"</literal> and <literal>"account_number"</literal>:</simpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">* Connection #0 to host console.redhat.com left intact
{"request_id":"393a7cf1093e434ea8dd4ab3eb28884c","upload":{"account_number":"6274079"}}%</programlisting>
</para>
</formalpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Verification steps</title>
<listitem>
<simpara>Log in to <link xl:href="https://console.redhat.com/openshift">https://console.redhat.com/openshift</link>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Clusters</emphasis> menu in the left pane.</simpara>
</listitem>
<listitem>
<simpara>To display the details of the cluster, click the cluster name.</simpara>
</listitem>
<listitem>
<simpara>Open the <emphasis role="strong">Insights Advisor</emphasis> tab of the cluster.</simpara>
<simpara>If the upload was successful, the tab displays one of the following:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Your cluster passed all recommendations</emphasis>, if Insights Advisor did not identify any issues.</simpara>
</listitem>
<listitem>
<simpara>A list of issues that Insights Advisor has detected, prioritized by risk (low, moderate, important, and critical).</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="insights-operator-enable-obfuscation_remote-health-reporting-from-restricted-network">
<title>Enabling Insights Operator data obfuscation</title>
<simpara>You can enable obfuscation to mask sensitive and identifiable IPv4 addresses and cluster base domains that the Insights Operator sends to <link xl:href="https://console.redhat.com">console.redhat.com</link>.</simpara>
<warning>
<simpara>Although this feature is available, Red Hat recommends keeping obfuscation disabled for a more effective support experience.</simpara>
</warning>
<simpara>Obfuscation assigns non-identifying values to cluster IPv4 addresses, and uses a translation table that is retained in memory to change IP addresses to their obfuscated versions throughout the Insights Operator archive before uploading the data to <link xl:href="https://console.redhat.com">console.redhat.com</link>.</simpara>
<simpara>For cluster base domains, obfuscation changes the base domain to a hardcoded substring. For example, <literal>cluster-api.openshift.example.com</literal> becomes <literal>cluster-api.&lt;CLUSTER_BASE_DOMAIN&gt;</literal>.</simpara>
<simpara>The following procedure enables obfuscation using the <literal>support</literal> secret in the <literal>openshift-config</literal> namespace.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as <literal>cluster-admin</literal>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret using the <emphasis role="strong">Search by name</emphasis> field. If it does not exist, click <emphasis role="strong">Create</emphasis> &#8594; <emphasis role="strong">Key/value secret</emphasis> to create it.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Key/Value</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Create a key named <literal>enableGlobalObfuscation</literal> with a value of <literal>true</literal>, and click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Pods</emphasis></simpara>
</listitem>
<listitem>
<simpara>Select the <literal>openshift-insights</literal> project.</simpara>
</listitem>
<listitem>
<simpara>Find the <literal>insights-operator</literal> pod.</simpara>
</listitem>
<listitem>
<simpara>To restart the <literal>insights-operator</literal> pod, click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Delete Pod</emphasis>.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Verification</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-insights</emphasis> project.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">obfuscation-translation-table</emphasis> secret using the <emphasis role="strong">Search by name</emphasis> field.</simpara>
</listitem>
</orderedlist>
<simpara>If the <literal>obfuscation-translation-table</literal> secret exists, then obfuscation is enabled and working.</simpara>
<simpara>Alternatively, you can inspect <literal>/insights-operator/gathers.json</literal> in your Insights Operator archive for the value <literal>"is_global_obfuscation_enabled": true</literal>.</simpara>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>For more information on how to download your Insights Operator archive, see <link xl:href="../../support/remote_health_monitoring/showing-data-collected-by-remote-health-monitoring.xml#insights-operator-showing-data-collected-from-the-cluster_showing-data-collected-by-remote-health-monitoring">Showing data collected by the Insights Operator</link>.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="insights-operator-simple-access">
<title>Importing simple content access entitlements with Insights Operator</title>

<simpara>Insights Operator periodically imports your simple content access entitlements from <link xl:href="https://console.redhat.com/openshift">OpenShift Cluster Manager Hybrid Cloud Console</link> and stores them in the <literal>etc-pki-entitlement</literal> secret in the <literal>openshift-config-managed</literal> namespace. Simple content access is a capability in Red Hat subscription tools which simplifies the behavior of the entitlement tooling. This feature makes it easier to consume the content provided by your Red Hat subscriptions without the complexity of configuring subscription tooling.</simpara>
<simpara>Insights Operator imports simple content access entitlements every eight hours, but can be configured or disabled using the <literal>support</literal> secret in the <literal>openshift-config</literal> namespace.</simpara>
<note>
<simpara>Simple content access must be enabled in Red Hat Subscription Management for the importing to function.</simpara>
</note>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>See <link xl:href="https://access.redhat.com/documentation/en-us/subscription_central/2021/html-single/getting_started_with_simple_content_access/index#assembly-about-simplecontent">About simple content access</link> in the Red Hat Subscription Central documentation, for more information about simple content access.</simpara>
</listitem>
<listitem>
<simpara>See <link xl:href="../../cicd/builds/running-entitled-builds.xml">Using Red Hat subscriptions in builds</link> for more information about using simple content access entitlements in {product-title} builds.</simpara>
</listitem>
</itemizedlist>
<section xml:id="insights-operator-configuring-sca_remote-health-reporting-from-restricted-network">
<title>Configuring simple content access import interval</title>
<simpara>You can configure how often the Insights Operator imports the simple content access entitlements by using the <literal>support</literal> secret in the <literal>openshift-config</literal> namespace. The entitlement import normally occurs every eight hours, but you can shorten this interval if you update your simple content access configuration in Red Hat Subscription Management.</simpara>
<simpara>This procedure describes how to update the import interval to one hour.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret by using the <emphasis role="strong">Search by name</emphasis> field. If it does not exist, click <emphasis role="strong">Create</emphasis> &#8594; <emphasis role="strong">Key/value secret</emphasis> to create it.</simpara>
<itemizedlist>
<listitem>
<simpara>If the secret exists:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Key/Value</emphasis>.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, enter <literal>scaInterval</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> field, enter <literal>1h</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If the secret does not exist:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis> &#8594; <emphasis role="strong">Key/value secret</emphasis>.</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>In the <emphasis role="strong">Secret name</emphasis> field, enter <literal>support</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, enter <literal>scaInterval</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> field, enter <literal>1h</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
<note>
<simpara>The interval <literal>1h</literal> can also be entered as <literal>60m</literal> for 60 minutes.</simpara>
</note>
</listitem>
</orderedlist>
</section>
<section xml:id="insights-operator-disabling-sca_remote-health-reporting-from-restricted-network">
<title>Disabling simple content access import</title>
<simpara>You can disable the importing of simple content access entitlements by using the <literal>support</literal> secret in the <literal>openshift-config</literal> namespace.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as <literal>cluster-admin</literal>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret using the <emphasis role="strong">Search by name</emphasis> field.</simpara>
<itemizedlist>
<listitem>
<simpara>If the secret exists:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Key/Value</emphasis>.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, enter <literal>scaPullDisabled</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> field, enter <literal>true</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If the secret does not exist:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis> &#8594; <emphasis role="strong">Key/value secret</emphasis>.</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>In the <emphasis role="strong">Secret name</emphasis> field, enter <literal>support</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, enter <literal>scaPullDisabled</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> field, enter <literal>true</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
<simpara>The simple content access entitlement import is now disabled.</simpara>
<note>
<simpara>To enable the simple content access import again, edit the <literal>support</literal> secret and delete the <literal>scaPullDisabled</literal> key.</simpara>
</note>
</listitem>
</orderedlist>
</section>
<section xml:id="insights-operator-enabling-sca_remote-health-reporting-from-restricted-network">
<title>Enabling a previously disabled simple content access import</title>
<simpara>If the importing of simple content access entitlements is disabled, the Insights Operator does not import simple content access entitlements. You can change this behavior.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Workloads</emphasis> &#8594; <emphasis role="strong">Secrets</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">openshift-config</emphasis> project.</simpara>
</listitem>
<listitem>
<simpara>Search for the <emphasis role="strong">support</emphasis> secret by using the <emphasis role="strong">Search by name</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Options</emphasis> menu <inlinemediaobject>
<imageobject>
<imagedata fileref="images/kebab.png"/>
</imageobject>
<textobject><phrase>kebab</phrase></textobject>
</inlinemediaobject>, and then click <emphasis role="strong">Edit Secret</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For the <literal>scaPullDisabled</literal> key, set the <emphasis role="strong">Value</emphasis> field to <literal>false</literal>.</simpara>
<simpara>The simple content access entitlement import is now disabled.</simpara>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="gathering-cluster-data">
<title>Gathering data about your cluster</title>

<simpara>When opening a support case, it is helpful to provide debugging
information about your cluster to Red Hat Support.</simpara>
<simpara>It is recommended to provide:</simpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="../support/gathering-cluster-data.xml#support_gathering_data_gathering-cluster-data">Data gathered using the <literal>oc adm must-gather</literal> command</link></simpara>
</listitem>
<listitem>
<simpara>The  <link xl:href="../support/gathering-cluster-data.xml#support-get-cluster-id_gathering-cluster-data">unique cluster ID</link></simpara>
</listitem>
</itemizedlist>
<section xml:id="about-must-gather_gathering-cluster-data">
<title>About the must-gather tool</title>
<simpara>The <literal>oc adm must-gather</literal> CLI command collects the information from your cluster that is most likely needed for debugging issues, including:</simpara>
<itemizedlist>
<listitem>
<simpara>Resource definitions</simpara>
</listitem>
<listitem>
<simpara>Service logs</simpara>
</listitem>
</itemizedlist>
<simpara>By default, the <literal>oc adm must-gather</literal> command uses the default plugin image and writes into <literal>./must-gather.local</literal>.</simpara>
<simpara>Alternatively, you can collect specific information by running the command with the appropriate arguments as described in the following sections:</simpara>
<itemizedlist>
<listitem>
<simpara>To collect data related to one or more specific features, use the <literal>--image</literal> argument with an image, as listed in a following section.</simpara>
<simpara>For example:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather \
  --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel9:v4.15.0</programlisting>
</listitem>
<listitem>
<simpara>To collect the audit logs, use the <literal>-- /usr/bin/gather_audit_logs</literal> argument, as described in a following section.</simpara>
<simpara>For example:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather -- /usr/bin/gather_audit_logs</programlisting>
<note>
<simpara>Audit logs are not collected as part of the default set of information to reduce the size of the files.</simpara>
</note>
</listitem>
</itemizedlist>
<simpara>When you run <literal>oc adm must-gather</literal>, a new pod with a random name is created in a new project on the cluster. The data is collected on that pod and saved in a new directory that starts with <literal>must-gather.local</literal> in the current working directory.</simpara>
<simpara>For example:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">NAMESPACE                      NAME                 READY   STATUS      RESTARTS      AGE
...
openshift-must-gather-5drcj    must-gather-bklx4    2/2     Running     0             72s
openshift-must-gather-5drcj    must-gather-s8sdh    2/2     Running     0             72s
...</programlisting>
<simpara>Optionally, you can run the <literal>oc adm must-gather</literal> command in a specific namespace by using the <literal>--run-namespace</literal> option.</simpara>
<simpara>For example:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather --run-namespace &lt;namespace&gt; \
  --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel9:v4.15.0</programlisting>
<section xml:id="support_gathering_data_gathering-cluster-data">
<title>Gathering data about your cluster for Red Hat Support</title>
<simpara>You can gather debugging information about your cluster by using the <literal>oc adm must-gather</literal> CLI command.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>The {product-title} CLI (<literal>oc</literal>) is installed.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to the directory where you want to store the <literal>must-gather</literal> data.</simpara>
<note>
<simpara>If your cluster is in a disconnected environment, you must take additional steps. If your mirror registry has a trusted CA, you must first add the trusted CA to the cluster. For all clusters in disconnected environments, you must import the default <literal>must-gather</literal> image as an image stream.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc import-image is/must-gather -n openshift</programlisting>
</note>
</listitem>
<listitem>
<simpara>Run the <literal>oc adm must-gather</literal> command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather</programlisting>
<important>
<simpara>If you are in a disconnected environment, use the <literal>--image</literal> flag as part of must-gather and point to the payload image.</simpara>
</important>
<note>
<simpara>Because this command picks a random control plane node by default, the pod might be scheduled to a control plane node that is in the <literal>NotReady</literal> and <literal>SchedulingDisabled</literal> state.</simpara>
</note>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>If this command fails, for example, if you cannot schedule a pod on your cluster, then use the <literal>oc adm inspect</literal> command to gather information for particular resources.</simpara>
<note>
<simpara>Contact Red Hat Support for the recommended resources to gather.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Create a compressed file from the <literal>must-gather</literal> directory that was just created in your working directory. For example, on a computer that uses a Linux
operating system, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ tar cvaf must-gather.tar.gz must-gather.local.5421342344627712289/ <co xml:id="CO14-1"/></programlisting>
<calloutlist>
<callout arearefs="CO14-1">
<para>Make sure to replace <literal>must-gather-local.5421342344627712289/</literal> with the actual directory name.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Attach the compressed file to your support case on the <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="gathering-data-specific-features_gathering-cluster-data">
<title>Gathering data about specific features</title>
<simpara>You can gather debugging information about specific features by using the <literal>oc adm must-gather</literal> CLI command with the <literal>--image</literal> or <literal>--image-stream</literal> argument. The <literal>must-gather</literal> tool supports multiple images, so you can gather data about more than one feature by running a single command.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Supported must-gather images</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Image</entry>
<entry align="left" valign="top">Purpose</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel9:v4.15.0</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for OpenShift Virtualization.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift-serverless-1/svls-must-gather-rhel8</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for OpenShift Serverless.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift-service-mesh/istio-must-gather-rhel8:&lt;installed_version_service_mesh&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for Red Hat OpenShift Service Mesh.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v&lt;installed_version_migration_toolkit&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the Migration Toolkit for Containers.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/odf4/ocs-must-gather-rhel8:v&lt;installed_version_ODF&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for Red Hat OpenShift Data Foundation.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift-logging/cluster-logging-rhel8-operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for OpenShift Logging.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift4/ose-csi-driver-shared-resource-mustgather-rhel8</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for OpenShift Shared Resource CSI Driver.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift4/ose-local-storage-mustgather-rhel8:v&lt;installed_version_LSO&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for Local Storage Operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel8:v&lt;installed_version_sandboxed_containers&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for OpenShift sandboxed containers.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/workload-availability/self-node-remediation-must-gather-rhel8:v&lt;installed-version-SNR&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the Self Node Remediation (SNR) Operator and the Node Health Check (NHC) Operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/numaresources/numaresources-must-gather-rhel9:v&lt;installed-version-nro&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the NUMA Resources Operator (NRO).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift4/ptp-must-gather-rhel8:v&lt;installed-version-ptp&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the PTP Operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/workload-availability/node-maintenance-must-gather-rhel8:v&lt;installed-version-NMO&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the Node Maintenance Operator (NMO).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift-gitops-1/must-gather-rhel8:v&lt;installed_version_GitOps&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for Red Hat OpenShift GitOps.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/openshift4/ose-secrets-store-csi-mustgather-rhel8:v&lt;installed_version_secret_store&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the Secrets Store CSI Driver Operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>registry.redhat.io/lvms4/lvms-must-gather-rhel9:v&lt;installed_version_LVMS&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Data collection for the LVM Operator.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<note>
<simpara>To determine the latest version for an {product-title} component&#8217;s image, see the <link xl:href="https://access.redhat.com/support/policy/updates/openshift">Red Hat {product-title} Life Cycle Policy</link> web page on the Red Hat Customer Portal.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>The {product-title} CLI (<literal>oc</literal>) is installed.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to the directory where you want to store the <literal>must-gather</literal> data.</simpara>
</listitem>
<listitem>
<simpara>Run the <literal>oc adm must-gather</literal> command with one or more <literal>--image</literal> or <literal>--image-stream</literal> arguments.</simpara>
<note>
<itemizedlist>
<listitem>
<simpara>To collect the default <literal>must-gather</literal> data in addition to specific feature data, add the <literal>--image-stream=openshift/must-gather</literal> argument.</simpara>
</listitem>
<listitem>
<simpara>For information on gathering data about the Custom Metrics Autoscaler, see the Additional resources section that follows.</simpara>
</listitem>
</itemizedlist>
</note>
<simpara>For example, the following command gathers both the default cluster data and information specific to OpenShift Virtualization:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather \
  --image-stream=openshift/must-gather \ <co xml:id="CO15-1"/>
  --image=registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel9:v4.15.0 <co xml:id="CO15-2"/></programlisting>
<calloutlist>
<callout arearefs="CO15-1">
<para>The default {product-title} <literal>must-gather</literal> image</para>
</callout>
<callout arearefs="CO15-2">
<para>The must-gather image for OpenShift Virtualization</para>
</callout>
</calloutlist>
<simpara>You can use the <literal>must-gather</literal> tool with additional arguments to gather data that is specifically related to OpenShift Logging and the
Red Hat OpenShift
Logging Operator in your cluster. For OpenShift Logging, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather --image=$(oc -n openshift-logging get deployment.apps/cluster-logging-operator \
  -o jsonpath='{.spec.template.spec.containers[?(@.name == "cluster-logging-operator")].image}')</programlisting>
<example>
<title>Example <literal>must-gather</literal> output for OpenShift Logging</title>
<programlisting language="terminal" linenumbering="unnumbered">├── cluster-logging
│  ├── clo
│  │  ├── cluster-logging-operator-74dd5994f-6ttgt
│  │  ├── clusterlogforwarder_cr
│  │  ├── cr
│  │  ├── csv
│  │  ├── deployment
│  │  └── logforwarding_cr
│  ├── collector
│  │  ├── fluentd-2tr64
│  ├── eo
│  │  ├── csv
│  │  ├── deployment
│  │  └── elasticsearch-operator-7dc7d97b9d-jb4r4
│  ├── es
│  │  ├── cluster-elasticsearch
│  │  │  ├── aliases
│  │  │  ├── health
│  │  │  ├── indices
│  │  │  ├── latest_documents.json
│  │  │  ├── nodes
│  │  │  ├── nodes_stats.json
│  │  │  └── thread_pool
│  │  ├── cr
│  │  ├── elasticsearch-cdm-lp8l38m0-1-794d6dd989-4jxms
│  │  └── logs
│  │     ├── elasticsearch-cdm-lp8l38m0-1-794d6dd989-4jxms
│  ├── install
│  │  ├── co_logs
│  │  ├── install_plan
│  │  ├── olmo_logs
│  │  └── subscription
│  └── kibana
│     ├── cr
│     ├── kibana-9d69668d4-2rkvz
├── cluster-scoped-resources
│  └── core
│     ├── nodes
│     │  ├── ip-10-0-146-180.eu-west-1.compute.internal.yaml
│     └── persistentvolumes
│        ├── pvc-0a8d65d9-54aa-4c44-9ecc-33d9381e41c1.yaml
├── event-filter.html
├── gather-debug.log
└── namespaces
   ├── openshift-logging
   │  ├── apps
   │  │  ├── daemonsets.yaml
   │  │  ├── deployments.yaml
   │  │  ├── replicasets.yaml
   │  │  └── statefulsets.yaml
   │  ├── batch
   │  │  ├── cronjobs.yaml
   │  │  └── jobs.yaml
   │  ├── core
   │  │  ├── configmaps.yaml
   │  │  ├── endpoints.yaml
   │  │  ├── events
   │  │  │  ├── elasticsearch-im-app-1596020400-gm6nl.1626341a296c16a1.yaml
   │  │  │  ├── elasticsearch-im-audit-1596020400-9l9n4.1626341a2af81bbd.yaml
   │  │  │  ├── elasticsearch-im-infra-1596020400-v98tk.1626341a2d821069.yaml
   │  │  │  ├── elasticsearch-im-app-1596020400-cc5vc.1626341a3019b238.yaml
   │  │  │  ├── elasticsearch-im-audit-1596020400-s8d5s.1626341a31f7b315.yaml
   │  │  │  ├── elasticsearch-im-infra-1596020400-7mgv8.1626341a35ea59ed.yaml
   │  │  ├── events.yaml
   │  │  ├── persistentvolumeclaims.yaml
   │  │  ├── pods.yaml
   │  │  ├── replicationcontrollers.yaml
   │  │  ├── secrets.yaml
   │  │  └── services.yaml
   │  ├── openshift-logging.yaml
   │  ├── pods
   │  │  ├── cluster-logging-operator-74dd5994f-6ttgt
   │  │  │  ├── cluster-logging-operator
   │  │  │  │  └── cluster-logging-operator
   │  │  │  │     └── logs
   │  │  │  │        ├── current.log
   │  │  │  │        ├── previous.insecure.log
   │  │  │  │        └── previous.log
   │  │  │  └── cluster-logging-operator-74dd5994f-6ttgt.yaml
   │  │  ├── cluster-logging-operator-registry-6df49d7d4-mxxff
   │  │  │  ├── cluster-logging-operator-registry
   │  │  │  │  └── cluster-logging-operator-registry
   │  │  │  │     └── logs
   │  │  │  │        ├── current.log
   │  │  │  │        ├── previous.insecure.log
   │  │  │  │        └── previous.log
   │  │  │  ├── cluster-logging-operator-registry-6df49d7d4-mxxff.yaml
   │  │  │  └── mutate-csv-and-generate-sqlite-db
   │  │  │     └── mutate-csv-and-generate-sqlite-db
   │  │  │        └── logs
   │  │  │           ├── current.log
   │  │  │           ├── previous.insecure.log
   │  │  │           └── previous.log
   │  │  ├── elasticsearch-cdm-lp8l38m0-1-794d6dd989-4jxms
   │  │  ├── elasticsearch-im-app-1596030300-bpgcx
   │  │  │  ├── elasticsearch-im-app-1596030300-bpgcx.yaml
   │  │  │  └── indexmanagement
   │  │  │     └── indexmanagement
   │  │  │        └── logs
   │  │  │           ├── current.log
   │  │  │           ├── previous.insecure.log
   │  │  │           └── previous.log
   │  │  ├── fluentd-2tr64
   │  │  │  ├── fluentd
   │  │  │  │  └── fluentd
   │  │  │  │     └── logs
   │  │  │  │        ├── current.log
   │  │  │  │        ├── previous.insecure.log
   │  │  │  │        └── previous.log
   │  │  │  ├── fluentd-2tr64.yaml
   │  │  │  └── fluentd-init
   │  │  │     └── fluentd-init
   │  │  │        └── logs
   │  │  │           ├── current.log
   │  │  │           ├── previous.insecure.log
   │  │  │           └── previous.log
   │  │  ├── kibana-9d69668d4-2rkvz
   │  │  │  ├── kibana
   │  │  │  │  └── kibana
   │  │  │  │     └── logs
   │  │  │  │        ├── current.log
   │  │  │  │        ├── previous.insecure.log
   │  │  │  │        └── previous.log
   │  │  │  ├── kibana-9d69668d4-2rkvz.yaml
   │  │  │  └── kibana-proxy
   │  │  │     └── kibana-proxy
   │  │  │        └── logs
   │  │  │           ├── current.log
   │  │  │           ├── previous.insecure.log
   │  │  │           └── previous.log
   │  └── route.openshift.io
   │     └── routes.yaml
   └── openshift-operators-redhat
      ├── ...</programlisting>
</example>
</listitem>
<listitem>
<simpara>Run the <literal>oc adm must-gather</literal> command with one or more <literal>--image</literal> or <literal>--image-stream</literal> arguments. For example, the following command gathers both the default cluster data and information specific to KubeVirt:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather \
 --image-stream=openshift/must-gather \ <co xml:id="CO16-1"/>
 --image=quay.io/kubevirt/must-gather <co xml:id="CO16-2"/></programlisting>
<calloutlist>
<callout arearefs="CO16-1">
<para>The default {product-title} <literal>must-gather</literal> image</para>
</callout>
<callout arearefs="CO16-2">
<para>The must-gather image for KubeVirt</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create a compressed file from the <literal>must-gather</literal> directory that was just created in your working directory. For example, on a computer that uses a Linux
operating system, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ tar cvaf must-gather.tar.gz must-gather.local.5421342344627712289/ <co xml:id="CO17-1"/></programlisting>
<calloutlist>
<callout arearefs="CO17-1">
<para>Make sure to replace <literal>must-gather-local.5421342344627712289/</literal> with the
actual directory name.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Attach the compressed file to your support case on the <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="_additional_resources">
<title>Additional resources</title>
<itemizedlist>
<listitem>
<simpara><link xl:href="../nodes/cma/nodes-cma-autoscaling-custom.xml#nodes-cma-autoscaling-custom-gather">Gathering debugging data</link> for the Custom Metrics Autoscaler.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/support/policy/updates/openshift">Red Hat {product-title} Life Cycle Policy</link></simpara>
</listitem>
</itemizedlist>
<section xml:id="gathering-data-network-logs_gathering-cluster-data">
<title>Gathering network logs</title>
<simpara>You can gather network logs on all nodes in a cluster.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Run the <literal>oc adm must-gather</literal> command with <literal>-- gather_network_logs</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather -- gather_network_logs</programlisting>
</listitem>
</orderedlist>
<note>
<simpara>By default, the <literal>must-gather</literal> tool collects the OVN <literal>nbdb</literal> and <literal>sbdb</literal> databases from all of the nodes in the cluster. Adding the <literal>-- gather_network_logs</literal> option to include additional logs that contain OVN-Kubernetes transactions for OVN <literal>nbdb</literal> database.</simpara>
</note>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create a compressed file from the <literal>must-gather</literal> directory that was just created in your working directory. For example, on a computer that uses a Linux operating system, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ tar cvaf must-gather.tar.gz must-gather.local.472290403699006248 <co xml:id="CO18-1"/></programlisting>
<calloutlist>
<callout arearefs="CO18-1">
<para>Replace <literal>must-gather-local.472290403699006248</literal> with the actual directory name.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Attach the compressed file to your support case on the <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="must-gather-storage-limit_gathering-cluster-data">
<title>Changing the must-gather storage limit</title>
<simpara>When using the <literal>oc adm must-gather</literal> command to collect data the default maximum storage for the information is 30% of the storage capacity of the container. After the 30% limit is reached the container is killed and the gathering process stops. Information already gathered is downloaded to your local storage. To run the must-gather command again, you need either a container with more storage capacity or to adjust the maximum volume percentage.</simpara>
<simpara>If the container reaches the storage limit, an error message similar to the following example is generated.</simpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Disk usage exceeds the volume percentage of 30% for mounted directory. Exiting...</programlisting>
</para>
</formalpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>The OpenShift CLI (<literal>oc</literal>) is installed.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Run the <literal>oc adm must-gather</literal> command with the <literal>volume-percentage</literal> flag. The new value cannot exceed 100.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather --volume-percentage &lt;storage_percentage&gt;</programlisting>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="support-get-cluster-id_gathering-cluster-data">
<title>Obtaining your cluster ID</title>
<simpara>When providing information to Red Hat Support, it is helpful to provide the unique identifier for your cluster. You can have your cluster ID autofilled by using the {product-title} web console. You can also manually obtain your cluster ID by using the web console or the OpenShift CLI (<literal>oc</literal>).</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have access to the web console or the OpenShift CLI (<literal>oc</literal>) installed.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To open a support case and have your cluster ID autofilled using the web console:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From the toolbar, navigate to <emphasis role="strong">(?) Help</emphasis> &#8594; <emphasis role="strong">Open Support Case</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">Cluster ID</emphasis> value is autofilled.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>To manually obtain your cluster ID using the web console:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Navigate to <emphasis role="strong">Home</emphasis> &#8594; <emphasis role="strong">Overview</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>The value is available in the <emphasis role="strong">Cluster ID</emphasis> field of the <emphasis role="strong">Details</emphasis> section.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>To obtain your cluster ID using the OpenShift CLI (<literal>oc</literal>), run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get clusterversion -o jsonpath='{.items[].spec.clusterID}{"\n"}'</programlisting>
</listitem>
</itemizedlist>
</section>
<section xml:id="about-sosreport_gathering-cluster-data">
<title>About sosreport</title>
<simpara><literal>sosreport</literal> is a tool that collects configuration details, system information, and diagnostic data from Red Hat Enterprise Linux (RHEL) and Red Hat Enterprise Linux CoreOS (RHCOS) systems. <literal>sosreport</literal> provides a standardized way to collect diagnostic information relating to a node, which can then be provided to Red Hat Support for issue diagnosis.</simpara>
<simpara>In some support interactions, Red Hat Support may ask you to collect a <literal>sosreport</literal> archive for a specific {product-title} node. For example, it might sometimes be necessary to review system logs or other node-specific data that is not included within the output of <literal>oc adm must-gather</literal>.</simpara>
</section>
<section xml:id="support-generating-a-sosreport-archive_gathering-cluster-data">
<title>Generating a sosreport archive for an {product-title} cluster node</title>
<simpara>The recommended way to generate a <literal>sosreport</literal> for an {product-title} {product-version} cluster node is through a debug pod.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat standard or premium Subscription.</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat Customer Portal account.</simpara>
</listitem>
<listitem>
<simpara>You have an existing Red Hat Support case ID.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Obtain a list of cluster nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
</listitem>
<listitem>
<simpara>Enter into a debug session on the target node. This step instantiates a debug pod called <literal>&lt;node_name&gt;-debug</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node</programlisting>
<simpara>To enter into a debug session on the target node that is tainted with the <literal>NoExecute</literal> effect, add a toleration to a dummy namespace, and start the debug pod in the dummy namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc new-project dummy</programlisting>
<programlisting language="terminal" linenumbering="unnumbered">$ oc patch namespace dummy --type=merge -p '{"metadata": {"annotations": { "scheduler.alpha.kubernetes.io/defaultTolerations": "[{\"operator\": \"Exists\"}]"}}}'</programlisting>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>Start a <literal>toolbox</literal> container, which includes the required binaries and plugins to run <literal>sosreport</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># toolbox</programlisting>
<note>
<simpara>If an existing <literal>toolbox</literal> pod is already running, the <literal>toolbox</literal> command outputs <literal>'toolbox-' already exists. Trying to start&#8230;&#8203;</literal>. Remove the running toolbox container with <literal>podman rm toolbox-</literal> and spawn a new toolbox container, to avoid issues with <literal>sosreport</literal> plugins.</simpara>
</note>
</listitem>
<listitem>
<simpara>Collect a <literal>sosreport</literal> archive.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Run the <literal>sos report</literal> command to collect necessary troubleshooting data on <literal>crio</literal> and <literal>podman</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># sos report -k crio.all=on -k crio.logs=on  -k podman.all=on -k podman.logs=on <co xml:id="CO19-1"/></programlisting>
<calloutlist>
<callout arearefs="CO19-1">
<para><literal>-k</literal> enables you to define <literal>sosreport</literal> plugin parameters outside of the defaults.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Optional: To include information on OVN-Kubernetes networking configurations from a node in your report, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># sos report --all-logs</programlisting>
</listitem>
<listitem>
<simpara>Press <emphasis role="strong">Enter</emphasis> when prompted, to continue.</simpara>
</listitem>
<listitem>
<simpara>Provide the Red Hat Support case ID. <literal>sosreport</literal> adds the ID to the archive&#8217;s file name.</simpara>
</listitem>
<listitem>
<simpara>The <literal>sosreport</literal> output provides the archive&#8217;s location and checksum. The following sample output references support case ID <literal>01234567</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">Your sosreport has been generated and saved in:
  /host/var/tmp/sosreport-my-cluster-node-01234567-2020-05-28-eyjknxt.tar.xz <co xml:id="CO20-1"/>

The checksum is: 382ffc167510fd71b4f12a4f40b97a4e</programlisting>
<calloutlist>
<callout arearefs="CO20-1">
<para>The <literal>sosreport</literal> archive&#8217;s file path is outside of the <literal>chroot</literal> environment because the toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Provide the <literal>sosreport</literal> archive to Red Hat Support for analysis, using one of the following methods.</simpara>
<itemizedlist>
<listitem>
<simpara>Upload the file to an existing Red Hat support case directly from an {product-title} cluster.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From within the toolbox container, run <literal>redhat-support-tool</literal> to attach the archive directly to an existing Red Hat support case. This example uses support case ID <literal>01234567</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># redhat-support-tool addattachment -c 01234567 /host/var/tmp/my-sosreport.tar.xz <co xml:id="CO21-1"/></programlisting>
<calloutlist>
<callout arearefs="CO21-1">
<para>The toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>. Reference the absolute path from the toolbox container&#8217;s root directory, including <literal>/host/</literal>, when specifying files to upload through the <literal>redhat-support-tool</literal> command.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Upload the file to an existing Red Hat support case.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Concatenate the <literal>sosreport</literal> archive by running the <literal>oc debug node/&lt;node_name&gt;</literal> command and redirect the output to a file. This command assumes you have exited the previous <literal>oc debug</literal> session:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node -- bash -c 'cat /host/var/tmp/sosreport-my-cluster-node-01234567-2020-05-28-eyjknxt.tar.xz' &gt; /tmp/sosreport-my-cluster-node-01234567-2020-05-28-eyjknxt.tar.xz <co xml:id="CO22-1"/></programlisting>
<calloutlist>
<callout arearefs="CO22-1">
<para>The debug container mounts the host&#8217;s root directory at <literal>/host</literal>. Reference the absolute path from the debug container&#8217;s root directory, including <literal>/host</literal>, when specifying target files for concatenation.</para>
</callout>
</calloutlist>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Transferring a <literal>sosreport</literal> archive from a cluster node by using <literal>scp</literal> is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to copy a <literal>sosreport</literal> archive from a node by running <literal>scp core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;:&lt;file_path&gt; &lt;local_path&gt;</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Navigate to an existing support case within <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Attach files</emphasis> and follow the prompts to upload the file.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="querying-bootstrap-node-journal-logs_gathering-cluster-data">
<title>Querying bootstrap node journal logs</title>
<simpara>If you experience bootstrap-related issues, you can gather <literal>bootkube.service</literal> <literal>journald</literal> unit logs and container logs from the bootstrap node.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have SSH access to your bootstrap node.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain name of the bootstrap node.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Query <literal>bootkube.service</literal> <literal>journald</literal> unit logs from a bootstrap node during {product-title} installation. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; journalctl -b -f -u bootkube.service</programlisting>
<note>
<simpara>The <literal>bootkube.service</literal> log on the bootstrap node outputs etcd <literal>connection refused</literal> errors, indicating that the bootstrap server is unable to connect to etcd on control plane nodes. After etcd has started on each control plane node and the nodes have joined the cluster, the errors should stop.</simpara>
</note>
</listitem>
<listitem>
<simpara>Collect logs from the bootstrap node containers using <literal>podman</literal> on the bootstrap node. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; 'for pod in $(sudo podman ps -a -q); do sudo podman logs $pod; done'</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="querying-cluster-node-journal-logs_gathering-cluster-data">
<title>Querying cluster node journal logs</title>
<simpara>You can gather <literal>journald</literal> unit logs and other logs within <literal>/var/log</literal> on individual cluster nodes.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Query <literal>kubelet</literal> <literal>journald</literal> unit logs from {product-title} cluster nodes. The following example queries control plane nodes only:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u kubelet  <co xml:id="CO23-1"/></programlisting>
<calloutlist>
<callout arearefs="CO23-1">
<para>Replace <literal>kubelet</literal> as appropriate to query other unit logs.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Collect logs from specific subdirectories under <literal>/var/log/</literal> on cluster nodes.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve a list of logs contained within a <literal>/var/log/</literal> subdirectory. The following example lists files in <literal>/var/log/openshift-apiserver/</literal> on all control plane nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master --path=openshift-apiserver</programlisting>
</listitem>
<listitem>
<simpara>Inspect a specific log within a <literal>/var/log/</literal> subdirectory. The following example outputs <literal>/var/log/openshift-apiserver/audit.log</literal> contents from all control plane nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master --path=openshift-apiserver/audit.log</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs on each node using SSH instead. The following example tails <literal>/var/log/openshift-apiserver/audit.log</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo tail -f /var/log/openshift-apiserver/audit.log</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="support-network-trace-methods_gathering-cluster-data">
<title>Network trace methods</title>
<simpara>Collecting network traces, in the form of packet capture records, can assist Red Hat Support with troubleshooting network issues.</simpara>
<simpara>{product-title} supports two ways of performing a network trace.
Review the following table and choose the method that meets your needs.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Supported methods of collecting a network trace</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="80*"/>
<thead>
<row>
<entry align="left" valign="top">Method</entry>
<entry align="left" valign="top">Benefits and capabilities</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Collecting a host network trace</simpara></entry>
<entry align="left" valign="top"><simpara>You perform a packet capture for a duration that you specify on one or more nodes at the same time.
The packet capture files are transferred from nodes to the client machine when the specified duration is met.</simpara>
<simpara>You can troubleshoot why a specific action triggers network communication issues. Run the packet capture, perform the action that triggers the issue, and use the logs to diagnose the issue.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Collecting a network trace from an {product-title} node or container</simpara></entry>
<entry align="left" valign="top"><simpara>You perform a packet capture on one node or one container.
You run the <literal>tcpdump</literal> command interactively, so you can control the duration of the packet capture.</simpara>
<simpara>You can start the packet capture manually, trigger the network communication issue, and then stop the packet capture manually.</simpara>
<simpara>This method uses the <literal>cat</literal> command and shell redirection to copy the packet capture data from the node or container to the client machine.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="support-collecting-host-network-trace_gathering-cluster-data">
<title>Collecting a host network trace</title>
<simpara>Sometimes, troubleshooting a network-related issue is simplified by tracing network communication and capturing packets on multiple nodes at the same time.</simpara>
<simpara>You can use a combination of the <literal>oc adm must-gather</literal> command and the <literal>registry.redhat.io/openshift4/network-tools-rhel8</literal> container image to gather packet captures from nodes.
Analyzing packet captures can help you troubleshoot network communication issues.</simpara>
<simpara>The <literal>oc adm must-gather</literal> command is used to run the <literal>tcpdump</literal> command in pods on specific nodes.
The <literal>tcpdump</literal> command records the packet captures in the pods.
When the <literal>tcpdump</literal> command exits, the <literal>oc adm must-gather</literal> command transfers the files with the packet captures from the pods to your client machine.</simpara>
<tip>
<simpara>The sample command in the following procedure demonstrates performing a packet capture with the <literal>tcpdump</literal> command.
However, you can run any command in the container image that is specified in the <literal>--image</literal> argument to gather troubleshooting information from multiple nodes at the same time.</simpara>
</tip>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You are logged in to {product-title} as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Run a packet capture from the host network on some nodes by running the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm must-gather \
    --dest-dir /tmp/captures \  <co xml:id="CO24-1"/>
    --source-dir '/tmp/tcpdump/' \  <co xml:id="CO24-2"/>
    --image registry.redhat.io/openshift4/network-tools-rhel8:latest \  <co xml:id="CO24-3"/>
    --node-selector 'node-role.kubernetes.io/worker' \  <co xml:id="CO24-4"/>
    --host-network=true \  <co xml:id="CO24-5"/>
    --timeout 30s \  <co xml:id="CO24-6"/>
    -- \
    tcpdump -i any \  <co xml:id="CO24-7"/>
    -w /tmp/tcpdump/%Y-%m-%dT%H:%M:%S.pcap -W 1 -G 300</programlisting>
<calloutlist>
<callout arearefs="CO24-1">
<para>The <literal>--dest-dir</literal> argument specifies that <literal>oc adm must-gather</literal> stores the packet captures in directories that are relative to <literal>/tmp/captures</literal> on the client machine. You can specify any writable directory.</para>
</callout>
<callout arearefs="CO24-2">
<para>When <literal>tcpdump</literal> is run in the debug pod that <literal>oc adm must-gather</literal> starts, the <literal>--source-dir</literal> argument specifies that the packet captures are temporarily stored in the <literal>/tmp/tcpdump</literal> directory on the pod.</para>
</callout>
<callout arearefs="CO24-3">
<para>The <literal>--image</literal> argument specifies a container image that includes the <literal>tcpdump</literal> command.</para>
</callout>
<callout arearefs="CO24-4">
<para>The <literal>--node-selector</literal> argument and example value specifies to perform the packet captures on the worker nodes. As an alternative, you can specify the <literal>--node-name</literal> argument instead to run the packet capture on a single node. If you omit both the <literal>--node-selector</literal> and the <literal>--node-name</literal> argument, the packet captures are performed on all nodes.</para>
</callout>
<callout arearefs="CO24-5">
<para>The <literal>--host-network=true</literal> argument is required so that the packet captures are performed on the network interfaces of the node.</para>
</callout>
<callout arearefs="CO24-6">
<para>The <literal>--timeout</literal> argument and value specify to run the debug pod for 30 seconds. If you do not specify the <literal>--timeout</literal> argument and a duration, the debug pod runs for 10 minutes.</para>
</callout>
<callout arearefs="CO24-7">
<para>The <literal>-i any</literal> argument for the <literal>tcpdump</literal> command specifies to capture packets on all network interfaces. As an alternative, you can specify a network interface name.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Perform the action, such as accessing a web application, that triggers the network communication issue while the network trace captures packets.</simpara>
</listitem>
<listitem>
<simpara>Review the packet capture files that <literal>oc adm must-gather</literal> transferred from the pods to your client machine:</simpara>
<programlisting language="text" linenumbering="unnumbered">tmp/captures
├── event-filter.html
├── ip-10-0-192-217-ec2-internal  <co xml:id="CO25-1"/>
│   └── registry-redhat-io-openshift4-network-tools-rhel8-sha256-bca...
│       └── 2022-01-13T19:31:31.pcap
├── ip-10-0-201-178-ec2-internal  <co xml:id="CO25-2"/>
│   └── registry-redhat-io-openshift4-network-tools-rhel8-sha256-bca...
│       └── 2022-01-13T19:31:30.pcap
├── ip-...
└── timestamp</programlisting>
<calloutlist>
<callout arearefs="CO25-1 CO25-2">
<para>The packet captures are stored in directories that identify the hostname, container, and file name.
If you did not specify the <literal>--node-selector</literal> argument, then the directory level for the hostname is not present.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</section>
<section xml:id="support-collecting-network-trace_gathering-cluster-data">
<title>Collecting a network trace from an {product-title} node or container</title>
<simpara>When investigating potential network-related {product-title} issues, Red Hat Support might request a network packet trace from a specific {product-title} cluster node or from a specific container. The recommended method to capture a network trace in {product-title} is through a debug pod.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat standard or premium Subscription.</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat Customer Portal account.</simpara>
</listitem>
<listitem>
<simpara>You have an existing Red Hat Support case ID.</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Obtain a list of cluster nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
</listitem>
<listitem>
<simpara>Enter into a debug session on the target node. This step instantiates a debug pod called <literal>&lt;node_name&gt;-debug</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>From within the <literal>chroot</literal> environment console, obtain the node&#8217;s interface names:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># ip ad</programlisting>
</listitem>
<listitem>
<simpara>Start a <literal>toolbox</literal> container, which includes the required binaries and plugins to run <literal>sosreport</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># toolbox</programlisting>
<note>
<simpara>If an existing <literal>toolbox</literal> pod is already running, the <literal>toolbox</literal> command outputs <literal>'toolbox-' already exists. Trying to start&#8230;&#8203;</literal>. To avoid <literal>tcpdump</literal> issues, remove the running toolbox container with <literal>podman rm toolbox-</literal> and spawn a new toolbox container.</simpara>
</note>
</listitem>
<listitem>
<simpara>Initiate a <literal>tcpdump</literal> session on the cluster node and redirect output to a capture file. This example uses <literal>ens5</literal> as the interface name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ tcpdump -nn -s 0 -i ens5 -w /host/var/tmp/my-cluster-node_$(date +%d_%m_%Y-%H_%M_%S-%Z).pcap  <co xml:id="CO26-1"/></programlisting>
<calloutlist>
<callout arearefs="CO26-1">
<para>The <literal>tcpdump</literal> capture file&#8217;s path is outside of the <literal>chroot</literal> environment because the toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>If a <literal>tcpdump</literal> capture is required for a specific container on the node, follow these steps.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Determine the target container ID. The <literal>chroot host</literal> command precedes the <literal>crictl</literal> command in this step because the toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host crictl ps</programlisting>
</listitem>
<listitem>
<simpara>Determine the container&#8217;s process ID. In this example, the container ID is <literal>a7fe32346b120</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host crictl inspect --output yaml a7fe32346b120 | grep 'pid' | awk '{print $2}'</programlisting>
</listitem>
<listitem>
<simpara>Initiate a <literal>tcpdump</literal> session on the container and redirect output to a capture file. This example uses <literal>49628</literal> as the container&#8217;s process ID and <literal>ens5</literal> as the interface name. The <literal>nsenter</literal> command enters the namespace of a target process and runs a command in its namespace. because the target process in this example is a container&#8217;s process ID, the <literal>tcpdump</literal> command is run in the container&#8217;s namespace from the host:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># nsenter -n -t 49628 -- tcpdump -nn -i ens5 -w /host/var/tmp/my-cluster-node-my-container_$(date +%d_%m_%Y-%H_%M_%S-%Z).pcap  <co xml:id="CO27-1"/></programlisting>
<calloutlist>
<callout arearefs="CO27-1">
<para>The <literal>tcpdump</literal> capture file&#8217;s path is outside of the <literal>chroot</literal> environment because the toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Provide the <literal>tcpdump</literal> capture file to Red Hat Support for analysis, using one of the following methods.</simpara>
<itemizedlist>
<listitem>
<simpara>Upload the file to an existing Red Hat support case directly from an {product-title} cluster.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From within the toolbox container, run <literal>redhat-support-tool</literal> to attach the file directly to an existing Red Hat Support case. This example uses support case ID <literal>01234567</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># redhat-support-tool addattachment -c 01234567 /host/var/tmp/my-tcpdump-capture-file.pcap <co xml:id="CO28-1"/></programlisting>
<calloutlist>
<callout arearefs="CO28-1">
<para>The toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>. Reference the absolute path from the toolbox container&#8217;s root directory, including <literal>/host/</literal>, when specifying files to upload through the <literal>redhat-support-tool</literal> command.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Upload the file to an existing Red Hat support case.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Concatenate the <literal>sosreport</literal> archive by running the <literal>oc debug node/&lt;node_name&gt;</literal> command and redirect the output to a file. This command assumes you have exited the previous <literal>oc debug</literal> session:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node -- bash -c 'cat /host/var/tmp/my-tcpdump-capture-file.pcap' &gt; /tmp/my-tcpdump-capture-file.pcap <co xml:id="CO29-1"/></programlisting>
<calloutlist>
<callout arearefs="CO29-1">
<para>The debug container mounts the host&#8217;s root directory at <literal>/host</literal>. Reference the absolute path from the debug container&#8217;s root directory, including <literal>/host</literal>, when specifying target files for concatenation.</para>
</callout>
</calloutlist>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Transferring a <literal>tcpdump</literal> capture file from a cluster node by using <literal>scp</literal> is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to copy a <literal>tcpdump</literal> capture file from a node by running <literal>scp core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;:&lt;file_path&gt; &lt;local_path&gt;</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Navigate to an existing support case within <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Attach files</emphasis> and follow the prompts to upload the file.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="support-providing-diagnostic-data-to-red-hat_gathering-cluster-data">
<title>Providing diagnostic data to Red Hat Support</title>
<simpara>When investigating {product-title} issues, Red Hat Support might ask you to upload diagnostic data to a support case. Files can be uploaded to a support case through the Red Hat Customer Portal, or from an {product-title} cluster directly by using the <literal>redhat-support-tool</literal> command.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat standard or premium Subscription.</simpara>
</listitem>
<listitem>
<simpara>You have a Red Hat Customer Portal account.</simpara>
</listitem>
<listitem>
<simpara>You have an existing Red Hat Support case ID.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Upload diagnostic data to an existing Red Hat support case through the Red Hat Customer Portal.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Concatenate a diagnostic file contained on an {product-title} node by using the <literal>oc debug node/&lt;node_name&gt;</literal> command and redirect the output to a file. The following example copies <literal>/host/var/tmp/my-diagnostic-data.tar.gz</literal> from a debug container to <literal>/var/tmp/my-diagnostic-data.tar.gz</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node -- bash -c 'cat /host/var/tmp/my-diagnostic-data.tar.gz' &gt; /var/tmp/my-diagnostic-data.tar.gz <co xml:id="CO30-1"/></programlisting>
<calloutlist>
<callout arearefs="CO30-1">
<para>The debug container mounts the host&#8217;s root directory at <literal>/host</literal>. Reference the absolute path from the debug container&#8217;s root directory, including <literal>/host</literal>, when specifying target files for concatenation.</para>
</callout>
</calloutlist>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Transferring files from a cluster node by using <literal>scp</literal> is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to copy diagnostic files from a node by running <literal>scp core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;:&lt;file_path&gt; &lt;local_path&gt;</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Navigate to an existing support case within <link xl:href="https://access.redhat.com/support/cases/#/case/list">the <emphasis role="strong">Customer Support</emphasis> page</link> of the Red Hat Customer Portal.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Attach files</emphasis> and follow the prompts to upload the file.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Upload diagnostic data to an existing Red Hat support case directly from an {product-title} cluster.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Obtain a list of cluster nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
</listitem>
<listitem>
<simpara>Enter into a debug session on the target node. This step instantiates a debug pod called <literal>&lt;node_name&gt;-debug</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>Start a <literal>toolbox</literal> container, which includes the required binaries to run <literal>redhat-support-tool</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># toolbox</programlisting>
<note>
<simpara>If an existing <literal>toolbox</literal> pod is already running, the <literal>toolbox</literal> command outputs <literal>'toolbox-' already exists. Trying to start&#8230;&#8203;</literal>. Remove the running toolbox container with <literal>podman rm toolbox-</literal> and spawn a new toolbox container, to avoid issues.</simpara>
</note>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Run <literal>redhat-support-tool</literal> to attach a file from the debug pod directly to an existing Red Hat Support case. This example uses support case ID '01234567' and example file path <literal>/host/var/tmp/my-diagnostic-data.tar.gz</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># redhat-support-tool addattachment -c 01234567 /host/var/tmp/my-diagnostic-data.tar.gz <co xml:id="CO31-1"/></programlisting>
<calloutlist>
<callout arearefs="CO31-1">
<para>The toolbox container mounts the host&#8217;s root directory at <literal>/host</literal>. Reference the absolute path from the toolbox container&#8217;s root directory, including <literal>/host/</literal>, when specifying files to upload through the <literal>redhat-support-tool</literal> command.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="about-toolbox_gathering-cluster-data">
<title>About <literal>toolbox</literal></title>
<simpara><literal>toolbox</literal> is a tool that starts a container on a Red Hat Enterprise Linux CoreOS (RHCOS) system. The tool is primarily used to start a container that includes the required binaries and plugins that are needed to run commands such as <literal>sosreport</literal> and <literal>redhat-support-tool</literal>.</simpara>
<simpara>The primary purpose for a <literal>toolbox</literal> container is to gather diagnostic information and to provide it to Red Hat Support. However, if additional diagnostic tools are required, you can add RPM packages or run an image that is an alternative to the standard support tools image.</simpara>
<bridgehead xml:id="installing-packages-to-a-toolbox-container_gathering-cluster-data" renderas="sect3">Installing packages to a <literal>toolbox</literal> container</bridgehead>
<simpara>By default, running the <literal>toolbox</literal> command starts a container with the <literal>registry.redhat.io/rhel8/support-tools:latest</literal> image. This image contains the most frequently used support tools. If you need to collect node-specific data that requires a support tool that is not part of the image, you can install additional packages.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have accessed a node with the <literal>oc debug node/&lt;node_name&gt;</literal> command.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
</listitem>
<listitem>
<simpara>Start the toolbox container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># toolbox</programlisting>
</listitem>
<listitem>
<simpara>Install the additional package, such as <literal>wget</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># dnf install -y &lt;package_name&gt;</programlisting>
</listitem>
</orderedlist>
<bridgehead xml:id="starting-an-alternative-image-with-toolbox_gathering-cluster-data" renderas="sect3">Starting an alternative image with <literal>toolbox</literal></bridgehead>
<simpara>By default, running the <literal>toolbox</literal> command starts a container with the <literal>registry.redhat.io/rhel8/support-tools:latest</literal> image. You can start an alternative image by creating a <literal>.toolboxrc</literal> file and specifying the image to run.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have accessed a node with the <literal>oc debug node/&lt;node_name&gt;</literal> command.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
</listitem>
<listitem>
<simpara>Create a <literal>.toolboxrc</literal> file in the home directory for the root user ID:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># vi ~/.toolboxrc</programlisting>
<programlisting language="text" linenumbering="unnumbered">REGISTRY=quay.io                <co xml:id="CO32-1"/>
IMAGE=fedora/fedora:33-x86_64   <co xml:id="CO32-2"/>
TOOLBOX_NAME=toolbox-fedora-33  <co xml:id="CO32-3"/></programlisting>
<calloutlist>
<callout arearefs="CO32-1">
<para>Optional: Specify an alternative container registry.</para>
</callout>
<callout arearefs="CO32-2">
<para>Specify an alternative image to start.</para>
</callout>
<callout arearefs="CO32-3">
<para>Optional: Specify an alternative name for the toolbox container.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Start a toolbox container with the alternative image:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># toolbox</programlisting>
<note>
<simpara>If an existing <literal>toolbox</literal> pod is already running, the <literal>toolbox</literal> command outputs <literal>'toolbox-' already exists. Trying to start&#8230;&#8203;</literal>. Remove the running toolbox container with <literal>podman rm toolbox-</literal> and spawn a new toolbox container, to avoid issues with <literal>sosreport</literal> plugins.</simpara>
</note>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="summarizing-cluster-specifications">
<title>Summarizing cluster specifications</title>

<section xml:id="summarizing-cluster-specifications-through-clusterversion_summarizing-cluster-specifications">
<title>Summarizing cluster specifications by using a cluster version object</title>
<simpara>You can obtain a summary of {product-title} cluster specifications by querying the <literal>clusterversion</literal> resource.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Query cluster version, availability, uptime, and general status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get clusterversion</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="text" linenumbering="unnumbered">NAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS
version   4.13.8    True        False         8h      Cluster version is 4.13.8</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Obtain a detailed summary of cluster specifications, update availability, and update history:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe clusterversion</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="text" linenumbering="unnumbered">Name:         version
Namespace:
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  config.openshift.io/v1
Kind:         ClusterVersion
# ...
    Image:    quay.io/openshift-release-dev/ocp-release@sha256:a956488d295fe5a59c8663a4d9992b9b5d0950f510a7387dbbfb8d20fc5970ce
    URL:      https://access.redhat.com/errata/RHSA-2023:4456
    Version:  4.13.8
  History:
    Completion Time:    2023-08-17T13:20:21Z
    Image:              quay.io/openshift-release-dev/ocp-release@sha256:a956488d295fe5a59c8663a4d9992b9b5d0950f510a7387dbbfb8d20fc5970ce
    Started Time:       2023-08-17T12:59:45Z
    State:              Completed
    Verified:           false
    Version:            4.13.8
# ...</programlisting>
</para>
</formalpara>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="_troubleshooting">
<title>Troubleshooting</title>
<section xml:id="troubleshooting-installations">
<title>Troubleshooting installations</title>

<section xml:id="determining-where-installation-issues-occur_troubleshooting-installations">
<title>Determining where installation issues occur</title>
<simpara>When troubleshooting {product-title} installation issues, you can monitor installation logs to determine at which stage issues occur. Then, retrieve diagnostic data relevant to that stage.</simpara>
<simpara>{product-title} installation proceeds through the following stages:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Ignition configuration files are created.</simpara>
</listitem>
<listitem>
<simpara>The bootstrap machine boots and starts hosting the remote resources required for the control plane machines to boot.</simpara>
</listitem>
<listitem>
<simpara>The control plane machines fetch the remote resources from the bootstrap machine and finish booting.</simpara>
</listitem>
<listitem>
<simpara>The control plane machines use the bootstrap machine to form an etcd cluster.</simpara>
</listitem>
<listitem>
<simpara>The bootstrap machine starts a temporary Kubernetes control plane using the new etcd cluster.</simpara>
</listitem>
<listitem>
<simpara>The temporary control plane schedules the production control plane to the control plane machines.</simpara>
</listitem>
<listitem>
<simpara>The temporary control plane shuts down and passes control to the production control plane.</simpara>
</listitem>
<listitem>
<simpara>The bootstrap machine adds {product-title} components into the production control plane.</simpara>
</listitem>
<listitem>
<simpara>The installation program shuts down the bootstrap machine.</simpara>
</listitem>
<listitem>
<simpara>The control plane sets up the worker nodes.</simpara>
</listitem>
<listitem>
<simpara>The control plane installs additional services in the form of a set of Operators.</simpara>
</listitem>
<listitem>
<simpara>The cluster downloads and configures remaining components needed for the day-to-day operation, including the creation of worker machines in supported environments.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="upi-installation-considerations_troubleshooting-installations">
<title>User-provisioned infrastructure installation considerations</title>
<simpara>The default installation method uses installer-provisioned infrastructure. With installer-provisioned infrastructure clusters, {product-title} manages all aspects of the cluster, including the operating system itself. If possible, use this feature to avoid having to provision and maintain the cluster infrastructure.</simpara>
<simpara>You can alternatively install {product-title} {product-version} on infrastructure that you provide. If you use this installation method, follow user-provisioned infrastructure installation documentation carefully. Additionally, review the following considerations before the installation:</simpara>
<itemizedlist>
<listitem>
<simpara>Check the <link xl:href="https://access.redhat.com/ecosystem/search/#/ecosystem/Red%20Hat%20Enterprise%20Linux">Red Hat Enterprise Linux (RHEL) Ecosystem</link> to determine the level of Red Hat Enterprise Linux CoreOS (RHCOS) support provided for your chosen server hardware or virtualization technology.</simpara>
</listitem>
<listitem>
<simpara>Many virtualization and cloud environments require agents to be installed on guest operating systems. Ensure that these agents are installed as a containerized workload deployed through a daemon set.</simpara>
</listitem>
<listitem>
<simpara>Install cloud provider integration if you want to enable features such as dynamic storage, on-demand service routing, node hostname to Kubernetes hostname resolution, and cluster autoscaling.</simpara>
<note>
<simpara>It is not possible to enable cloud provider integration in {product-title} environments that mix resources from different cloud providers, or that span multiple physical or virtual platforms. The node life cycle controller will not allow nodes that are external to the existing provider to be added to a cluster, and it is not possible to specify more than one cloud provider integration.</simpara>
</note>
</listitem>
<listitem>
<simpara>A provider-specific Machine API implementation is required if you want to use machine sets or autoscaling to automatically provision {product-title} cluster nodes.</simpara>
</listitem>
<listitem>
<simpara>Check whether your chosen cloud provider offers a method to inject Ignition configuration files into hosts as part of their initial deployment. If they do not, you will need to host Ignition configuration files by using an HTTP server. The steps taken to troubleshoot Ignition configuration file issues will differ depending on which of these two methods is deployed.</simpara>
</listitem>
<listitem>
<simpara>Storage needs to be manually provisioned if you want to leverage optional framework components such as the embedded container registry, Elasticsearch, or Prometheus. Default storage classes are not defined in user-provisioned infrastructure installations unless explicitly configured.</simpara>
</listitem>
<listitem>
<simpara>A load balancer is required to distribute API requests across all control plane nodes in highly available {product-title} environments. You can use any TCP-based load balancing solution that meets {product-title} DNS routing and port requirements.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="checking-load-balancer-configuration_troubleshooting-installations">
<title>Checking a load balancer configuration before {product-title} installation</title>
<simpara>Check your load balancer configuration prior to starting an {product-title} installation.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have configured an external load balancer of your choosing, in preparation for an {product-title} installation. The following example is based on a Red Hat Enterprise Linux (RHEL) host using HAProxy to provide load balancing services to a cluster.</simpara>
</listitem>
<listitem>
<simpara>You have configured DNS in preparation for an {product-title} installation.</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your load balancer.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Check that the <literal>haproxy</literal> systemd service is active:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh &lt;user_name&gt;@&lt;load_balancer&gt; systemctl status haproxy</programlisting>
</listitem>
<listitem>
<simpara>Verify that the load balancer is listening on the required ports. The following example references ports <literal>80</literal>, <literal>443</literal>, <literal>6443</literal>, and <literal>22623</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>For HAProxy instances running on Red Hat Enterprise Linux (RHEL) 6, verify port status by using the <literal>netstat</literal> command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh &lt;user_name&gt;@&lt;load_balancer&gt; netstat -nltupe | grep -E ':80|:443|:6443|:22623'</programlisting>
</listitem>
<listitem>
<simpara>For HAProxy instances running on Red Hat Enterprise Linux (RHEL) 7 or 8, verify port status by using the <literal>ss</literal> command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh &lt;user_name&gt;@&lt;load_balancer&gt; ss -nltupe | grep -E ':80|:443|:6443|:22623'</programlisting>
<note>
<simpara>Red Hat recommends the <literal>ss</literal> command instead of <literal>netstat</literal> in Red Hat Enterprise Linux (RHEL) 7 or later. <literal>ss</literal> is provided by the iproute package. For more information on the <literal>ss</literal> command, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/performance_tuning_guide/sect-red_hat_enterprise_linux-performance_tuning_guide-tool_reference-ss">Red Hat Enterprise Linux (RHEL) 7 Performance Tuning Guide</link>.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Check that the wildcard DNS record resolves to the load balancer:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ dig &lt;wildcard_fqdn&gt; @&lt;dns_server&gt;</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="specifying-openshift-installer-log-levels_troubleshooting-installations">
<title>Specifying {product-title} installer log levels</title>
<simpara>By default, the {product-title} installer log level is set to <literal>info</literal>. If more detailed logging is required when diagnosing a failed {product-title} installation, you can increase the <literal>openshift-install</literal> log level to <literal>debug</literal> when starting the installation again.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the installation host.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Set the installation log level to <literal>debug</literal> when initiating the installation:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ./openshift-install --dir &lt;installation_directory&gt; wait-for bootstrap-complete --log-level debug  <co xml:id="CO33-1"/></programlisting>
<calloutlist>
<callout arearefs="CO33-1">
<para>Possible log levels include <literal>info</literal>, <literal>warn</literal>, <literal>error,</literal> and <literal>debug</literal>.</para>
</callout>
</calloutlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="troubleshooting-openshift-install-command-issues_troubleshooting-installations">
<title>Troubleshooting openshift-install command issues</title>
<simpara>If you experience issues running the <literal>openshift-install</literal> command, check the following:</simpara>
<itemizedlist>
<listitem>
<simpara>The installation has been initiated within 24 hours of Ignition configuration file creation. The Ignition files are created when the following command is run:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ./openshift-install create ignition-configs --dir=./install_dir</programlisting>
</listitem>
<listitem>
<simpara>The <literal>install-config.yaml</literal> file is in the same directory as the installer. If an alternative installation path is declared by using the <literal>./openshift-install --dir</literal> option, verify that the <literal>install-config.yaml</literal> file exists within that directory.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="monitoring-installation-progress_troubleshooting-installations">
<title>Monitoring installation progress</title>
<simpara>You can monitor high-level installation, bootstrap, and control plane logs as an {product-title} installation progresses. This provides greater visibility into how an installation progresses and helps identify the stage at which an installation failure occurs.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> cluster role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the bootstrap and control plane nodes.</simpara>
<note>
<simpara>The initial <literal>kubeadmin</literal> password can be found in <literal>&lt;install_directory&gt;/auth/kubeadmin-password</literal> on the installation host.</simpara>
</note>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Watch the installation log as the installation progresses:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ tail -f ~/&lt;installation_directory&gt;/.openshift_install.log</programlisting>
</listitem>
<listitem>
<simpara>Monitor the <literal>bootkube.service</literal> journald unit log on the bootstrap node, after it has booted. This provides visibility into the bootstrapping of the first control plane. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; journalctl -b -f -u bootkube.service</programlisting>
<note>
<simpara>The <literal>bootkube.service</literal> log on the bootstrap node outputs etcd <literal>connection refused</literal> errors, indicating that the bootstrap server is unable to connect to etcd on control plane nodes. After etcd has started on each control plane node and the nodes have joined the cluster, the errors should stop.</simpara>
</note>
</listitem>
<listitem>
<simpara>Monitor <literal>kubelet.service</literal> journald unit logs on control plane nodes, after they have booted. This provides visibility into control plane node agent activity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Monitor the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u kubelet</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u kubelet.service</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Monitor <literal>crio.service</literal> journald unit logs on control plane nodes, after they have booted. This provides visibility into control plane node CRI-O container runtime activity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Monitor the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u crio</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@master-N.cluster_name.sub_domain.domain journalctl -b -f -u crio.service</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="gathering-bootstrap-diagnostic-data_troubleshooting-installations">
<title>Gathering bootstrap node diagnostic data</title>
<simpara>When experiencing bootstrap-related issues, you can gather <literal>bootkube.service</literal> <literal>journald</literal> unit logs and container logs from the bootstrap node.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have SSH access to your bootstrap node.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain name of the bootstrap node.</simpara>
</listitem>
<listitem>
<simpara>If you are hosting Ignition configuration files by using an HTTP server, you must have the HTTP server&#8217;s fully qualified domain name and the port number. You must also have SSH access to the HTTP host.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>If you have access to the bootstrap node&#8217;s console, monitor the console until the node reaches the login prompt.</simpara>
</listitem>
<listitem>
<simpara>Verify the Ignition file configuration.</simpara>
<itemizedlist>
<listitem>
<simpara>If you are hosting Ignition configuration files by using an HTTP server.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Verify the bootstrap node Ignition file URL. Replace <literal>&lt;http_server_fqdn&gt;</literal> with HTTP server&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl -I http://&lt;http_server_fqdn&gt;:&lt;port&gt;/bootstrap.ign  <co xml:id="CO34-1"/></programlisting>
<calloutlist>
<callout arearefs="CO34-1">
<para>The <literal>-I</literal> option returns the header only. If the Ignition file is available on the specified URL, the command returns <literal>200 OK</literal> status. If it is not available, the command returns <literal>404 file not found</literal>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To verify that the Ignition file was received by the bootstrap node, query the HTTP server logs on the serving host. For example, if you are using an Apache web server to serve Ignition files, enter the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ grep -is 'bootstrap.ign' /var/log/httpd/access_log</programlisting>
<simpara>If the bootstrap Ignition file is received, the associated <literal>HTTP GET</literal> log message will include a <literal>200 OK</literal> success status, indicating that the request succeeded.</simpara>
</listitem>
<listitem>
<simpara>If the Ignition file was not received, check that the Ignition files exist and that they have the appropriate file and web server permissions on the serving host directly.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If you are using a cloud provider mechanism to inject Ignition configuration files into hosts as part of their initial deployment.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review the bootstrap node&#8217;s console to determine if the mechanism is injecting the bootstrap node Ignition file correctly.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Verify the availability of the bootstrap node&#8217;s assigned storage device.</simpara>
</listitem>
<listitem>
<simpara>Verify that the bootstrap node has been assigned an IP address from the DHCP server.</simpara>
</listitem>
<listitem>
<simpara>Collect <literal>bootkube.service</literal> journald unit logs from the bootstrap node. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; journalctl -b -f -u bootkube.service</programlisting>
<note>
<simpara>The <literal>bootkube.service</literal> log on the bootstrap node outputs etcd <literal>connection refused</literal> errors, indicating that the bootstrap server is unable to connect to etcd on control plane nodes. After etcd has started on each control plane node and the nodes have joined the cluster, the errors should stop.</simpara>
</note>
</listitem>
<listitem>
<simpara>Collect logs from the bootstrap node containers.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Collect the logs using <literal>podman</literal> on the bootstrap node. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; 'for pod in $(sudo podman ps -a -q); do sudo podman logs $pod; done'</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If the bootstrap process fails, verify the following.</simpara>
<itemizedlist>
<listitem>
<simpara>You can resolve <literal>api.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> from the installation host.</simpara>
</listitem>
<listitem>
<simpara>The load balancer proxies port 6443 connections to bootstrap and control plane nodes. Ensure that the proxy configuration meets {product-title} installation requirements.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="investigating-master-node-installation-issues_troubleshooting-installations">
<title>Investigating control plane node installation issues</title>
<simpara>If you experience control plane node installation issues, determine the control plane node {product-title} software defined network (SDN), and network Operator status. Collect <literal>kubelet.service</literal>, <literal>crio.service</literal> journald unit logs, and control plane node container logs for visibility into control plane node agent, CRI-O container runtime, and pod activity.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the bootstrap and control plane nodes.</simpara>
</listitem>
<listitem>
<simpara>If you are hosting Ignition configuration files by using an HTTP server, you must have the HTTP server&#8217;s fully qualified domain name and the port number. You must also have SSH access to the HTTP host.</simpara>
<note>
<simpara>The initial <literal>kubeadmin</literal> password can be found in <literal>&lt;install_directory&gt;/auth/kubeadmin-password</literal> on the installation host.</simpara>
</note>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>If you have access to the console for the control plane node, monitor the console until the node reaches the login prompt. During the installation, Ignition log messages are output to the console.</simpara>
</listitem>
<listitem>
<simpara>Verify Ignition file configuration.</simpara>
<itemizedlist>
<listitem>
<simpara>If you are hosting Ignition configuration files by using an HTTP server.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Verify the control plane node Ignition file URL. Replace <literal>&lt;http_server_fqdn&gt;</literal> with HTTP server&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl -I http://&lt;http_server_fqdn&gt;:&lt;port&gt;/master.ign  <co xml:id="CO35-1"/></programlisting>
<calloutlist>
<callout arearefs="CO35-1">
<para>The <literal>-I</literal> option returns the header only. If the Ignition file is available on the specified URL, the command returns <literal>200 OK</literal> status. If it is not available, the command returns <literal>404 file not found</literal>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To verify that the Ignition file was received by the control plane node query the HTTP server logs on the serving host. For example, if you are using an Apache web server to serve Ignition files:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ grep -is 'master.ign' /var/log/httpd/access_log</programlisting>
<simpara>If the master Ignition file is received, the associated <literal>HTTP GET</literal> log message will include a <literal>200 OK</literal> success status, indicating that the request succeeded.</simpara>
</listitem>
<listitem>
<simpara>If the Ignition file was not received, check that it exists on the serving host directly. Ensure that the appropriate file and web server permissions are in place.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If you are using a cloud provider mechanism to inject Ignition configuration files into hosts as part of their initial deployment.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review the console for the control plane node to determine if the mechanism is injecting the control plane node Ignition file correctly.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Check the availability of the storage device assigned to the control plane node.</simpara>
</listitem>
<listitem>
<simpara>Verify that the control plane node has been assigned an IP address from the DHCP server.</simpara>
</listitem>
<listitem>
<simpara>Determine control plane node status.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Query control plane node status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
</listitem>
<listitem>
<simpara>If one of the control plane nodes does not reach a <literal>Ready</literal> status, retrieve a detailed node description:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe node &lt;master_node&gt;</programlisting>
<note>
<simpara>It is not possible to run <literal>oc</literal> commands if an installation issue prevents the {product-title} API from running or if the kubelet is not running yet on each node:</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Determine {product-title} SDN status.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review <literal>sdn-controller</literal>, <literal>sdn</literal>, and <literal>ovs</literal> daemon set status, in the <literal>openshift-sdn</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get daemonsets -n openshift-sdn</programlisting>
</listitem>
<listitem>
<simpara>If those resources are listed as <literal>Not found</literal>, review pods in the <literal>openshift-sdn</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-sdn</programlisting>
</listitem>
<listitem>
<simpara>Review logs relating to failed {product-title} SDN pods in the <literal>openshift-sdn</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs &lt;sdn_pod&gt; -n openshift-sdn</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Determine cluster network configuration status.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review whether the cluster&#8217;s network configuration exists:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get network.config.openshift.io cluster -o yaml</programlisting>
</listitem>
<listitem>
<simpara>If the installer failed to create the network configuration, generate the Kubernetes manifests again and review message output:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ./openshift-install create manifests</programlisting>
</listitem>
<listitem>
<simpara>Review the pod status in the <literal>openshift-network-operator</literal> namespace to determine whether the Cluster Network Operator (CNO) is running:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-network-operator</programlisting>
</listitem>
<listitem>
<simpara>Gather network Operator pod logs from the <literal>openshift-network-operator</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;network_operator_pod_name&gt; -n openshift-network-operator</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Monitor <literal>kubelet.service</literal> journald unit logs on control plane nodes, after they have booted. This provides visibility into control plane node agent activity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u kubelet</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u kubelet.service</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Retrieve <literal>crio.service</literal> journald unit logs on control plane nodes, after they have booted. This provides visibility into control plane node CRI-O container runtime activity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u crio</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u crio.service</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Collect logs from specific subdirectories under <literal>/var/log/</literal> on control plane nodes.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve a list of logs contained within a <literal>/var/log/</literal> subdirectory. The following example lists files in <literal>/var/log/openshift-apiserver/</literal> on all control plane nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master --path=openshift-apiserver</programlisting>
</listitem>
<listitem>
<simpara>Inspect a specific log within a <literal>/var/log/</literal> subdirectory. The following example outputs <literal>/var/log/openshift-apiserver/audit.log</literal> contents from all control plane nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master --path=openshift-apiserver/audit.log</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs on each node using SSH instead. The following example tails <literal>/var/log/openshift-apiserver/audit.log</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo tail -f /var/log/openshift-apiserver/audit.log</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Review control plane node container logs using SSH.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>List the containers:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl ps -a</programlisting>
</listitem>
<listitem>
<simpara>Retrieve a container&#8217;s logs using <literal>crictl</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl logs -f &lt;container_id&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If you experience control plane node configuration issues, verify that the MCO, MCO endpoint, and DNS record are functioning. The Machine Config Operator (MCO) manages operating system configuration during the installation procedure. Also verify system clock accuracy and certificate validity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Test whether the MCO endpoint is available. Replace <literal>&lt;cluster_name&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl https://api-int.&lt;cluster_name&gt;:22623/config/master</programlisting>
</listitem>
<listitem>
<simpara>If the endpoint is unresponsive, verify load balancer configuration. Ensure that the endpoint is configured to run on port 22623.</simpara>
</listitem>
<listitem>
<simpara>Verify that the MCO endpoint&#8217;s DNS record is configured and resolves to the load balancer.</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>Run a DNS lookup for the defined MCO endpoint name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ dig api-int.&lt;cluster_name&gt; @&lt;dns_server&gt;</programlisting>
</listitem>
<listitem>
<simpara>Run a reverse lookup to the assigned MCO IP address on the load balancer:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ dig -x &lt;load_balancer_mco_ip_address&gt; @&lt;dns_server&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Verify that the MCO is functioning from the bootstrap node directly. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; curl https://api-int.&lt;cluster_name&gt;:22623/config/master</programlisting>
</listitem>
<listitem>
<simpara>System clock time must be synchronized between bootstrap, master, and worker nodes. Check each node&#8217;s system clock reference time and time synchronization statistics:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; chronyc tracking</programlisting>
</listitem>
<listitem>
<simpara>Review certificate validity:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ openssl s_client -connect api-int.&lt;cluster_name&gt;:22623 | openssl x509 -noout -text</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="investigating-etcd-installation-issues_troubleshooting-installations">
<title>Investigating etcd installation issues</title>
<simpara>If you experience etcd issues during installation, you can check etcd pod status and collect etcd pod logs. You can also verify etcd DNS records and check DNS availability on control plane nodes.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the control plane nodes.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Check the status of etcd pods.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review the status of pods in the <literal>openshift-etcd</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-etcd</programlisting>
</listitem>
<listitem>
<simpara>Review the status of pods in the <literal>openshift-etcd-operator</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-etcd-operator</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If any of the pods listed by the previous commands are not showing a <literal>Running</literal> or a <literal>Completed</literal> status, gather diagnostic information for the pod.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review events for the pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe pod/&lt;pod_name&gt; -n &lt;namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Inspect the pod&#8217;s logs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;pod_name&gt; -n &lt;namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>If the pod has more than one container, the preceding command will create an error, and the container names will be provided in the error message. Inspect logs for each container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;pod_name&gt; -c &lt;container_name&gt; -n &lt;namespace&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If the API is not functional, review etcd pod and container logs on each control plane node by using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>List etcd pods on each control plane node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl pods --name=etcd-</programlisting>
</listitem>
<listitem>
<simpara>For any pods not showing <literal>Ready</literal> status, inspect pod status in detail. Replace <literal>&lt;pod_id&gt;</literal> with the pod&#8217;s ID listed in the output of the preceding command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl inspectp &lt;pod_id&gt;</programlisting>
</listitem>
<listitem>
<simpara>List containers related to a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl ps | grep '&lt;pod_id&gt;'</programlisting>
</listitem>
<listitem>
<simpara>For any containers not showing <literal>Ready</literal> status, inspect container status in detail. Replace <literal>&lt;container_id&gt;</literal> with container IDs listed in the output of the preceding command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl inspect &lt;container_id&gt;</programlisting>
</listitem>
<listitem>
<simpara>Review the logs for any containers not showing a <literal>Ready</literal> status. Replace <literal>&lt;container_id&gt;</literal> with the container IDs listed in the output of the preceding command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl logs -f &lt;container_id&gt;</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Validate primary and secondary DNS server connectivity from control plane nodes.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="investigating-kubelet-api-installation-issues_troubleshooting-installations">
<title>Investigating control plane node kubelet and API server issues</title>
<simpara>To investigate control plane node kubelet and API server issues during installation, check DNS, DHCP, and load balancer functionality. Also, verify that certificates have not expired.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the control plane nodes.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Verify that the API server&#8217;s DNS record directs the kubelet on control plane nodes to <literal>https://api-int.&lt;cluster_name&gt;.&lt;base_domain&gt;:6443</literal>. Ensure that the record references the load balancer.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the load balancer&#8217;s port 6443 definition references each control plane node.</simpara>
</listitem>
<listitem>
<simpara>Check that unique control plane node hostnames have been provided by DHCP.</simpara>
</listitem>
<listitem>
<simpara>Inspect the <literal>kubelet.service</literal> journald unit logs on each control plane node.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u kubelet</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u kubelet.service</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Check for certificate expiration messages in the control plane node kubelet logs.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the log using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u kubelet | grep -is 'x509: certificate has expired'</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u kubelet.service  | grep -is 'x509: certificate has expired'</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="investigating-worker-node-installation-issues_troubleshooting-installations">
<title>Investigating worker node installation issues</title>
<simpara>If you experience worker node installation issues, you can review the worker node status. Collect <literal>kubelet.service</literal>, <literal>crio.service</literal> journald unit logs and the worker node container logs for visibility into the worker node agent, CRI-O container runtime and pod activity. Additionally, you can check the Ignition file and Machine API Operator functionality. If worker node postinstallation configuration fails, check Machine Config Operator (MCO) and DNS functionality. You can also verify system clock synchronization between the bootstrap, master, and worker nodes, and validate certificates.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the bootstrap and worker nodes.</simpara>
</listitem>
<listitem>
<simpara>If you are hosting Ignition configuration files by using an HTTP server, you must have the HTTP server&#8217;s fully qualified domain name and the port number. You must also have SSH access to the HTTP host.</simpara>
<note>
<simpara>The initial <literal>kubeadmin</literal> password can be found in <literal>&lt;install_directory&gt;/auth/kubeadmin-password</literal> on the installation host.</simpara>
</note>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>If you have access to the worker node&#8217;s console, monitor the console until the node reaches the login prompt. During the installation, Ignition log messages are output to the console.</simpara>
</listitem>
<listitem>
<simpara>Verify Ignition file configuration.</simpara>
<itemizedlist>
<listitem>
<simpara>If you are hosting Ignition configuration files by using an HTTP server.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Verify the worker node Ignition file URL. Replace <literal>&lt;http_server_fqdn&gt;</literal> with HTTP server&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl -I http://&lt;http_server_fqdn&gt;:&lt;port&gt;/worker.ign  <co xml:id="CO36-1"/></programlisting>
<calloutlist>
<callout arearefs="CO36-1">
<para>The <literal>-I</literal> option returns the header only. If the Ignition file is available on the specified URL, the command returns <literal>200 OK</literal> status. If it is not available, the command returns <literal>404 file not found</literal>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To verify that the Ignition file was received by the worker node, query the HTTP server logs on the HTTP host. For example, if you are using an Apache web server to serve Ignition files:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ grep -is 'worker.ign' /var/log/httpd/access_log</programlisting>
<simpara>If the worker Ignition file is received, the associated <literal>HTTP GET</literal> log message will include a <literal>200 OK</literal> success status, indicating that the request succeeded.</simpara>
</listitem>
<listitem>
<simpara>If the Ignition file was not received, check that it exists on the serving host directly. Ensure that the appropriate file and web server permissions are in place.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If you are using a cloud provider mechanism to inject Ignition configuration files into hosts as part of their initial deployment.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review the worker node&#8217;s console to determine if the mechanism is injecting the worker node Ignition file correctly.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Check the availability of the worker node&#8217;s assigned storage device.</simpara>
</listitem>
<listitem>
<simpara>Verify that the worker node has been assigned an IP address from the DHCP server.</simpara>
</listitem>
<listitem>
<simpara>Determine worker node status.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Query node status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
</listitem>
<listitem>
<simpara>Retrieve a detailed node description for any worker nodes not showing a <literal>Ready</literal> status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe node &lt;worker_node&gt;</programlisting>
<note>
<simpara>It is not possible to run <literal>oc</literal> commands if an installation issue prevents the {product-title} API from running or if the kubelet is not running yet on each node.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Unlike control plane nodes, worker nodes are deployed and scaled using the Machine API Operator. Check the status of the Machine API Operator.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Review Machine API Operator pod status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-machine-api</programlisting>
</listitem>
<listitem>
<simpara>If the Machine API Operator pod does not have a <literal>Ready</literal> status, detail the pod&#8217;s events:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe pod/&lt;machine_api_operator_pod_name&gt; -n openshift-machine-api</programlisting>
</listitem>
<listitem>
<simpara>Inspect <literal>machine-api-operator</literal> container logs. The container runs within the <literal>machine-api-operator</literal> pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;machine_api_operator_pod_name&gt; -n openshift-machine-api -c machine-api-operator</programlisting>
</listitem>
<listitem>
<simpara>Also inspect <literal>kube-rbac-proxy</literal> container logs. The container also runs within the <literal>machine-api-operator</literal> pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;machine_api_operator_pod_name&gt; -n openshift-machine-api -c kube-rbac-proxy</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Monitor <literal>kubelet.service</literal> journald unit logs on worker nodes, after they have booted. This provides visibility into worker node agent activity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=worker -u kubelet</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;worker-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;worker-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u kubelet.service</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Retrieve <literal>crio.service</literal> journald unit logs on worker nodes, after they have booted. This provides visibility into worker node CRI-O container runtime activity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the logs using <literal>oc</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=worker -u crio</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;worker-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u crio.service</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Collect logs from specific subdirectories under <literal>/var/log/</literal> on worker nodes.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve a list of logs contained within a <literal>/var/log/</literal> subdirectory. The following example lists files in <literal>/var/log/sssd/</literal> on all worker nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=worker --path=sssd</programlisting>
</listitem>
<listitem>
<simpara>Inspect a specific log within a <literal>/var/log/</literal> subdirectory. The following example outputs <literal>/var/log/sssd/audit.log</literal> contents from all worker nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=worker --path=sssd/sssd.log</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs on each node using SSH instead. The following example tails <literal>/var/log/sssd/sssd.log</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;worker-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo tail -f /var/log/sssd/sssd.log</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Review worker node container logs using SSH.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>List the containers:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;worker-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl ps -a</programlisting>
</listitem>
<listitem>
<simpara>Retrieve a container&#8217;s logs using <literal>crictl</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;worker-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl logs -f &lt;container_id&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If you experience worker node configuration issues, verify that the MCO, MCO endpoint, and DNS record are functioning. The Machine Config Operator (MCO) manages operating system configuration during the installation procedure. Also verify system clock accuracy and certificate validity.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Test whether the MCO endpoint is available. Replace <literal>&lt;cluster_name&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ curl https://api-int.&lt;cluster_name&gt;:22623/config/worker</programlisting>
</listitem>
<listitem>
<simpara>If the endpoint is unresponsive, verify load balancer configuration. Ensure that the endpoint is configured to run on port 22623.</simpara>
</listitem>
<listitem>
<simpara>Verify that the MCO endpoint&#8217;s DNS record is configured and resolves to the load balancer.</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>Run a DNS lookup for the defined MCO endpoint name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ dig api-int.&lt;cluster_name&gt; @&lt;dns_server&gt;</programlisting>
</listitem>
<listitem>
<simpara>Run a reverse lookup to the assigned MCO IP address on the load balancer:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ dig -x &lt;load_balancer_mco_ip_address&gt; @&lt;dns_server&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Verify that the MCO is functioning from the bootstrap node directly. Replace <literal>&lt;bootstrap_fqdn&gt;</literal> with the bootstrap node&#8217;s fully qualified domain name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;bootstrap_fqdn&gt; curl https://api-int.&lt;cluster_name&gt;:22623/config/worker</programlisting>
</listitem>
<listitem>
<simpara>System clock time must be synchronized between bootstrap, master, and worker nodes. Check each node&#8217;s system clock reference time and time synchronization statistics:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; chronyc tracking</programlisting>
</listitem>
<listitem>
<simpara>Review certificate validity:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ openssl s_client -connect api-int.&lt;cluster_name&gt;:22623 | openssl x509 -noout -text</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="querying-operator-status-after-installation_troubleshooting-installations">
<title>Querying Operator status after installation</title>
<simpara>You can check Operator status at the end of an installation. Retrieve diagnostic data for Operators that do not become available. Review logs for any Operator pods that are listed as <literal>Pending</literal> or have an error status. Validate base images used by problematic pods.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Check that cluster Operators are all available at the end of an installation.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get clusteroperators</programlisting>
</listitem>
<listitem>
<simpara>Verify that all of the required certificate signing requests (CSRs) are approved. Some nodes might not move to a <literal>Ready</literal> status and some cluster Operators might not become available if there are pending CSRs.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Check the status of the CSRs and ensure that you see a client and server request with the <literal>Pending</literal> or <literal>Approved</literal> status for each machine that you added to the cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get csr</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME        AGE     REQUESTOR                                                                   CONDITION
csr-8b2br   15m     system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   Pending <co xml:id="CO37-1"/>
csr-8vnps   15m     system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   Pending
csr-bfd72   5m26s   system:node:ip-10-0-50-126.us-east-2.compute.internal                       Pending <co xml:id="CO37-2"/>
csr-c57lv   5m26s   system:node:ip-10-0-95-157.us-east-2.compute.internal                       Pending
...</programlisting>
</para>
</formalpara>
<calloutlist>
<callout arearefs="CO37-1">
<para>A client request CSR.</para>
</callout>
<callout arearefs="CO37-2">
<para>A server request CSR.</para>
</callout>
</calloutlist>
<simpara>In this example, two machines are joining the cluster. You might see more approved CSRs in the list.</simpara>
</listitem>
<listitem>
<simpara>If the CSRs were not approved, after all of the pending CSRs for the machines you added are in <literal>Pending</literal> status, approve the CSRs for your cluster machines:</simpara>
<note>
<simpara>Because the CSRs rotate automatically, approve your CSRs within an hour of adding the machines to the cluster. If you do not approve them within an hour, the certificates will rotate, and more than two certificates will be present for each node. You must approve all of these certificates. After you approve the initial CSRs, the subsequent node client CSRs are automatically approved by the cluster <literal>kube-controller-manager</literal>.</simpara>
</note>
<note>
<simpara>For clusters running on platforms that are not machine API enabled, such as bare metal and other user-provisioned infrastructure, you must implement a method of automatically approving the kubelet serving certificate requests (CSRs). If a request is not approved, then the <literal>oc exec</literal>, <literal>oc rsh</literal>, and <literal>oc logs</literal> commands cannot succeed, because a serving certificate is required when the API server connects to the kubelet. Any operation that contacts the Kubelet endpoint requires this certificate approval to be in place. The method must watch for new CSRs, confirm that the CSR was submitted by the <literal>node-bootstrapper</literal> service account in the <literal>system:node</literal> or <literal>system:admin</literal> groups, and confirm the identity of the node.</simpara>
</note>
<itemizedlist>
<listitem>
<simpara>To approve them individually, run the following command for each valid CSR:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm certificate approve &lt;csr_name&gt; <co xml:id="CO38-1"/></programlisting>
<calloutlist>
<callout arearefs="CO38-1">
<para><literal>&lt;csr_name&gt;</literal> is the name of a CSR from the list of current CSRs.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To approve all pending CSRs, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get csr -o go-template='{{range .items}}{{if not .status}}{{.metadata.name}}{{"\n"}}{{end}}{{end}}' | xargs oc adm certificate approve</programlisting>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>View Operator events:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe clusteroperator &lt;operator_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Review Operator pod status within the Operator&#8217;s namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Obtain a detailed description for pods that do not have <literal>Running</literal> status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe pod/&lt;operator_pod_name&gt; -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Inspect pod logs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;operator_pod_name&gt; -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>When experiencing pod base image related issues, review base image status.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Obtain details of the base image used by a problematic pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pod -o "jsonpath={range .status.containerStatuses[*]}{.name}{'\t'}{.state}{'\t'}{.image}{'\n'}{end}" &lt;operator_pod_name&gt; -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>List base image release information:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm release info &lt;image_path&gt;:&lt;tag&gt; --commits</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="installation-bootstrap-gather_troubleshooting-installations">
<title>Gathering logs from a failed installation</title>
<simpara>If you gave an SSH key to your installation program, you can gather data about
your failed installation.</simpara>
<note>
<simpara>You use a different command to gather logs about an unsuccessful installation
than to gather logs from a running cluster. If you must gather logs from a
running cluster, use the <literal>oc adm must-gather</literal> command.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Your {product-title} installation failed before the bootstrap process finished. The bootstrap node is running and accessible through SSH.</simpara>
</listitem>
<listitem>
<simpara>The <literal>ssh-agent</literal> process is active on your computer, and you provided the same SSH key to both the <literal>ssh-agent</literal> process and the installation program.</simpara>
</listitem>
<listitem>
<simpara>If you tried to install a cluster on infrastructure that you provisioned, you must have the fully qualified domain names of the bootstrap and control plane nodes.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Generate the commands that are required to obtain the installation logs from
the bootstrap and control plane machines:</simpara>
<itemizedlist>
<listitem>
<simpara>If you used installer-provisioned infrastructure, change to the directory that contains the installation program and run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ./openshift-install gather bootstrap --dir &lt;installation_directory&gt; <co xml:id="CO39-1"/></programlisting>
<calloutlist>
<callout arearefs="CO39-1">
<para><literal>installation_directory</literal> is the directory you specified when you ran <literal>./openshift-install create cluster</literal>. This directory contains the {product-title}
definition files that the installation program creates.</para>
</callout>
</calloutlist>
<simpara>For installer-provisioned infrastructure, the installation program stores
information about the cluster, so you do not specify the hostnames or IP
addresses.</simpara>
</listitem>
<listitem>
<simpara>If you used infrastructure that you provisioned yourself, change to the directory that contains the installation program and run the following
command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ./openshift-install gather bootstrap --dir &lt;installation_directory&gt; \ <co xml:id="CO40-1"/>
    --bootstrap &lt;bootstrap_address&gt; \ <co xml:id="CO40-2"/>
    --master &lt;master_1_address&gt; \ <co xml:id="CO40-3"/>
    --master &lt;master_2_address&gt; \ <co xml:id="CO40-4"/>
    --master &lt;master_3_address&gt;" <co xml:id="CO40-5"/></programlisting>
<calloutlist>
<callout arearefs="CO40-1">
<para>For <literal>installation_directory</literal>, specify the same directory you specified when you ran <literal>./openshift-install create cluster</literal>. This directory contains the {product-title}
definition files that the installation program creates.</para>
</callout>
<callout arearefs="CO40-2">
<para><literal>&lt;bootstrap_address&gt;</literal> is the fully qualified domain name or IP address of
the cluster&#8217;s bootstrap machine.</para>
</callout>
<callout arearefs="CO40-3 CO40-4 CO40-5">
<para>For each control plane, or master, machine in your cluster, replace <literal>&lt;master_*_address&gt;</literal> with its fully qualified domain name or IP address.</para>
</callout>
</calloutlist>
<note>
<simpara>A default cluster contains three control plane machines. List all of your control plane machines as shown, no matter how many your cluster uses.</simpara>
</note>
</listitem>
</itemizedlist>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">INFO Pulling debug logs from the bootstrap machine
INFO Bootstrap gather logs captured here "&lt;installation_directory&gt;/log-bundle-&lt;timestamp&gt;.tar.gz"</programlisting>
</para>
</formalpara>
<simpara>If you open a Red Hat support case about your installation failure, include
the compressed logs in the case.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="_additional_resources_2" role="_additional-resources">
<title>Additional resources</title>
<itemizedlist>
<listitem>
<simpara>See <link xl:href="../../architecture/architecture-installation.xml#installation-process_architecture-installation">Installation process</link> for more details on {product-title} installation types and process.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="verifying-node-health">
<title>Verifying node health</title>

<section xml:id="reviewing-node-status-use-and-configuration_verifying-node-health">
<title>Reviewing node status, resource usage, and configuration</title>
<simpara>Review cluster node health status, resource consumption statistics, and node logs. Additionally, query <literal>kubelet</literal> status on individual nodes.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>List the name, status, and role for all nodes in the cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
</listitem>
<listitem>
<simpara>Summarize CPU and memory usage for each node within the cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm top nodes</programlisting>
</listitem>
<listitem>
<simpara>Summarize CPU and memory usage for a specific node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm top node my-node</programlisting>
</listitem>
</itemizedlist>
</section>
<section xml:id="querying-kubelet-status-on-a-node_verifying-node-health">
<title>Querying the kubelet&#8217;s status on a node</title>
<simpara>You can review cluster node health status, resource consumption statistics, and node logs. Additionally, you can query <literal>kubelet</literal> status on individual nodes.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>The kubelet is managed using a systemd service on each node. Review the kubelet&#8217;s status by querying the <literal>kubelet</literal> systemd service within a debug pod.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Start a debug pod for a node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-node</programlisting>
<note>
<simpara>If you are running <literal>oc debug</literal> on a control plane node, you can find administrative <literal>kubeconfig</literal> files in the <literal>/etc/kubernetes/static-pod-resources/kube-apiserver-certs/secrets/node-kubeconfigs</literal> directory.</simpara>
</note>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or <literal>kubelet</literal> is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>Check whether the <literal>kubelet</literal> systemd service is active on the node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl is-active kubelet</programlisting>
</listitem>
<listitem>
<simpara>Output a more detailed <literal>kubelet.service</literal> status summary:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl status kubelet</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="querying-cluster-node-journal-logs_verifying-node-health">
<title>Querying cluster node journal logs</title>
<simpara>You can gather <literal>journald</literal> unit logs and other logs within <literal>/var/log</literal> on individual cluster nodes.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have SSH access to your hosts.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Query <literal>kubelet</literal> <literal>journald</literal> unit logs from {product-title} cluster nodes. The following example queries control plane nodes only:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u kubelet  <co xml:id="CO41-1"/></programlisting>
<calloutlist>
<callout arearefs="CO41-1">
<para>Replace <literal>kubelet</literal> as appropriate to query other unit logs.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Collect logs from specific subdirectories under <literal>/var/log/</literal> on cluster nodes.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve a list of logs contained within a <literal>/var/log/</literal> subdirectory. The following example lists files in <literal>/var/log/openshift-apiserver/</literal> on all control plane nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master --path=openshift-apiserver</programlisting>
</listitem>
<listitem>
<simpara>Inspect a specific log within a <literal>/var/log/</literal> subdirectory. The following example outputs <literal>/var/log/openshift-apiserver/audit.log</literal> contents from all control plane nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master --path=openshift-apiserver/audit.log</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs on each node using SSH instead. The following example tails <literal>/var/log/openshift-apiserver/audit.log</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo tail -f /var/log/openshift-apiserver/audit.log</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="troubleshooting-crio-issues">
<title>Troubleshooting CRI-O container runtime issues</title>

<section xml:id="about-crio_troubleshooting-crio-issues">
<title>About CRI-O container runtime engine</title>
<simpara>CRI-O is a Kubernetes-native container engine implementation that integrates closely with the operating system to deliver an efficient and optimized Kubernetes experience. The CRI-O container engine runs as a systemd service on each {product-title} cluster node.</simpara>
<simpara>When container runtime issues occur, verify the status of the <literal>crio</literal> systemd service on each node. Gather CRI-O journald unit logs from nodes that have container runtime issues.</simpara>
</section>
<section xml:id="verifying-crio-status_troubleshooting-crio-issues">
<title>Verifying CRI-O runtime engine status</title>
<simpara>You can verify CRI-O container runtime engine status on each cluster node.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Review CRI-O status by querying the <literal>crio</literal> systemd service on a node, within a debug pod.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Start a debug pod for a node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-node</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>Check whether the <literal>crio</literal> systemd service is active on the node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl is-active crio</programlisting>
</listitem>
<listitem>
<simpara>Output a more detailed <literal>crio.service</literal> status summary:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl status crio.service</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="gathering-crio-logs_troubleshooting-crio-issues">
<title>Gathering CRI-O journald unit logs</title>
<simpara>If you experience CRI-O issues, you can obtain CRI-O journald unit logs from a node.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the control plane or control plane machines.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Gather CRI-O journald unit logs. The following example collects logs from all control plane nodes (within the cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs --role=master -u crio</programlisting>
</listitem>
<listitem>
<simpara>Gather CRI-O journald unit logs from a specific node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs &lt;node_name&gt; -u crio</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review the logs using SSH instead. Replace <literal>&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; journalctl -b -f -u crio.service</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</section>
<section xml:id="cleaning-crio-storage_troubleshooting-crio-issues">
<title>Cleaning CRI-O storage</title>
<simpara>You can manually clear the CRI-O ephemeral storage if you experience the following issues:</simpara>
<itemizedlist>
<listitem>
<simpara>A node cannot run on any pods and this error appears:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">Failed to create pod sandbox: rpc error: code = Unknown desc = failed to mount container XXX: error recreating the missing symlinks: error reading name of symlink for XXX: open /var/lib/containers/storage/overlay/XXX/link: no such file or directory</programlisting>
</listitem>
<listitem>
<simpara>You cannot create a new container on a working node and the  “can’t stat lower layer” error appears:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">can't stat lower layer ...  because it does not exist.  Going through storage to recreate the missing symlinks.</programlisting>
</listitem>
<listitem>
<simpara>Your node is in the <literal>NotReady</literal> state after a cluster upgrade or if you attempt to reboot it.</simpara>
</listitem>
<listitem>
<simpara>The container runtime implementation (<literal>crio</literal>) is not working properly.</simpara>
</listitem>
<listitem>
<simpara>You are unable to start a debug shell on the node using <literal>oc debug node/&lt;node_name&gt;</literal> because the container runtime instance (<literal>crio</literal>) is not working.</simpara>
</listitem>
</itemizedlist>
<simpara>Follow this process to completely wipe the CRI-O storage and resolve the errors.</simpara>
<itemizedlist>
<title>Prerequisites:</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Use <literal>cordon</literal> on the node. This is to avoid any workload getting scheduled if the node gets into the <literal>Ready</literal> status. You will know that scheduling is disabled when <literal>SchedulingDisabled</literal> is in your Status section:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm cordon &lt;node_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Drain the node as the cluster-admin user:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm drain &lt;node_name&gt; --ignore-daemonsets --delete-emptydir-data</programlisting>
<note>
<simpara>The <literal>terminationGracePeriodSeconds</literal> attribute of a pod or pod template controls the graceful termination period. This attribute defaults at 30 seconds, but can be customized for each application as necessary. If set to more than 90 seconds, the pod might be marked as <literal>SIGKILLed</literal> and fail to terminate successfully.</simpara>
</note>
</listitem>
<listitem>
<simpara>When the node returns, connect back to the node via SSH or Console. Then connect to the root user:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@node1.example.com
$ sudo -i</programlisting>
</listitem>
<listitem>
<simpara>Manually stop the kubelet:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl stop kubelet</programlisting>
</listitem>
<listitem>
<simpara>Stop the containers and pods:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Use the following command to stop the pods that are not in the <literal>HostNetwork</literal>. They must be removed first because their removal relies on the networking plugin pods, which are in the <literal>HostNetwork</literal>.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">.. for pod in $(crictl pods -q); do if [[ "$(crictl inspectp $pod | jq -r .status.linux.namespaces.options.network)" != "NODE" ]]; then crictl rmp -f $pod; fi; done</programlisting>
</listitem>
<listitem>
<simpara>Stop all other pods:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># crictl rmp -fa</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Manually stop the crio services:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl stop crio</programlisting>
</listitem>
<listitem>
<simpara>After you run those commands, you can completely wipe the ephemeral storage:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># crio wipe -f</programlisting>
</listitem>
<listitem>
<simpara>Start the crio and kubelet service:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl start crio
# systemctl start kubelet</programlisting>
</listitem>
<listitem>
<simpara>You will know if the clean up worked if the crio and kubelet services are started, and the node is in the <literal>Ready</literal> status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME				    STATUS	                ROLES    AGE    VERSION
ci-ln-tkbxyft-f76d1-nvwhr-master-1  Ready, SchedulingDisabled   master	 133m   v1.28.5</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Mark the node schedulable. You will know that the scheduling is enabled when <literal>SchedulingDisabled</literal> is no longer in status:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm uncordon &lt;node_name&gt;</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME				     STATUS	      ROLES    AGE    VERSION
ci-ln-tkbxyft-f76d1-nvwhr-master-1   Ready            master   133m   v1.28.5</programlisting>
</para>
</formalpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="troubleshooting-operating-system-issues">
<title>Troubleshooting operating system issues</title>

<simpara>{product-title} runs on RHCOS. You can follow these procedures to troubleshoot problems related to the operating system.</simpara>
<section xml:id="investigating-kernel-crashes">
<title>Investigating kernel crashes</title>
<simpara>The <literal>kdump</literal> service, included in the <literal>kexec-tools</literal> package, provides a crash-dumping mechanism. You can use this service to save the contents of a system&#8217;s memory for later analysis.</simpara>
<simpara>The <literal>x86_64</literal> architecture supports kdump in General Availability (GA) status, whereas other architectures support kdump in Technology Preview (TP) status.</simpara>
<simpara>The following table provides details about the support level of kdump for different architectures.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Kdump support in RHCOS</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Architecture</entry>
<entry align="center" valign="top">Support level</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>x86_64</literal></simpara></entry>
<entry align="center" valign="top"><simpara>GA</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>aarch64</literal></simpara></entry>
<entry align="center" valign="top"><simpara>TP</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>s390x</literal></simpara></entry>
<entry align="center" valign="top"><simpara>TP</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ppc64le</literal></simpara></entry>
<entry align="center" valign="top"><simpara>TP</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<important>
<simpara>Kdump support, for the preceding three architectures in the table, is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</simpara>
<simpara>For more information about the support scope of Red Hat Technology Preview features, see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</link>.</simpara>
</important>
<section xml:id="enabling-kdump">
<title>Enabling kdump</title>
<simpara>RHCOS ships with the <literal>kexec-tools</literal> package, but manual configuration is required to enable the <literal>kdump</literal> service.</simpara>
<formalpara>
<title>Procedure</title>
<para>Perform the following steps to enable kdump on RHCOS.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>To reserve memory for the crash kernel during the first kernel booting, provide kernel arguments by entering the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># rpm-ostree kargs --append='crashkernel=256M'</programlisting>
<note>
<simpara>For the <literal>ppc64le</literal> platform, the recommended value for <literal>crashkernel</literal> is <literal>crashkernel=2G-4G:384M,4G-16G:512M,16G-64G:1G,64G-128G:2G,128G-:4G</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Optional: To write the crash dump over the network or to some other location, rather than to the default local <literal>/var/crash</literal> location, edit the <literal>/etc/kdump.conf</literal> configuration file.</simpara>
<note>
<simpara>If your node uses LUKS-encrypted devices, you must use network dumps as kdump does not support saving crash dumps to LUKS-encrypted devices.</simpara>
</note>
<simpara>For details on configuring the <literal>kdump</literal> service, see the comments in <literal>/etc/sysconfig/kdump</literal>, <literal>/etc/kdump.conf</literal>, and the <literal>kdump.conf</literal> manual page.
Also refer to the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_monitoring_and_updating_the_kernel/configuring-kdump-on-the-command-line_managing-monitoring-and-updating-the-kernel#configuring-the-kdump-target_configuring-kdump-on-the-command-line">RHEL kdump documentation</link> for further information on configuring the dump target.</simpara>
</listitem>
<listitem>
<simpara>Enable the <literal>kdump</literal> systemd service.</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl enable kdump.service</programlisting>
</listitem>
<listitem>
<simpara>Reboot your system.</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl reboot</programlisting>
</listitem>
<listitem>
<simpara>Ensure that kdump has loaded a crash kernel by checking that the <literal>kdump.service</literal> systemd service has started and exited successfully and that the command, <literal>cat /sys/kernel/kexec_crash_loaded</literal>, prints the value <literal>1</literal>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="enabling-kdump-day-one">
<title>Enabling kdump on day-1</title>
<simpara>The <literal>kdump</literal> service is intended to be enabled per node to debug kernel problems. Because there are costs to having kdump enabled, and these costs accumulate with each additional kdump-enabled node, it is recommended that the <literal>kdump</literal> service only be enabled on each node as needed. Potential costs of enabling the <literal>kdump</literal> service on each node include:</simpara>
<itemizedlist>
<listitem>
<simpara>Less available RAM due to memory being reserved for the crash kernel.</simpara>
</listitem>
<listitem>
<simpara>Node unavailability while the kernel is dumping the core.</simpara>
</listitem>
<listitem>
<simpara>Additional storage space being used to store the crash dumps.</simpara>
</listitem>
</itemizedlist>
<simpara>If you are aware of the downsides and trade-offs of having the <literal>kdump</literal> service enabled, it is possible to enable kdump in a cluster-wide fashion. Although machine-specific machine configs are not yet supported, you can use a <literal>systemd</literal> unit in a <literal>MachineConfig</literal> object as a day-1 customization and have kdump enabled on all nodes in the cluster. You can create a <literal>MachineConfig</literal> object and inject that object into the set of manifest files used by Ignition during cluster setup.</simpara>
<note>
<simpara>See "Customizing nodes" in the <emphasis>Installing &#8594; Installation configuration</emphasis> section for more information and examples on how to use Ignition configs.</simpara>
</note>
<formalpara>
<title>Procedure</title>
<para>Create a <literal>MachineConfig</literal> object for cluster-wide configuration:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create a Butane config file, <literal>99-worker-kdump.bu</literal>, that configures and enables kdump:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">variant: openshift
version: {product-version}.0
metadata:
  name: 99-worker-kdump <co xml:id="CO42-1"/>
  labels:
    machineconfiguration.openshift.io/role: worker <co xml:id="CO42-2"/>
openshift:
  kernel_arguments: <co xml:id="CO42-3"/>
    - crashkernel=256M
storage:
  files:
    - path: /etc/kdump.conf <co xml:id="CO42-4"/>
      mode: 0644
      overwrite: true
      contents:
        inline: |
          path /var/crash
          core_collector makedumpfile -l --message-level 7 -d 31

    - path: /etc/sysconfig/kdump <co xml:id="CO42-5"/>
      mode: 0644
      overwrite: true
      contents:
        inline: |
          KDUMP_COMMANDLINE_REMOVE="hugepages hugepagesz slub_debug quiet log_buf_len swiotlb"
          KDUMP_COMMANDLINE_APPEND="irqpoll nr_cpus=1 reset_devices cgroup_disable=memory mce=off numa=off udev.children-max=2 panic=10 rootflags=nofail acpi_no_memhotplug transparent_hugepage=never nokaslr novmcoredd hest_disable" <co xml:id="CO42-6"/>
          KEXEC_ARGS="-s"
          KDUMP_IMG="vmlinuz"

systemd:
  units:
    - name: kdump.service
      enabled: true</programlisting>
<calloutlist>
<callout arearefs="CO42-1 CO42-2">
<para>Replace <literal>worker</literal> with <literal>master</literal> in both locations when creating a <literal>MachineConfig</literal> object for control plane nodes.</para>
</callout>
<callout arearefs="CO42-3">
<para>Provide kernel arguments to reserve memory for the crash kernel. You can add other kernel arguments if necessary. For the <literal>ppc64le</literal> platform, the recommended value for <literal>crashkernel</literal> is <literal>crashkernel=2G-4G:384M,4G-16G:512M,16G-64G:1G,64G-128G:2G,128G-:4G</literal>.</para>
</callout>
<callout arearefs="CO42-4">
<para>If you want to change the contents of <literal>/etc/kdump.conf</literal> from the default, include this section and modify the <literal>inline</literal> subsection accordingly.</para>
</callout>
<callout arearefs="CO42-5">
<para>If you want to change the contents of <literal>/etc/sysconfig/kdump</literal> from the default, include this section and modify the <literal>inline</literal> subsection accordingly.</para>
</callout>
<callout arearefs="CO42-6">
<para>For the <literal>ppc64le</literal> platform, replace <literal>nr_cpus=1</literal> with <literal>maxcpus=1</literal>, which is not supported on this platform.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Use Butane to generate a machine config YAML file, <literal>99-worker-kdump.yaml</literal>, containing the configuration to be delivered to the nodes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ butane 99-worker-kdump.bu -o 99-worker-kdump.yaml</programlisting>
</listitem>
<listitem>
<simpara>Put the YAML file into the <literal>&lt;installation_directory&gt;/manifests/</literal> directory during cluster setup. You can also create this <literal>MachineConfig</literal> object after cluster setup with the YAML file:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc create -f 99-worker-kdump.yaml</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="testing-kdump-configuration">
<title>Testing the kdump configuration</title>
<simpara>See the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/configuring-kdump-on-the-command-line_managing-monitoring-and-updating-the-kernel#testing-the-kdump-configuration_configuring-kdump-on-the-command-line">Testing the kdump configuration</link> section in the RHEL documentation for kdump.</simpara>
</section>
<section xml:id="analyzing-core-dumps">
<title>Analyzing a core dump</title>
<simpara>See the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/analyzing-a-core-dump_managing-monitoring-and-updating-the-kernel">Analyzing a core dump</link> section in the RHEL documentation for kdump.</simpara>
<note>
<simpara>It is recommended to perform vmcore analysis on a separate RHEL system.</simpara>
</note>
<bridgehead xml:id="additional-resources_investigating-kernel-crashes" role="_additional-resources" renderas="sect4">Additional resources</bridgehead>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/configuring-kdump-on-the-command-line_managing-monitoring-and-updating-the-kernel">Setting up kdump in RHEL</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://www.kernel.org/doc/html/latest/admin-guide/kdump/kdump.html">Linux kernel documentation for kdump</link></simpara>
</listitem>
<listitem>
<simpara>kdump.conf(5) — a manual page for the <literal>/etc/kdump.conf</literal> configuration file containing the full documentation of available options</simpara>
</listitem>
<listitem>
<simpara>kexec(8) — a manual page for the <literal>kexec</literal> package</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/site/solutions/6038">Red Hat Knowledgebase article</link> regarding kexec and kdump</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="debugging-ignition_troubleshooting-operating-system-issues">
<title>Debugging Ignition failures</title>
<simpara>If a machine cannot be provisioned, Ignition fails and RHCOS will boot into the emergency shell. Use the following procedure to get debugging information.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Run the following command to show which service units failed:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ systemctl --failed</programlisting>
</listitem>
<listitem>
<simpara>Optional: Run the following command on an individual service unit to find out more information:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ journalctl -u &lt;unit&gt;.service</programlisting>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="troubleshooting-network-issues">
<title>Troubleshooting network issues</title>

<section xml:id="nw-how-nw-iface-selected_troubleshooting-network-issues">
<title>How the network interface is selected</title>
<simpara>For installations on bare metal or with virtual machines that have more than one network interface controller (NIC), the NIC that {product-title} uses for communication with the Kubernetes API server is determined by the <literal>nodeip-configuration.service</literal> service unit that is run by systemd when the node boots. The <literal>nodeip-configuration.service</literal> selects the IP from the interface associated with the default route.</simpara>
<simpara>After the <literal>nodeip-configuration.service</literal> service determines the correct NIC, the service creates the <literal>/etc/systemd/system/kubelet.service.d/20-nodenet.conf</literal> file. The <literal>20-nodenet.conf</literal> file sets the <literal>KUBELET_NODE_IP</literal> environment variable to the IP address that the service selected.</simpara>
<simpara>When the kubelet service starts, it reads the value of the environment variable from the <literal>20-nodenet.conf</literal> file and sets the IP address as the value of the <literal>--node-ip</literal> kubelet command-line argument. As a result, the kubelet service uses the selected IP address as the node IP address.</simpara>
<simpara>If hardware or networking is reconfigured after installation, or if there is a networking layout where the node IP should not come from the default route interface, it is possible for the <literal>nodeip-configuration.service</literal> service to select a different NIC after a reboot. In some cases, you might be able to detect that a different NIC is selected by reviewing the <literal>INTERNAL-IP</literal> column in the output from the <literal>oc get nodes -o wide</literal> command.</simpara>
<simpara>If network communication is disrupted or misconfigured because a different NIC is selected, you might receive the following error: <literal>EtcdCertSignerControllerDegraded</literal>. You can create a hint file that includes the <literal>NODEIP_HINT</literal> variable to override the default IP selection logic. For more information, see Optional: Overriding the default node IP selection logic.</simpara>
<section xml:id="overriding-default-node-ip-selection-logic_troubleshooting-network-issues">
<title>Optional: Overriding the default node IP selection logic</title>
<simpara>To override the default IP selection logic, you can create a hint file that includes the <literal>NODEIP_HINT</literal> variable to override the default IP selection logic. Creating a hint file allows you to select a specific node IP address from the interface in the subnet of the IP address specified in the <literal>NODEIP_HINT</literal> variable.</simpara>
<simpara>For example, if a node has two interfaces, <literal>eth0</literal> with an address of <literal>10.0.0.10/24</literal>, and <literal>eth1</literal> with an address of <literal>192.0.2.5/24</literal>, and the default route points to <literal>eth0</literal> (<literal>10.0.0.10</literal>),the node IP address would normally use the <literal>10.0.0.10</literal> IP address.</simpara>
<simpara>Users can configure the <literal>NODEIP_HINT</literal> variable to point at a known IP in the subnet, for example, a subnet gateway such as <literal>192.0.2.1</literal> so that the other subnet, <literal>192.0.2.0/24</literal>, is selected. As a result, the <literal>192.0.2.5</literal> IP address on <literal>eth1</literal> is used for the node.</simpara>
<simpara>The following procedure shows how to override the default node IP selection logic.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Add a hint file to your <literal>/etc/default/nodeip-configuration</literal> file, for example:</simpara>
<programlisting language="text" linenumbering="unnumbered">NODEIP_HINT=192.0.2.1</programlisting>
<important>
<itemizedlist>
<listitem>
<simpara>Do not use the exact IP address of a node as a hint, for example, <literal>192.0.2.5</literal>. Using the exact IP address of a node causes the node using the hint IP address to fail to configure correctly.</simpara>
</listitem>
<listitem>
<simpara>The IP address in the hint file is only used to determine the correct subnet. It will not receive traffic as a result of appearing in the hint file.</simpara>
</listitem>
</itemizedlist>
</important>
</listitem>
<listitem>
<simpara>Generate the <literal>base-64</literal> encoded content by running the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ echo -n 'NODEIP_HINT=192.0.2.1' | base64 -w0</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Tk9ERUlQX0hJTlQ9MTkyLjAuMCxxxx==</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Activate the hint by creating a machine config manifest for both <literal>master</literal> and <literal>worker</literal> roles before deploying the cluster:</simpara>
<formalpara>
<title>99-nodeip-hint-master.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 99-nodeip-hint-master
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,&lt;encoded_content&gt; <co xml:id="CO43-1"/>
        mode: 0644
        overwrite: true
        path: /etc/default/nodeip-configuration</programlisting>
</para>
</formalpara>
<calloutlist>
<callout arearefs="CO43-1">
<para>Replace <literal>&lt;encoded_contents&gt;</literal> with the  base64-encoded content of the <literal>/etc/default/nodeip-configuration</literal> file, for example, <literal>Tk9ERUlQX0hJTlQ9MTkyLjAuMCxxxx==</literal>. Note that a space is not acceptable after the comma and before the encoded content.</para>
</callout>
</calloutlist>
<formalpara>
<title>99-nodeip-hint-worker.yaml</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
 labels:
   machineconfiguration.openshift.io/role: worker
   name: 99-nodeip-hint-worker
spec:
 config:
   ignition:
     version: 3.2.0
   storage:
     files:
     - contents:
         source: data:text/plain;charset=utf-8;base64,&lt;encoded_content&gt; <co xml:id="CO44-1"/>
       mode: 0644
       overwrite: true
       path: /etc/default/nodeip-configuration</programlisting>
</para>
</formalpara>
<calloutlist>
<callout arearefs="CO44-1">
<para>Replace <literal>&lt;encoded_contents&gt;</literal> with the  base64-encoded content of the <literal>/etc/default/nodeip-configuration</literal> file, for example, <literal>Tk9ERUlQX0hJTlQ9MTkyLjAuMCxxxx==</literal>. Note that a space is not acceptable after the comma and before the encoded content.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Save the manifest to the directory where you store your cluster configuration, for example, <literal>~/clusterconfigs</literal>.</simpara>
</listitem>
<listitem>
<simpara>Deploy the cluster.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="nw-troubleshoot-ovs_troubleshooting-network-issues">
<title>Troubleshooting Open vSwitch issues</title>
<simpara>To troubleshoot some Open vSwitch (OVS) issues, you might need to configure the log level to include more information.</simpara>
<simpara>If you modify the log level on a node temporarily, be aware that you can receive log messages from the machine config daemon on the node like the following example:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">E0514 12:47:17.998892    2281 daemon.go:1350] content mismatch for file /etc/systemd/system/ovs-vswitchd.service: [Unit]</programlisting>
<simpara>To avoid the log messages related to the mismatch, revert the log level change after you complete your troubleshooting.</simpara>
<section xml:id="configuring-ovs-log-level-temp_troubleshooting-network-issues">
<title>Configuring the Open vSwitch log level temporarily</title>
<simpara>For short-term troubleshooting, you can configure the Open vSwitch (OVS) log level temporarily.
The following procedure does not require rebooting the node.
In addition, the configuration change does not persist whenever you reboot the node.</simpara>
<simpara>After you perform this procedure to change the log level, you can receive log messages from the machine config daemon that indicate a content mismatch for the <literal>ovs-vswitchd.service</literal>.
To avoid the log messages, repeat this procedure and set the log level to the original value.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Start a debug pod for a node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/&lt;node_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the root file system from the host in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries from the host file system:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
</listitem>
<listitem>
<simpara>View the current syslog level for OVS modules:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># ovs-appctl vlog/list</programlisting>
<simpara>The following example output shows the log level for syslog set to <literal>info</literal>.</simpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">                 console    syslog    file
                 -------    ------    ------
backtrace          OFF       INFO       INFO
bfd                OFF       INFO       INFO
bond               OFF       INFO       INFO
bridge             OFF       INFO       INFO
bundle             OFF       INFO       INFO
bundles            OFF       INFO       INFO
cfm                OFF       INFO       INFO
collectors         OFF       INFO       INFO
command_line       OFF       INFO       INFO
connmgr            OFF       INFO       INFO
conntrack          OFF       INFO       INFO
conntrack_tp       OFF       INFO       INFO
coverage           OFF       INFO       INFO
ct_dpif            OFF       INFO       INFO
daemon             OFF       INFO       INFO
daemon_unix        OFF       INFO       INFO
dns_resolve        OFF       INFO       INFO
dpdk               OFF       INFO       INFO
...</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Specify the log level in the <literal>/etc/systemd/system/ovs-vswitchd.service.d/10-ovs-vswitchd-restart.conf</literal> file:</simpara>
<programlisting language="text" linenumbering="unnumbered">Restart=always
ExecStartPre=-/bin/sh -c '/usr/bin/chown -R :$${OVS_USER_ID##*:} /var/lib/openvswitch'
ExecStartPre=-/bin/sh -c '/usr/bin/chown -R :$${OVS_USER_ID##*:} /etc/openvswitch'
ExecStartPre=-/bin/sh -c '/usr/bin/chown -R :$${OVS_USER_ID##*:} /run/openvswitch'
ExecStartPost=-/usr/bin/ovs-appctl vlog/set syslog:dbg
ExecReload=-/usr/bin/ovs-appctl vlog/set syslog:dbg</programlisting>
<simpara>In the preceding example, the log level is set to <literal>dbg</literal>.
Change the last two lines by setting <literal>syslog:&lt;log_level&gt;</literal> to <literal>off</literal>, <literal>emer</literal>, <literal>err</literal>, <literal>warn</literal>, <literal>info</literal>, or <literal>dbg</literal>. The <literal>off</literal> log level filters out all log messages.</simpara>
</listitem>
<listitem>
<simpara>Restart the service:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl daemon-reload</programlisting>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl restart ovs-vswitchd</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-ovs-log-level-permanently_troubleshooting-network-issues">
<title>Configuring the Open vSwitch log level permanently</title>
<simpara>For long-term changes to the Open vSwitch (OVS) log level, you can change the log level permanently.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Create a file, such as <literal>99-change-ovs-loglevel.yaml</literal>, with a <literal>MachineConfig</literal> object like the following example:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master  <co xml:id="CO45-1"/>
  name: 99-change-ovs-loglevel
spec:
  config:
    ignition:
      version: 3.2.0
    systemd:
      units:
      - dropins:
        - contents: |
            [Service]
              ExecStartPost=-/usr/bin/ovs-appctl vlog/set syslog:dbg  <co xml:id="CO45-2"/>
              ExecReload=-/usr/bin/ovs-appctl vlog/set syslog:dbg
          name: 20-ovs-vswitchd-restart.conf
        name: ovs-vswitchd.service</programlisting>
<calloutlist>
<callout arearefs="CO45-1">
<para>After you perform this procedure to configure control plane nodes, repeat the procedure and set the role to <literal>worker</literal> to configure worker nodes.</para>
</callout>
<callout arearefs="CO45-2">
<para>Set the <literal>syslog:&lt;log_level&gt;</literal> value. Log levels are <literal>off</literal>, <literal>emer</literal>, <literal>err</literal>, <literal>warn</literal>, <literal>info</literal>, or <literal>dbg</literal>. Setting the value to <literal>off</literal> filters out all log messages.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Apply the machine config:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc apply -f 99-change-ovs-loglevel.yaml</programlisting>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="../../post_installation_configuration/machine-configuration-tasks.xml#understanding-the-machine-config-operator">Understanding the Machine Config Operator</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="../../post_installation_configuration/machine-configuration-tasks.xml#checking-mco-status_post-install-machine-configuration-tasks">Checking machine config pool status</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="displaying-ovs-logs_troubleshooting-network-issues">
<title>Displaying Open vSwitch logs</title>
<simpara>Use the following procedure to display Open vSwitch (OVS) logs.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Run one of the following commands:</simpara>
<itemizedlist>
<listitem>
<simpara>Display the logs by using the <literal>oc</literal> command from outside the cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs &lt;node_name&gt; -u ovs-vswitchd</programlisting>
</listitem>
<listitem>
<simpara>Display the logs after logging on to a node in the cluster:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># journalctl -b -f -u ovs-vswitchd.service</programlisting>
<simpara>One way to log on to a node is by using the <literal>oc debug node/&lt;node_name&gt;</literal> command.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="troubleshooting-operator-issues">
<title>Troubleshooting Operator issues</title>

<simpara>Operators are a method of packaging, deploying, and managing an {product-title} application. They act like an extension of the software vendor&#8217;s engineering team, watching over an {product-title} environment and using its current state to make decisions in real time. Operators are designed to handle upgrades seamlessly, react to failures automatically, and not take shortcuts, such as skipping a software backup process to save time.</simpara>
<simpara>{product-title} {product-version} includes a default set of Operators that are required for proper functioning of the cluster. These default Operators are managed by the Cluster Version Operator (CVO).</simpara>
<simpara>As a cluster administrator, you can install application Operators from the OperatorHub using the {product-title} web console or the CLI. You can then subscribe the Operator to one or more namespaces to make it available for developers on your cluster. Application Operators are managed by Operator Lifecycle Manager (OLM).</simpara>
<simpara>If you experience Operator issues, verify Operator subscription status. Check Operator pod health across the cluster and gather Operator logs for diagnosis.</simpara>
<section xml:id="olm-status-conditions_troubleshooting-operator-issues">
<title>Operator subscription condition types</title>
<simpara>Subscriptions can report the following condition types:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Subscription condition types</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="66.6667*"/>
<thead>
<row>
<entry align="left" valign="top">Condition</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>CatalogSourcesUnhealthy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Some or all of the catalog sources to be used in resolution are unhealthy.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>InstallPlanMissing</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An install plan for a subscription is missing.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>InstallPlanPending</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An install plan for a subscription is pending installation.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>InstallPlanFailed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An install plan for a subscription has failed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ResolutionFailed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The dependency resolution for a subscription has failed.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<note>
<simpara>Default {product-title} cluster Operators are managed by the Cluster Version Operator (CVO) and they do not have a <literal>Subscription</literal> object. Application Operators are managed by Operator Lifecycle Manager (OLM) and they have a <literal>Subscription</literal> object.</simpara>
</note>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="../../operators/understanding/olm/olm-understanding-olm.xml#olm-cs-health_olm-understanding-olm">Catalog health requirements</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="olm-status-viewing-cli_troubleshooting-operator-issues">
<title>Viewing Operator subscription status by using the CLI</title>
<simpara>You can view Operator subscription status by using the CLI.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>List Operator subscriptions:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get subs -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Use the <literal>oc describe</literal> command to inspect a <literal>Subscription</literal> resource:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe sub &lt;subscription_name&gt; -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>In the command output, find the <literal>Conditions</literal> section for the status of Operator subscription condition types. In the following example, the <literal>CatalogSourcesUnhealthy</literal> condition type has a status of <literal>false</literal> because all available catalog sources are healthy:</simpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Name:         cluster-logging
Namespace:    openshift-logging
Labels:       operators.coreos.com/cluster-logging.openshift-logging=
Annotations:  &lt;none&gt;
API Version:  operators.coreos.com/v1alpha1
Kind:         Subscription
# ...
Conditions:
   Last Transition Time:  2019-07-29T13:42:57Z
   Message:               all available catalogsources are healthy
   Reason:                AllCatalogSourcesHealthy
   Status:                False
   Type:                  CatalogSourcesUnhealthy
# ...</programlisting>
</para>
</formalpara>
</listitem>
</orderedlist>
<note>
<simpara>Default {product-title} cluster Operators are managed by the Cluster Version Operator (CVO) and they do not have a <literal>Subscription</literal> object. Application Operators are managed by Operator Lifecycle Manager (OLM) and they have a <literal>Subscription</literal> object.</simpara>
</note>
</section>
<section xml:id="olm-cs-status-cli_troubleshooting-operator-issues">
<title>Viewing Operator catalog source status by using the CLI</title>
<simpara>You can view the status of an Operator catalog source by using the CLI.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>List the catalog sources in a namespace. For example, you can check the <literal>openshift-marketplace</literal> namespace, which is used for cluster-wide catalog sources:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get catalogsources -n openshift-marketplace</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME                  DISPLAY               TYPE   PUBLISHER   AGE
certified-operators   Certified Operators   grpc   Red Hat     55m
community-operators   Community Operators   grpc   Red Hat     55m
example-catalog       Example Catalog       grpc   Example Org 2m25s
redhat-marketplace    Red Hat Marketplace   grpc   Red Hat     55m
redhat-operators      Red Hat Operators     grpc   Red Hat     55m</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Use the <literal>oc describe</literal> command to get more details and status about a catalog source:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe catalogsource example-catalog -n openshift-marketplace</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Name:         example-catalog
Namespace:    openshift-marketplace
Labels:       &lt;none&gt;
Annotations:  operatorframework.io/managed-by: marketplace-operator
              target.workload.openshift.io/management: {"effect": "PreferredDuringScheduling"}
API Version:  operators.coreos.com/v1alpha1
Kind:         CatalogSource
# ...
Status:
  Connection State:
    Address:              example-catalog.openshift-marketplace.svc:50051
    Last Connect:         2021-09-09T17:07:35Z
    Last Observed State:  TRANSIENT_FAILURE
  Registry Service:
    Created At:         2021-09-09T17:05:45Z
    Port:               50051
    Protocol:           grpc
    Service Name:       example-catalog
    Service Namespace:  openshift-marketplace
# ...</programlisting>
</para>
</formalpara>
<simpara>In the preceding example output, the last observed state is <literal>TRANSIENT_FAILURE</literal>. This state indicates that there is a problem establishing a connection for the catalog source.</simpara>
</listitem>
<listitem>
<simpara>List the pods in the namespace where your catalog source was created:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n openshift-marketplace</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME                                    READY   STATUS             RESTARTS   AGE
certified-operators-cv9nn               1/1     Running            0          36m
community-operators-6v8lp               1/1     Running            0          36m
marketplace-operator-86bfc75f9b-jkgbc   1/1     Running            0          42m
example-catalog-bwt8z                   0/1     ImagePullBackOff   0          3m55s
redhat-marketplace-57p8c                1/1     Running            0          36m
redhat-operators-smxx8                  1/1     Running            0          36m</programlisting>
</para>
</formalpara>
<simpara>When a catalog source is created in a namespace, a pod for the catalog source is created in that namespace. In the preceding example output, the status for the <literal>example-catalog-bwt8z</literal> pod is <literal>ImagePullBackOff</literal>. This status indicates that there is an issue pulling the catalog source&#8217;s index image.</simpara>
</listitem>
<listitem>
<simpara>Use the <literal>oc describe</literal> command to inspect a pod for more detailed information:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe pod example-catalog-bwt8z -n openshift-marketplace</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Name:         example-catalog-bwt8z
Namespace:    openshift-marketplace
Priority:     0
Node:         ci-ln-jyryyg2-f76d1-ggdbq-worker-b-vsxjd/10.0.128.2
...
Events:
  Type     Reason          Age                From               Message
  ----     ------          ----               ----               -------
  Normal   Scheduled       48s                default-scheduler  Successfully assigned openshift-marketplace/example-catalog-bwt8z to ci-ln-jyryyf2-f76d1-fgdbq-worker-b-vsxjd
  Normal   AddedInterface  47s                multus             Add eth0 [10.131.0.40/23] from openshift-sdn
  Normal   BackOff         20s (x2 over 46s)  kubelet            Back-off pulling image "quay.io/example-org/example-catalog:v1"
  Warning  Failed          20s (x2 over 46s)  kubelet            Error: ImagePullBackOff
  Normal   Pulling         8s (x3 over 47s)   kubelet            Pulling image "quay.io/example-org/example-catalog:v1"
  Warning  Failed          8s (x3 over 47s)   kubelet            Failed to pull image "quay.io/example-org/example-catalog:v1": rpc error: code = Unknown desc = reading manifest v1 in quay.io/example-org/example-catalog: unauthorized: access to the requested resource is not authorized
  Warning  Failed          8s (x3 over 47s)   kubelet            Error: ErrImagePull</programlisting>
</para>
</formalpara>
<simpara>In the preceding example output, the error messages indicate that the catalog source&#8217;s index image is failing to pull successfully because of an authorization issue. For example, the index image might be stored in a registry that requires login credentials.</simpara>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="../../operators/understanding/olm/olm-understanding-olm.xml#olm-catalogsource_olm-understanding-olm">Operator Lifecycle Manager concepts and resources &#8594; Catalog source</link></simpara>
</listitem>
<listitem>
<simpara>gRPC documentation: <link xl:href="https://grpc.github.io/grpc/core/md_doc_connectivity-semantics-and-api.html">States of Connectivity</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="../../operators/admin/olm-managing-custom-catalogs.xml#olm-accessing-images-private-registries_olm-managing-custom-catalogs">Accessing images for Operators from private registries</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="querying-operator-pod-status_troubleshooting-operator-issues">
<title>Querying Operator pod status</title>
<simpara>You can list Operator pods within a cluster and their status. You can also collect a detailed Operator pod summary.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>List Operators running in the cluster. The output includes Operator version, availability, and up-time information:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get clusteroperators</programlisting>
</listitem>
<listitem>
<simpara>List Operator pods running in the Operator&#8217;s namespace, plus pod status, restarts, and age:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pod -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Output a detailed Operator pod summary:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe pod &lt;operator_pod_name&gt; -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>If an Operator issue is node-specific, query Operator container status on that node.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Start a debug pod for the node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-node</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>List details about the node&#8217;s containers, including state and associated pod IDs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># crictl ps</programlisting>
</listitem>
<listitem>
<simpara>List information about a specific Operator container on the node. The following example lists information about the <literal>network-operator</literal> container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># crictl ps --name network-operator</programlisting>
</listitem>
<listitem>
<simpara>Exit from the debug shell.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="gathering-operator-logs_troubleshooting-operator-issues">
<title>Gathering Operator logs</title>
<simpara>If you experience Operator issues, you can gather detailed diagnostic information from Operator pod logs.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have the fully qualified domain names of the control plane or control plane machines.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>List the Operator pods that are running in the Operator&#8217;s namespace, plus the pod status, restarts, and age:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Review logs for an Operator pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;pod_name&gt; -n &lt;operator_namespace&gt;</programlisting>
<simpara>If an Operator pod has multiple containers, the preceding command will produce an error that includes the name of each container. Query logs from an individual container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs pod/&lt;operator_pod_name&gt; -c &lt;container_name&gt; -n &lt;operator_namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>If the API is not functional, review Operator pod and container logs on each control plane node by using SSH instead. Replace <literal>&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> with appropriate values.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>List pods on each control plane node:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl pods</programlisting>
</listitem>
<listitem>
<simpara>For any Operator pods not showing a <literal>Ready</literal> status, inspect the pod&#8217;s status in detail. Replace <literal>&lt;operator_pod_id&gt;</literal> with the Operator pod&#8217;s ID listed in the output of the preceding command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl inspectp &lt;operator_pod_id&gt;</programlisting>
</listitem>
<listitem>
<simpara>List containers related to an Operator pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl ps --pod=&lt;operator_pod_id&gt;</programlisting>
</listitem>
<listitem>
<simpara>For any Operator container not showing a <literal>Ready</literal> status, inspect the container&#8217;s status in detail. Replace <literal>&lt;container_id&gt;</literal> with a container ID listed in the output of the preceding command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl inspect &lt;container_id&gt;</programlisting>
</listitem>
<listitem>
<simpara>Review the logs for any Operator containers not showing a <literal>Ready</literal> status. Replace <literal>&lt;container_id&gt;</literal> with a container ID listed in the output of the preceding command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh core@&lt;master-node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt; sudo crictl logs -f &lt;container_id&gt;</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. Before attempting to collect diagnostic data over SSH, review whether the data collected by running <literal>oc adm must gather</literal> and other <literal>oc</literal> commands is sufficient instead. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="troubleshooting-disabling-autoreboot-mco_troubleshooting-operator-issues">
<title>Disabling the Machine Config Operator from automatically rebooting</title>
<simpara>When configuration changes are made by the Machine Config Operator (MCO), Red Hat Enterprise Linux CoreOS (RHCOS) must reboot for the changes to take effect. Whether the configuration change is automatic or manual, an RHCOS node reboots automatically unless it is paused.</simpara>
<note>
<simpara>The following modifications do not trigger a node reboot:</simpara>
<itemizedlist>
<listitem>
<simpara>When the MCO detects any of the following changes, it applies the update without draining or rebooting the node:</simpara>
<itemizedlist>
<listitem>
<simpara>Changes to the SSH key in the <literal>spec.config.passwd.users.sshAuthorizedKeys</literal> parameter of a machine config.</simpara>
</listitem>
<listitem>
<simpara>Changes to the global pull secret or pull secret in the <literal>openshift-config</literal> namespace.</simpara>
</listitem>
<listitem>
<simpara>Automatic rotation of the <literal>/etc/kubernetes/kubelet-ca.crt</literal> certificate authority (CA) by the Kubernetes API Server Operator.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>When the MCO detects changes to the <literal>/etc/containers/registries.conf</literal> file, such as adding or editing an <literal>ImageDigestMirrorSet</literal>, <literal>ImageTagMirrorSet</literal>, or <literal>ImageContentSourcePolicy</literal> object, it drains the corresponding nodes, applies the changes, and uncordons the nodes. The node drain does not happen for the following changes:</simpara>
<itemizedlist>
<listitem>
<simpara>The addition of a registry with the <literal>pull-from-mirror = "digest-only"</literal> parameter set for each mirror.</simpara>
</listitem>
<listitem>
<simpara>The addition of a mirror with the <literal>pull-from-mirror = "digest-only"</literal> parameter set in a registry.</simpara>
</listitem>
<listitem>
<simpara>The addition of items to the <literal>unqualified-search-registries</literal> list.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</note>
<simpara>To avoid unwanted disruptions, you can modify the machine config pool (MCP) to prevent automatic rebooting after the Operator makes changes to the machine config.</simpara>
<section xml:id="troubleshooting-disabling-autoreboot-mco-console_troubleshooting-operator-issues">
<title>Disabling the Machine Config Operator from automatically rebooting by using the console</title>
<simpara>To avoid unwanted disruptions from changes made by the Machine Config Operator (MCO), you can use the {product-title} web console to modify the machine config pool (MCP) to prevent the MCO from making any changes to nodes in that pool. This prevents any reboots that would normally be part of the MCO update process.</simpara>
<note>
<simpara>See second <literal>NOTE</literal> in <link xl:href="../../support/troubleshooting/troubleshooting-operator-issues.xml#troubleshooting-disabling-autoreboot-mco_troubleshooting-operator-issues">Disabling the Machine Config Operator from automatically rebooting</link>.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Procedure</title>
<para>To pause or unpause automatic MCO update rebooting:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Pause the autoreboot process:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Compute</emphasis> &#8594; <emphasis role="strong">MachineConfigPools</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">MachineConfigPools</emphasis> page, click either <emphasis role="strong">master</emphasis> or <emphasis role="strong">worker</emphasis>, depending upon which nodes you want to pause rebooting for.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">master</emphasis> or <emphasis role="strong">worker</emphasis> page, click <emphasis role="strong">YAML</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the YAML, update the <literal>spec.paused</literal> field to <literal>true</literal>.</simpara>
<formalpara>
<title>Sample MachineConfigPool object</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfigPool
# ...
spec:
# ...
  paused: true <co xml:id="CO46-1"/>
# ...</programlisting>
</para>
</formalpara>
<calloutlist>
<callout arearefs="CO46-1">
<para>Update the <literal>spec.paused</literal> field to <literal>true</literal> to pause rebooting.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>To verify that the MCP is paused, return to the <emphasis role="strong">MachineConfigPools</emphasis> page.</simpara>
<simpara>On the <emphasis role="strong">MachineConfigPools</emphasis> page, the <emphasis role="strong">Paused</emphasis> column reports <emphasis role="strong">True</emphasis> for the MCP you modified.</simpara>
<simpara>If the MCP has pending changes while paused, the <emphasis role="strong">Updated</emphasis> column is <emphasis role="strong">False</emphasis> and <emphasis role="strong">Updating</emphasis> is <emphasis role="strong">False</emphasis>. When <emphasis role="strong">Updated</emphasis> is <emphasis role="strong">True</emphasis> and <emphasis role="strong">Updating</emphasis> is <emphasis role="strong">False</emphasis>, there are no pending changes.</simpara>
<important>
<simpara>If there are pending changes (where both the <emphasis role="strong">Updated</emphasis> and <emphasis role="strong">Updating</emphasis> columns are <emphasis role="strong">False</emphasis>), it is recommended to schedule a maintenance window for a reboot as early as possible. Use the following steps for unpausing the autoreboot process to apply the changes that were queued since the last reboot.</simpara>
</important>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Unpause the autoreboot process:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the {product-title} web console as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Compute</emphasis> &#8594; <emphasis role="strong">MachineConfigPools</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">MachineConfigPools</emphasis> page, click either <emphasis role="strong">master</emphasis> or <emphasis role="strong">worker</emphasis>, depending upon which nodes you want to pause rebooting for.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">master</emphasis> or <emphasis role="strong">worker</emphasis> page, click <emphasis role="strong">YAML</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the YAML, update the <literal>spec.paused</literal> field to <literal>false</literal>.</simpara>
<formalpara>
<title>Sample MachineConfigPool object</title>
<para>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfigPool
# ...
spec:
# ...
  paused: false <co xml:id="CO47-1"/>
# ...</programlisting>
</para>
</formalpara>
<calloutlist>
<callout arearefs="CO47-1">
<para>Update the <literal>spec.paused</literal> field to <literal>false</literal> to allow rebooting.</para>
</callout>
</calloutlist>
<note>
<simpara>By unpausing an MCP, the MCO applies all paused changes reboots Red Hat Enterprise Linux CoreOS (RHCOS) as needed.</simpara>
</note>
</listitem>
<listitem>
<simpara>To verify that the MCP is paused, return to the <emphasis role="strong">MachineConfigPools</emphasis> page.</simpara>
<simpara>On the <emphasis role="strong">MachineConfigPools</emphasis> page, the <emphasis role="strong">Paused</emphasis> column reports <emphasis role="strong">False</emphasis> for the MCP you modified.</simpara>
<simpara>If the MCP is applying any pending changes, the <emphasis role="strong">Updated</emphasis> column is <emphasis role="strong">False</emphasis> and the <emphasis role="strong">Updating</emphasis> column is <emphasis role="strong">True</emphasis>. When <emphasis role="strong">Updated</emphasis> is <emphasis role="strong">True</emphasis> and <emphasis role="strong">Updating</emphasis> is <emphasis role="strong">False</emphasis>, there are no further changes being made.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="troubleshooting-disabling-autoreboot-mco-cli_troubleshooting-operator-issues">
<title>Disabling the Machine Config Operator from automatically rebooting by using the CLI</title>
<simpara>To avoid unwanted disruptions from changes made by the Machine Config Operator (MCO), you can modify the machine config pool (MCP) using the OpenShift CLI (oc) to prevent the MCO from making any changes to nodes in that pool. This prevents any reboots that would normally be part of the MCO update process.</simpara>
<note>
<simpara>See second <literal>NOTE</literal> in <link xl:href="../../support/troubleshooting/troubleshooting-operator-issues.xml#troubleshooting-disabling-autoreboot-mco_troubleshooting-operator-issues">Disabling the Machine Config Operator from automatically rebooting</link>.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Procedure</title>
<para>To pause or unpause automatic MCO update rebooting:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Pause the autoreboot process:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Update the <literal>MachineConfigPool</literal> custom resource to set the <literal>spec.paused</literal> field to <literal>true</literal>.</simpara>
<formalpara>
<title>Control plane (master) nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc patch --type=merge --patch='{"spec":{"paused":true}}' machineconfigpool/master</programlisting>
</para>
</formalpara>
<formalpara>
<title>Worker nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc patch --type=merge --patch='{"spec":{"paused":true}}' machineconfigpool/worker</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Verify that the MCP is paused:</simpara>
<formalpara>
<title>Control plane (master) nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get machineconfigpool/master --template='{{.spec.paused}}'</programlisting>
</para>
</formalpara>
<formalpara>
<title>Worker nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get machineconfigpool/worker --template='{{.spec.paused}}'</programlisting>
</para>
</formalpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">true</programlisting>
</para>
</formalpara>
<simpara>The <literal>spec.paused</literal> field is <literal>true</literal> and the MCP is paused.</simpara>
</listitem>
<listitem>
<simpara>Determine if the MCP has pending changes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># oc get machineconfigpool</programlisting>
<formalpara>
<title>Example output</title>
<para>
<screen>NAME     CONFIG                                             UPDATED   UPDATING
master   rendered-master-33cf0a1254318755d7b48002c597bf91   True      False
worker   rendered-worker-e405a5bdb0db1295acea08bcca33fa60   False     False</screen>
</para>
</formalpara>
<simpara>If the <emphasis role="strong">UPDATED</emphasis> column is <emphasis role="strong">False</emphasis> and <emphasis role="strong">UPDATING</emphasis> is <emphasis role="strong">False</emphasis>, there are pending changes. When <emphasis role="strong">UPDATED</emphasis> is <emphasis role="strong">True</emphasis> and <emphasis role="strong">UPDATING</emphasis> is <emphasis role="strong">False</emphasis>, there are no pending changes. In the previous example, the worker node has pending changes. The control plane node does not have any pending changes.</simpara>
<important>
<simpara>If there are pending changes (where both the <emphasis role="strong">Updated</emphasis> and <emphasis role="strong">Updating</emphasis> columns are <emphasis role="strong">False</emphasis>), it is recommended to schedule a maintenance window for a reboot as early as possible. Use the following steps for unpausing the autoreboot process to apply the changes that were queued since the last reboot.</simpara>
</important>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Unpause the autoreboot process:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Update the <literal>MachineConfigPool</literal> custom resource to set the <literal>spec.paused</literal> field to <literal>false</literal>.</simpara>
<formalpara>
<title>Control plane (master) nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc patch --type=merge --patch='{"spec":{"paused":false}}' machineconfigpool/master</programlisting>
</para>
</formalpara>
<formalpara>
<title>Worker nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc patch --type=merge --patch='{"spec":{"paused":false}}' machineconfigpool/worker</programlisting>
</para>
</formalpara>
<note>
<simpara>By unpausing an MCP, the MCO applies all paused changes and reboots Red Hat Enterprise Linux CoreOS (RHCOS) as needed.</simpara>
</note>
</listitem>
<listitem>
<simpara>Verify that the MCP is unpaused:</simpara>
<formalpara>
<title>Control plane (master) nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get machineconfigpool/master --template='{{.spec.paused}}'</programlisting>
</para>
</formalpara>
<formalpara>
<title>Worker nodes</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get machineconfigpool/worker --template='{{.spec.paused}}'</programlisting>
</para>
</formalpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">false</programlisting>
</para>
</formalpara>
<simpara>The <literal>spec.paused</literal> field is <literal>false</literal> and the MCP is unpaused.</simpara>
</listitem>
<listitem>
<simpara>Determine if the MCP has pending changes:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get machineconfigpool</programlisting>
<formalpara>
<title>Example output</title>
<para>
<screen>NAME     CONFIG                                   UPDATED  UPDATING
master   rendered-master-546383f80705bd5aeaba93   True     False
worker   rendered-worker-b4c51bb33ccaae6fc4a6a5   False    True</screen>
</para>
</formalpara>
<simpara>If the MCP is applying any pending changes, the <emphasis role="strong">UPDATED</emphasis> column is <emphasis role="strong">False</emphasis> and the <emphasis role="strong">UPDATING</emphasis> column is <emphasis role="strong">True</emphasis>. When <emphasis role="strong">UPDATED</emphasis> is <emphasis role="strong">True</emphasis> and <emphasis role="strong">UPDATING</emphasis> is <emphasis role="strong">False</emphasis>, there are no further changes being made. In the previous example, the MCO is updating the worker node.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="olm-refresh-subs_troubleshooting-operator-issues">
<title>Refreshing failing subscriptions</title>
<simpara>In Operator Lifecycle Manager (OLM), if you subscribe to an Operator that references images that are not accessible on your network, you can find jobs in the <literal>openshift-marketplace</literal> namespace that are failing with the following errors:</simpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">ImagePullBackOff for
Back-off pulling image "example.com/openshift4/ose-elasticsearch-operator-bundle@sha256:6d2587129c846ec28d384540322b40b05833e7e00b25cca584e004af9a1d292e"</programlisting>
</para>
</formalpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">rpc error: code = Unknown desc = error pinging docker registry example.com: Get "https://example.com/v2/": dial tcp: lookup example.com on 10.0.0.1:53: no such host</programlisting>
</para>
</formalpara>
<simpara>As a result, the subscription is stuck in this failing state and the Operator is unable to install or upgrade.</simpara>
<simpara>You can refresh a failing subscription by deleting the subscription, cluster service version (CSV), and other related objects. After recreating the subscription, OLM then reinstalls the correct version of the Operator.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have a failing subscription that is unable to pull an inaccessible bundle image.</simpara>
</listitem>
<listitem>
<simpara>You have confirmed that the correct bundle image is accessible.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Get the names of the <literal>Subscription</literal> and <literal>ClusterServiceVersion</literal> objects from the namespace where the Operator is installed:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get sub,csv -n &lt;namespace&gt;</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME                                                       PACKAGE                  SOURCE             CHANNEL
subscription.operators.coreos.com/elasticsearch-operator   elasticsearch-operator   redhat-operators   5.0

NAME                                                                         DISPLAY                            VERSION    REPLACES   PHASE
clusterserviceversion.operators.coreos.com/elasticsearch-operator.5.0.0-65   OpenShift Elasticsearch Operator   5.0.0-65              Succeeded</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Delete the subscription:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete subscription &lt;subscription_name&gt; -n &lt;namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Delete the cluster service version:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete csv &lt;csv_name&gt; -n &lt;namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Get the names of any failing jobs and related config maps in the <literal>openshift-marketplace</literal> namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get job,configmap -n openshift-marketplace</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME                                                                        COMPLETIONS   DURATION   AGE
job.batch/1de9443b6324e629ddf31fed0a853a121275806170e34c926d69e53a7fcbccb   1/1           26s        9m30s

NAME                                                                        DATA   AGE
configmap/1de9443b6324e629ddf31fed0a853a121275806170e34c926d69e53a7fcbccb   3      9m30s</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Delete the job:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete job &lt;job_name&gt; -n openshift-marketplace</programlisting>
<simpara>This ensures pods that try to pull the inaccessible image are not recreated.</simpara>
</listitem>
<listitem>
<simpara>Delete the config map:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete configmap &lt;configmap_name&gt; -n openshift-marketplace</programlisting>
</listitem>
<listitem>
<simpara>Reinstall the Operator using OperatorHub in the web console.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Verification</title>
<listitem>
<simpara>Check that the Operator has been reinstalled successfully:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get sub,csv,installplan -n &lt;namespace&gt;</programlisting>
</listitem>
</itemizedlist>
</section>
<section xml:id="olm-reinstall_troubleshooting-operator-issues">
<title>Reinstalling Operators after failed uninstallation</title>
<simpara>You must successfully and completely uninstall an Operator prior to attempting to reinstall the same Operator. Failure to fully uninstall the Operator properly can leave resources, such as a project or namespace, stuck in a "Terminating" state and cause "error resolving resource" messages. For example:</simpara>
<formalpara>
<title>Example <literal>Project</literal> resource description</title>
<para>
<screen>...
    message: 'Failed to delete all resource types, 1 remaining: Internal error occurred:
      error resolving resource'
...</screen>
</para>
</formalpara>
<simpara>These types of issues can prevent an Operator from being reinstalled successfully.</simpara>
<warning>
<simpara>Forced deletion of a namespace is not likely to resolve "Terminating" state issues and can lead to unstable or unpredictable cluster behavior, so it is better to try to find related resources that might be preventing the namespace from being deleted. For more information, see the <link xl:href="https://access.redhat.com/solutions/4165791">Red Hat Knowledgebase Solution #4165791</link>, paying careful attention to the cautions and warnings.</simpara>
</warning>
<simpara>The following procedure shows how to troubleshoot when an Operator cannot be reinstalled because an existing custom resource definition (CRD) from a previous installation of the Operator is preventing a related namespace from deleting successfully.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Check if there are any namespaces related to the Operator that are stuck in "Terminating" state:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get namespaces</programlisting>
<formalpara>
<title>Example output</title>
<para>
<screen>operator-ns-1                                       Terminating</screen>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Check if there are any CRDs related to the Operator that are still present after the failed uninstallation:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get crds</programlisting>
<note>
<simpara>CRDs are global cluster definitions; the actual custom resource (CR) instances related to the CRDs could be in other namespaces or be global cluster instances.</simpara>
</note>
</listitem>
<listitem>
<simpara>If there are any CRDs that you know were provided or managed by the Operator and that should have been deleted after uninstallation, delete the CRD:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete crd &lt;crd_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Check if there are any remaining CR instances related to the Operator that are still present after uninstallation, and if so, delete the CRs:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>The type of CRs to search for can be difficult to determine after uninstallation and can require knowing what CRDs the Operator manages. For example, if you are troubleshooting an uninstallation of the etcd Operator, which provides the <literal>EtcdCluster</literal> CRD, you can search for remaining <literal>EtcdCluster</literal> CRs in a namespace:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get EtcdCluster -n &lt;namespace_name&gt;</programlisting>
<simpara>Alternatively, you can search across all namespaces:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get EtcdCluster --all-namespaces</programlisting>
</listitem>
<listitem>
<simpara>If there are any remaining CRs that should be removed, delete the instances:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete &lt;cr_name&gt; &lt;cr_instance_name&gt; -n &lt;namespace_name&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Check that the namespace deletion has successfully resolved:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get namespace &lt;namespace_name&gt;</programlisting>
<important>
<simpara>If the namespace or other Operator resources are still not uninstalled cleanly, contact Red Hat Support.</simpara>
</important>
</listitem>
<listitem>
<simpara>Reinstall the Operator using OperatorHub in the web console.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Verification</title>
<listitem>
<simpara>Check that the Operator has been reinstalled successfully:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get sub,csv,installplan -n &lt;namespace&gt;</programlisting>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="../../operators/admin/olm-deleting-operators-from-cluster.xml#olm-deleting-operators-from-a-cluster">Deleting Operators from a cluster</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="../../operators/admin/olm-adding-operators-to-cluster.xml#olm-adding-operators-to-a-cluster">Adding Operators to a cluster</link></simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="investigating-pod-issues">
<title>Investigating pod issues</title>

<simpara>{product-title} leverages the Kubernetes concept of a pod, which is one or more containers deployed together on one host. A pod is the smallest compute unit that can be defined, deployed, and managed on {product-title} {product-version}.</simpara>
<simpara>After a pod is defined, it is assigned to run on a node until its containers exit, or until it is removed. Depending on policy and exit code, Pods are either removed after exiting or retained so that their logs can be accessed.</simpara>
<simpara>The first thing to check when pod issues arise is the pod&#8217;s status. If an explicit pod failure has occurred, observe the pod&#8217;s error state to identify specific image, container, or pod network issues. Focus diagnostic data collection according to the error state. Review pod event messages, as well as pod and container log information. Diagnose issues dynamically by accessing running Pods on the command line, or start a debug pod with root access based on a problematic pod&#8217;s deployment configuration.</simpara>
<section xml:id="understanding-pod-error-states_investigating-pod-issues">
<title>Understanding pod error states</title>
<simpara>Pod failures return explicit error states that can be observed in the <literal>status</literal> field in the output of <literal>oc get pods</literal>. Pod error states cover image, container, and container network related failures.</simpara>
<simpara>The following table provides a list of pod error states along with their descriptions.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Pod error states</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="80*"/>
<thead>
<row>
<entry align="left" valign="top">Pod error state</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>ErrImagePull</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Generic image retrieval error.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrImagePullBackOff</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Image retrieval failed and is backed off.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrInvalidImageName</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The specified image name was invalid.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrImageInspect</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Image inspection did not succeed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrImageNeverPull</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>PullPolicy</literal> is set to <literal>NeverPullImage</literal> and the target image is not present locally on the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrRegistryUnavailable</literal></simpara></entry>
<entry align="left" valign="top"><simpara>When attempting to retrieve an image from a registry, an HTTP error was encountered.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrContainerNotFound</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The specified container is either not present or not managed by the kubelet, within the declared pod.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrRunInitContainer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Container initialization failed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrRunContainer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>None of the pod&#8217;s containers started successfully.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrKillContainer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>None of the pod&#8217;s containers were killed successfully.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrCrashLoopBackOff</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A container has terminated. The kubelet will not attempt to restart it.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrVerifyNonRoot</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A container or image attempted to run with root privileges.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrCreatePodSandbox</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Pod sandbox creation did not succeed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrConfigPodSandbox</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Pod sandbox configuration was not obtained.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrKillPodSandbox</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A pod sandbox did not stop successfully.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrSetupNetwork</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Network initialization failed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ErrTeardownNetwork</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Network termination failed.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="reviewing-pod-status_investigating-pod-issues">
<title>Reviewing pod status</title>
<simpara>You can query pod status and error states. You can also query a pod&#8217;s associated deployment configuration and review base image availability.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara><literal>skopeo</literal> is installed.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Switch into a project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc project &lt;project_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>List pods running within the namespace, as well as pod status, error states, restarts, and age:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods</programlisting>
</listitem>
<listitem>
<simpara>Determine whether the namespace is managed by a deployment configuration:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc status</programlisting>
<simpara>If the namespace is managed by a deployment configuration, the output includes the deployment configuration name and a base image reference.</simpara>
</listitem>
<listitem>
<simpara>Inspect the base image referenced in the preceding command&#8217;s output:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ skopeo inspect docker://&lt;image_reference&gt;</programlisting>
</listitem>
<listitem>
<simpara>If the base image reference is not correct, update the reference in the deployment configuration:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc edit deployment/my-deployment</programlisting>
</listitem>
<listitem>
<simpara>When deployment configuration changes on exit, the configuration will automatically redeploy. Watch pod status as the deployment progresses, to determine whether the issue has been resolved:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -w</programlisting>
</listitem>
<listitem>
<simpara>Review events within the namespace for diagnostic information relating to pod failures:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get events</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="inspecting-pod-and-container-logs_investigating-pod-issues">
<title>Inspecting pod and container logs</title>
<simpara>You can inspect pod and container logs for warnings and error messages related to explicit pod failures. Depending on policy and exit code, pod and container logs remain available after pods have been terminated.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Query logs for a specific pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs &lt;pod_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Query logs for a specific container within a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs &lt;pod_name&gt; -c &lt;container_name&gt;</programlisting>
<simpara>Logs retrieved using the preceding <literal>oc logs</literal> commands are composed of messages sent to stdout within pods or containers.</simpara>
</listitem>
<listitem>
<simpara>Inspect logs contained in <literal>/var/log/</literal> within a pod.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>List log files and subdirectories contained in <literal>/var/log</literal> within a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc exec &lt;pod_name&gt;  -- ls -alh /var/log</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="text" linenumbering="unnumbered">total 124K
drwxr-xr-x. 1 root root   33 Aug 11 11:23 .
drwxr-xr-x. 1 root root   28 Sep  6  2022 ..
-rw-rw----. 1 root utmp    0 Jul 10 10:31 btmp
-rw-r--r--. 1 root root  33K Jul 17 10:07 dnf.librepo.log
-rw-r--r--. 1 root root  69K Jul 17 10:07 dnf.log
-rw-r--r--. 1 root root 8.8K Jul 17 10:07 dnf.rpm.log
-rw-r--r--. 1 root root  480 Jul 17 10:07 hawkey.log
-rw-rw-r--. 1 root utmp    0 Jul 10 10:31 lastlog
drwx------. 2 root root   23 Aug 11 11:14 openshift-apiserver
drwx------. 2 root root    6 Jul 10 10:31 private
drwxr-xr-x. 1 root root   22 Mar  9 08:05 rhsm
-rw-rw-r--. 1 root utmp    0 Jul 10 10:31 wtmp</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Query a specific log file contained in <literal>/var/log</literal> within a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc exec &lt;pod_name&gt; cat /var/log/&lt;path_to_log&gt;</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="text" linenumbering="unnumbered">2023-07-10T10:29:38+0000 INFO --- logging initialized ---
2023-07-10T10:29:38+0000 DDEBUG timer: config: 13 ms
2023-07-10T10:29:38+0000 DEBUG Loaded plugins: builddep, changelog, config-manager, copr, debug, debuginfo-install, download, generate_completion_cache, groups-manager, needs-restarting, playground, product-id, repoclosure, repodiff, repograph, repomanage, reposync, subscription-manager, uploadprofile
2023-07-10T10:29:38+0000 INFO Updating Subscription Management repositories.
2023-07-10T10:29:38+0000 INFO Unable to read consumer identity
2023-07-10T10:29:38+0000 INFO Subscription Manager is operating in container mode.
2023-07-10T10:29:38+0000 INFO</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>List log files and subdirectories contained in <literal>/var/log</literal> within a specific container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc exec &lt;pod_name&gt; -c &lt;container_name&gt; ls /var/log</programlisting>
</listitem>
<listitem>
<simpara>Query a specific log file contained in <literal>/var/log</literal> within a specific container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc exec &lt;pod_name&gt; -c &lt;container_name&gt; cat /var/log/&lt;path_to_log&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="accessing-running-pods_investigating-pod-issues">
<title>Accessing running pods</title>
<simpara>You can review running pods dynamically by opening a shell inside a pod or by gaining network access through port forwarding.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Switch into the project that contains the pod you would like to access. This is necessary because the <literal>oc rsh</literal> command does not accept the <literal>-n</literal> namespace option:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc project &lt;namespace&gt;</programlisting>
</listitem>
<listitem>
<simpara>Start a remote shell into a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc rsh &lt;pod_name&gt;  <co xml:id="CO48-1"/></programlisting>
<calloutlist>
<callout arearefs="CO48-1">
<para>If a pod has multiple containers, <literal>oc rsh</literal> defaults to the first container unless <literal>-c &lt;container_name&gt;</literal> is specified.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Start a remote shell into a specific container within a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc rsh -c &lt;container_name&gt; pod/&lt;pod_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Create a port forwarding session to a port on a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc port-forward &lt;pod_name&gt; &lt;host_port&gt;:&lt;pod_port&gt;  <co xml:id="CO49-1"/></programlisting>
<calloutlist>
<callout arearefs="CO49-1">
<para>Enter <literal>Ctrl+C</literal> to cancel the port forwarding session.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
</section>
<section xml:id="starting-debug-pods-with-root-access_investigating-pod-issues">
<title>Starting debug pods with root access</title>
<simpara>You can start a debug pod with root access, based on a problematic pod&#8217;s deployment or deployment configuration. Pod users typically run with non-root privileges, but running troubleshooting pods with temporary root privileges can be useful during issue investigation.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Start a debug pod with root access, based on a deployment.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Obtain a project&#8217;s deployment name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get deployment -n &lt;project_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Start a debug pod with root privileges, based on the deployment:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug deployment/my-deployment --as-root -n &lt;project_name&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Start a debug pod with root access, based on a deployment configuration.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Obtain a project&#8217;s deployment configuration name:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get deploymentconfigs -n &lt;project_name&gt;</programlisting>
</listitem>
<listitem>
<simpara>Start a debug pod with root privileges, based on the deployment configuration:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug deploymentconfig/my-deployment-configuration --as-root -n &lt;project_name&gt;</programlisting>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<note>
<simpara>You can append <literal>-- &lt;command&gt;</literal> to the preceding <literal>oc debug</literal> commands to run individual commands within a debug pod, instead of running an interactive shell.</simpara>
</note>
</section>
<section xml:id="copying-files-pods-and-containers_investigating-pod-issues">
<title>Copying files to and from pods and containers</title>
<simpara>You can copy files to and from a pod to test configuration changes or gather diagnostic information.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Copy a file to a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc cp &lt;local_path&gt; &lt;pod_name&gt;:/&lt;path&gt; -c &lt;container_name&gt;  <co xml:id="CO50-1"/></programlisting>
<calloutlist>
<callout arearefs="CO50-1">
<para>The first container in a pod is selected if the <literal>-c</literal> option is not specified.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Copy a file from a pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc cp &lt;pod_name&gt;:/&lt;path&gt;  -c &lt;container_name&gt; &lt;local_path&gt;  <co xml:id="CO51-1"/></programlisting>
<calloutlist>
<callout arearefs="CO51-1">
<para>The first container in a pod is selected if the <literal>-c</literal> option is not specified.</para>
</callout>
</calloutlist>
<note>
<simpara>For <literal>oc cp</literal> to function, the <literal>tar</literal> binary must be available within the container.</simpara>
</note>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="troubleshooting-s2i">
<title>Troubleshooting the Source-to-Image process</title>

<section xml:id="strategies-for-s2i-troubleshooting_troubleshooting-s2i">
<title>Strategies for Source-to-Image troubleshooting</title>
<simpara>Use Source-to-Image (S2I) to build reproducible, Docker-formatted container images. You can create ready-to-run images by injecting application source code into a container image and assembling a new image. The new image incorporates the base image (the builder) and built source.</simpara>
<simpara>To determine where in the S2I process a failure occurs, you can observe the state of the pods relating to each of the following S2I stages:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><emphasis role="strong">During the build configuration stage</emphasis>, a build pod is used to create an application container image from a base image and application source code.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">During the deployment configuration stage</emphasis>, a deployment pod is used to deploy application pods from the application container image that was built in the build configuration stage. The deployment pod also deploys other resources such as services and routes. The deployment configuration begins after the build configuration succeeds.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">After the deployment pod has started the application pods</emphasis>, application failures can occur within the running application pods. For instance, an application might not behave as expected even though the application pods are in a <literal>Running</literal> state. In this scenario, you can access running application pods to investigate application failures within a pod.</simpara>
</listitem>
</orderedlist>
<simpara>When troubleshooting S2I issues, follow this strategy:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Monitor build, deployment, and application pod status</simpara>
</listitem>
<listitem>
<simpara>Determine the stage of the S2I process where the problem occurred</simpara>
</listitem>
<listitem>
<simpara>Review logs corresponding to the failed stage</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="gathering-s2i-diagnostic-data_troubleshooting-s2i">
<title>Gathering Source-to-Image diagnostic data</title>
<simpara>The S2I tool runs a build pod and a deployment pod in sequence. The deployment pod is responsible for deploying the application pods based on the application container image created in the build stage. Watch build, deployment and application pod status to determine where in the S2I process a failure occurs. Then, focus diagnostic data collection accordingly.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>Your API service is still functional.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Watch the pod status throughout the S2I process to determine at which stage a failure occurs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get pods -w  <co xml:id="CO52-1"/></programlisting>
<calloutlist>
<callout arearefs="CO52-1">
<para>Use <literal>-w</literal> to monitor pods for changes until you quit the command using <literal>Ctrl+C</literal>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Review a failed pod&#8217;s logs for errors.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">If the build pod fails</emphasis>, review the build pod&#8217;s logs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs -f pod/&lt;application_name&gt;-&lt;build_number&gt;-build</programlisting>
<note>
<simpara>Alternatively, you can review the build configuration&#8217;s logs using <literal>oc logs -f bc/&lt;application_name&gt;</literal>. The build configuration&#8217;s logs include the logs from the build pod.</simpara>
</note>
</listitem>
<listitem>
<simpara><emphasis role="strong">If the deployment pod fails</emphasis>, review the deployment pod&#8217;s logs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs -f pod/&lt;application_name&gt;-&lt;build_number&gt;-deploy</programlisting>
<note>
<simpara>Alternatively, you can review the deployment configuration&#8217;s logs using <literal>oc logs -f dc/&lt;application_name&gt;</literal>. This outputs logs from the deployment pod until the deployment pod completes successfully. The command outputs logs from the application pods if you run it after the deployment pod has completed. After a deployment pod completes, its logs can still be accessed by running <literal>oc logs -f pod/&lt;application_name&gt;-&lt;build_number&gt;-deploy</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara><emphasis role="strong">If an application pod fails, or if an application is not behaving as expected within a running application pod</emphasis>, review the application pod&#8217;s logs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs -f pod/&lt;application_name&gt;-&lt;build_number&gt;-&lt;random_string&gt;</programlisting>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="gathering-application-diagnostic-data_troubleshooting-s2i">
<title>Gathering application diagnostic data to investigate application failures</title>
<simpara>Application failures can occur within running application pods. In these situations, you can retrieve diagnostic information with these strategies:</simpara>
<itemizedlist>
<listitem>
<simpara>Review events relating to the application pods.</simpara>
</listitem>
<listitem>
<simpara>Review the logs from the application pods, including application-specific log files that are not collected by the OpenShift Logging framework.</simpara>
</listitem>
<listitem>
<simpara>Test application functionality interactively and run diagnostic tools in an application container.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>List events relating to a specific application pod. The following example retrieves events for an application pod named <literal>my-app-1-akdlg</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc describe pod/my-app-1-akdlg</programlisting>
</listitem>
<listitem>
<simpara>Review logs from an application pod:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs -f pod/my-app-1-akdlg</programlisting>
</listitem>
<listitem>
<simpara>Query specific logs within a running application pod. Logs that are sent to stdout are collected by the OpenShift Logging framework and are included in the output of the preceding command. The following query is only required for logs that are not sent to stdout.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>If an application log can be accessed without root privileges within a pod, concatenate the log file as follows:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc exec my-app-1-akdlg -- cat /var/log/my-application.log</programlisting>
</listitem>
<listitem>
<simpara>If root access is required to view an application log, you can start a debug container with root privileges and then view the log file from within the container. Start the debug container from the project&#8217;s <literal>DeploymentConfig</literal> object. Pod users typically run with non-root privileges, but running troubleshooting pods with temporary root privileges can be useful during issue investigation:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug dc/my-deployment-configuration --as-root -- cat /var/log/my-application.log</programlisting>
<note>
<simpara>You can access an interactive shell with root access within the debug pod if you run <literal>oc debug dc/&lt;deployment_configuration&gt; --as-root</literal> without appending <literal>-- &lt;command&gt;</literal>.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Test application functionality interactively and run diagnostic tools, in an application container with an interactive shell.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Start an interactive shell on the application container:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc exec -it my-app-1-akdlg /bin/bash</programlisting>
</listitem>
<listitem>
<simpara>Test application functionality interactively from within the shell. For example, you can run the container&#8217;s entry point command and observe the results. Then, test changes from the command line directly, before updating the source code and rebuilding the application container through the S2I process.</simpara>
</listitem>
<listitem>
<simpara>Run diagnostic binaries available within the container.</simpara>
<note>
<simpara>Root privileges are required to run some diagnostic binaries. In these situations you can start a debug pod with root access, based on a problematic pod&#8217;s <literal>DeploymentConfig</literal> object, by running <literal>oc debug dc/&lt;deployment_configuration&gt; --as-root</literal>. Then, you can run diagnostic binaries as root from within the debug pod.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If diagnostic binaries are not available within a container, you can run a host&#8217;s diagnostic binaries within a container&#8217;s namespace by using <literal>nsenter</literal>. The following example runs <literal>ip ad</literal> within a container&#8217;s namespace, using the host`s <literal>ip</literal> binary.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Enter into a debug session on the target node. This step instantiates a debug pod called <literal>&lt;node_name&gt;-debug</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc debug node/my-cluster-node</programlisting>
</listitem>
<listitem>
<simpara>Set <literal>/host</literal> as the root directory within the debug shell. The debug pod mounts the host&#8217;s root file system in <literal>/host</literal> within the pod. By changing the root directory to <literal>/host</literal>, you can run binaries contained in the host&#8217;s executable paths:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># chroot /host</programlisting>
<note>
<simpara>{product-title} {product-version} cluster nodes running Red Hat Enterprise Linux CoreOS (RHCOS) are immutable and rely on Operators to apply cluster changes. Accessing cluster nodes by using SSH is not recommended. However, if the {product-title} API is not available, or the kubelet is not properly functioning on the target node, <literal>oc</literal> operations will be impacted. In such situations, it is possible to access nodes using <literal>ssh core@&lt;node&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</literal> instead.</simpara>
</note>
</listitem>
<listitem>
<simpara>Determine the target container ID:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># crictl ps</programlisting>
</listitem>
<listitem>
<simpara>Determine the container&#8217;s process ID. In this example, the target container ID is <literal>a7fe32346b120</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># crictl inspect a7fe32346b120 --output yaml | grep 'pid:' | awk '{print $2}'</programlisting>
</listitem>
<listitem>
<simpara>Run <literal>ip ad</literal> within the container&#8217;s namespace, using the host&#8217;s <literal>ip</literal> binary. This example uses <literal>31150</literal> as the container&#8217;s process ID. The <literal>nsenter</literal> command enters the namespace of a target process and runs a command in its namespace. Because the target process in this example is a container&#8217;s process ID, the <literal>ip ad</literal> command is run in the container&#8217;s namespace from the host:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># nsenter -n -t 31150 -- ip ad</programlisting>
<note>
<simpara>Running a host&#8217;s diagnostic binaries within a container&#8217;s namespace is only possible if you are using a privileged container such as a debug node.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="_additional_resources_3" role="_additional-resources">
<title>Additional resources</title>
<itemizedlist>
<listitem>
<simpara>See <link xl:href="../../cicd/builds/build-strategies.xml#build-strategy-s2i_build-strategies">Source-to-Image (S2I) build</link> for more details about the S2I build strategy.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="troubleshooting-storage-issues">
<title>Troubleshooting storage issues</title>

<section xml:id="storage-multi-attach-error_troubleshooting-storage-issues">
<title>Resolving multi-attach errors</title>
<simpara>When a node crashes or shuts down abruptly, the attached ReadWriteOnce (RWO) volume is expected to be unmounted from the node so that it can be used by a pod scheduled on another node.</simpara>
<simpara>However, mounting on a new node is not possible because the failed node is unable to unmount the attached volume.</simpara>
<simpara>A multi-attach error is reported:</simpara>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">Unable to attach or mount volumes: unmounted volumes=[sso-mysql-pvol], unattached volumes=[sso-mysql-pvol default-token-x4rzc]: timed out waiting for the condition
Multi-Attach error for volume "pvc-8837384d-69d7-40b2-b2e6-5df86943eef9" Volume is already used by pod(s) sso-mysql-1-ns6b4</programlisting>
</para>
</formalpara>
<formalpara>
<title>Procedure</title>
<para>To resolve the multi-attach issue, use one of the following solutions:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Enable multiple attachments by using RWX volumes.</simpara>
<simpara>For most storage solutions, you can use ReadWriteMany (RWX) volumes to prevent multi-attach errors.</simpara>
</listitem>
<listitem>
<simpara>Recover or delete the failed node when using an RWO volume.</simpara>
<simpara>For storage that does not support RWX, such as VMware vSphere, RWO volumes must be used instead. However, RWO volumes cannot be mounted on multiple nodes.</simpara>
<simpara>If you encounter a multi-attach error message with an RWO volume, force delete the pod on a shutdown or crashed node to avoid data loss in critical workloads, such as when dynamic persistent volumes are attached.</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc delete pod &lt;old_pod&gt; --force=true --grace-period=0</programlisting>
<simpara>This command deletes the volumes stuck on shutdown or crashed nodes after six minutes.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="troubleshooting-windows-container-workload-issues">
<title>Troubleshooting Windows container workload issues</title>

<section xml:id="wmco-does-not-install_troubleshooting-windows-container-workload-issues">
<title>Windows Machine Config Operator does not install</title>
<simpara>If you have completed the process of installing the Windows Machine Config Operator (WMCO), but the Operator is stuck in the <literal>InstallWaiting</literal> phase, your issue is likely caused by a networking issue.</simpara>
<simpara>The WMCO requires your {product-title} cluster to be configured with hybrid networking using OVN-Kubernetes; the WMCO cannot complete the installation process without hybrid networking available. This is necessary to manage nodes on multiple operating systems (OS) and OS variants. This must be completed during the installation of your cluster.</simpara>
<simpara>For more information, see <link xl:href="../../networking/ovn_kubernetes_network_provider/configuring-hybrid-networking.xml#configuring-hybrid-ovnkubernetes">Configuring hybrid networking</link>.</simpara>
</section>
<section xml:id="investigating-why-windows-machine-compute-node_troubleshooting-windows-container-workload-issues">
<title>Investigating why Windows Machine does not become compute node</title>
<simpara>There are various reasons why a Windows Machine does not become a compute node. The best way to investigate this problem is to collect the Windows Machine Config Operator (WMCO) logs.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You installed the Windows Machine Config Operator (WMCO) using Operator Lifecycle Manager (OLM).</simpara>
</listitem>
<listitem>
<simpara>You have created a Windows compute machine set.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Run the following command to collect the WMCO logs:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc logs -f deployment/windows-machine-config-operator -n openshift-windows-machine-config-operator</programlisting>
</listitem>
</itemizedlist>
</section>
<section xml:id="accessing-windows-node">
<title>Accessing a Windows node</title>
<simpara>Windows nodes cannot be accessed using the <literal>oc debug node</literal> command; the command requires running a privileged pod on the node, which is not yet supported for Windows. Instead, a Windows node can be accessed using a secure shell (SSH) or Remote Desktop Protocol (RDP). An SSH bastion is required for both methods.</simpara>
<section xml:id="accessing-windows-node-using-ssh_troubleshooting-windows-container-workload-issues">
<title>Accessing a Windows node using SSH</title>
<simpara>You can access a Windows node by using a secure shell (SSH).</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have installed the Windows Machine Config Operator (WMCO) using Operator Lifecycle Manager (OLM).</simpara>
</listitem>
<listitem>
<simpara>You have created a Windows compute machine set.</simpara>
</listitem>
<listitem>
<simpara>You have added the key used in the <literal>cloud-private-key</literal> secret and the key used when creating the cluster to the ssh-agent. For security reasons, remember to remove the keys from the ssh-agent after use.</simpara>
</listitem>
<listitem>
<simpara>You have connected to the Windows node <link xl:href="https://access.redhat.com/solutions/4073041">using an <literal>ssh-bastion</literal> pod</link>.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Access the Windows node by running the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh -t -o StrictHostKeyChecking=no -o ProxyCommand='ssh -A -o StrictHostKeyChecking=no \
    -o ServerAliveInterval=30 -W %h:%p core@$(oc get service --all-namespaces -l run=ssh-bastion \
    -o go-template="{{ with (index (index .items 0).status.loadBalancer.ingress 0) }}{{ or .hostname .ip }}{{end}}")' &lt;username&gt;@&lt;windows_node_internal_ip&gt; <co xml:id="CO53-1"/> <co xml:id="CO53-2"/></programlisting>
<calloutlist>
<callout arearefs="CO53-1">
<para>Specify the cloud provider username, such as <literal>Administrator</literal> for Amazon Web Services (AWS) or <literal>capi</literal> for Microsoft Azure.</para>
</callout>
<callout arearefs="CO53-2">
<para>Specify the internal IP address of the node, which can be discovered by running the following command:</para>
</callout>
</calloutlist>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes &lt;node_name&gt; -o jsonpath={.status.addresses[?\(@.type==\"InternalIP\"\)].address}</programlisting>
</listitem>
</itemizedlist>
</section>
<section xml:id="accessing-windows-node-using-rdp_troubleshooting-windows-container-workload-issues">
<title>Accessing a Windows node using RDP</title>
<simpara>You can access a Windows node by using a Remote Desktop Protocol (RDP).</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You installed the Windows Machine Config Operator (WMCO) using Operator Lifecycle Manager (OLM).</simpara>
</listitem>
<listitem>
<simpara>You have created a Windows compute machine set.</simpara>
</listitem>
<listitem>
<simpara>You have added the key used in the <literal>cloud-private-key</literal> secret and the key used when creating the cluster to the ssh-agent. For security reasons, remember to remove the keys from the ssh-agent after use.</simpara>
</listitem>
<listitem>
<simpara>You have connected to the Windows node <link xl:href="https://access.redhat.com/solutions/4073041">using an <literal>ssh-bastion</literal> pod</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Run the following command to set up an SSH tunnel:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ ssh -L 2020:&lt;windows_node_internal_ip&gt;:3389 \ <co xml:id="CO54-1"/>
    core@$(oc get service --all-namespaces -l run=ssh-bastion -o go-template="{{ with (index (index .items 0).status.loadBalancer.ingress 0) }}{{ or .hostname .ip }}{{end}}")</programlisting>
<calloutlist>
<callout arearefs="CO54-1">
<para>Specify the internal IP address of the node, which can be discovered by running the following command:</para>
</callout>
</calloutlist>
<programlisting language="terminal" linenumbering="unnumbered">$ oc get nodes &lt;node_name&gt; -o jsonpath={.status.addresses[?\(@.type==\"InternalIP\"\)].address}</programlisting>
</listitem>
<listitem>
<simpara>From within the resulting shell, SSH into the Windows node and run the following command to create a password for the user:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">C:\&gt; net user &lt;username&gt; * <co xml:id="CO55-1"/></programlisting>
<calloutlist>
<callout arearefs="CO55-1">
<para>Specify the cloud provider user name, such as <literal>Administrator</literal> for AWS or <literal>capi</literal> for Azure.</para>
</callout>
</calloutlist>
</listitem>
</orderedlist>
<simpara>You can now remotely access the Windows node at <literal>localhost:2020</literal> using an RDP client.</simpara>
</section>
</section>
<section xml:id="collecting-kube-node-logs-windows_troubleshooting-windows-container-workload-issues">
<title>Collecting Kubernetes node logs for Windows containers</title>
<simpara>Windows container logging works differently from Linux container logging; the Kubernetes node logs for Windows workloads are streamed to the <literal>C:\var\logs</literal> directory by default. Therefore, you must gather the Windows node logs from that directory.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You installed the Windows Machine Config Operator (WMCO) using Operator Lifecycle Manager (OLM).</simpara>
</listitem>
<listitem>
<simpara>You have created a Windows compute machine set.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To view the logs under all directories in <literal>C:\var\logs</literal>, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs -l kubernetes.io/os=windows --path= \
    /ip-10-0-138-252.us-east-2.compute.internal containers \
    /ip-10-0-138-252.us-east-2.compute.internal hybrid-overlay \
    /ip-10-0-138-252.us-east-2.compute.internal kube-proxy \
    /ip-10-0-138-252.us-east-2.compute.internal kubelet \
    /ip-10-0-138-252.us-east-2.compute.internal pods</programlisting>
</listitem>
<listitem>
<simpara>You can now list files in the directories using the same command and view the individual log files. For example, to view the kubelet logs, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs -l kubernetes.io/os=windows --path=/kubelet/kubelet.log</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="collecting-windows-application-event-logs_troubleshooting-windows-container-workload-issues">
<title>Collecting Windows application event logs</title>
<simpara>The <literal>Get-WinEvent</literal> shim on the kubelet <literal>logs</literal> endpoint can be used to collect application event logs from Windows machines.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You installed the Windows Machine Config Operator (WMCO) using Operator Lifecycle Manager (OLM).</simpara>
</listitem>
<listitem>
<simpara>You have created a Windows compute machine set.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To view logs from all applications logging to the event logs on the Windows machine, run:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs -l kubernetes.io/os=windows --path=journal</programlisting>
<simpara>The same command is executed when collecting logs with <literal>oc adm must-gather</literal>.</simpara>
<simpara>Other Windows application logs from the event log can also be collected by specifying the respective service with a <literal>-u</literal> flag. For example, you can run the following command to collect logs for the docker runtime service:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc adm node-logs -l kubernetes.io/os=windows --path=journal -u docker</programlisting>
</listitem>
</itemizedlist>
</section>
<section xml:id="collecting-docker-logs-windows_troubleshooting-windows-container-workload-issues">
<title>Collecting Docker logs for Windows containers</title>
<simpara>The Windows Docker service does not stream its logs to stdout, but instead, logs to the event log for Windows. You can view the Docker event logs to investigate issues you think might be caused by the Windows Docker service.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You installed the Windows Machine Config Operator (WMCO) using Operator Lifecycle Manager (OLM).</simpara>
</listitem>
<listitem>
<simpara>You have created a Windows compute machine set.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>SSH into the Windows node and enter PowerShell:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">C:\&gt; powershell</programlisting>
</listitem>
<listitem>
<simpara>View the Docker logs by running the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">C:\&gt; Get-EventLog -LogName Application -Source Docker</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="_additional_resources_4" role="_additional-resources">
<title>Additional resources</title>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/troubleshooting">Containers on Windows troubleshooting</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/deploy-containers/update-containers#troubleshoot-host-and-container-image-mismatches">Troubleshoot host and container image mismatches</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://docs.docker.com/docker-for-windows/troubleshoot/">Docker for Windows troubleshooting</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/common-problems">Common Kubernetes problems with Windows</link></simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="investigating-monitoring-issues">
<title>Investigating monitoring issues</title>

<simpara>{product-title} includes a preconfigured, preinstalled, and self-updating monitoring stack that provides monitoring for core platform components. In {product-title} {product-version}, cluster administrators can optionally enable monitoring for user-defined projects.</simpara>
<simpara>You can follow these procedures if your own metrics are unavailable or if Prometheus is consuming a lot of disk space.</simpara>
<section xml:id="investigating-why-user-defined-metrics-are-unavailable_investigating-monitoring-issues">
<title>Investigating why user-defined project metrics are unavailable</title>
<simpara><literal>ServiceMonitor</literal> resources enable you to determine how to use the metrics exposed by a service in user-defined projects. Follow the steps outlined in this procedure if you have created a <literal>ServiceMonitor</literal> resource but cannot see any corresponding metrics in the Metrics UI.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
<listitem>
<simpara>You have enabled and configured monitoring for user-defined workloads.</simpara>
</listitem>
<listitem>
<simpara>You have created the <literal>user-workload-monitoring-config</literal> <literal>ConfigMap</literal> object.</simpara>
</listitem>
<listitem>
<simpara>You have created a <literal>ServiceMonitor</literal> resource.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara><emphasis role="strong">Check that the corresponding labels match</emphasis> in the service and <literal>ServiceMonitor</literal> resource configurations.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Obtain the label defined in the service. The following example queries the <literal>prometheus-example-app</literal> service in the <literal>ns1</literal> project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n ns1 get service prometheus-example-app -o yaml</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">  labels:
    app: prometheus-example-app</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Check that the <literal>matchLabels</literal> <literal>app</literal> label in the <literal>ServiceMonitor</literal> resource configuration matches the label output in the preceding step:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n ns1 get servicemonitor prometheus-example-monitor -o yaml</programlisting>
<formalpara>
<title>Example output</title>
<para>
<screen>apiVersion: v1
kind: Service
# ...
spec:
  endpoints:
  - interval: 30s
    port: web
    scheme: http
  selector:
    matchLabels:
      app: prometheus-example-app
# ...</screen>
</para>
</formalpara>
<note>
<simpara>You can check service and <literal>ServiceMonitor</literal> resource labels as a developer with view permissions for the project.</simpara>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">Inspect the logs for the Prometheus Operator</emphasis> in the <literal>openshift-user-workload-monitoring</literal> project.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>List the pods in the <literal>openshift-user-workload-monitoring</literal> project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n openshift-user-workload-monitoring get pods</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">NAME                                   READY   STATUS    RESTARTS   AGE
prometheus-operator-776fcbbd56-2nbfm   2/2     Running   0          132m
prometheus-user-workload-0             5/5     Running   1          132m
prometheus-user-workload-1             5/5     Running   1          132m
thanos-ruler-user-workload-0           3/3     Running   0          132m
thanos-ruler-user-workload-1           3/3     Running   0          132m</programlisting>
</para>
</formalpara>
</listitem>
<listitem>
<simpara>Obtain the logs from the <literal>prometheus-operator</literal> container in the <literal>prometheus-operator</literal> pod. In the following example, the pod is called <literal>prometheus-operator-776fcbbd56-2nbfm</literal>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n openshift-user-workload-monitoring logs prometheus-operator-776fcbbd56-2nbfm -c prometheus-operator</programlisting>
<simpara>If there is a issue with the service monitor, the logs might include an error similar to this example:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">level=warn ts=2020-08-10T11:48:20.906739623Z caller=operator.go:1829 component=prometheusoperator msg="skipping servicemonitor" error="it accesses file system via bearer token file which Prometheus specification prohibits" servicemonitor=eagle/eagle namespace=openshift-user-workload-monitoring prometheus=user-workload</programlisting>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">Review the target status for your endpoint</emphasis> on the <emphasis role="strong">Metrics targets</emphasis> page in the {product-title} web console UI.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Log in to the {product-title} web console and navigate to <emphasis role="strong">Observe</emphasis> → <emphasis role="strong">Targets</emphasis> in the <emphasis role="strong">Administrator</emphasis> perspective.</simpara>
</listitem>
<listitem>
<simpara>Locate the metrics endpoint in the list, and review the status of the target in the <emphasis role="strong">Status</emphasis> column.</simpara>
</listitem>
<listitem>
<simpara>If the <emphasis role="strong">Status</emphasis> is <emphasis role="strong">Down</emphasis>, click the URL for the endpoint to view more information on the <emphasis role="strong">Target Details</emphasis> page for that metrics target.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">Configure debug level logging for the Prometheus Operator</emphasis> in the <literal>openshift-user-workload-monitoring</literal> project.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Edit the <literal>user-workload-monitoring-config</literal> <literal>ConfigMap</literal> object in the <literal>openshift-user-workload-monitoring</literal> project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config</programlisting>
</listitem>
<listitem>
<simpara>Add <literal>logLevel: debug</literal> for <literal>prometheusOperator</literal> under <literal>data/config.yaml</literal> to set the log level to <literal>debug</literal>:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">apiVersion: v1
kind: ConfigMap
metadata:
  name: user-workload-monitoring-config
  namespace: openshift-user-workload-monitoring
data:
  config.yaml: |
    prometheusOperator:
      logLevel: debug
# ...</programlisting>
</listitem>
<listitem>
<simpara>Save the file to apply the changes.</simpara>
<note>
<simpara>The <literal>prometheus-operator</literal> in the <literal>openshift-user-workload-monitoring</literal> project restarts automatically when you apply the log-level change.</simpara>
</note>
</listitem>
<listitem>
<simpara>Confirm that the <literal>debug</literal> log-level has been applied to the <literal>prometheus-operator</literal> deployment in the <literal>openshift-user-workload-monitoring</literal> project:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n openshift-user-workload-monitoring get deploy prometheus-operator -o yaml |  grep "log-level"</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">        - --log-level=debug</programlisting>
</para>
</formalpara>
<simpara>Debug level logging will show all calls made by the Prometheus Operator.</simpara>
</listitem>
<listitem>
<simpara>Check that the <literal>prometheus-operator</literal> pod is running:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc -n openshift-user-workload-monitoring get pods</programlisting>
<note>
<simpara>If an unrecognized Prometheus Operator <literal>loglevel</literal> value is included in the config map, the <literal>prometheus-operator</literal> pod might not restart successfully.</simpara>
</note>
</listitem>
<listitem>
<simpara>Review the debug logs to see if the Prometheus Operator is using the <literal>ServiceMonitor</literal> resource. Review the logs for other related errors.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="../../monitoring/configuring-the-monitoring-stack.xml#creating-user-defined-workload-monitoring-configmap_configuring-the-monitoring-stack">Creating a user-defined workload monitoring config map</link></simpara>
</listitem>
<listitem>
<simpara>See <link xl:href="../../monitoring/managing-metrics.xml#specifying-how-a-service-is-monitored_managing-metrics">Specifying how a service is monitored</link> for details on how to create a service monitor or pod monitor</simpara>
</listitem>
<listitem>
<simpara>See <link xl:href="../../monitoring/managing-metrics.xml#getting-detailed-information-about-a-target_managing-metrics">Getting detailed information about a metrics target</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="determining-why-prometheus-is-consuming-disk-space_investigating-monitoring-issues">
<title>Determining why Prometheus is consuming a lot of disk space</title>
<simpara>Developers can create labels to define attributes for metrics in the form of key-value pairs. The number of potential key-value pairs corresponds to the number of possible values for an attribute. An attribute that has an unlimited number of potential values is called an unbound attribute. For example, a <literal>customer_id</literal> attribute is unbound because it has an infinite number of possible values.</simpara>
<simpara>Every assigned key-value pair has a unique time series. The use of many unbound attributes in labels can result in an exponential increase in the number of time series created. This can impact Prometheus performance and can consume a lot of disk space.</simpara>
<simpara>You can use the following measures when Prometheus consumes a lot of disk:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Check the number of scrape samples</emphasis> that are being collected.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Check the time series database (TSDB) status using the Prometheus HTTP API</emphasis> for more information about which labels are creating the most time series. Doing so requires cluster administrator privileges.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Reduce the number of unique time series that are created</emphasis> by reducing the number of unbound attributes that are assigned to user-defined metrics.</simpara>
<note>
<simpara>Using attributes that are bound to a limited set of possible values reduces the number of potential key-value pair combinations.</simpara>
</note>
</listitem>
<listitem>
<simpara><emphasis role="strong">Enforce limits on the number of samples that can be scraped</emphasis> across user-defined projects. This requires cluster administrator privileges.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have access to the cluster as a user with the <literal>cluster-admin</literal> cluster role.</simpara>
</listitem>
<listitem>
<simpara>You have installed the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the <emphasis role="strong">Administrator</emphasis> perspective, navigate to <emphasis role="strong">Observe</emphasis> &#8594; <emphasis role="strong">Metrics</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Run the following Prometheus Query Language (PromQL) query in the <emphasis role="strong">Expression</emphasis> field. This returns the ten metrics that have the highest number of scrape samples:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">topk(10,count by (job)({__name__=~".+"}))</programlisting>
</listitem>
<listitem>
<simpara>Investigate the number of unbound label values assigned to metrics with higher than expected scrape sample counts.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">If the metrics relate to a user-defined project</emphasis>, review the metrics key-value pairs assigned to your workload. These are implemented through Prometheus client libraries at the application level. Try to limit the number of unbound attributes referenced in your labels.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">If the metrics relate to a core {product-title} project</emphasis>, create a Red Hat support case on the <link xl:href="https://access.redhat.com/">Red Hat Customer Portal</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Review the TSDB status using the Prometheus HTTP API by running the following commands as a
cluster administrator:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc login -u &lt;username&gt; -p &lt;password&gt;</programlisting>
<programlisting language="terminal" linenumbering="unnumbered">$ host=$(oc -n openshift-monitoring get route prometheus-k8s -ojsonpath={.spec.host})</programlisting>
<programlisting language="terminal" linenumbering="unnumbered">$ token=$(oc whoami -t)</programlisting>
<programlisting language="terminal" linenumbering="unnumbered">$ curl -H "Authorization: Bearer $token" -k "https://$host/api/v1/status/tsdb"</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="terminal" linenumbering="unnumbered">"status": "success",</programlisting>
</para>
</formalpara>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara>See <link xl:href="../../monitoring/configuring-the-monitoring-stack.xml#setting-scrape-sample-and-label-limits-for-user-defined-projects_configuring-the-monitoring-stack">Setting a scrape sample limit for user-defined projects</link> for details on how to set a scrape sample limit and create related alerting rules</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="diagnosing-oc-issues">
<title>Diagnosing OpenShift CLI (<literal>oc</literal>) issues</title>

<section xml:id="understanding-oc-log-levels_diagnosing-oc-issues">
<title>Understanding OpenShift CLI (<literal>oc</literal>) log levels</title>
<simpara>With the OpenShift CLI (<literal>oc</literal>), you can create applications and manage {product-title} projects from a terminal.</simpara>
<simpara>If <literal>oc</literal> command-specific issues arise, increase the <literal>oc</literal> log level to output API request, API response, and <literal>curl</literal> request details generated by the command. This provides a granular view of a particular <literal>oc</literal> command&#8217;s underlying operation, which in turn might provide insight into the nature of a failure.</simpara>
<simpara><literal>oc</literal> log levels range from 1 to 10. The following table provides a list of <literal>oc</literal> log levels, along with their descriptions.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>OpenShift CLI (<literal>oc</literal>) log levels</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="80*"/>
<thead>
<row>
<entry align="left" valign="top">Log level</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>1 to 5</simpara></entry>
<entry align="left" valign="top"><simpara>No additional logging to stderr.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>6</simpara></entry>
<entry align="left" valign="top"><simpara>Log API requests to stderr.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>7</simpara></entry>
<entry align="left" valign="top"><simpara>Log API requests and headers to stderr.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>8</simpara></entry>
<entry align="left" valign="top"><simpara>Log API requests, headers, and body, plus API response headers and body to stderr.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>9</simpara></entry>
<entry align="left" valign="top"><simpara>Log API requests, headers, and body, API response headers and body, plus <literal>curl</literal> requests to stderr.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>10</simpara></entry>
<entry align="left" valign="top"><simpara>Log API requests, headers, and body, API response headers and body, plus <literal>curl</literal> requests to stderr, in verbose detail.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="specifying-oc-log-levels_diagnosing-oc-issues">
<title>Specifying OpenShift CLI (<literal>oc</literal>) log levels</title>
<simpara>You can investigate OpenShift CLI (<literal>oc</literal>) issues by increasing the command&#8217;s log level.</simpara>
<simpara>The {product-title} user&#8217;s current session token is typically included in logged <literal>curl</literal> requests where required. You can also obtain the current user&#8217;s session token manually, for use when testing aspects of an <literal>oc</literal> command&#8217;s underlying process step-by-step.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Install the OpenShift CLI (<literal>oc</literal>).</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Specify the <literal>oc</literal> log level when running an <literal>oc</literal> command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc &lt;command&gt; --loglevel &lt;log_level&gt;</programlisting>
<simpara>where:</simpara>
<variablelist>
<varlistentry>
<term>&lt;command&gt;</term>
<listitem>
<simpara>Specifies the command you are running.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>&lt;log_level&gt;</term>
<listitem>
<simpara>Specifies the log level to apply to the command.</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
<listitem>
<simpara>To obtain the current user&#8217;s session token, run the following command:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">$ oc whoami -t</programlisting>
<formalpara>
<title>Example output</title>
<para>
<programlisting language="text" linenumbering="unnumbered">sha256~RCV3Qcn7H-OEfqCGVI0CvnZ6...</programlisting>
</para>
</formalpara>
</listitem>
</itemizedlist>
</section>
</section>
</chapter>
</book>