:_mod-docs-content-type: ASSEMBLY
[id="service-mesh-release-notes"]
= Service Mesh Release Notes
// The {product-title} attribute provides the context-sensitive name of the relevant OpenShift distribution, for example, "OpenShift Container Platform" or "OKD". The {product-version} attribute provides the product version relative to the distribution, for example "4.9".
// {product-title} and {product-version} are parsed when AsciiBinder queries the _distro_map.yml file in relation to the base branch of a pull request.
// See https://github.com/openshift/openshift-docs/blob/main/contributing_to_docs/doc_guidelines.adoc#product-name-and-version for more information on this topic.
// Other common attributes are defined in the following lines:
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:imagesdir: images
:prewrap!:
:op-system-first: Red Hat Enterprise Linux CoreOS (RHCOS)
:op-system: RHCOS
:op-system-lowercase: rhcos
:op-system-base: RHEL
:op-system-base-full: Red Hat Enterprise Linux (RHEL)
:op-system-version: 8.x
:tsb-name: Template Service Broker
:kebab: image:kebab.png[title="Options menu"]
:rh-openstack-first: Red Hat OpenStack Platform (RHOSP)
:rh-openstack: RHOSP
:ai-full: Assisted Installer
:ai-version: 2.3
:cluster-manager-first: Red Hat OpenShift Cluster Manager
:cluster-manager: OpenShift Cluster Manager
:cluster-manager-url: link:https://console.redhat.com/openshift[OpenShift Cluster Manager Hybrid Cloud Console]
:cluster-manager-url-pull: link:https://console.redhat.com/openshift/install/pull-secret[pull secret from the Red Hat OpenShift Cluster Manager]
:insights-advisor-url: link:https://console.redhat.com/openshift/insights/advisor/[Insights Advisor]
:hybrid-console: Red Hat Hybrid Cloud Console
:hybrid-console-second: Hybrid Cloud Console
:oadp-first: OpenShift API for Data Protection (OADP)
:oadp-full: OpenShift API for Data Protection
:oc-first: pass:quotes[OpenShift CLI (`oc`)]
:product-registry: OpenShift image registry
:rh-storage-first: Red Hat OpenShift Data Foundation
:rh-storage: OpenShift Data Foundation
:rh-rhacm-first: Red Hat Advanced Cluster Management (RHACM)
:rh-rhacm: RHACM
:rh-rhacm-version: 2.8
:sandboxed-containers-first: OpenShift sandboxed containers
:sandboxed-containers-operator: OpenShift sandboxed containers Operator
:sandboxed-containers-version: 1.3
:sandboxed-containers-version-z: 1.3.3
:sandboxed-containers-legacy-version: 1.3.2
:cert-manager-operator: cert-manager Operator for Red Hat OpenShift
:secondary-scheduler-operator-full: Secondary Scheduler Operator for Red Hat OpenShift
:secondary-scheduler-operator: Secondary Scheduler Operator
// Backup and restore
:velero-domain: velero.io
:velero-version: 1.11
:launch: image:app-launcher.png[title="Application Launcher"]
:mtc-short: MTC
:mtc-full: Migration Toolkit for Containers
:mtc-version: 1.8
:mtc-version-z: 1.8.0
// builds (Valid only in 4.11 and later)
:builds-v2title: Builds for Red Hat OpenShift
:builds-v2shortname: OpenShift Builds v2
:builds-v1shortname: OpenShift Builds v1
//gitops
:gitops-title: Red Hat OpenShift GitOps
:gitops-shortname: GitOps
:gitops-ver: 1.1
:rh-app-icon: image:red-hat-applications-menu-icon.jpg[title="Red Hat applications"]
//pipelines
:pipelines-title: Red Hat OpenShift Pipelines
:pipelines-shortname: OpenShift Pipelines
:pipelines-ver: pipelines-1.12
:pipelines-version-number: 1.12
:tekton-chains: Tekton Chains
:tekton-hub: Tekton Hub
:artifact-hub: Artifact Hub
:pac: Pipelines as Code
//odo
:odo-title: odo
//OpenShift Kubernetes Engine
:oke: OpenShift Kubernetes Engine
//OpenShift Platform Plus
:opp: OpenShift Platform Plus
//openshift virtualization (cnv)
:VirtProductName: OpenShift Virtualization
:VirtVersion: 4.14
:KubeVirtVersion: v0.59.0
:HCOVersion: 4.14.0
:CNVNamespace: openshift-cnv
:CNVOperatorDisplayName: OpenShift Virtualization Operator
:CNVSubscriptionSpecSource: redhat-operators
:CNVSubscriptionSpecName: kubevirt-hyperconverged
:delete: image:delete.png[title="Delete"]
//distributed tracing
:DTProductName: Red Hat OpenShift distributed tracing platform
:DTShortName: distributed tracing platform
:DTProductVersion: 2.9
:JaegerName: Red Hat OpenShift distributed tracing platform (Jaeger)
:JaegerShortName: distributed tracing platform (Jaeger)
:JaegerVersion: 1.47.0
:OTELName: Red Hat OpenShift distributed tracing data collection
:OTELShortName: distributed tracing data collection
:OTELOperator: Red Hat OpenShift distributed tracing data collection Operator
:OTELVersion: 0.81.0
:TempoName: Red Hat OpenShift distributed tracing platform (Tempo)
:TempoShortName: distributed tracing platform (Tempo)
:TempoOperator: Tempo Operator
:TempoVersion: 2.1.1
//logging
:logging-title: logging subsystem for Red Hat OpenShift
:logging-title-uc: Logging subsystem for Red Hat OpenShift
:logging: logging subsystem
:logging-uc: Logging subsystem
//serverless
:ServerlessProductName: OpenShift Serverless
:ServerlessProductShortName: Serverless
:ServerlessOperatorName: OpenShift Serverless Operator
:FunctionsProductName: OpenShift Serverless Functions
//service mesh v2
:product-dedicated: Red Hat OpenShift Dedicated
:product-rosa: Red Hat OpenShift Service on AWS
:SMProductName: Red Hat OpenShift Service Mesh
:SMProductShortName: Service Mesh
:SMProductVersion: 2.4.4
:MaistraVersion: 2.4
//Service Mesh v1
:SMProductVersion1x: 1.1.18.2
//Windows containers
:productwinc: Red Hat OpenShift support for Windows Containers
// Red Hat Quay Container Security Operator
:rhq-cso: Red Hat Quay Container Security Operator
// Red Hat Quay
:quay: Red Hat Quay
:sno: single-node OpenShift
:sno-caps: Single-node OpenShift
//TALO and Redfish events Operators
:cgu-operator-first: Topology Aware Lifecycle Manager (TALM)
:cgu-operator-full: Topology Aware Lifecycle Manager
:cgu-operator: TALM
:redfish-operator: Bare Metal Event Relay
//Formerly known as CodeReady Containers and CodeReady Workspaces
:openshift-local-productname: Red Hat OpenShift Local
:openshift-dev-spaces-productname: Red Hat OpenShift Dev Spaces
// Factory-precaching-cli tool
:factory-prestaging-tool: factory-precaching-cli tool
:factory-prestaging-tool-caps: Factory-precaching-cli tool
:openshift-networking: Red Hat OpenShift Networking
// TODO - this probably needs to be different for OKD
//ifdef::openshift-origin[]
//:openshift-networking: OKD Networking
//endif::[]
// logical volume manager storage
:lvms-first: Logical volume manager storage (LVM Storage)
:lvms: LVM Storage
//Operator SDK version
:osdk_ver: 1.31.0
//Operator SDK version that shipped with the previous OCP 4.x release
:osdk_ver_n1: 1.28.0
//Next-gen (OCP 4.14+) Operator Lifecycle Manager, aka "v1"
:olmv1: OLM 1.0
:olmv1-first: Operator Lifecycle Manager (OLM) 1.0
:ztp-first: GitOps Zero Touch Provisioning (ZTP)
:ztp: GitOps ZTP
:3no: three-node OpenShift
:3no-caps: Three-node OpenShift
:run-once-operator: Run Once Duration Override Operator
// Web terminal
:web-terminal-op: Web Terminal Operator
:devworkspace-op: DevWorkspace Operator
:secrets-store-driver: Secrets Store CSI driver
:secrets-store-operator: Secrets Store CSI Driver Operator
//AWS STS
:sts-first: Security Token Service (STS)
:sts-full: Security Token Service
:sts-short: STS
//Cloud provider names
//AWS
:aws-first: Amazon Web Services (AWS)
:aws-full: Amazon Web Services
:aws-short: AWS
//GCP
:gcp-first: Google Cloud Platform (GCP)
:gcp-full: Google Cloud Platform
:gcp-short: GCP
//alibaba cloud
:alibaba: Alibaba Cloud
// IBM Cloud VPC
:ibmcloudVPCProductName: IBM Cloud VPC
:ibmcloudVPCRegProductName: IBM(R) Cloud VPC
// IBM Cloud
:ibm-cloud-bm: IBM Cloud Bare Metal (Classic)
:ibm-cloud-bm-reg: IBM Cloud(R) Bare Metal (Classic)
// IBM Power
:ibmpowerProductName: IBM Power
:ibmpowerRegProductName: IBM(R) Power
// IBM zSystems
:ibmzProductName: IBM Z
:ibmzRegProductName: IBM(R) Z
:linuxoneProductName: IBM(R) LinuxONE
//Azure
:azure-full: Microsoft Azure
:azure-short: Azure
//vSphere
:vmw-full: VMware vSphere
:vmw-short: vSphere
//Oracle
:oci-first: Oracle(R) Cloud Infrastructure
:oci: OCI
:ocvs-first: Oracle(R) Cloud VMware Solution (OCVS)
:ocvs: OCVS
:context: ossm-release-notes

toc::[]

// The following include statements pull in the module files that comprise 2.x release notes.

:leveloffset: +1

// Module included in the following assemblies:
//
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-0.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-1.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-2.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-3.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-4.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-5.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-6.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-7.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-8.adoc
// * distr_tracing/distr_tracing_rn/distr-tracing-rn-2-9.adoc

:_mod-docs-content-type: CONCEPT

[id="making-open-source-more-inclusive_{context}"]
= Making open source more inclusive

Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see link:https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language[our CTO Chris Wright's message].

:leveloffset!:

:leveloffset: +1

////
Module included in the following assemblies:
* service_mesh/v2x/servicemesh-release-notes.adoc
////

:_mod-docs-content-type: PROCEDURE
[id="ossm-rn-new-features_{context}"]
= New features and enhancements

////
*Feature* – Describe the new functionality available to the customer. For enhancements, try to describe as specifically as possible where the customer will see changes.
*Reason* – If known, include why has the enhancement been implemented (use case, performance, technology, etc.). For example, showcases integration of X with Y, demonstrates Z API feature, includes latest framework bug fixes. There may not have been a 'problem' previously, but system behavior may have changed.
*Result* – If changed, describe the current user experience
////

This release adds improvements related to the following components and concepts.

== New features {SMProductName} version 2.4.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.11 and later versions.

=== Component versions included in {SMProductName} version 2.4.4
//Istio stays the same
//Envoy updated to 1.24.12
//According to distributed tracing release 2.9, the latest at time of OSSM 2.4.4, Jaeger has been updated to 1.47.0
//Kiali updated to 1.65.9
//Kiali updated to 1.65.10 on 10/31/2023 due to security fix
|===
|Component |Version

|Istio
|1.16.7

|Envoy Proxy
|1.24.12

|Jaeger
|1.47.0

|Kiali
|1.65.10
|===
//Components updated for 2.4.4

== New features {SMProductName} version 2.4.3

* The {SMProductName} Operator is now available on ARM-based clusters as a Technology Preview feature.
* The `envoyExtAuthzGrpc` field has been added, which is used to configure an external authorization provider using the gRPC API.
* Common Vulnerabilities and Exposures (CVEs) have been addressed.
* This release is supported on {product-title} 4.10 and newer versions.

=== Component versions included in {SMProductName} version 2.4.3
//THESE MAY NEED TO BE UPDATED FOR 2.4.3
//Kiali updated to 1.65.8 on 09/06/2023
//09/06/2023: According to distributed tracing release notes, Jaeger component version remains unchanged.
|===
|Component |Version

|Istio
|1.16.7

|Envoy Proxy
|1.24.10

|Jaeger
|1.42.0

|Kiali
|1.65.8
|===
//COMPONENTS ABOVE MAY NEED TO BE UPDATED FOR 2.4.3

=== {SMProductName} operator to ARM-based clusters
:FeatureName: {SMProductName} operator to ARM based clusters
// When including this file, ensure that {FeatureName} is set immediately before
// the include. Otherwise it will result in an incorrect replacement.

[IMPORTANT]
====
[subs="attributes+"]
{FeatureName} is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====
// Undefine {FeatureName} attribute, so that any mistakes are easily spotted
:!FeatureName:

This release makes the {SMProductName} Operator available on ARM-based clusters as a Technology Preview feature. Images are available for Istio, Envoy, Prometheus, Kiali, and Grafana. Images are not available for Jaeger, so Jaeger must be disabled as a {SMProductShortName} add-on.

=== Remote Procedure Calls (gRPC) API support for external authorization configuration

This enhancement adds the `envoyExtAuthzGrpc` field to configure an external authorization provider using the gRPC API.

== New features {SMProductName} version 2.4.2

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.4.2

|===
|Component |Version

|Istio
|1.16.7

|Envoy Proxy
|1.24.10

|Jaeger
|1.42.0

|Kiali
|1.65.7
|===

== New features {SMProductName} version 2.4.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.4.1

|===
|Component |Version

|Istio
|1.16.5

|Envoy Proxy
|1.24.8

|Jaeger
|1.42.0

|Kiali
|1.65.7
|===

== New features {SMProductName} version 2.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.4

|===
|Component |Version

|Istio
|1.16.5

|Envoy Proxy
|1.24.8

|Jaeger
|1.42.0

|Kiali
|1.65.6
|===

=== Cluster-wide deployments
This enhancement introduces a generally available version of cluster-wide deployments. A cluster-wide deployment contains a service mesh control plane that monitors resources for an entire cluster. The control plane uses a single query across all namespaces to monitor each Istio or Kubernetes resource that affects the mesh configuration. Reducing the number of queries the control plane performs in a cluster-wide deployment improves performance.

=== Support for discovery selectors
This enhancement introduces a generally available version of the `meshConfig.discoverySelectors` field, which can be used in cluster-wide deployments to limit the services the service mesh control plane can discover.

[source,yaml]
----
spec:
  meshConfig
    discoverySelectors:
    - matchLabels:
        env: prod
        region: us-east1
    - matchExpressions:
      - key: app
        operator: In
        values:
          - cassandra
          - spark
----

=== Integration with cert-manager istio-csr
With this update, {SMProductName} integrates with the `cert-manager` controller and the `istio-csr` agent. `cert-manager` adds certificates and certificate issuers as resource types in Kubernetes clusters, and simplifies the process of obtaining, renewing, and using those certificates. `cert-manager` provides and rotates an intermediate CA certificate for Istio. Integration with `istio-csr` enables users to delegate signing certificate requests from Istio proxies to `cert-manager`. `ServiceMeshControlPlane` v2.4 accepts CA certificates provided by `cert-manager` as `cacerts` secret.

[NOTE]
====
Integration with `cert-manager` and `istio-csr` is not supported on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.
====

=== Integration with external authorization systems
This enhancement introduces a generally available method of integrating {SMProductName} with external authorization systems by using the `action: CUSTOM` field of the `AuthorizationPolicy` resource. Use the `envoyExtAuthzHttp` field to delegate the access control to an external authorization system.

=== Integration with external Prometheus installation

This enhancement introduces a generally available version of the Prometheus extension provider. You can expose metrics to the {product-title} monitoring stack or a custom Prometheus installation by setting the value of the `extensionProviders` field to `prometheus` in the `spec.meshConfig` specification. The telemetry object configures Istio proxies to collect traffic metrics. {SMProductShortName} only supports the Telemetry API for Prometheus metrics.

[source,yaml]
----
spec:
  meshConfig:
    extensionProviders:
    - name: prometheus
      prometheus: {}
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: enable-prometheus-metrics
spec:
  metrics:
  - providers:
    - name: prometheus
----

=== Single stack IPv6 support

This enhancement introduces generally available support for single stack IPv6 clusters, providing access to a broader range of IP addresses. Dual stack IPv4 or IPv6 cluster is not supported.

[NOTE]
====
Single stack IPv6 support is not available on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.
====

=== {product-title} Gateway API support
:FeatureName: {product-title} Gateway API support
// When including this file, ensure that {FeatureName} is set immediately before
// the include. Otherwise it will result in an incorrect replacement.

[IMPORTANT]
====
[subs="attributes+"]
{FeatureName} is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====
// Undefine {FeatureName} attribute, so that any mistakes are easily spotted
:!FeatureName:

This enhancement introduces an updated Technology Preview version of the {product-title} Gateway API. By default, the {product-title} Gateway API is disabled.

==== Enabling {product-title} Gateway API
To enable the {product-title} Gateway API, set the value of the `enabled` field to `true` in the `techPreview.gatewayAPI` specification of the `ServiceMeshControlPlane` resource.

[source,yaml]
----
spec:
  techPreview:
    gatewayAPI:
      enabled: true
----

Previously, environment variables were used to enable the Gateway API.

[source,yaml]
----
spec:
  runtime:
    components:
      pilot:
        container:
          env:
            PILOT_ENABLE_GATEWAY_API: "true"
            PILOT_ENABLE_GATEWAY_API_STATUS: "true"
            PILOT_ENABLE_GATEWAY_API_DEPLOYMENT_CONTROLLER: "true"
----


=== Control plane deployment on infrastructure nodes
{SMProductShortName} control plane deployment is now supported and documented on OpenShift infrastructure nodes. For more information, see the following documentation:

* Configuring all {SMProductShortName} control plane components to run on infrastructure nodes
* Configuring individual {SMProductShortName} control plane components to run on infrastructure nodes


=== Istio 1.16 support
{SMProductShortName} 2.4 is based on Istio 1.16, which brings in new features and product enhancements. While many Istio 1.16 features are supported, the following exceptions should be noted:

* HBONE protocol for sidecars is an experimental feature that is not supported.
* {SMProductShortName} on ARM64 architecture is not supported.
* OpenTelemetry API remains a Technology Preview feature.

== New features {SMProductName} version 2.3.8
//Update with 2.4.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.11 and later versions.

=== Component versions included in {SMProductName} version 2.3.8
//Istio for 2.3.8 is now 1.14.5
//Kiali is 1.57.13
//Jaeger is 1.47.0
//Envoy stays the same
|===
|Component |Version

|Istio
|1.14.5

|Envoy Proxy
|1.22.11

|Jaeger
|1.47.0

|Kiali
|1.57.13
|===
//Components updated for 2.3.8 as part of 2.4.4 update

== New features {SMProductName} version 2.3.7

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.3.7

|===
|Component |Version

|Istio
|1.14.6

|Envoy Proxy
|1.22.11

|Jaeger
|1.42.0

|Kiali
|1.57.11
|===

== New features {SMProductName} version 2.3.6

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.3.6

|===
|Component |Version

|Istio
|1.14.5

|Envoy Proxy
|1.22.11

|Jaeger
|1.42.0

|Kiali
|1.57.10
|===

== New features {SMProductName} version 2.3.5

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.3.5

|===
|Component |Version

|Istio
|1.14.5

|Envoy Proxy
|1.22.9

|Jaeger
|1.42.0

|Kiali
|1.57.10
|===

== New features {SMProductName} version 2.3.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.3.4

|===
|Component |Version

|Istio
|1.14.6

|Envoy Proxy
|1.22.9

|Jaeger
|1.42.0

|Kiali
|1.57.9
|===

== New features {SMProductName} version 2.3.3

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.
//only Envoy Proxy changed 04/17/2023
//kiali and istio changed 04/19/2023
//Jaeger updated 04/20/2023

=== Component versions included in {SMProductName} version 2.3.3

|===
|Component |Version

|Istio
|1.14.5

|Envoy Proxy
|1.22.9

|Jaeger
|1.42.0

|Kiali
|1.57.7
|===

== New features {SMProductName} version 2.3.2

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.3.2

|===
|Component |Version

|Istio
|1.14.5

|Envoy Proxy
|1.22.7

|Jaeger
|1.39

|Kiali
|1.57.6
|===

== New features {SMProductName} version 2.3.1

This release of {SMProductName} introduces new features, addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.3.1

|===
|Component |Version

|Istio
|1.14.5

|Envoy Proxy
|1.22.4

|Jaeger
|1.39

|Kiali
|1.57.5
|===

== New features {SMProductName} version 2.3

This release of {SMProductName} introduces new features, addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.3

|===
|Component |Version

|Istio
|1.14.3

|Envoy Proxy
|1.22.4

|Jaeger
|1.38

|Kiali
|1.57.3
|===

=== New Container Network Interface (CNI) DaemonSet container and ConfigMap

The `openshift-operators` namespace includes a new istio CNI DaemonSet `istio-cni-node-v2-3` and a new `ConfigMap` resource, `istio-cni-config-v2-3`.

When upgrading to Service Mesh Control Plane 2.3, the existing `istio-cni-node` DaemonSet is not changed, and a new `istio-cni-node-v2-3` DaemonSet is created.

This name change does not affect previous releases or any `istio-cni-node` CNI DaemonSet associated with a Service Mesh Control Plane deployed using a previous release.

=== Gateway injection support

This release introduces generally available support for Gateway injection. Gateway configurations are applied to standalone Envoy proxies that are running at the edge of the mesh, rather than the sidecar Envoy proxies running alongside your service workloads. This enables the ability to customize gateway options. When using gateway injection, you must create the following resources in the namespace where you want to run your gateway proxy: `Service`, `Deployment`, `Role`, and `RoleBinding`.

=== Istio 1.14 Support

{SMProductShortName} 2.3 is based on Istio 1.14, which brings in new features and product enhancements. While many Istio 1.14 features are supported, the following exceptions should be noted:

* ProxyConfig API is supported with the exception of the image field.
* Telemetry API is a Technology Preview feature.
* SPIRE runtime is not a supported feature.

=== OpenShift Service Mesh Console
:FeatureName: OpenShift Service Mesh Console
// When including this file, ensure that {FeatureName} is set immediately before
// the include. Otherwise it will result in an incorrect replacement.

[IMPORTANT]
====
[subs="attributes+"]
{FeatureName} is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====
// Undefine {FeatureName} attribute, so that any mistakes are easily spotted
:!FeatureName:

This release introduces a Technology Preview version of the {product-title} Service Mesh Console, which integrates the Kiali interface directly into the OpenShift web console. For additional information, see link:https://cloud.redhat.com/blog/introducing-the-openshift-service-mesh-console-a-developer-preview[Introducing the OpenShift Service Mesh Console (A Technology Preview)]

===  Cluster-wide deployment
:FeatureName: Cluster-wide deployment
// When including this file, ensure that {FeatureName} is set immediately before
// the include. Otherwise it will result in an incorrect replacement.

[IMPORTANT]
====
[subs="attributes+"]
{FeatureName} is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====
// Undefine {FeatureName} attribute, so that any mistakes are easily spotted
:!FeatureName:

This release introduces cluster-wide deployment as a Technology Preview feature. A cluster-wide deployment contains a Service Mesh Control Plane that monitors resources for an entire cluster. The control plane uses a single query across all namespaces to monitor each Istio or Kubernetes resource kind that affects the mesh configuration. In contrast, the multitenant approach uses a query per namespace for each resource kind. Reducing the number of queries the control plane performs in a cluster-wide deployment improves performance.

[NOTE]
====
This cluster-wide deployment documentation is only applicable for control planes deployed using SMCP v2.3. cluster-wide deployments created using SMCP v2.3 are not compatible with cluster-wide deployments created using SMCP v2.4.
====

==== Configuring cluster-wide deployment

The following example `ServiceMeshControlPlane` object configures a cluster-wide deployment.

To create an SMCP for cluster-wide deployment, a user must belong to the `cluster-admin` ClusterRole. If the SMCP is configured for cluster-wide deployment, it must be the only SMCP in the cluster. You cannot change the control plane mode from multitenant to cluster-wide (or from cluster-wide to multitenant). If a multitenant control plane already exists, delete it and create a new one.

This example configures the SMCP for cluster-wide deployment.

[source,yaml]
----
  apiVersion: maistra.io/v2
  kind: ServiceMeshControlPlane
  metadata:
    name: cluster-wide
    namespace: istio-system
  spec:
    version: v2.3
    techPreview:
      controlPlaneMode: ClusterScoped <1>
----
<1> Enables Istiod to monitor resources at the cluster level rather than monitor each individual namespace.

Additionally, the SMMR must also be configured for cluster-wide deployment. This example configures the SMMR for cluster-wide deployment.

[source,yaml]
----
  apiVersion: maistra.io/v1
  kind: ServiceMeshMemberRoll
  metadata:
    name: default
  spec:
    members:
    - '*' <1>
----
<1> Adds all namespaces to the mesh, including any namespaces you subsequently create. The following namespaces are not part of the mesh: kube, openshift, kube-* and openshift-*.

== New features {SMProductName} version 2.2.11

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.11 and later versions.

=== Component versions included in {SMProductName} version 2.2.11
//Istio remains the same
//Kiali updated to 1.48.10
//Jaeger updated to 1.47.0
//Envoy remains the same
|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.47.0

|Kiali
|1.48.10
|===
//Components updated for 2.2.11 with 2.4.4 release

== New features {SMProductName} version 2.2.10

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.2.10

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.42.0

|Kiali
|1.48.8
|===

== New features {SMProductName} version 2.2.9

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.2.9

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.42.0

|Kiali
|1.48.7
|===

== New features {SMProductName} version 2.2.8

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.2.8

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.42.0

|Kiali
|1.48.7
|===

== New features {SMProductName} version 2.2.7

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.10 and later versions.

=== Component versions included in {SMProductName} version 2.2.7

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.42.0

|Kiali
|1.48.6
|===

== New features {SMProductName} version 2.2.6

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2.6

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.39

|Kiali
|1.48.5
|===

== New features {SMProductName} version 2.2.5

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2.5

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.39

|Kiali
|1.48.3
|===

== New features {SMProductName} version 2.2.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2.4

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.36.14

|Kiali
|1.48.3
|===

== New features {SMProductName} version 2.2.3

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2.3

|===
|Component |Version

|Istio
|1.12.9

|Envoy Proxy
|1.20.8

|Jaeger
|1.36

|Kiali
|1.48.3
|===

== New features {SMProductName} version 2.2.2

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2.2

|===
|Component |Version

|Istio
|1.12.7

|Envoy Proxy
|1.20.6

|Jaeger
|1.36

|Kiali
|1.48.2-1
|===

=== Copy route labels

With this enhancement, in addition to copying annotations, you can copy specific labels for an OpenShift route. {SMProductName} copies all labels and annotations present in the Istio Gateway resource (with the exception of annotations starting with kubectl.kubernetes.io) into the managed OpenShift Route resource.

== New features {SMProductName} version 2.2.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2.1

|===
|Component |Version

|Istio
|1.12.7

|Envoy Proxy
|1.20.6

|Jaeger
|1.34.1

|Kiali
|1.48.2-1
|===

== New features {SMProductName} 2.2

This release of {SMProductName} adds new features and enhancements, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.2

|===
|Component |Version

|Istio
|1.12.7

|Envoy Proxy
|1.20.4

|Jaeger
|1.34.1

|Kiali
|1.48.0.16
|===

=== `WasmPlugin` API
This release adds support for the `WasmPlugin` API and deprecates the `ServiceMeshExtension` API.

=== ROSA support
This release introduces service mesh support for Red Hat OpenShift on AWS (ROSA), including multi-cluster federation.

=== `istio-node` DaemonSet renamed
This release, the `istio-node` DaemonSet is renamed to `istio-cni-node` to match the name in upstream Istio.

=== Envoy sidecar networking changes
Istio 1.10 updated Envoy to send traffic to the application container using `eth0` rather than `lo` by default.

=== Service Mesh Control Plane 1.1
This release marks the end of support for {SMProductShortName} Control Planes based on Service Mesh 1.1 for all platforms.

=== Istio 1.12 Support

{SMProductShortName} 2.2 is based on Istio 1.12, which brings in new features and product enhancements. While many Istio 1.12 features are supported, the following unsupported features should be noted:

* AuthPolicy Dry Run is a tech preview feature.
* gRPC Proxyless Service Mesh is a tech preview feature.
* Telemetry API is a tech preview feature.
* Discovery selectors is not a supported feature.
* External control plane is not a supported feature.
* Gateway injection is not a supported feature.

=== Kubernetes Gateway API
:FeatureName: Kubernetes Gateway API
// When including this file, ensure that {FeatureName} is set immediately before
// the include. Otherwise it will result in an incorrect replacement.

[IMPORTANT]
====
[subs="attributes+"]
{FeatureName} is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====
// Undefine {FeatureName} attribute, so that any mistakes are easily spotted
:!FeatureName:

Kubernetes Gateway API is a technology preview feature that is disabled by default. If the Kubernetes API deployment controller is disabled, you must manually deploy and link an ingress gateway to the created Gateway object.

If the Kubernetes API deployment controller is enabled, then an ingress gateway automatically deploys when a Gateway object is created.

==== Installing the Gateway API CRDs
The Gateway API CRDs do not come preinstalled by default on OpenShift clusters. Install the CRDs prior to enabling Gateway API support in the SMCP.

[source,terminal]
----
$ kubectl get crd gateways.gateway.networking.k8s.io || { kubectl kustomize "github.com/kubernetes-sigs/gateway-api/config/crd?ref=v0.4.0" | kubectl apply -f -; }
----

==== Enabling Kubernetes Gateway API
To enable the feature, set the following environment variables for the `Istiod` container in `ServiceMeshControlPlane`:

[source,yaml]
----
spec:
  runtime:
    components:
      pilot:
        container:
          env:
            PILOT_ENABLE_GATEWAY_API: "true"
            PILOT_ENABLE_GATEWAY_API_STATUS: "true"
            # and optionally, for the deployment controller
            PILOT_ENABLE_GATEWAY_API_DEPLOYMENT_CONTROLLER: "true"
----
Restricting route attachment on Gateway API listeners is possible using the `SameNamespace` or `All` settings. Istio ignores usage of label selectors in `listeners.allowedRoutes.namespaces` and reverts to the default behavior (`SameNamespace`).

==== Manually linking an existing gateway to a Gateway resource
If the Kubernetes API deployment controller is disabled, you must manually deploy and then link an ingress gateway to the created Gateway resource.

[source,yaml]
----
  apiVersion: gateway.networking.k8s.io/v1alpha2
  kind: Gateway
  metadata:
    name: gateway
  spec:
    addresses:
    - value: ingress.istio-gateways.svc.cluster.local
      type: Hostname
----

== New features {SMProductName} 2.1.6

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.1.6

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.5

|Jaeger
|1.36

|Kiali
|1.36.16
|===

== New features {SMProductName} 2.1.5.2

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), contains bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.1.5.2

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.5

|Jaeger
|1.36

|Kiali
|1.24.17
|===

== New features {SMProductName} 2.1.5.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.1.5.1

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.5

|Jaeger
|1.36

|Kiali
|1.36.13
|===

== New features {SMProductName} 2.1.5

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 and later versions.

=== Component versions included in {SMProductName} version 2.1.5

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.1

|Jaeger
|1.36

|Kiali
|1.36.12-1
|===

== New features {SMProductName} 2.1.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

=== Component versions included in {SMProductName} version 2.1.4

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.1

|Jaeger
|1.30.2

|Kiali
|1.36.12-1
|===

== New features {SMProductName} 2.1.3

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

=== Component versions included in {SMProductName} version 2.1.3

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.1

|Jaeger
|1.30.2

|Kiali
|1.36.10-2
|===

== New features {SMProductName} 2.1.2.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

=== Component versions included in {SMProductName} version 2.1.2.1

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.1

|Jaeger
|1.30.2

|Kiali
|1.36.9
|===

== New features {SMProductName} 2.1.2

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

With this release, the {JaegerName} Operator is now installed to the `openshift-distributed-tracing` namespace by default.  Previously the default installation had been in the `openshift-operator` namespace.

=== Component versions included in {SMProductName} version 2.1.2

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.1

|Jaeger
|1.30.1

|Kiali
|1.36.8
|===

== New features {SMProductName} 2.1.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

This release also adds the ability to disable the automatic creation of network policies.

=== Component versions included in {SMProductName} version 2.1.1

|===
|Component |Version

|Istio
|1.9.9

|Envoy Proxy
|1.17.1

|Jaeger
|1.24.1

|Kiali
|1.36.7
|===

[id="ossm-config-disable-networkpolicy_{context}"]
=== Disabling network policies

{SMProductName} automatically creates and manages a number of `NetworkPolicies` resources in the {SMProductShortName} control plane and application namespaces. This is to ensure that applications and the control plane can communicate with each other.

If you want to disable the automatic creation and management of `NetworkPolicies` resources, for example to enforce company security policies, you can do so.  You can edit the `ServiceMeshControlPlane` to set the `spec.security.manageNetworkPolicy` setting to `false`

[NOTE]
====
When you disable `spec.security.manageNetworkPolicy` {SMProductName} will not create *any* `NetworkPolicy` objects.  The system administrator is responsible for managing the network and fixing any issues this might cause.
====

.Procedure

. In the {product-title} web console, click *Operators* -> *Installed Operators*.

. Select the project where you installed the {SMProductShortName} control plane, for example `istio-system`, from the Project menu.

. Click the {SMProductName} Operator. In the *Istio Service Mesh Control Plane* column, click the name of your `ServiceMeshControlPlane`, for example `basic-install`.

. On the *Create ServiceMeshControlPlane Details* page, click `YAML` to modify your configuration.

. Set the `ServiceMeshControlPlane` field `spec.security.manageNetworkPolicy` to `false`, as shown in this example.
+
[source,yaml]
----
apiVersion: maistra.io/v2
kind: ServiceMeshControlPlane
spec:
  security:
      trust:
      manageNetworkPolicy: false
----
+
. Click *Save*.

== New features and enhancements {SMProductName} 2.1

This release of {SMProductName} adds support for Istio 1.9.8, Envoy Proxy 1.17.1, Jaeger 1.24.1, and Kiali 1.36.5 on {product-title} 4.6 EUS, 4.7, 4.8, 4.9, along with new features and enhancements.

=== Component versions included in {SMProductName} version 2.1

|===
|Component |Version

|Istio
|1.9.6

|Envoy Proxy
|1.17.1

|Jaeger
|1.24.1

|Kiali
|1.36.5
|===

=== Service Mesh Federation

New Custom Resource Definitions (CRDs) have been added to support federating service meshes. Service meshes may be federated both within the same cluster or across different OpenShift clusters. These new resources include:

* `ServiceMeshPeer` - Defines a federation with a separate service mesh, including gateway configuration, root trust certificate configuration, and status fields. In a pair of federated meshes, each mesh will define its own separate `ServiceMeshPeer` resource.

* `ExportedServiceMeshSet` - Defines which services for a given `ServiceMeshPeer` are available for the peer mesh to import.

* `ImportedServiceSet` - Defines which services for a given `ServiceMeshPeer` are imported from the peer mesh. These services must also be made available by the peer’s `ExportedServiceMeshSet` resource.

Service Mesh Federation is not supported between clusters on Red Hat OpenShift Service on AWS (ROSA), Azure Red Hat OpenShift (ARO), or OpenShift Dedicated (OSD).

=== OVN-Kubernetes Container Network Interface (CNI) generally available

The OVN-Kubernetes Container Network Interface (CNI) was previously introduced as a Technology Preview feature in {SMProductName} 2.0.1 and is now generally available in {SMProductName} 2.1 and 2.0.x for use on {product-title} 4.7.32, {product-title} 4.8.12, and {product-title} 4.9.

=== Service Mesh WebAssembly (WASM) Extensions

The `ServiceMeshExtensions` Custom Resource Definition (CRD), first introduced in 2.0 as Technology Preview, is now generally available. You can use CRD to build your own plugins, but Red Hat does not provide support for the plugins you create.

Mixer has been completely removed in Service Mesh 2.1. Upgrading from a Service Mesh 2.0.x release to 2.1 will be blocked if Mixer is enabled. Mixer plugins will need to be ported to WebAssembly Extensions.

=== 3scale WebAssembly Adapter (WASM)

With Mixer now officially removed, OpenShift Service Mesh 2.1 does not support the 3scale mixer adapter. Before upgrading to Service Mesh 2.1, remove the Mixer-based 3scale adapter and any additional Mixer plugins. Then, manually install and configure the new 3scale WebAssembly adapter with Service Mesh 2.1+ using a `ServiceMeshExtension` resource.

3scale 2.11 introduces an updated Service Mesh integration based on  `WebAssembly`.

=== Istio 1.9 Support

{SMProductShortName} 2.1 is based on Istio 1.9, which brings in a large number of new features and product enhancements. While the majority of Istio 1.9 features are supported, the following exceptions should be noted:

* Virtual Machine integration is not yet supported
* Kubernetes Gateway API is not yet supported
* Remote fetch and load of WebAssembly HTTP filters are not yet supported
* Custom CA Integration using the Kubernetes CSR API is not yet supported
* Request Classification for monitoring traffic is a tech preview feature
* Integration with external authorization systems via Authorization policy’s CUSTOM action is a tech preview feature

=== Improved Service Mesh operator performance

The amount of time {SMProductName} uses to prune old resources at the end of every `ServiceMeshControlPlane` reconciliation has been reduced. This results in faster `ServiceMeshControlPlane` deployments, and allows changes applied to existing SMCPs to take effect more quickly.


=== Kiali updates

Kiali 1.36 includes the following features and enhancements:

* {SMProductShortName} troubleshooting functionality
** Control plane and gateway monitoring
** Proxy sync statuses
** Envoy configuration views
** Unified view showing Envoy proxy and application logs interleaved
* Namespace and cluster boxing to support federated service mesh views
* New validations, wizards, and distributed tracing enhancements

== New features {SMProductName} 2.0.11.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 or later.

=== Component versions included in {SMProductName} version 2.0.11.1

|===
|Component |Version

|Istio
|1.6.14

|Envoy Proxy
|1.14.5

|Jaeger
|1.36

|Kiali
|1.24.17
|===

== New features {SMProductName} 2.0.11

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs), bug fixes, and is supported on {product-title} 4.9 or later.

=== Component versions included in {SMProductName} version 2.0.11

|===
|Component |Version

|Istio
|1.6.14

|Envoy Proxy
|1.14.5

|Jaeger
|1.36

|Kiali
|1.24.16-1
|===

== New features {SMProductName} 2.0.10

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

=== Component versions included in {SMProductName} version 2.0.10

|===
|Component |Version

|Istio
|1.6.14

|Envoy Proxy
|1.14.5

|Jaeger
|1.28.0

|Kiali
|1.24.16-1
|===

== New features {SMProductName} 2.0.9

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

=== Component versions included in {SMProductName} version 2.0.9

|===
|Component |Version

|Istio
|1.6.14

|Envoy Proxy
|1.14.5

|Jaeger
|1.24.1

|Kiali
|1.24.11
|===

== New features {SMProductName} 2.0.8

This release of {SMProductName} addresses bug fixes.

== New features {SMProductName} 2.0.7.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs).

=== Change in how {SMProductName} handles URI fragments

{SMProductName} contains a remotely exploitable vulnerability, link:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39156[CVE-2021-39156], where an HTTP request with a fragment (a section in the end of a URI that begins with a # character) in the URI path could bypass the Istio URI path-based authorization policies. For instance, an Istio authorization policy denies requests sent to the URI path `/user/profile`. In the vulnerable versions, a request with URI path `/user/profile#section1` bypasses the deny policy and routes to the backend (with the normalized URI `path /user/profile%23section1`), possibly leading to a security incident.

You are impacted by this vulnerability if you use authorization policies with DENY actions and `operation.paths`, or ALLOW actions and `operation.notPaths`.

With the mitigation, the fragment part of the request’s URI is removed before the authorization and routing. This prevents a request with a fragment in its URI from bypassing authorization policies which are based on the URI without the fragment part.

To opt-out from the new behavior in the mitigation, the fragment section in the URI will be kept. You can configure your `ServiceMeshControlPlane` to keep URI fragments.

[WARNING]
====
Disabling the new behavior will normalize your paths as described above and is considered unsafe. Ensure that you have accommodated for this in any security policies before opting to keep URI fragments.
====

.Example `ServiceMeshControlPlane` modification
[source,yaml]
----
apiVersion: maistra.io/v2
kind: ServiceMeshControlPlane
metadata:
  name: basic
spec:
  techPreview:
    meshConfig:
      defaultConfig:
        proxyMetadata: HTTP_STRIP_FRAGMENT_FROM_PATH_UNSAFE_IF_DISABLED: "false"
----

=== Required update for authorization policies

Istio generates hostnames for both the hostname itself and all matching ports. For instance, a virtual service or Gateway for a host of "httpbin.foo" generates a config matching "httpbin.foo and httpbin.foo:*". However, exact match authorization policies only match the exact string given for the `hosts` or `notHosts` fields.

Your cluster is impacted if you have `AuthorizationPolicy` resources using exact string comparison for the rule to determine link:https://istio.io/latest/docs/reference/config/security/authorization-policy/#Operation[hosts or notHosts].

You must update your authorization policy link:https://istio.io/latest/docs/reference/config/security/authorization-policy/#Rule[rules] to use prefix match instead of exact match.  For example, replacing `hosts: ["httpbin.com"]` with `hosts: ["httpbin.com:*"]` in the first `AuthorizationPolicy` example.

.First example AuthorizationPolicy using prefix match
[source,yaml]
----
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: httpbin
  namespace: foo
spec:
  action: DENY
  rules:
  - from:
    - source:
        namespaces: ["dev"]
    to:
    - operation:
        hosts: [“httpbin.com”,"httpbin.com:*"]
----

.Second example AuthorizationPolicy using prefix match
[source,yaml]
----
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: httpbin
  namespace: default
spec:
  action: DENY
  rules:
  - to:
    - operation:
        hosts: ["httpbin.example.com:*"]
----

== New features {SMProductName} 2.0.7

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

== {SMProductName} on {product-dedicated} and Microsoft Azure Red Hat OpenShift

{SMProductName} is now supported through {product-dedicated} and Microsoft Azure Red Hat OpenShift.

== New features {SMProductName} 2.0.6

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

== New features {SMProductName} 2.0.5

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

== New features {SMProductName} 2.0.4

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

[IMPORTANT]
====
There are manual steps that must be completed to address CVE-2021-29492 and CVE-2021-31920.
====

[id="manual-updates-cve-2021-29492_{context}"]
=== Manual updates required by CVE-2021-29492 and CVE-2021-31920

Istio contains a remotely exploitable vulnerability where an HTTP request path with multiple slashes or escaped slash characters (`%2F` or `%5C`) could potentially bypass an Istio authorization policy when path-based authorization rules are used.

For example, assume an Istio cluster administrator defines an authorization DENY policy to reject the request at path `/admin`. A request sent to the URL path `//admin` will NOT be rejected by the authorization policy.

According to https://tools.ietf.org/html/rfc3986#section-6[RFC 3986], the path `//admin` with multiple slashes should technically be treated as a different path from the `/admin`. However, some backend services choose to normalize the URL paths by merging multiple slashes into a single slash. This can result in a bypass of the authorization policy (`//admin` does not match `/admin`), and a user can access the resource at path `/admin` in the backend; this would represent a security incident.

Your cluster is impacted by this vulnerability if you have authorization policies using `ALLOW action + notPaths` field or `DENY action + paths field` patterns. These patterns are vulnerable to unexpected policy bypasses.

Your cluster is NOT impacted by this vulnerability if:

* You don’t have authorization policies.
* Your authorization policies don’t define `paths` or `notPaths` fields.
* Your authorization policies use `ALLOW action + paths` field or `DENY action + notPaths` field patterns. These patterns could only cause unexpected rejection instead of policy bypasses. The upgrade is optional for these cases.

[NOTE]
====
The {SMProductName} configuration location for path normalization is different from the Istio configuration.
====

=== Updating the path normalization configuration

Istio authorization policies can be based on the URL paths in the HTTP request.
https://en.wikipedia.org/wiki/URI_normalization[Path normalization], also known as URI normalization, modifies and standardizes the incoming requests' paths so that the normalized paths can be processed in a standard way.
Syntactically different paths may be equivalent after path normalization.

Istio supports the following normalization schemes on the request paths before evaluating against the authorization policies and routing the requests:

.Normalization schemes
[options="header"]
[cols="a, a, a, a"]
|====
| Option | Description | Example |Notes
|`NONE`
|No normalization is done. Anything received by Envoy will be forwarded exactly as-is to any backend service.
|`../%2Fa../b` is evaluated by the authorization policies and sent to your service.
|This setting is vulnerable to CVE-2021-31920.

|`BASE`
|This is currently the option used in the *default* installation of Istio. This applies the https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-normalize-path[`normalize_path`] option on Envoy proxies, which follows https://tools.ietf.org/html/rfc3986[RFC 3986] with extra normalization to convert backslashes to forward slashes.
|`/a/../b` is normalized to `/b`. `\da` is normalized to `/da`.
|This setting is vulnerable to CVE-2021-31920.

| `MERGE_SLASHES`
| Slashes are merged after the _BASE_ normalization.
| `/a//b` is normalized to `/a/b`.
|Update to this setting to mitigate CVE-2021-31920.

|`DECODE_AND_MERGE_SLASHES`
|The strictest setting when you allow all traffic by default. This setting is recommended, with the caveat that you must thoroughly test your authorization policies routes. https://tools.ietf.org/html/rfc3986#section-2.1[Percent-encoded] slash and backslash characters (`%2F`, `%2f`, `%5C` and `%5c`) are decoded to `/` or `\`, before the `MERGE_SLASHES` normalization.
|`/a%2fb` is normalized to `/a/b`.
|Update to this setting to mitigate CVE-2021-31920. This setting is more secure, but also has the potential to break applications. Test your applications before deploying to production.
|====

The normalization algorithms are conducted in the following order:

. Percent-decode `%2F`, `%2f`, `%5C` and `%5c`.
. The https://tools.ietf.org/html/rfc3986[RFC 3986] and other normalization implemented by the https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-normalize-path[`normalize_path`] option in Envoy.
. Merge slashes.

[WARNING]
====
While these normalization options represent recommendations from HTTP standards and common industry practices, applications may interpret a URL in any way it chooses to. When using denial policies, ensure that you understand how your application behaves.
====

=== Path normalization configuration examples

Ensuring Envoy normalizes request paths to match your backend services' expectations is critical to the security of your system.
The following examples can be used as a reference for you to configure your system.
The normalized URL paths, or the original URL paths if `NONE` is selected, will be:

. Used to check against the authorization policies.
. Forwarded to the backend application.

.Configuration examples
[options="header"]
[cols="a, a"]
|====
|If your application... |Choose...
|Relies on the proxy to do normalization
|`BASE`, `MERGE_SLASHES` or `DECODE_AND_MERGE_SLASHES`

|Normalizes request paths based on https://tools.ietf.org/html/rfc3986[RFC 3986] and does not merge slashes.
|`BASE`

|Normalizes request paths based on https://tools.ietf.org/html/rfc3986[RFC 3986] and merges slashes, but does not decode https://tools.ietf.org/html/rfc3986#section-2.1[percent-encoded] slashes.
|`MERGE_SLASHES`

|Normalizes request paths based on https://tools.ietf.org/html/rfc3986[RFC 3986], decodes https://tools.ietf.org/html/rfc3986#section-2.1[percent-encoded] slashes, and merges slashes.
|`DECODE_AND_MERGE_SLASHES`

|Processes request paths in a way that is incompatible with https://tools.ietf.org/html/rfc3986[RFC 3986].
|`NONE`
|====

=== Configuring your SMCP for path normalization

To configure path normalization for {SMProductName}, specify the following in your `ServiceMeshControlPlane`. Use the configuration examples to help determine the settings for your system.

.SMCP v2 pathNormalization
[source,yaml]
----
spec:
  techPreview:
    global:
      pathNormalization: <option>
----

=== Configuring for case normalization

In some environments, it may be useful to have paths in authorization policies compared in a case insensitive manner.
For example, treating `https://myurl/get` and `https://myurl/GeT` as equivalent.
In those cases, you can use the `EnvoyFilter` shown below.
This filter will change both the path used for comparison and the path presented to the application. In this example, `istio-system` is the name of the {SMProductShortName} control plane project.

Save the `EnvoyFilter` to a file and run the following command:

[source,terminal]
----
$ oc create -f <myEnvoyFilterFile>
----

[source,yaml]
----
apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  name: ingress-case-insensitive
  namespace: istio-system
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: "envoy.filters.network.http_connection_manager"
            subFilter:
              name: "envoy.filters.http.router"
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.lua
        typed_config:
            "@type": "type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua"
            inlineCode: |
              function envoy_on_request(request_handle)
                local path = request_handle:headers():get(":path")
                request_handle:headers():replace(":path", string.lower(path))
              end

----


== New features {SMProductName} 2.0.3

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

In addition, this release has the following new features:

* Added an option to the `must-gather` data collection tool that gathers information from a specified {SMProductShortName} control plane namespace. For more information, see link:https://issues.redhat.com/browse/OSSM-351[OSSM-351].
* Improved performance for {SMProductShortName} control planes with hundreds of namespaces

== New features {SMProductName} 2.0.2

This release of {SMProductName} adds support for IBM Z and IBM Power Systems. It also addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

== New features {SMProductName} 2.0.1

This release of {SMProductName} addresses Common Vulnerabilities and Exposures (CVEs) and bug fixes.

== New features {SMProductName} 2.0

This release of {SMProductName} adds support for Istio 1.6.5, Jaeger 1.20.0, Kiali 1.24.2, and the 3scale Istio Adapter 2.0 and {product-title} 4.6.

In addition, this release has the following new features:

** Simplifies installation, upgrades, and management of the {SMProductShortName} control plane.
** Reduces the {SMProductShortName} control plane's resource usage and startup time.
** Improves performance by reducing inter-control plane communication over networking.

* Adds support for Envoy's Secret Discovery Service (SDS). SDS is a more secure and efficient mechanism for delivering secrets to Envoy side car proxies.
** Removes the need to use Kubernetes Secrets, which have well known security risks.
** Improves performance during certificate rotation, as proxies no longer require a restart to recognize new certificates.

* Adds support for Istio's Telemetry v2 architecture, which is built using WebAssembly extensions. This new architecture brings significant performance improvements.

* Updates the ServiceMeshControlPlane resource to v2 with a streamlined configuration to make it easier to manage the {SMProductShortName} Control Plane.

* Introduces WebAssembly extensions as a link:https://access.redhat.com/support/offerings/techpreview[Technology Preview] feature.

:leveloffset!:

:leveloffset: +1

////
Module included in the following assemblies:
- v2x\servicemesh-release-notes.adoc
////

[id="ossm-rn-tech-preview_{context}"]
= Technology Preview

Some features in this release are currently in Technology Preview. These experimental features are not intended for production use.

[IMPORTANT]
====
Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see link:https://access.redhat.com/support/offerings/techpreview/[Technology Preview Features Support Scope].
====

:leveloffset!:

:leveloffset: +1

////
Module included in the following assemblies:
* service_mesh/v2x/servicemesh-release-notes.adoc
////

[id="ossm-deprecated-features_{context}"]
////
Description - Description of the any features (including technology previews) that have been removed from the product. Write the description from a customer perspective, what UI elements, commands, or options are no longer available.
Consequence or a recommended replacement - Description of what the customer can no longer do, and recommended replacement (if known).
////
= Deprecated and removed features
Some features available in previous releases have been deprecated or removed.

Deprecated functionality is still included in {product-title} and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments.

Removed functionality no longer exists in the product.

== Deprecated and removed features in {SMProductName} 2.4

The v2.1 `ServiceMeshControlPlane` resource is no longer supported. Customers should upgrade their mesh deployments to use a later version of the `ServiceMeshControlPlane` resource.

Support for Istio OpenShift Routing (IOR) is deprecated and will be removed in a future release.

Support for Grafana is deprecated and will be removed in a future release.

Support for the following cipher suites, which were deprecated in {SMProductName} 2.3, has been removed from the default list of ciphers used in TLS negotiations on both the client and server sides. Applications that require access to services requiring one of these cipher suites will fail to connect when a TLS connection is initiated from the proxy.

* ECDHE-ECDSA-AES128-SHA
* ECDHE-RSA-AES128-SHA
* AES128-GCM-SHA256
* AES128-SHA
* ECDHE-ECDSA-AES256-SHA
* ECDHE-RSA-AES256-SHA
* AES256-GCM-SHA384
* AES256-SHA

== Deprecated and removed features in {SMProductName} 2.3

Support for the following cipher suites has been deprecated. In a future release, they will be removed from the default list of ciphers used in TLS negotiations on both the client and server sides.

* ECDHE-ECDSA-AES128-SHA
* ECDHE-RSA-AES128-SHA
* AES128-GCM-SHA256
* AES128-SHA
* ECDHE-ECDSA-AES256-SHA
* ECDHE-RSA-AES256-SHA
* AES256-GCM-SHA384
* AES256-SHA

The `ServiceMeshExtension` API, which was deprecated in {SMProductName} version 2.2, was removed in {SMProductName} version 2.3. If you are using the `ServiceMeshExtension` API, you must migrate to the `WasmPlugin` API to continue using your WebAssembly extensions.

== Deprecated features in {SMProductName} 2.2

The `ServiceMeshExtension` API is deprecated as of release 2.2 and will be removed in a future release.  While `ServiceMeshExtension` API is still supported in release 2.2, customers should start moving to the new `WasmPlugin` API.

== Removed features in {SMProductName} 2.2

This release marks the end of support for {SMProductShortName} control planes based on Service Mesh 1.1 for all platforms.

== Removed features in {SMProductName} 2.1

In Service Mesh 2.1, the Mixer component is removed. Bug fixes and support is provided through the end of the Service Mesh 2.0 life cycle.

Upgrading from a Service Mesh 2.0.x release to 2.1 will not proceed if Mixer plugins are enabled. Mixer plugins must be ported to WebAssembly Extensions.

== Deprecated features in {SMProductName} 2.0

The Mixer component was deprecated in release 2.0 and will be removed in release 2.1. While using Mixer for implementing extensions was still supported in release 2.0, extensions should have been migrated to the new link:https://istio.io/latest/blog/2020/wasm-announce/[WebAssembly] mechanism.

The following resource types are no longer supported in {SMProductName} 2.0:

* `Policy` (authentication.istio.io/v1alpha1) is no longer supported. Depending on the specific configuration in your Policy resource, you may have to configure multiple resources to achieve the same effect.
** Use `RequestAuthentication` (security.istio.io/v1beta1)
** Use `PeerAuthentication` (security.istio.io/v1beta1)
* `ServiceMeshPolicy` (maistra.io/v1) is no longer supported.
** Use `RequestAuthentication` or `PeerAuthentication`, as mentioned above, but place in the {SMProductShortName} control plane namespace.
* `RbacConfig` (rbac.istio.io/v1alpha1) is no longer supported.
** Replaced by `AuthorizationPolicy` (security.istio.io/v1beta1), which encompasses behavior of `RbacConfig`, `ServiceRole`, and `ServiceRoleBinding`.
* `ServiceMeshRbacConfig` (maistra.io/v1) is no longer supported.
** Use `AuthorizationPolicy` as above, but place in {SMProductShortName} control plane namespace.
* `ServiceRole` (rbac.istio.io/v1alpha1) is no longer supported.
* `ServiceRoleBinding` (rbac.istio.io/v1alpha1) is no longer supported.
* In Kiali, the `login` and `LDAP` strategies are deprecated. A future version will introduce authentication using OpenID providers.

:leveloffset!:

:leveloffset: +1

////
Module included in the following assemblies:
* service_mesh/v2x/servicemesh-release-notes.adoc
////
:_mod-docs-content-type: REFERENCE
[id="ossm-rn-known-issues_{context}"]
= Known issues

////
*Consequence* - What user action or situation would make this problem appear (Selecting the Foo option with the Bar version 1.3 plugin enabled results in an error message)?  What did the customer experience as a result of the issue? What was the symptom?
*Cause* (if it has been identified) - Why did this happen?
*Workaround* (If there is one)- What can you do to avoid or negate the effects of this issue in the meantime?  Sometimes if there is no workaround it is worthwhile telling readers to contact support for advice. Never promise future fixes.
*Result* - If the workaround does not completely address the problem.
////

These limitations exist in {SMProductName}:

* {SMProductName} does not yet fully support link:https://issues.redhat.com/browse/MAISTRA-1314[IPv6]. As a result, {SMProductName} does not support dual-stack clusters.

* Graph layout - The layout for the Kiali graph can render differently, depending on your application architecture and the data to display (number of graph nodes and their interactions). Because it is difficult if not impossible to create a single layout that renders nicely for every situation, Kiali offers a choice of several different layouts. To choose a different layout, you can choose a different *Layout Schema* from the *Graph Settings* menu.

* The first time you access related services such as {JaegerShortName} and Grafana, from the Kiali console, you must accept the certificate and re-authenticate using your {product-title} login credentials. This happens due to an issue with how the framework displays embedded pages in the console.

* The Bookinfo sample application cannot be installed on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.

* WebAssembly extensions are not supported on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.

* LuaJIT is not supported on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.

* Single stack IPv6 support is not available on {ibmpowerProductName}, {ibmzProductName}, and {linuxoneProductName}.

[id="ossm-rn-known-issues-ossm_{context}"]
== {SMProductShortName} known issues

These are the known issues in {SMProductName}:

* https://issues.redhat.com/browse/OSSM-3890[OSSM-3890] Attempting to use the Gateway API in a multitenant mesh deployment generates an error message similar to the following:
+
[source,text]
----
2023-05-02T15:20:42.541034Z	error	watch error in cluster Kubernetes: failed to list *v1alpha2.TLSRoute: the server could not find the requested resource (get tlsroutes.gateway.networking.k8s.io)
2023-05-02T15:20:42.616450Z	info	kube	controller "gateway.networking.k8s.io/v1alpha2/TCPRoute" is syncing...
----
+
To support Gateway API in a multitenant mesh deployment, all Gateway API Custom Resource Definition (CRD) files must be present in the cluster.
+
In a multitenant mesh deployment, CRD scan is disabled, and Istio has no way to discover which CRDs are present in a cluster. As a result, Istio attempts to watch all supported Gateway API CRDs, but generates errors if some of those CRDs are not present.
+
{SMProductShortName} 2.3.1 and later versions support both `v1alpha2` and `v1beta1` CRDs. Therefore, both CRD versions must be present for a multitenant mesh deployment to support the Gateway API.
+
Workaround: In the following example, the `kubectl get` operation installs the `v1alpha2` and `v1beta1` CRDs. Note the URL contains the additional `experimental` segment and updates any of your existing scripts accordingly:
+
[source,terminal]
----
$ kubectl get crd gateways.gateway.networking.k8s.io ||   { kubectl kustomize "github.com/kubernetes-sigs/gateway-api/config/crd/experimental?ref=v0.5.1" | kubectl apply -f -; }
----

* https://issues.redhat.com/browse/OSSM-2042[OSSM-2042] Deployment of SMCP named `default` fails. If you are creating an SMCP object, and set its version field to v2.3, the name of the object cannot be `default`. If the name is `default`, then the control plane fails to deploy, and OpenShift generates a `Warning` event with the following message:
+
`Error processing component mesh-config: error: [mesh-config/templates/telemetryv2_1.6.yaml: Internal error occurred: failed calling webhook "rev.validation.istio.io": Post "https://istiod-default.istio-system.svc:443/validate?timeout=10s": x509: certificate is valid for istiod.istio-system.svc, istiod-remote.istio-system.svc, istio-pilot.istio-system.svc, not istiod-default.istio-system.svc, mesh-config/templates/enable-mesh-permissive.yaml`

//Keep OSSM-1655 in RN, closed as "explained" error is expected.
* https://issues.redhat.com/browse/OSSM-1655[OSSM-1655] Kiali dashboard shows error after enabling mTLS in `SMCP`.
+
After enabling the `spec.security.controlPlane.mtls` setting in the SMCP, the Kiali console displays the following error message `No subsets defined`.

* https://issues.redhat.com/browse/OSSM-1505[OSSM-1505] This issue only occurs when using the `ServiceMeshExtension` resource on OpenShift Container Platform 4.11. When you use `ServiceMeshExtension` on OpenShift Container Platform 4.11 the resource never becomes ready. If you inspect the issue using `oc describe ServiceMeshExtension` you will see the following error:  `stderr: Error creating mount namespace before pivot: function not implemented`.
+
Workaround: `ServiceMeshExtension` was deprecated in {SMProductShortName} 2.2. Migrate from `ServiceMeshExtension` to the `WasmPlugin` resource.
For more information, see Migrating from `ServiceMeshExtension` to `WasmPlugin` resources.

* https://issues.redhat.com/browse/OSSM-1396[OSSM-1396] If a gateway resource contains the `spec.externalIPs` setting, instead of being recreated when the `ServiceMeshControlPlane` is updated, the gateway is removed and never recreated.

* https://issues.redhat.com/browse/OSSM-1168[OSSM-1168] When service mesh resources are created as a single YAML file, the Envoy proxy sidecar is not reliably injected into pods. When the SMCP, SMMR, and Deployment resources are created individually, the deployment works as expected.
//Keep OSSM-1052 in RN - Closed as documented.

* https://issues.redhat.com/browse/OSSM-1115[OSSM-1115] The `concurrency` field of the `spec.proxy` API did not propagate to the istio-proxy. The `concurrency` field works when set with `ProxyConfig`. The `concurrency` field specifies the number of worker threads to run. If the field is set to `0`, then the number of worker threads available is equal to the number of CPU cores. If the field is not set, then the number of worker threads available defaults to `2`.
+
In the following example, the `concurrency` field is set to `0`.
+
[source,yaml]
----
apiVersion: networking.istio.io/v1beta1
kind: ProxyConfig
metadata:
  name: mesh-wide-concurrency
  namespace: <istiod-namespace>
spec:
  concurrency: 0
----

* https://issues.redhat.com/browse/OSSM-1052[OSSM-1052] When configuring a Service `ExternalIP` for the ingressgateway in the {SMProductShortName} control plane, the service is not created. The schema for the SMCP is missing the parameter for the service.
+
Workaround: Disable the gateway creation in the SMCP spec and manage the gateway deployment entirely manually (including Service, Role and RoleBinding).

//Keep OSSM-882 in RN to document the workaround
* https://issues.redhat.com/browse/OSSM-882[OSSM-882] This applies for {SMProductShortName} 2.1 and earlier. Namespace is in the accessible_namespace list but does not appear in Kiali UI. By default, Kiali will not show any namespaces that start with "kube" because these namespaces are typically internal-use only and not part of a mesh.
+
For example, if you create a namespace called 'akube-a' and add it to the Service Mesh member roll, then the Kiali UI does not display the namespace. For defined exclusion patterns, the software excludes namespaces that start with or contain the pattern.
+
Workaround: Change the Kiali Custom Resource setting so it prefixes the setting with a carat (^). For example:
+
[source,yaml]
----
api:
  namespaces:
    exclude:
    - "^istio-operator"
    - "^kube-.*"
    - "^openshift.*"
    - "^ibm.*"
    - "^kiali-operator"
----

+
* link:https://issues.redhat.com/browse/MAISTRA-2692[MAISTRA-2692] With Mixer removed, custom metrics that have been defined in {SMProductShortName} 2.0.x cannot be used in 2.1. Custom metrics can be configured using `EnvoyFilter`. Red Hat is unable to support `EnvoyFilter` configuration except where explicitly documented. This is due to tight coupling with the underlying Envoy APIs, meaning that backward compatibility cannot be maintained.

* link:https://issues.redhat.com/browse/MAISTRA-2648[MAISTRA-2648] Service mesh extensions are currently not compatible with meshes deployed on {ibmzProductName}.

* link:https://issues.jboss.org/browse/MAISTRA-1959[MAISTRA-1959] _Migration to 2.0_ Prometheus scraping (`spec.addons.prometheus.scrape` set to `true`) does not work when mTLS is enabled. Additionally, Kiali displays extraneous graph data when mTLS is disabled.
+
This problem can be addressed by excluding port 15020 from proxy configuration, for example,
+
[source,yaml]
----
spec:
  proxy:
    networking:
      trafficControl:
        inbound:
          excludedPorts:
          - 15020
----

* link:https://issues.jboss.org/browse/MAISTRA-453[MAISTRA-453] If you create a new project and deploy pods immediately, sidecar injection does not occur. The operator fails to add the `maistra.io/member-of` before the pods are created, therefore the pods must be deleted and recreated for sidecar injection to occur.

* link:https://issues.jboss.org/browse/MAISTRA-158[MAISTRA-158] Applying multiple gateways referencing the same hostname will cause all gateways to stop functioning.

[id="ossm-rn-known-issues-kiali_{context}"]
== Kiali known issues

[NOTE]
====
New issues for Kiali should be created in the link:https://issues.redhat.com/projects/OSSM/[OpenShift Service Mesh] project with the `Component` set to `Kiali`.
====

These are the known issues in Kiali:

//Keep KIALI-2206 in RN as this is for information purposes.
* link:https://issues.jboss.org/browse/KIALI-2206[KIALI-2206] When you are accessing the Kiali console for the first time, and there is no cached browser data for Kiali, the “View in Grafana” link on the Metrics tab of the Kiali Service Details page redirects to the wrong location. The only way you would encounter this issue is if you are accessing Kiali for the first time.
//Keep KIALI-507 in RN as this is for information purposes.
* link:https://github.com/kiali/kiali/issues/507[KIALI-507] Kiali does not support Internet Explorer 11. This is because the underlying frameworks do not support Internet Explorer. To access the Kiali console, use one of the two most recent versions of the Chrome, Edge, Firefox or Safari browser.

:leveloffset!:

:leveloffset: +1

////
Module included in the following assemblies:
* service_mesh/v2x/servicemesh-release-notes.adoc
////
:_mod-docs-content-type: REFERENCE
[id="ossm-rn-fixed-issues_{context}"]
= Fixed issues

////
Provide the following info for each issue if possible:
*Consequence* - What user action or situation would make this problem appear (If you have the foo option enabled and did x)? What did the customer experience as a result of the issue? What was the symptom?
*Cause* - Why did this happen?
*Fix* - What did we change to fix the problem?
*Result* - How has the behavior changed as a result? Try to avoid “It is fixed” or “The issue is resolved” or “The error no longer presents”.
////

The following issues have been resolved in the current release:

* https://issues.redhat.com/browse/OSSM-4851[OSSM-4851] Previously, an error occurred in the operator deploying new pods in a namespace scoped inside the mesh when `runAsGroup`, `runAsUser`, or `fsGroup` parameters were `nil`. Now, a yaml validation has been added to avoid the `nil` value.

* https://issues.redhat.com/browse/OSSM-3771[OSSM-3771] Previously, OpenShift routes could not be disabled for additional ingress gateways defined in a Service Mesh Control Plane (SMCP). Now, a `routeConfig` block can be added to each `additionalIngress` gateway so the creation of OpenShift routes can be enabled or disabled for each gateway.

The following issues have been resolved in previous releases:

[id="ossm-rn-fixed-issues-ossm_{context}"]
== {SMProductShortName} fixed issues

* https://issues.redhat.com/browse/OSSM-4197[OSSM-4197] Previously, if you deployed a v2.2 or v2.1 of the 'ServiceMeshControlPlane' resource, the `/etc/cni/multus/net.d/` directory was not created. As a result, the `istio-cni` pod failed to become ready, and the `istio-cni` pods log contained the following message:
+
[source,terminal]
----
$ error   Installer exits with open /host/etc/cni/multus/net.d/v2-2-istio-cni.kubeconfig.tmp.841118073: no such file or directory
----
+
Now, if you deploy a v2.2 or v2.1 of the 'ServiceMeshControlPlane' resource, the `/etc/cni/multus/net.d/` directory is created, and the `istio-cni` pod becomes ready.

* https://issues.redhat.com/browse/OSSM-3993[OSSM-3993] Previously, Kiali only supported OpenShift OAuth via a proxy on the standard HTTPS port of `443`. Now, Kiali supports OpenShift OAuth over a non-standard HTTPS port. To enable the port, you must set the `spec.server.web_port` field to the proxy's non-standard HTTPS port in the Kiali CR.

* https://issues.redhat.com/browse/OSSM-3936[OSSM-3936] Previously, the values for the `injection_label_rev` and `injection_label_name` attributes were hardcoded. This prevented custom configurations from taking effect in the Kiali Custom Resource Definition (CRD). Now, the attribute values are not hardcoded. You can customize the values for the `injection_label_rev` and `injection_label_name` attributes in the `spec.istio_labels` specification.

* https://issues.redhat.com/browse/OSSM-3644[OSSM-3644] Previously, the federation egress-gateway received the wrong update of network gateway endpoints, causing extra endpoint entries. Now, the federation-egress gateway has been updated on the server side so it receives the correct network gateway endpoints.

* https://issues.redhat.com/browse/OSSM-3595[OSSM-3595] Previously, the `istio-cni` plugin sometimes failed on {op-system-base} because SELinux did not allow the utility `iptables-restore` to open files in the `/tmp` directory. Now, SELinux passes `iptables-restore` via `stdin` input stream instead of via a file.

* https://issues.redhat.com/browse/OSSM-3586[OSSM-3586] Previously, Istio proxies were slow to start when Google Cloud Platform (GCP) metadata servers were not available. When you upgrade to Istio 1.14.6, Istio proxies start as expected on GCP, even if metadata servers are not available.

* https://issues.redhat.com/browse/OSSM-3025[OSSM-3025] Istiod sometimes fails to become ready. Sometimes, when a mesh contained many member namespaces, the Istiod pod did not become ready due to a deadlock within Istiod. The deadlock is now resolved and the pod now starts as expected.

* https://issues.redhat.com/browse/OSSM-2493[OSSM-2493] Default `nodeSelector` and `tolerations` in SMCP not passed to Kiali. The `nodeSelector` and `tolerations` you add to `SMCP.spec.runtime.defaults` are now passed to the Kiali resource.

* https://issues.redhat.com/browse/OSSM-2492[OSSM-2492] Default tolerations in SMCP not passed to Jaeger. The `nodeSelector` and `tolerations` you add to `SMCP.spec.runtime.defaults` are now passed to the Jaeger resource.

* https://issues.redhat.com/browse/OSSM-2374[OSSM-2374] If you deleted one of the `ServiceMeshMember` resources, then the Service Mesh operator deleted the `ServiceMeshMemberRoll`. While this is expected behavior when you delete the last `ServiceMeshMember`, the operator should not delete the `ServiceMeshMemberRoll` if it contains any members in addition to the one that was deleted. This issue is now fixed and the operator only deletes the ServiceMeshMemberRoll when the last `ServiceMeshMember` resource is deleted.

* https://issues.redhat.com/browse/OSSM-2373[OSSM-2373] Error trying to get OAuth metadata when logging in. To fetch the cluster version, the `system:anonymous` account is used. With the cluster's default bundled ClusterRoles and ClusterRoleBinding, the anonymous account can fetch the version correctly. If the `system:anonymous` account loses its privileges to fetch the cluster version, OpenShift authentication becomes unusable.
+
This is fixed by using the Kiali SA to fetch the cluster version. This also allows for improved security on the cluster.

* https://issues.redhat.com/browse/OSSM-2371[OSSM-2371] Despite Kiali being configured as "view-only," a user can change the proxy logging level via the Workload details' Logs tab's kebab menu. This issue has been fixed so the options under "Set Proxy Log Level" are disabled when Kiali is configured as "view-only."

* https://issues.redhat.com/browse/OSSM-2344[OSSM-2344] Restarting Istiod causes Kiali to flood CRI-O with port-forward requests. This issue occurred when Kiali could not connect to Istiod and Kiali simultaneously issued a large number of requests to istiod. Kiali now limits the number of requests it sends to istiod.

* https://issues.redhat.com/browse/OSSM-2335[OSSM-2335] Dragging the mouse pointer over the Traces scatterchart plot sometimes caused the Kiali console to stop responding due to concurrent backend requests.

* https://issues.redhat.com/browse/OSSM-2221[OSSM-2221] Previously, gateway injection in the `ServiceMeshControlPlane` namespace was not possible because the `ignore-namespace` label was applied to the namespace by default.
+
When creating a v2.4 control plane, the namespace no longer has the `ignore-namespace` label applied, and gateway injection is possible.
+
In the following example, the `oc label` command removes the `ignore-namespace` label from a namespace in an existing deployment:
+
[source,terminal]
----
$ oc label namespace <istio_system> maistra.io/ignore-namespace-
----
+
In the example above, <istio_system> represents the name of the `ServiceMeshControlPlane` namespace.

* https://issues.redhat.com/browse/OSSM-2053[OSSM-2053] Using {SMProductName} Operator 2.2 or 2.3, during SMCP reconciliation, the SMMR controller removed the member namespaces from `SMMR.status.configuredMembers`. This caused the services in the member namespaces to become unavailable for a few moments.
+
Using {SMProductName} Operator 2.2 or 2.3, the SMMR controller no longer removes the namespaces from `SMMR.status.configuredMembers`. Instead, the controller adds the namespaces to `SMMR.status.pendingMembers` to indicate that they are not up-to-date. During reconciliation, as each namespace synchronizes with the SMCP, the namespace is automatically removed from `SMMR.status.pendingMembers`.

* https://issues.redhat.com/browse/OSSM-1962[OSSM-1962] Use `EndpointSlices` in federation controller. The federation controller now uses `EndpointSlices`, which improves scalability and performance in large deployments. The PILOT_USE_ENDPOINT_SLICE flag is enabled by default. Disabling the flag prevents use of federation deployments.

* https://issues.redhat.com/browse/OSSM-1668[OSSM-1668] A new field `spec.security.jwksResolverCA` was added to the Version 2.1 `SMCP` but was missing in the 2.2.0 and 2.2.1 releases. When upgrading from an Operator version where this field was present to an Operator version that was missing this field, the `.spec.security.jwksResolverCA` field was not available in the `SMCP`.

* https://issues.redhat.com/browse/OSSM-1325[OSSM-1325] istiod pod crashes and displays the following error message: `fatal error: concurrent map iteration and map write`.

* https://issues.redhat.com/browse/OSSM-1211[OSSM-1211]
Configuring Federated service meshes for failover does not work as expected.
+
The Istiod pilot log displays the following error: `envoy connection [C289] TLS error: 337047686:SSL routines:tls_process_server_certificate:certificate verify failed`

* https://issues.redhat.com/browse/OSSM-1099[OSSM-1099]
The Kiali console displayed the message `Sorry, there was a problem. Try a refresh or navigate to a different page.`

* https://issues.redhat.com/browse/OSSM-1074[OSSM-1074]
Pod annotations defined in SMCP are not injected in the pods.

* https://issues.redhat.com/browse/OSSM-999[OSSM-999]
Kiali retention did not work as expected. Calendar times were greyed out in the dashboard graph.

* link:https://issues.redhat.com/browse/OSSM-797[OSSM-797] Kiali Operator pod generates `CreateContainerConfigError` while installing or updating the operator.

* https://issues.redhat.com/browse/OSSM-722[OSSM-722]
Namespace starting with `kube` is hidden from Kiali.

* link:https://issues.redhat.com/browse/OSSM-569[OSSM-569] There is no CPU memory limit for the Prometheus `istio-proxy` container. The Prometheus `istio-proxy` sidecar now uses the resource limits defined in `spec.proxy.runtime.container`.

* link:https://issues.redhat.com/browse/OSSM-535[OSSM-535] Support validationMessages in SMCP. The `ValidationMessages` field in the Service Mesh Control Plane can now be set to `True`. This writes a log for the status of the resources, which can be helpful when troubleshooting problems.

* link:https://issues.redhat.com/browse/OSSM-449[OSSM-449] VirtualService and Service causes an error "Only unique values for domains are permitted. Duplicate entry of domain."

* link:https://issues.redhat.com/browse/OSSM-419[OSSM-419] Namespaces with similar names will all show in Kiali namespace list, even though namespaces may not be defined in Service Mesh Member Role.

* link:https://issues.redhat.com/browse/OSSM-296[OSSM-296] When adding health configuration to the Kiali custom resource (CR) is it not being replicated to the Kiali configmap.

* link:https://issues.redhat.com/browse/OSSM-291[OSSM-291] In the Kiali console, on the Applications, Services, and Workloads pages, the "Remove Label from Filters" function is not working.

* link:https://issues.redhat.com/browse/OSSM-289[OSSM-289] In the Kiali console, on the Service Details pages for the 'istio-ingressgateway' and 'jaeger-query' services there are no Traces being displayed. The traces exist in Jaeger.

* link:https://issues.redhat.com/browse/OSSM-287[OSSM-287] In the Kiali console there are no traces being displayed on the Graph Service.

* link:https://issues.redhat.com/browse/OSSM-285[OSSM-285] When trying to access the Kiali console, receive the following error message "Error trying to get OAuth Metadata".
+
Workaround: Restart the Kiali pod.

* link:https://issues.redhat.com/browse/MAISTRA-2735[MAISTRA-2735] The resources that the Service Mesh Operator deletes when reconciling the SMCP changed in {SMProductName} version 2.1. Previously, the Operator deleted a resource with the following labels:

** `maistra.io/owner`
** `app.kubernetes.io/version`

+
Now, the Operator ignores resources that does not also include the `app.kubernetes.io/managed-by=maistra-istio-operator` label. If you create your own resources, you should not add the `app.kubernetes.io/managed-by=maistra-istio-operator` label to them.


* link:https://issues.jboss.org/browse/MAISTRA-2687[MAISTRA-2687] {SMProductName} 2.1 federation gateway does not send the full certificate chain when using external certificates. The {SMProductShortName} federation egress gateway only sends the client certificate. Because the federation ingress gateway only knows about the root certificate, it cannot verify the client certificate unless you add the root certificate to the federation import `ConfigMap`.

* link:https://issues.redhat.com/browse/MAISTRA-2635[MAISTRA-2635] Replace deprecated Kubernetes API. To remain compatible with {product-title} 4.8, the `apiextensions.k8s.io/v1beta1` API was deprecated as of {SMProductName} 2.0.8.

* link:https://issues.redhat.com/browse/MAISTRA-2631[MAISTRA-2631] The WASM feature is not working because podman is failing due to nsenter binary not being present. {SMProductName} generates the following error message: `Error: error configuring CNI network plugin exec: "nsenter": executable file not found in $PATH`. The container image now contains nsenter and WASM works as expected.

* link:https://issues.redhat.com/browse/MAISTRA-2534[MAISTRA-2534] When istiod attempted to fetch the JWKS for an issuer specified in a JWT rule, the issuer service responded with a 502.  This prevented the proxy container from becoming ready and caused deployments to hang. The fix for the link:https://github.com/istio/istio/issues/24629[community bug] has been included in the  {SMProductShortName} 2.0.7 release.

* link:https://issues.jboss.org/browse/MAISTRA-2411[MAISTRA-2411] When the Operator creates a new ingress gateway using `spec.gateways.additionaIngress` in the `ServiceMeshControlPlane`, Operator is not creating a `NetworkPolicy` for the additional ingress gateway like it does for the default istio-ingressgateway. This is causing a 503 response from the route of the new gateway.
+
Workaround: Manually create the `NetworkPolicy` in the <istio-system> namespace.

* link:https://issues.redhat.com/browse/MAISTRA-2401[MAISTRA-2401] CVE-2021-3586 servicemesh-operator: NetworkPolicy resources incorrectly specified ports for ingress resources. The NetworkPolicy resources installed for {SMProductName} did not properly specify which ports could be accessed. This allowed access to all ports on these resources from any pod. Network policies applied to the following resources are affected:

** Galley
** Grafana
** Istiod
** Jaeger
** Kiali
** Prometheus
** Sidecar injector

* link:https://issues.redhat.com/browse/MAISTRA-2378[MAISTRA-2378] When the cluster is configured to use OpenShift SDN with `ovs-multitenant` and the mesh contains a large number of namespaces (200+), the {product-title} networking plugin is unable to configure the namespaces quickly. {SMProductShortName} times out causing namespaces to be continuously dropped from the service mesh and then reenlisted.

* link:https://issues.redhat.com/browse/MAISTRA-2370[MAISTRA-2370] Handle tombstones in listerInformer. The updated cache codebase was not handling tombstones when translating the events from the namespace caches to the aggregated cache, leading to a panic in the go routine.

* link:https://issues.redhat.com/browse/MAISTRA-2117[MAISTRA-2117] Add optional `ConfigMap` mount to operator. The CSV now contains an optional `ConfigMap` volume mount, which mounts the `smcp-templates` `ConfigMap` if it exists. If the `smcp-templates` `ConfigMap` does not exist, the mounted directory is empty. When you create the `ConfigMap`, the directory is populated with the entries from the `ConfigMap` and can be referenced in `SMCP.spec.profiles`. No restart of the Service Mesh operator is required.
+
Customers using the 2.0 operator with a modified CSV to mount the smcp-templates ConfigMap can upgrade to {SMProductName} 2.1. After upgrading, you can continue using an existing ConfigMap, and the profiles it contains, without editing the CSV. Customers that previously used ConfigMap with a different name will either have to rename the ConfigMap or update the CSV after upgrading.

* link:https://issues.redhat.com/browse/MAISTRA-2010[MAISTRA-2010] AuthorizationPolicy does not support `request.regex.headers` field. The `validatingwebhook` rejects any AuthorizationPolicy with the field, and even if you disable that, Pilot tries to validate it using the same code, and it does not work.

* link:https://issues.jboss.org/browse/MAISTRA-1979[MAISTRA-1979] _Migration to 2.0_ The conversion webhook drops the following important fields when converting `SMCP.status` from v2 to v1:

** conditions
** components
** observedGeneration
** annotations
+
Upgrading the operator to 2.0 might break client tools that read the SMCP status using the maistra.io/v1 version of the resource.
+
This also causes the READY and STATUS columns to be empty when you run `oc get servicemeshcontrolplanes.v1.maistra.io`.

* link:https://issues.jboss.org/browse/MAISTRA-1947[MAISTRA-1947] _Technology Preview_ Updates to ServiceMeshExtensions are not applied.
+
Workaround: Remove and recreate the `ServiceMeshExtensions`.

* link:https://issues.redhat.com/browse/MAISTRA-1983[MAISTRA-1983] _Migration to 2.0_ Upgrading to 2.0.0 with an existing invalid `ServiceMeshControlPlane` cannot easily be repaired. The invalid items in the `ServiceMeshControlPlane` resource caused an unrecoverable error. The fix makes the errors recoverable. You can delete the invalid resource and replace it with a new one or edit the resource to fix the errors. For more information about editing your resource, see [Configuring the Red Hat OpenShift Service Mesh installation].

* link:https://issues.redhat.com/browse/MAISTRA-1502[MAISTRA-1502] As a result of CVEs fixes in version 1.0.10, the Istio dashboards are not available from the *Home Dashboard* menu in Grafana. To access the Istio dashboards, click the *Dashboard* menu in the navigation panel and select the *Manage* tab.

* link:https://issues.redhat.com/browse/MAISTRA-1399[MAISTRA-1399] {SMProductName} no longer prevents you from installing unsupported CNI protocols. The supported network configurations has not changed.

* link:https://issues.jboss.org/browse/MAISTRA-1089[MAISTRA-1089] _Migration to 2.0_ Gateways created in a non-control plane namespace are automatically deleted. After removing the gateway definition from the SMCP spec, you need to manually delete these resources.

* link:https://issues.jboss.org/browse/MAISTRA-858[MAISTRA-858] The following Envoy log messages describing link:https://www.envoyproxy.io/docs/envoy/latest/intro/deprecated[deprecated options and configurations associated with Istio 1.1.x] are expected:
+
** [2019-06-03 07:03:28.943][19][warning][misc] [external/envoy/source/common/protobuf/utility.cc:129] Using deprecated option 'envoy.api.v2.listener.Filter.config'. This configuration will be removed from Envoy soon.
** [2019-08-12 22:12:59.001][13][warning][misc] [external/envoy/source/common/protobuf/utility.cc:174] Using deprecated option 'envoy.api.v2.Listener.use_original_dst' from file lds.proto. This configuration will be removed from Envoy soon.

* link:https://issues.jboss.org/browse/MAISTRA-806[MAISTRA-806] Evicted Istio Operator Pod causes mesh and CNI not to deploy.
+
Workaround: If the `istio-operator` pod is evicted while deploying the control pane, delete the evicted `istio-operator` pod.

* link:https://issues.jboss.org/browse/MAISTRA-681[MAISTRA-681] When the {SMProductShortName} control plane has many namespaces, it can lead to performance issues.

* link:https://issues.jboss.org/browse/MAISTRA-193[MAISTRA-193] Unexpected console info messages are visible when health checking is enabled for citadel.

* link:https://bugzilla.redhat.com/show_bug.cgi?id=1821432[Bugzilla 1821432] The toggle controls in {product-title} Custom Resource details page does not update the CR correctly. UI Toggle controls in the {SMProductShortName} Control Plane (SMCP) Overview page in the {product-title} web console sometimes updates the wrong field in the resource. To update a SMCP, edit the YAML content directly or update the resource from the command line instead of clicking the toggle controls.

:leveloffset!:

//# includes=_attributes/common-attributes,modules/making-open-source-more-inclusive,modules/ossm-rn-new-features,modules/snippets/technology-preview,modules/ossm-rn-technology-preview,modules/ossm-rn-deprecated-features,modules/ossm-rn-known-issues,modules/ossm-rn-fixed-issues
