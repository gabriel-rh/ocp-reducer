:_mod-docs-content-type: ASSEMBLY
[id="installing-mirroring-creating-registry"]
= Creating a mirror registry with mirror registry for Red Hat OpenShift
// The {product-title} attribute provides the context-sensitive name of the relevant OpenShift distribution, for example, "OpenShift Container Platform" or "OKD". The {product-version} attribute provides the product version relative to the distribution, for example "4.9".
// {product-title} and {product-version} are parsed when AsciiBinder queries the _distro_map.yml file in relation to the base branch of a pull request.
// See https://github.com/openshift/openshift-docs/blob/main/contributing_to_docs/doc_guidelines.adoc#product-name-and-version for more information on this topic.
// Other common attributes are defined in the following lines:
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:imagesdir: images
:prewrap!:
:op-system-first: Red Hat Enterprise Linux CoreOS (RHCOS)
:op-system: RHCOS
:op-system-lowercase: rhcos
:op-system-base: RHEL
:op-system-base-full: Red Hat Enterprise Linux (RHEL)
:op-system-version: 8.x
:tsb-name: Template Service Broker
:kebab: image:kebab.png[title="Options menu"]
:rh-openstack-first: Red Hat OpenStack Platform (RHOSP)
:rh-openstack: RHOSP
:ai-full: Assisted Installer
:ai-version: 2.3
:cluster-manager-first: Red Hat OpenShift Cluster Manager
:cluster-manager: OpenShift Cluster Manager
:cluster-manager-url: link:https://console.redhat.com/openshift[OpenShift Cluster Manager Hybrid Cloud Console]
:cluster-manager-url-pull: link:https://console.redhat.com/openshift/install/pull-secret[pull secret from the Red Hat OpenShift Cluster Manager]
:insights-advisor-url: link:https://console.redhat.com/openshift/insights/advisor/[Insights Advisor]
:hybrid-console: Red Hat Hybrid Cloud Console
:hybrid-console-second: Hybrid Cloud Console
:oadp-first: OpenShift API for Data Protection (OADP)
:oadp-full: OpenShift API for Data Protection
:oc-first: pass:quotes[OpenShift CLI (`oc`)]
:product-registry: OpenShift image registry
:rh-storage-first: Red Hat OpenShift Data Foundation
:rh-storage: OpenShift Data Foundation
:rh-rhacm-first: Red Hat Advanced Cluster Management (RHACM)
:rh-rhacm: RHACM
:rh-rhacm-version: 2.8
:sandboxed-containers-first: OpenShift sandboxed containers
:sandboxed-containers-operator: OpenShift sandboxed containers Operator
:sandboxed-containers-version: 1.3
:sandboxed-containers-version-z: 1.3.3
:sandboxed-containers-legacy-version: 1.3.2
:cert-manager-operator: cert-manager Operator for Red Hat OpenShift
:secondary-scheduler-operator-full: Secondary Scheduler Operator for Red Hat OpenShift
:secondary-scheduler-operator: Secondary Scheduler Operator
// Backup and restore
:velero-domain: velero.io
:velero-version: 1.11
:launch: image:app-launcher.png[title="Application Launcher"]
:mtc-short: MTC
:mtc-full: Migration Toolkit for Containers
:mtc-version: 1.8
:mtc-version-z: 1.8.0
// builds (Valid only in 4.11 and later)
:builds-v2title: Builds for Red Hat OpenShift
:builds-v2shortname: OpenShift Builds v2
:builds-v1shortname: OpenShift Builds v1
//gitops
:gitops-title: Red Hat OpenShift GitOps
:gitops-shortname: GitOps
:gitops-ver: 1.1
:rh-app-icon: image:red-hat-applications-menu-icon.jpg[title="Red Hat applications"]
//pipelines
:pipelines-title: Red Hat OpenShift Pipelines
:pipelines-shortname: OpenShift Pipelines
:pipelines-ver: pipelines-1.12
:pipelines-version-number: 1.12
:tekton-chains: Tekton Chains
:tekton-hub: Tekton Hub
:artifact-hub: Artifact Hub
:pac: Pipelines as Code
//odo
:odo-title: odo
//OpenShift Kubernetes Engine
:oke: OpenShift Kubernetes Engine
//OpenShift Platform Plus
:opp: OpenShift Platform Plus
//openshift virtualization (cnv)
:VirtProductName: OpenShift Virtualization
:VirtVersion: 4.14
:KubeVirtVersion: v0.59.0
:HCOVersion: 4.14.0
:CNVNamespace: openshift-cnv
:CNVOperatorDisplayName: OpenShift Virtualization Operator
:CNVSubscriptionSpecSource: redhat-operators
:CNVSubscriptionSpecName: kubevirt-hyperconverged
:delete: image:delete.png[title="Delete"]
//distributed tracing
:DTProductName: Red Hat OpenShift distributed tracing platform
:DTShortName: distributed tracing platform
:DTProductVersion: 2.9
:JaegerName: Red Hat OpenShift distributed tracing platform (Jaeger)
:JaegerShortName: distributed tracing platform (Jaeger)
:JaegerVersion: 1.47.0
:OTELName: Red Hat OpenShift distributed tracing data collection
:OTELShortName: distributed tracing data collection
:OTELOperator: Red Hat OpenShift distributed tracing data collection Operator
:OTELVersion: 0.81.0
:TempoName: Red Hat OpenShift distributed tracing platform (Tempo)
:TempoShortName: distributed tracing platform (Tempo)
:TempoOperator: Tempo Operator
:TempoVersion: 2.1.1
//logging
:logging-title: logging subsystem for Red Hat OpenShift
:logging-title-uc: Logging subsystem for Red Hat OpenShift
:logging: logging subsystem
:logging-uc: Logging subsystem
//serverless
:ServerlessProductName: OpenShift Serverless
:ServerlessProductShortName: Serverless
:ServerlessOperatorName: OpenShift Serverless Operator
:FunctionsProductName: OpenShift Serverless Functions
//service mesh v2
:product-dedicated: Red Hat OpenShift Dedicated
:product-rosa: Red Hat OpenShift Service on AWS
:SMProductName: Red Hat OpenShift Service Mesh
:SMProductShortName: Service Mesh
:SMProductVersion: 2.4.4
:MaistraVersion: 2.4
//Service Mesh v1
:SMProductVersion1x: 1.1.18.2
//Windows containers
:productwinc: Red Hat OpenShift support for Windows Containers
// Red Hat Quay Container Security Operator
:rhq-cso: Red Hat Quay Container Security Operator
// Red Hat Quay
:quay: Red Hat Quay
:sno: single-node OpenShift
:sno-caps: Single-node OpenShift
//TALO and Redfish events Operators
:cgu-operator-first: Topology Aware Lifecycle Manager (TALM)
:cgu-operator-full: Topology Aware Lifecycle Manager
:cgu-operator: TALM
:redfish-operator: Bare Metal Event Relay
//Formerly known as CodeReady Containers and CodeReady Workspaces
:openshift-local-productname: Red Hat OpenShift Local
:openshift-dev-spaces-productname: Red Hat OpenShift Dev Spaces
// Factory-precaching-cli tool
:factory-prestaging-tool: factory-precaching-cli tool
:factory-prestaging-tool-caps: Factory-precaching-cli tool
:openshift-networking: Red Hat OpenShift Networking
// TODO - this probably needs to be different for OKD
//ifdef::openshift-origin[]
//:openshift-networking: OKD Networking
//endif::[]
// logical volume manager storage
:lvms-first: Logical volume manager storage (LVM Storage)
:lvms: LVM Storage
//Operator SDK version
:osdk_ver: 1.31.0
//Operator SDK version that shipped with the previous OCP 4.x release
:osdk_ver_n1: 1.28.0
//Next-gen (OCP 4.14+) Operator Lifecycle Manager, aka "v1"
:olmv1: OLM 1.0
:olmv1-first: Operator Lifecycle Manager (OLM) 1.0
:ztp-first: GitOps Zero Touch Provisioning (ZTP)
:ztp: GitOps ZTP
:3no: three-node OpenShift
:3no-caps: Three-node OpenShift
:run-once-operator: Run Once Duration Override Operator
// Web terminal
:web-terminal-op: Web Terminal Operator
:devworkspace-op: DevWorkspace Operator
:secrets-store-driver: Secrets Store CSI driver
:secrets-store-operator: Secrets Store CSI Driver Operator
//AWS STS
:sts-first: Security Token Service (STS)
:sts-full: Security Token Service
:sts-short: STS
//Cloud provider names
//AWS
:aws-first: Amazon Web Services (AWS)
:aws-full: Amazon Web Services
:aws-short: AWS
//GCP
:gcp-first: Google Cloud Platform (GCP)
:gcp-full: Google Cloud Platform
:gcp-short: GCP
//alibaba cloud
:alibaba: Alibaba Cloud
// IBM Cloud VPC
:ibmcloudVPCProductName: IBM Cloud VPC
:ibmcloudVPCRegProductName: IBM(R) Cloud VPC
// IBM Cloud
:ibm-cloud-bm: IBM Cloud Bare Metal (Classic)
:ibm-cloud-bm-reg: IBM Cloud(R) Bare Metal (Classic)
// IBM Power
:ibmpowerProductName: IBM Power
:ibmpowerRegProductName: IBM(R) Power
// IBM zSystems
:ibmzProductName: IBM Z
:ibmzRegProductName: IBM(R) Z
:linuxoneProductName: IBM(R) LinuxONE
//Azure
:azure-full: Microsoft Azure
:azure-short: Azure
//vSphere
:vmw-full: VMware vSphere
:vmw-short: vSphere
//Oracle
:oci-first: Oracle(R) Cloud Infrastructure
:oci: OCI
:ocvs-first: Oracle(R) Cloud VMware Solution (OCVS)
:ocvs: OCVS
:context: installing-mirroring-creating-registry

toc::[]

The _mirror registry for Red Hat OpenShift_ is a small and streamlined container registry that you can use as a target for mirroring the required container images of {product-title} for disconnected installations.

If you already have a container image registry, such as Red Hat Quay, you can skip this section and go straight to xref:../../installing/disconnected_install/installing-mirroring-installation-images.adoc#installation-mirror-repository_installing-mirroring-installation-images[Mirroring the OpenShift Container Platform image repository].

[id="prerequisites_installing-mirroring-creating-registry"]
== Prerequisites

* An {product-title} subscription.
* {op-system-base-full} 8 and 9 with Podman 3.4.2 or later and OpenSSL installed.
* Fully qualified domain name for the Red Hat Quay service, which must resolve through a DNS server.
* Key-based SSH connectivity on the target host. SSH keys are automatically generated for local installs. For remote hosts, you must generate your own SSH keys.
* 2 or more vCPUs.
* 8 GB of RAM.
* About 12 GB for {product-title} {product-version} release images, or about 358 GB for {product-title} {product-version} release images and {product-title} {product-version} Red Hat Operator images. Up to 1 TB per stream or more is suggested.
+
[IMPORTANT]
====
These requirements are based on local testing results with only release images and Operator images. Storage requirements can vary based on your organization's needs. You might require more space, for example, when you mirror multiple z-streams. You can use standard link:https://access.redhat.com/documentation/en-us/red_hat_quay/3[Red Hat Quay functionality] or the proper link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html-single/red_hat_quay_api_guide/index#deletefulltag[API callout] to remove unnecessary images and free up space.
====

:leveloffset: +1

// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-installation-images.adoc

[id="mirror-registry-introduction_{context}"]
= Mirror registry for Red Hat OpenShift introduction

For disconnected deployments of {product-title}, a container registry is required to carry out the installation of the clusters. To run a production-grade registry service on such a cluster, you must create a separate registry deployment to install the first cluster. The _mirror registry for Red Hat OpenShift_ addresses this need and is included in every OpenShift subscription. It is available for download on the link:https://console.redhat.com/openshift/downloads#tool-mirror-registry[OpenShift console *Downloads*] page.

The _mirror registry for Red Hat OpenShift_ allows users to install a small-scale version of Red Hat Quay and its required components using the `mirror-registry` command line interface (CLI) tool. The _mirror registry for Red Hat OpenShift_ is deployed automatically with preconfigured local storage and a local database. It also includes auto-generated user credentials and access permissions with a single set of inputs and no additional configuration choices to get started.

The _mirror registry for Red Hat OpenShift_ provides a pre-determined network configuration and reports deployed component credentials and access URLs upon success. A limited set of optional configuration inputs like fully qualified domain name (FQDN) services, superuser name and password, and custom TLS certificates are also provided. This provides users with a container registry so that they can easily create an offline mirror of all {product-title} release content when running {product-title} in restricted network environments.

Use of the _mirror registry for Red Hat OpenShift_ is optional if another container registry is already available in the install environment.

[id="mirror-registry-limitations_{context}"]
== Mirror registry for Red Hat OpenShift limitations

The following limitations apply to the _mirror registry for Red Hat OpenShift_:

* The _mirror registry for Red Hat OpenShift_ is not a highly-available registry and only local file system storage is supported. It is not intended to replace {quay} or the internal image registry for {product-title}.

* The _mirror registry for Red Hat OpenShift_ is only supported for hosting images that are required to install a disconnected {product-title} cluster, such as Release images or Red Hat Operator images. It uses local storage on your {op-system-base-full} machine, and storage supported by {op-system-base} is supported by the _mirror registry for Red Hat OpenShift_.

* Support for Red Hat product images that are pushed to the _mirror registry for Red Hat OpenShift_ for bootstrapping purposes are covered by valid subscriptions for each respective product. A list of exceptions to further enable the bootstrap experience can be found on the link:https://www.redhat.com/en/resources/self-managed-openshift-sizing-subscription-guide[Self-managed Red Hat OpenShift sizing and subscription guide].

* Content built by customers should not be hosted by the _mirror registry for Red Hat OpenShift_.

* Using the _mirror registry for Red Hat OpenShift_ with more than one cluster is discouraged because multiple clusters can create a single point of failure when updating your cluster fleet. It is advised to leverage the _mirror registry for Red Hat OpenShift_ to install a cluster that can host a production-grade, highly-available registry such as {quay}, which can serve {product-title} content to other clusters.

:leveloffset!:
:leveloffset: +1

// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-installation-images.adoc

:_mod-docs-content-type: PROCEDURE
[id="mirror-registry-localhost_{context}"]
= Mirroring on a local host with mirror registry for Red Hat OpenShift

This procedure explains how to install the _mirror registry for Red Hat OpenShift_ on a local host using the `mirror-registry` installer tool. By doing so, users can create a local host registry running on port 443 for the purpose of storing a mirror of {product-title} images.

[NOTE]
====
Installing the _mirror registry for Red Hat OpenShift_ using the `mirror-registry` CLI tool makes several changes to your machine. After installation, a `$HOME/quay-install` directory is created, which has installation files, local storage, and the configuration bundle. Trusted SSH keys are generated in case the deployment target is the local host, and systemd files on the host machine are set up to ensure that container runtimes are persistent. Additionally, an initial user named `init` is created with an automatically generated password. All access credentials are printed at the end of the install routine.
====

.Procedure

. Download the `mirror-registry.tar.gz` package for the latest version of the _mirror registry for Red Hat OpenShift_ found on the link:https://console.redhat.com/openshift/downloads#tool-mirror-registry[OpenShift console *Downloads*] page.

. Install the _mirror registry for Red Hat OpenShift_ on your local host with your current user account by using the `mirror-registry` tool. For a full list of available flags, see "mirror registry for Red Hat OpenShift flags".
+
[source,terminal]
----
$ ./mirror-registry install \
  --quayHostname <host_example_com> \
  --quayRoot <example_directory_name>
----

. Use the user name and password generated during installation to log into the registry by running the following command:
+
[source,terminal]
----
$ podman login -u init \
  -p <password> \
  <host_example_com>:8443> \
  --tls-verify=false <1>
----
<1> You can avoid running `--tls-verify=false` by configuring your system to trust the generated rootCA certificates. See "Using SSL to protect connections to Red Hat Quay" and "Configuring the system to trust the certificate authority" for more information.
+
[NOTE]
====
You can also log in by accessing the UI at `\https://<host.example.com>:8443` after installation.
====

. You can mirror {product-title} images after logging in. Depending on your needs, see either the "Mirroring the {product-title} image repository" or the "Mirroring Operator catalogs for use with disconnected clusters" sections of this document.
+
[NOTE]
====
If there are issues with images stored by the _mirror registry for Red Hat OpenShift_ due to storage layer problems, you can remirror the {product-title} images, or reinstall mirror registry on more stable storage.
====

:leveloffset!:
:leveloffset: +1

// module included in the following assembly:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

:_mod-docs-content-type: PROCEDURE
[id="mirror-registry-localhost-update_{context}"]
= Updating mirror registry for Red Hat OpenShift from a local host

This procedure explains how to update the _mirror registry for Red Hat OpenShift_ from a local host using the `upgrade` command. Updating to the latest version ensures new features, bug fixes, and security vulnerability fixes.

[IMPORTANT]
====
When updating, there is intermittent downtime of your mirror registry, as it is restarted during the update process.
====

.Prerequisites

* You have installed the _mirror registry for Red Hat OpenShift_ on a local host.

.Procedure

* If you are upgrading the _mirror registry for Red Hat OpenShift_ from 1.2.z -> 1.3.0, and your installation directory is the default at `/etc/quay-install`, you can enter the following command:
+
[source,terminal]
----
$ sudo ./mirror-registry upgrade -v
----
+
[NOTE]
====
* _mirror registry for Red Hat OpenShift_ migrates Podman volumes for Quay storage, Postgres data, and `/etc/quay-install` data to the new `$HOME/quay-install` location. This allows you to use _mirror registry for Red Hat OpenShift_ without the `--quayRoot` flag during future upgrades.

* Users who upgrade _mirror registry for Red Hat OpenShift_ with the `./mirror-registry upgrade -v` flag must include the same credentials used when creating their mirror registry. For example, if you installed the _mirror registry for Red Hat OpenShift_ with `--quayHostname <host_example_com>` and `--quayRoot <example_directory_name>`, you must include that string to properly upgrade the mirror registry.
====

* If you are upgrading the _mirror registry for Red Hat OpenShift_ from 1.2.z -> 1.3.0 and you used a specified directory in your 1.2.z deployment, you must pass in the new `--pgStorage`and `--quayStorage` flags. For example:
+
[source,terminal]
----
$ sudo ./mirror-registry upgrade --quayHostname <host_example_com> --quayRoot <example_directory_name> --pgStorage <example_directory_name>/pg-data --quayStorage <example_directory_name>/quay-storage -v
----


:leveloffset!:
:leveloffset: +1

// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

:_mod-docs-content-type: PROCEDURE
[id="mirror-registry-remote_{context}"]
= Mirroring on a remote host with mirror registry for Red Hat OpenShift

This procedure explains how to install the _mirror registry for Red Hat OpenShift_ on a remote host using the `mirror-registry` tool. By doing so, users can create a registry to hold a mirror of {product-title} images.

[NOTE]
====
Installing the _mirror registry for Red Hat OpenShift_ using the `mirror-registry` CLI tool makes several changes to your machine. After installation, a `$HOME/quay-install` directory is created, which has installation files, local storage, and the configuration bundle. Trusted SSH keys are generated in case the deployment target is the local host, and systemd files on the host machine are set up to ensure that container runtimes are persistent. Additionally, an initial user named `init` is created with an automatically generated password. All access credentials are printed at the end of the install routine.
====

.Procedure

. Download the `mirror-registry.tar.gz` package for the latest version of the _mirror registry for Red Hat OpenShift_ found on the link:https://console.redhat.com/openshift/downloads#tool-mirror-registry[OpenShift console *Downloads*] page.

. Install the _mirror registry for Red Hat OpenShift_ on your local host with your current user account by using the `mirror-registry` tool. For a full list of available flags, see "mirror registry for Red Hat OpenShift flags".
+
[source,terminal]
----
$ ./mirror-registry install -v \
  --targetHostname <host_example_com> \
  --targetUsername <example_user> \
  -k ~/.ssh/my_ssh_key \
  --quayHostname <host_example_com> \
  --quayRoot <example_directory_name>
----

. Use the user name and password generated during installation to log into the mirror registry by running the following command:
+
[source,terminal]
----
$ podman login -u init \
  -p <password> \
  <host_example_com>:8443> \
  --tls-verify=false <1>
----
<1> You can avoid running `--tls-verify=false` by configuring your system to trust the generated rootCA certificates. See "Using SSL to protect connections to Red Hat Quay" and "Configuring the system to trust the certificate authority" for more information.
+
[NOTE]
====
You can also log in by accessing the UI at `\https://<host.example.com>:8443` after installation.
====

. You can mirror {product-title} images after logging in. Depending on your needs, see either the "Mirroring the OpenShift Container Platform image repository" or the "Mirroring Operator catalogs for use with disconnected clusters" sections of this document.
+
[NOTE]
====
If there are issues with images stored by the _mirror registry for Red Hat OpenShift_ due to storage layer problems, you can remirror the {product-title} images, or reinstall mirror registry on more stable storage.
====

:leveloffset!:
:leveloffset: +1

// module included in the following assembly:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

:_mod-docs-content-type: PROCEDURE
[id="mirror-registry-remote-host-update_{context}"]
= Updating mirror registry for Red Hat OpenShift from a remote host

This procedure explains how to update the _mirror registry for Red Hat OpenShift_ from a remote host using the `upgrade` command. Updating to the latest version ensures bug fixes and security vulnerability fixes.

[IMPORTANT]
====
When updating, there is intermittent downtime of your mirror registry, as it is restarted during the update process.
====

.Prerequisites

* You have installed the _mirror registry for Red Hat OpenShift_ on a remote host.

.Procedure

* To upgrade the _mirror registry for Red Hat OpenShift_ from a remote host, enter the following command:
+
[source,terminal]
----
$ ./mirror-registry upgrade -v --targetHostname <remote_host_url> --targetUsername <user_name> -k ~/.ssh/my_ssh_key
----
+
[NOTE]
====
Users who upgrade the _mirror registry for Red Hat OpenShift_ with the `./mirror-registry upgrade -v` flag must include the same credentials used when creating their mirror registry. For example, if you installed the _mirror registry for Red Hat OpenShift_ with `--quayHostname <host_example_com>` and `--quayRoot <example_directory_name>`, you must include that string to properly upgrade the mirror registry.
====

:leveloffset!:
:leveloffset: +1

// module included in the following assembly:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

:_mod-docs-content-type: PROCEDURE
[id="mirror-registry-ssl-cert-replace_{context}"]
= Replacing mirror registry for Red Hat OpenShift SSL/TLS certificates

In some cases, you might want to update your SSL/TLS certificates for the _mirror registry for Red Hat OpenShift_. This is useful in the following scenarios:

* If you are replacing the current _mirror registry for Red Hat OpenShift_ certificate.
* If you are using the same certificate as the previous _mirror registry for Red Hat OpenShift_ installation.
* If you are periodically updating the _mirror registry for Red Hat OpenShift_ certificate.

Use the following procedure to replace _mirror registry for Red Hat OpenShift_ SSL/TLS certificates.

.Prerequisites

* You have downloaded the `./mirror-registry` binary from the link:https://console.redhat.com/openshift/downloads#tool-mirror-registry[OpenShift console *Downloads*] page.

.Procedure

. Enter the following command to install the _mirror registry for Red Hat OpenShift_:
+
[source,terminal]
----
$ ./mirror-registry install \
--quayHostname <host_example_com> \
--quayRoot <example_directory_name>
----
+
This installs the _mirror registry for Red Hat OpenShift_ to the `$HOME/quay-install` directory.

. Prepare a new certificate authority (CA) bundle and generate new `ssl.key` and `ssl.crt` key files. For more information, see link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html-single/deploy_red_hat_quay_for_proof-of-concept_non-production_purposes/index#introduction-using-ssl[Using SSL/TLS].

. Assign `/$HOME/quay-install` an environment variable, for example, `QUAY`, by entering the following command:
+
[source,terminal]
----
$ export QUAY=/$HOME/quay-install
----

. Copy the new `ssl.crt` file to the `/$HOME/quay-install` directory by entering the following command:
+
[source,terminal]
----
$ cp ~/ssl.crt $QUAY/quay-config
----

. Copy the new `ssl.key` file to the `/$HOME/quay-install` directory by entering the following command:
+
[source,terminal]
----
$ cp ~/ssl.key $QUAY/quay-config
----

. Restart the `quay-app` application pod by entering the following command:
+
[source,terminal]
----
$ systemctl restart quay-app
----

:leveloffset!:
:leveloffset: +1

// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

[id="uninstalling-mirror-registry_{context}"]
= Uninstalling the mirror registry for Red Hat OpenShift

* You can uninstall the _mirror registry for Red Hat OpenShift_ from your local host by running the following command:
+
[source,terminal]
----
$ ./mirror-registry uninstall -v \
  --quayRoot <example_directory_name>
----
+
[NOTE]
====
* Deleting the _mirror registry for Red Hat OpenShift_ will prompt the user before deletion. You can use `--autoApprove` to skip this prompt.
* Users who install the _mirror registry for Red Hat OpenShift_ with the `--quayRoot` flag must include the `--quayRoot` flag when uninstalling. For example, if you installed the _mirror registry for Red Hat OpenShift_ with `--quayRoot example_directory_name`, you must include that string to properly uninstall the mirror registry.
====

:leveloffset!:
:leveloffset: +1

// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

[id="mirror-registry-flags_{context}"]
= Mirror registry for Red Hat OpenShift flags

The following flags are available for the _mirror registry for Red Hat OpenShift_:

[options="header",cols="1,3"]
|===
| Flags | Description
| `--autoApprove` | A boolean value that disables interactive prompts. If set to `true`, the `quayRoot` directory is automatically deleted when uninstalling the mirror registry. Defaults to `false` if left unspecified.
| `--initPassword` | The password of the init user created during Quay installation. Must be at least eight characters and contain no whitespace.
|`--initUser string` | Shows the username of the initial user. Defaults to `init` if left unspecified.
| `--no-color`, `-c` | Allows users to disable color sequences and propagate that to Ansible when running install, uninstall, and upgrade commands.
| `--pgStorage` | The folder where Postgres persistent storage data is saved. Defaults to the `pg-storage` Podman volume. Root privileges are required to uninstall.
| `--quayHostname` | The fully-qualified domain name of the mirror registry that clients will use to contact the registry. Equivalent to `SERVER_HOSTNAME` in the Quay `config.yaml`. Must resolve by DNS. Defaults to `<targetHostname>:8443` if left unspecified. ^[1]^
| `--quayStorage` | The folder where Quay persistent storage data is saved. Defaults to the `quay-storage` Podman volume. Root privileges are required to uninstall.
| `--quayRoot`, `-r` | The directory where container image layer and configuration data is saved, including `rootCA.key`, `rootCA.pem`, and `rootCA.srl` certificates. Defaults to `$HOME/quay-install` if left unspecified.
| `--ssh-key`, `-k` | The path of your SSH identity key. Defaults to `~/.ssh/quay_installer` if left unspecified.
| `--sslCert` | The path to the SSL/TLS public key / certificate. Defaults to `{quayRoot}/quay-config` and is auto-generated if left unspecified.
| `--sslCheckSkip` | Skips the check for the certificate hostname against the `SERVER_HOSTNAME` in the `config.yaml` file. ^[2]^
| `--sslKey` | The path to the SSL/TLS private key used for HTTPS communication. Defaults to `{quayRoot}/quay-config` and is auto-generated if left unspecified.
| `--targetHostname`, `-H` | The hostname of the target you want to install Quay to. Defaults to `$HOST`, for example, a local host, if left unspecified.
| `--targetUsername`, `-u` | The user on the target host which will be used for SSH. Defaults to `$USER`, for example, the current user if left unspecified.
| `--verbose`, `-v` | Shows debug logs and Ansible playbook outputs.
| `--version` | Shows the version for the _mirror registry for Red Hat OpenShift_.
|===
[.small]
1. `--quayHostname` must be modified if the public DNS name of your system is different from the local hostname. Additionally, the `--quayHostname` flag does not support installation with an IP address. Installation with a hostname is required.
2. `--sslCheckSkip` is used in cases when the mirror registry is set behind a proxy and the exposed hostname is different from the internal Quay hostname. It can also be used when users do not want the certificates to be validated against the provided Quay hostname during installation.

:leveloffset!:
:leveloffset: +1

// Module included in the following assemblies:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

[id="mirror-registry-release-notes_{context}"]
= Mirror registry for Red Hat OpenShift release notes

The _mirror registry for Red Hat OpenShift_ is a small and streamlined container registry that you can use as a target for mirroring the required container images of {product-title} for disconnected installations.

These release notes track the development of the _mirror registry for Red Hat OpenShift_ in {product-title}.

For an overview of the _mirror registry for Red Hat OpenShift_, see xref:../../installing/disconnected_install/installing-mirroring-creating-registry.adoc#mirror-registry-flags_installing-mirroring-creating-registry[Creating a mirror registry with mirror registry for Red Hat OpenShift].

[id="mirror-registry-for-openshift-1-3-9"]
== Mirror registry for Red Hat OpenShift 1.3.9

Issued: 2023-09-19

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.12.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:5241[RHBA-2023:5241 - mirror registry for Red Hat OpenShift 1.3.9]

[id="mirror-registry-for-openshift-1-3-8"]
== Mirror registry for Red Hat OpenShift 1.3.8

Issued: 2023-08-16

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.11.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:4622[RHBA-2023:4622 - mirror registry for Red Hat OpenShift 1.3.8]

[id="mirror-registry-for-openshift-1-3-7"]
== Mirror registry for Red Hat OpenShift 1.3.7

Issued: 2023-07-19

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.10.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:4087[RHBA-2023:4087 - mirror registry for Red Hat OpenShift 1.3.7]

[id="mirror-registry-for-openshift-1-3-6"]
== Mirror registry for Red Hat OpenShift 1.3.6

Issued: 2023-05-30

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.8.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:3302[RHBA-2023:3302 - mirror registry for Red Hat OpenShift 1.3.6]

[id="mirror-registry-for-openshift-1-3-5"]
== Mirror registry for Red Hat OpenShift 1.3.5

Issued: 2023-05-18

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.7.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:3225[RHBA-2023:3225 - mirror registry for Red Hat OpenShift 1.3.5]

[id="mirror-registry-for-openshift-1-3-4"]
== Mirror registry for Red Hat OpenShift 1.3.4

Issued: 2023-04-25

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.6.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:1914[RHBA-2023:1914 - mirror registry for Red Hat OpenShift 1.3.4]

[id="mirror-registry-for-openshift-1-3-3"]
== Mirror registry for Red Hat OpenShift 1.3.3

Issued: 2023-04-05

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.5.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:1528[RHBA-2023:1528 - mirror registry for Red Hat OpenShift 1.3.3]

[id="mirror-registry-for-openshift-1-3-2"]
== Mirror registry for Red Hat OpenShift 1.3.2

Issued: 2023-03-21

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.4.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:1376[RHBA-2023:1376 - mirror registry for Red Hat OpenShift 1.3.2]

[id="mirror-registry-for-openshift-1-3-1"]
== Mirror registry for Red Hat OpenShift 1.3.1

Issued: 2023-03-7

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.3.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:1086[RHBA-2023:1086 - mirror registry for Red Hat OpenShift 1.3.1]

[id="mirror-registry-for-openshift-1-3-0"]
== Mirror registry for Red Hat OpenShift 1.3.0

Issued: 2023-02-20

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.8.1.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2023:0558[RHBA-2023:0558 - mirror registry for Red Hat OpenShift 1.3.0]

=== New features

* _Mirror registry for Red Hat OpenShift_ is now supported on {op-system-base-full} 9 installations.

* IPv6 support is now available on _mirror registry for Red Hat OpenShift_ local host installations.
+
IPv6 is currently unsupported on _mirror registry for Red Hat OpenShift_ remote host installations.

* A new feature flag, `--quayStorage`, has been added. With this flag, users with root privileges can manually set the location of their Quay persistent storage.

* A new feature flag, `--pgStorage`, has been added. With this flag, users with root privileges can manually set the location of their Postgres persistent storage.

* Previously, users were required to have root privileges (`sudo`) to install _mirror registry for Red Hat OpenShift_. With this update, `sudo` is no longer required to install _mirror registry for Red Hat OpenShift_.
+
When _mirror registry for Red Hat OpenShift_ was installed with `sudo`, an `/etc/quay-install` directory that contained installation files, local storage, and the configuration bundle was created. With the removal of the `sudo` requirement, installation files and the configuration bundle are now installed to `$HOME/quay-install`. Local storage, for example Postgres and Quay, are now stored in named volumes automatically created by Podman.
+
To override the default directories that these files are stored in, you can use the command line arguments for _mirror registry for Red Hat OpenShift_. For more information about _mirror registry for Red Hat OpenShift_ command line arguments, see "_Mirror registry for Red Hat OpenShift_ flags".

=== Bug fixes

* Previously, the following error could be returned when attempting to uninstall _mirror registry for Red Hat OpenShift_: `["Error: no container with name or ID \"quay-postgres\" found: no such container"], "stdout": "", "stdout_lines": []***`. With this update, the order that _mirror registry for Red Hat OpenShift_ services are stopped and uninstalled have been changed so that the error no longer occurs when uninstalling _mirror registry for Red Hat OpenShift_. For more information, see link:https://issues.redhat.com/browse/PROJQUAY-4629[*PROJQUAY-4629*].


[id="mirror-registry-for-openshift-1-2-9"]
== Mirror registry for Red Hat OpenShift 1.2.9

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.10.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:7369[RHBA-2022:7369 - mirror registry for Red Hat OpenShift 1.2.9]


[id="mirror-registry-for-openshift-1-2-8"]
== Mirror registry for Red Hat OpenShift 1.2.8

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.9.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:7065[RHBA-2022:7065 - mirror registry for Red Hat OpenShift 1.2.8]


[id="mirror-registry-for-openshift-1-2-7"]
== Mirror registry for Red Hat OpenShift 1.2.7

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.8.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:6500[RHBA-2022:6500 - mirror registry for Red Hat OpenShift 1.2.7]

=== Bug fixes

* Previously, `getFQDN()` relied on the fully-qualified domain name (FQDN) library to determine its FQDN, and the FQDN library tried to read the `/etc/hosts` folder directly. Consequently, on some {op-system-first} installations with uncommon DNS configurations, the FQDN library would fail to install and abort the installation. With this update, _mirror registry for Red Hat OpenShift_ uses `hostname` to determine the FQDN. As a result, the FQDN library does not fail to install. (link:https://issues.redhat.com/browse/PROJQUAY-4139[*PROJQUAY-4139*])

[id="mirror-registry-for-openshift-1-2-6"]
== Mirror registry for Red Hat OpenShift 1.2.6

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.7.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:6278[RHBA-2022:6278 - mirror registry for Red Hat OpenShift 1.2.6]

=== New features

A new feature flag, `--no-color` (`-c`) has been added. This feature flag allows users to disable color sequences and propagate that to Ansible when running install, uninstall, and upgrade commands.

[id="mirror-registry-for-openshift-1-2-5"]
== Mirror registry for Red Hat OpenShift 1.2.5

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.6.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:6071[RHBA-2022:6071 - mirror registry for Red Hat OpenShift 1.2.5]

[id="mirror-registry-for-openshift-1-2-4"]
== Mirror registry for Red Hat OpenShift 1.2.4

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.5.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:5884[RHBA-2022:5884 - mirror registry for Red Hat OpenShift 1.2.4]

[id="mirror-registry-for-openshift-1-2-3"]
== Mirror registry for Red Hat OpenShift 1.2.3

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.4.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:5649[RHBA-2022:5649 - mirror registry for Red Hat OpenShift 1.2.3]

[id="mirror-registry-for-openshift-1-2-2"]
== Mirror registry for Red Hat OpenShift 1.2.2

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.3.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:5501[RHBA-2022:5501 - mirror registry for Red Hat OpenShift 1.2.2]


[id="mirror-registry-for-openshift-1-2-1"]
== Mirror registry for Red Hat OpenShift 1.2.1

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.2.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:5200[RHBA-2022:4986 - mirror registry for Red Hat OpenShift 1.2.1]

[id="mirror-registry-for-openshift-1-2-0"]
== Mirror registry for Red Hat OpenShift 1.2.0

_Mirror registry for Red Hat OpenShift_ is now available with Red Hat Quay 3.7.1.

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:4986[RHBA-2022:4986 - mirror registry for Red Hat OpenShift 1.2.0]


[id="mirror-registry-1-2-0-bug-fixes"]
=== Bug fixes

* Previously, all components and workers running inside of the Quay pod Operator had log levels set to `DEBUG`. As a result, large traffic logs were created that consumed unnecessary space. With this update, log levels are set to `WARN` by default, which reduces traffic information while emphasizing problem scenarios. (link:https://issues.redhat.com/browse/PROJQUAY-3504[*PROJQUAY-3504*])

[id="mirror-registry-for-openshift-1-1-0"]
== Mirror registry for Red Hat OpenShift 1.1.0

The following advisory is available for the _mirror registry for Red Hat OpenShift_:

* link:https://access.redhat.com/errata/RHBA-2022:0956[RHBA-2022:0956 - mirror registry for Red Hat OpenShift 1.1.0]

[id="mirror-registry-1-2-0-new-features"]
=== New features

* A new command, `mirror-registry upgrade` has been added. This command upgrades all container images without interfering with configurations or data.
+
[NOTE]
====
If `quayRoot` was previously set to something other than default, it must be passed into the upgrade command.
====

[id="mirror-registry-1-1-0-bug-fixes"]
=== Bug fixes

* Previously, the absence of `quayHostname` or `targetHostname` did not default to the local hostname. With this update, `quayHostname` and `targetHostname` now default to the local hostname if they are missing. (link:https://issues.redhat.com/browse/PROJQUAY-3079[*PROJQUAY-3079*])

* Previously, the command `./mirror-registry --version` returned an `unknown flag` error. Now, running `./mirror-registry --version` returns the current version of the _mirror registry for Red Hat OpenShift_. (link:https://issues.redhat.com/browse/PROJQUAY-3086[*PROJQUAY-3086*])

* Previously, users could not set a password during installation, for example, when running `./mirror-registry install --initUser <user_name> --initPassword <password> --verbose`. With this update, users can set a password during installation. (link:https://issues.redhat.com/browse/PROJQUAY-3149[*PROJQUAY-3149*])

* Previously, the _mirror registry for Red Hat OpenShift_ did not recreate pods if they were destroyed. Now, pods are recreated if they are destroyed. (link:https://issues.redhat.com/browse/PROJQUAY-3261[*PROJQUAY-3261*])

:leveloffset!:
:leveloffset: +1

// module included in the following assembly:
//
// * installing/disconnected_install/installing-mirroring-creating-registry.adoc

:_mod-docs-content-type: PROCEDURE
[id="mirror-registry-troubleshooting_{context}"]
= Troubleshooting mirror registry for Red Hat OpenShift

To assist in troubleshooting _mirror registry for Red Hat OpenShift_, you can gather logs of systemd services installed by the mirror registry. The following services are installed:

* quay-app.service
* quay-postgres.service
* quay-redis.service
* quay-pod.service

.Prerequisites

* You have installed _mirror registry for Red Hat OpenShift_.

.Procedure

* If you installed _mirror registry for Red Hat OpenShift_ with root privileges, you can get the status information of its systemd services by entering the following command:
+
[source,terminal]
----
$ sudo systemctl status <service>
----

* If you installed _mirror registry for Red Hat OpenShift_ as a standard user, you can get the status information of its systemd services by entering the following command:
+
[source,terminal]
----
$ systemctl --user status <service>
----

:leveloffset!:

[role="_additional-resources"]
.Additional resources

* link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/manage_red_hat_quay/using-ssl-to-protect-quay[Using SSL to protect connections to Red Hat Quay]

* link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/manage_red_hat_quay/using-ssl-to-protect-quay#configuring_the_system_to_trust_the_certificate_authority[Configuring the system to trust the certificate authority]

* xref:../../installing/disconnected_install/installing-mirroring-installation-images.adoc#installation-mirror-repository_installing-mirroring-installation-images[Mirroring the OpenShift Container Platform image repository]

* xref:../../installing/disconnected_install/installing-mirroring-installation-images.adoc#olm-mirror-catalog_installing-mirroring-installation-images[Mirroring Operator catalogs for use with disconnected clusters]

//# includes=_attributes/common-attributes,modules/mirror-registry-introduction,modules/mirror-registry-localhost,modules/mirror-registry-localhost-update,modules/mirror-registry-remote,modules/mirror-registry-remote-host-update,modules/mirror-registry-ssl-cert-replace,modules/mirror-registry-uninstall,modules/mirror-registry-flags,modules/mirror-registry-release-notes,modules/mirror-registry-troubleshooting
