:_mod-docs-content-type: ASSEMBLY
[id="replacing-unhealthy-etcd-member"]
= Replacing an unhealthy etcd member
include::../includes/common-attributes.adoc[]
:context: replacing-unhealthy-etcd-member


This document describes the process to replace a single unhealthy etcd member.

This process depends on whether the etcd member is unhealthy because the machine is not running or the node is not ready, or whether it is unhealthy because the etcd pod is crashlooping.

[NOTE]
====
If you have lost the majority of your control plane hosts, follow the disaster recovery procedure to xref:dr-restoring-cluster-state[restore to a previous cluster state] instead of this procedure.

If the control plane certificates are not valid on the member being replaced, then you must follow the procedure to xref:dr-recovering-expired-certs[recover from expired control plane certificates] instead of this procedure.

If a control plane node is lost and a new one is created, the etcd cluster Operator handles generating the new TLS certificates and adding the node as an etcd member.
====

== Prerequisites

* Take an xref:backing-up-etcd-data_backup-etcd[etcd backup] prior to replacing an unhealthy etcd member.

// Identifying an unhealthy etcd member
include::../includes/restore-identify-unhealthy-etcd-member.adoc[leveloffset=+1]

// Determining the state of the unhealthy etcd member
include::../includes/restore-determine-state-etcd-member.adoc[leveloffset=+1]

== Replacing the unhealthy etcd member

Depending on the state of your unhealthy etcd member, use one of the following procedures:

* xref:restore-replace-stopped-etcd-member_replacing-unhealthy-etcd-member[Replacing an unhealthy etcd member whose machine is not running or whose node is not ready]
* xref:restore-replace-crashlooping-etcd-member_replacing-unhealthy-etcd-member[Replacing an unhealthy etcd member whose etcd pod is crashlooping]
* xref:restore-replace-stopped-baremetal-etcd-member_replacing-unhealthy-etcd-member[Replacing an unhealthy stopped baremetal etcd member]

// Replacing an unhealthy etcd member whose machine is not running or whose node is not ready
include::../includes/restore-replace-stopped-etcd-member.adoc[leveloffset=+2]
[role="_additional-resources"]
.Additional resources
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/machine_management/#cpmso-ts-etcd-degraded_cpmso-troubleshooting[Recovering a degraded etcd Operator]

// Replacing an unhealthy etcd member whose etcd pod is crashlooping
include::../includes/restore-replace-crashlooping-etcd-member.adoc[leveloffset=+2]

// Replacing an unhealthy baremetal stopped etcd member
include::../includes/restore-replace-stopped-baremetal-etcd-member.adoc[leveloffset=+2]

[role="_additional-resources"]
[id="additional-resources_replacing-unhealthy-etcd-member"]
== Additional resources
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/machine_management/#machine-lifecycle-hook-deletion-etcd_deleting-machine[Quorum protection with machine lifecycle hooks]