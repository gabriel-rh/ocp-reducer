:_mod-docs-content-type: ASSEMBLY
[id="installing-vsphere-installer-provisioned-network-customizations"]
= Installing a cluster on vSphere with network customizations
include::../../includes/common-attributes.adoc[]
:context: installing-vsphere-installer-provisioned-network-customizations


In {product-title} version {product-version}, you can install a cluster on your
VMware vSphere instance by using installer-provisioned infrastructure with customized network configuration options. By customizing your network configuration, your cluster can coexist with existing IP address allocations in your environment and integrate with existing MTU and VXLAN configurations. To customize the installation, you modify parameters in the `install-config.yaml` file before you install the cluster.

You must set most of the network configuration parameters during installation, and you can modify only `kubeProxy` configuration parameters in a running cluster.

include::../../includes/vcenter-support.adoc[]

== Prerequisites

* You have completed the tasks in xref:ipi-vsphere-preparing-to-install[Preparing to install a cluster using installer-provisioned infrastructure].
* You reviewed your VMware platform licenses. Red{nbsp}Hat does not place any restrictions on your VMware licenses, but some VMware infrastructure components require licensing.
* You reviewed details about the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/architecture/#architecture-installation[{product-title} installation and update] processes.
* You read the documentation on xref:installing-preparing[selecting a cluster installation method and preparing it for users].
* You provisioned link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/storage/#understanding-persistent-storage[persistent storage] for your cluster. To deploy a private image registry, your storage must provide
`ReadWriteMany` access modes.
* The {product-title} installer requires access to port 443 on the vCenter and ESXi hosts. You verified that port 443 is accessible.
* If you use a firewall, confirm with the administrator that port 443 is accessible. Control plane nodes must be able to reach vCenter and ESXi hosts on port 443 for the installation to succeed.
* If you use a firewall, you xref:configuring-firewall[configured it to allow the sites] that your cluster requires access to.
+
[NOTE]
====
Be sure to also review this site list if you are configuring a proxy.
====

include::../../includes/cluster-entitlements.adoc[leveloffset=+1]

include::../../includes/installation-vsphere-regions-zones.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:installation-configuration-parameters-additional-vsphere_installation-config-parameters-vsphere[Additional VMware vSphere configuration parameters]

* xref:deprecated-parameters-vsphere_installation-config-parameters-vsphere[Deprecated VMware vSphere configuration parameters]

* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/storage/#persistent-storage-csi-migration-sc-vsphere_persistent-storage-csi-migration[vSphere automatic migration]

* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/storage/#persistent-storage-csi-vsphere-top-aware_persistent-storage-csi-vsphere[VMware vSphere CSI Driver Operator]

include::../../includes/installation-initializing.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources
* xref:installation-config-parameters-vsphere[Installation configuration parameters]

include::../../includes/installation-installer-provisioned-vsphere-config-yaml.adoc[leveloffset=+2]

include::../../includes/installation-configure-proxy.adoc[leveloffset=+2]

include::../../includes/ipi-install-modifying-install-config-for-dual-stack-network.adoc[leveloffset=+2]

include::../../includes/configuring-vsphere-regions-zones.adoc[leveloffset=+2]

// begin network customization
include::../../includes/nw-network-config.adoc[leveloffset=+1]
include::../../includes/nw-modifying-operator-install-config.adoc[leveloffset=+1]
include::../../includes/nw-operator-cr.adoc[leveloffset=+1]
// end network customization

include::../../includes/installation-launching-installer.adoc[leveloffset=+1]

include::../../includes/cli-logging-in-kubeadmin.adoc[leveloffset=+1]

[id="installing-vsphere-installer-provisioned-network-customizations-registry"]
== Creating registry storage
After you install the cluster, you must create storage for the registry Operator.

include::../../includes/registry-removed.adoc[leveloffset=+2]

include::../../includes/installation-registry-storage-config.adoc[leveloffset=+2]

include::../../includes/registry-configuring-storage-vsphere.adoc[leveloffset=+3]

include::../../includes/installation-registry-storage-block-recreate-rollout.adoc[leveloffset=+3]

For instructions about configuring registry storage so that it references the correct PVC, see link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/registry/#registry-configuring-storage-vsphere_configuring-registry-storage-vsphere[Configuring the registry for vSphere].

include::../../includes/cluster-telemetry.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* See link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/support/#about-remote-health-monitoring[About remote health monitoring] for more information about the Telemetry service

include::../../includes/nw-osp-configuring-external-load-balancer.adoc[leveloffset=+1]
include::../../includes/ipi-install-configure-network-components-to-run-on-the-control-plane.adoc[leveloffset=+1]

== Next steps

* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/postinstallation_configuration/#available_cluster_customizations[Customize your cluster].
* If necessary, you can
link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/support/#opting-out-remote-health-reporting_opting-out-remote-health-reporting[opt out of remote health reporting].
* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html-single/registry/#configuring-registry-storage-vsphere[Set up your registry and configure registry storage].
* Optional: xref:vsphere-problem-detector-viewing-events_vsphere-problem-detector[View the events from the vSphere Problem Detector Operator] to determine if the cluster has permission or storage configuration issues.
